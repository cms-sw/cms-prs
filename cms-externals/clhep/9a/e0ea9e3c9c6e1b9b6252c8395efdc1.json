{"additions": 465, "auther_ref": "enable_cxx_modules", "auther_sha": "33f7866e81e8eb1129b49cdb565ea6fddeb5f9f0", "author": "vgvassilev", "body": "The C++ modules feature as described in https://clang.llvm.org/docs/Modules.html allow producing a binary header representation to avoid redundant header reparsing.\r\n\r\nThis feature is used in ROOT's dictionary system since ROOT v6.20: https://github.com/root-project/root/blob/master/README/README.CXXMODULES.md\r\n\r\nCMSSW and other experiment migrate their dictionaries to use the provided by ROOT C++ modules support: https://github.com/cms-sw/cmssw/issues/15248\r\n\r\nDictionaries which transiently include clhep can be further optimized by building a separate module for CLHEP which this MR aims for.\r\n\r\nThe current patch introduces a module.modulemap file containing a mapping between a binary artifact (a module or a pcm file) and a set of header files. The C++ modules are more picky on translation unit encapsulation and thus require all headers which a translation unit uses to be included. In addition to the missing include we outline a few virtual destructors to avoid pollution of .o files with weak virtual tables.\r\n\r\nThis patch enables builds with modules via rootcling/genreflex/rootcint and enables compile-time module builds if configured like: cmake -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_CXX_FLAGS=\"-fmodules -Xclang -fmodules-local-submodule-visibility\" ../clhep/\r\n\r\nThe module.modulemap file is easy to maintain as it globs for the well-behaved header files and enumerates already the ones needed special treatment.\r\n\r\nThis is a \"backport\" of https://gitlab.cern.ch/CLHEP/CLHEP/-/merge_requests/3 ", "branch": "cms/modules/v2.4.1.3", "changed_files": 126, "closed_at": "1590403999", "comments": 5, "commits": 1, "created_at": "1590305278", "deletions": 52, "labels": ["comparison-pending", "externals-pending", "orp-pending", "pending-signatures", "tests-pending"], "merge_commit_sha": "721837aeadb7166daa593e51b9b5c6857927aa54", "merged_at": "1590403999", "merged_by": "davidlange6", "number": 6, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Enable C++ modules for CLHEP", "updated_at": "1590404000", "user": "vgvassilev"}
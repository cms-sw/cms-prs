{"additions": 4, "auther_ref": "quoted-args-2", "auther_sha": "00ddee915fade768b232b7d3a19a7bf29fb807ae", "author": "kpedro88", "body": "#3 introduced a bug, because: https://github.com/cms-sw/cmssw-osenv/blob/65ac146792e6d4b7bdd8741f157708344a8a6505/cmssw-env#L50-L52\r\nis not activated when testing the script locally, but is activated when the script is on cvmfs.\r\n\r\nThe `sh -c` construct removed in 311508994dc7da26b783a83645b08139b894327e is necessary to handle these multiple commands (the first argument in the command passed to `singularity exec` has to be an executable, not a builtin). However, restoring this still doesn't fix the problem, because `\"${CMD_TO_RUN[@]}\"` preserves the quoting of the individual array elements; `sh -c` only interprets the first array element as the command, and the rest is dropped. (This preservation of quoting was intentional in #3, but it doesn't do what we want in this case.)\r\n\r\nUsing `printf` to generate a properly quoted string is a bit inelegant, but it's the only method (among many arcane bash quoting techniques) that actually works reliably.\r\n\r\nTo test this in a cvmfs-like setup, I did the following:\r\n```\r\ngit clone git@github.com:kpedro88/cmssw-osenv -b quoted-args-2\r\ncd cmssw-osenv\r\nln -s /cvmfs/cms.cern.ch/cmsset_default.sh ../\r\nln -s /cvmfs/cms.cern.ch/common/cmsos .\r\n./cmssw-env --cmsos cc6 -B $(readlink -f $PWD/..) --pwd $PWD -- echo \"hello world\"\r\n```\r\n(and also reran the test from #3).\r\n\r\n@smuzaffar should we make a unit test file for this script (based on the above), to catch bugs like this in the future?", "branch": "master", "changed_files": 1, "closed_at": "1623953614", "comments": 2, "commits": 1, "created_at": "1623952825", "deletions": 2, "labels": ["externals-pending", "orp-pending", "pending-signatures", "tests-pending"], "merge_commit_sha": "e6638c825f6629cf3d6e85872dd3022090ba174b", "merged_at": "1623953614", "merged_by": "smuzaffar", "number": 4, "release-notes": [], "review_comments": 0, "state": "closed", "title": "fix handling of multiple commands", "updated_at": "1623953614", "user": "kpedro88"}
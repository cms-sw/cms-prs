{"additions": 86, "auther_ref": "split-rpmbuild-step", "auther_sha": "153ec302a2c9804d8248b75b10b4bc35dd46b38f", "author": "cms-sw", "body": "The change proposes to break the rpmbuild part in multiple steps\r\n- prep : Running only the `%prep` part of spec i.e. extracting sources etc.\r\n- build: Running only the `%build` part of spec i.e. `cmake/configure; make -j N`\r\n- install: Running only `%install` part of spec i.e. `make -jN install`\r\n- srpm: To build source RPM\r\n- rpms: To build the final binary RPM\r\n\r\nThis split allows to run more steps in parallel as most of the resources are utilized during the build phase. Spliting the build stages allows to run multiple independent prep/install/srpm/rpms in parallel.\r\n\r\noriginal `rpmbuild -ba` is now broken in to the following steps (`--short-circuit` is need to avoid rpmbuld running previous steps)\r\n- prep: `rpmbuild -bp`\r\n- build: `rpmbuild -bc --short-circuit`\r\n- install: `rpmbuild -bi --short-circuit`\r\n- srpm: `rpmbuild -bs --short-circuit`\r\n- rpms: `rpmbuild -bb` we ca not use `--short-circuit` as in that case rpmbuild builds a packages with `rpmlib(ShortCircuited)` feature which can not be installed. Although we can use `rpm -Uvh --nodeps` to force install such packages but then we lose the capability of dependency checking. Instead we generate a new SPEC without `%prep, %build, %install` section and let rpmbuild package the already built/installed files. \r\n\r\nBreaking `rpmbuild` in multiple steps also allows us to generate a tar.gz package file if needed.", "branch": "V00-34-XX", "changed_files": 2, "comments": 5, "commits": 2, "created_at": "1763546502", "deletions": 38, "labels": ["orp-pending", "pending-signatures", "tests-rejected", "externals-pending", "requires-external"], "number": 226, "release-notes": [], "review_comments": 0, "state": "open", "title": "Break rpmbuild in multiple steps: prep, build, install, packaging", "updated_at": "1763547072", "user": "smuzaffar"}
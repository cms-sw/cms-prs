{"additions": 1, "auther_ref": "fix-multi-build-order", "auther_sha": "11db41b9413013aaec1eaf04c92fc050ca0481bc", "author": "cms-sw", "body": "We have hit a threading related issue where a task which was force done (pending to done) by `buildPackage` was retired by the ` __doRescheduleParallel` . The reason is that while `forceDone` was moving the tasks from `pending` to `done` queue the  ` __doRescheduleParallel` noticed that `build-build-<pkg>` is done and tried to start the `build-install-<pkg>` . This change process the task in reverse order so it marks forceDone in following order\r\n1. build-rpms-pkg\r\n2. build-srpm-pkg\r\n3. build-install-pkg\r\n4. build-build-pkg\r\n\r\nthis way ` __doRescheduleParallel`  will not try to process any of step1-3 as as build-build-pkg is marked forcedone at the end.\r\n\r\n[a]\r\n```\r\n23:46:18 Creating directory /data/cmsbld/jenkins/workspace/build-any-ib/w/BUILD/el8_aarch64_gcc13/external/py3-jax/0.4.30-c4cfbfb81471703b473b3ae8ef025567 if not existing.\r\n23:46:18 ObjectStore: Checking package store for external+py3-jax+0.4.30-c4cfbfb81471703b473b3ae8ef025567.\r\n23:46:18 build-install-external+py3-jax+0.4.30-c4cfbfb81471703b473b3ae8ef025567 not in source list\r\n23:46:18 Traceback (most recent call last):\r\n23:46:18   File \"PKGTOOLS/cmsBuild\", line 5164, in <module>\r\n23:46:18     build(opts, args[1:], PKGFactory)\r\n23:46:18   File \"PKGTOOLS/cmsBuild\", line 4384, in build\r\n23:46:18     buildSpecs(packages)\r\n23:46:18   File \"PKGTOOLS/cmsBuild\", line 4308, in buildSpecs\r\n23:46:18     scheduler.run()\r\n23:46:18   File \"/data/cmsbld/jenkins/workspace/build-any-ib/PKGTOOLS/scheduler.py\", line 79, in run\r\n23:46:18     self.__doNotifications()\r\n23:46:18   File \"/data/cmsbld/jenkins/workspace/build-any-ib/PKGTOOLS/scheduler.py\", line 125, in __doNotifications\r\n23:46:18     self.__doRescheduleParallel()\r\n23:46:18   File \"/data/cmsbld/jenkins/workspace/build-any-ib/PKGTOOLS/scheduler.py\", line 203, in __doRescheduleParallel\r\n23:46:18     transition(taskId, self.pendingJobs, self.runningJobs)\r\n23:46:18   File \"/data/cmsbld/jenkins/workspace/build-any-ib/PKGTOOLS/scheduler.py\", line 20, in transition\r\n23:46:18     raise e\r\n23:46:18   File \"/data/cmsbld/jenkins/workspace/build-any-ib/PKGTOOLS/scheduler.py\", line 17, in transition\r\n23:46:18     fromList.remove(what)\r\n```", "branch": "V00-34-XX", "changed_files": 1, "comments": 3, "commits": 1, "created_at": "1763974826", "deletions": 1, "labels": ["orp-pending", "pending-signatures", "tests-started", "externals-pending", "requires-external"], "number": 227, "release-notes": [], "review_comments": 0, "state": "open", "title": "force done tasks in reverse order to avoid scheduler redo the same", "updated_at": "1763975392", "user": "smuzaffar"}
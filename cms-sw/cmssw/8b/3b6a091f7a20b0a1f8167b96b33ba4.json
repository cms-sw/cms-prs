{"additions": 12, "auther_ref": "fixPrePrefetchSelectionAsync", "auther_sha": "c90b07176490959d3779c9b99e82575abc47d2f2", "author": "makortel", "body": "#### PR description:\r\n\r\nThis PR fixes a bug introduced in https://github.com/cms-sw/cmssw/pull/44767 where a `return` when the worker is not selected was moved inside a lambda passed to `convertException()`. This PR fixes the function to return at the same spot as before if the worker is not selected. (this part fixes the ASAN failures in reported in #44888)\r\n\r\nOther problem was that if `implDoPrePrefetchSelection()` throws an exception, the exception status needs to stored in the `Worker::status_`, and the success task must be destroyed. (this part changes the assertion failures reported in #44887 to exceptions)\r\n\r\nThanks to @Dr15Jones for helping to figure out the cause.\r\n\r\nFixes https://github.com/cms-sw/cmssw/issues/44888\r\nFixes https://github.com/cms-sw/cmssw/issues/44887\r\nResolves https://github.com/cms-sw/framework-team/issues/912\r\n\r\n#### PR validation:\r\n\r\nWorkflow 4.17 succeeded in CMSSW_14_1_ASAN_X_2024-05-01-2300. Workflow 1001.3 properly reports the exceptions.\r\n", "branch": "master", "changed_files": 1, "comments": 29, "commits": 1, "created_at": "1714653500", "deletions": 2, "labels": ["core-approved", "fully-signed", "tests-rejected", "orp-pending", "bug-fix", "urgent", "code-checks-approved"], "milestone": "CMSSW_14_1_X", "number": 44891, "release-notes": [], "review_comments": 0, "state": "open", "title": "Fix exception handling in Worker::prePrefetchSelectionAsync()", "updated_at": "1714736076", "user": "makortel"}
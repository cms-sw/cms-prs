{"additions": 292, "auther_ref": "raw_to_digi_updates_data_check", "auther_sha": "97d35593c12002e4026b6a32404bbb1a090303b8", "author": "CTPPS", "body": "#### PR description:\r\n\r\nThis is an update of PR #42711. I had troubles to rebase it on top of newest CMSSW and found it easier to make a new PR.\r\nThis may also facilitate testing with the last update.\r\n\r\nThis PR is a next step in a way to resolve an issue from https://github.com/cms-sw/cmssw/pull/40765 - Transfer of all PPS detectors' mappings from XML to CondDB.\r\n\r\nIn this PR:\r\n\r\nUpdates of [TotemVFATRawToDigi.cc](https://github.com/CTPPS/cmssw/blob/6105ec09f9adba0ecaa36a6ab1ac23f249a67c6f/EventFilter/CTPPSRawToDigi/plugins/TotemVFATRawToDigi.cc)\r\n\r\nadd use of new TotemAnalysisMaskRcd separated from TotemReadoutRcd and introduced in https://github.com/cms-sw/cmssw/pull/42471;\r\nhandle retrieving objects from records using EventSetup::getHandle()\r\nChanges in [ctppsRawToDigi_cff.py](https://github.com/cms-sw/cmssw/compare/master...CTPPS:cmssw:raw_to_digi_updates#diff-1eb4c964687bc0dbea0102fa7d717cc7f42908aa1979fbc22cde1db187b8e3fa):\r\n\r\nremove imports of XML files containing mappings - now mappings will be taken from a GT\r\nNew config fragment: [ctppsRawToDigi_xml_cff.py](https://github.com/cms-sw/cmssw/compare/master...CTPPS:cmssw:raw_to_digi_updates#diff-ca62e8d0446df10a4cd189d5eabaecbaf40ca005968588089ab54e075954ad6a) which is an old [ctppsRawToDigi_cff.py](https://github.com/cms-sw/cmssw/compare/master...CTPPS:cmssw:raw_to_digi_updates#diff-1eb4c964687bc0dbea0102fa7d717cc7f42908aa1979fbc22cde1db187b8e3fa) - it imports XML files with mappings\r\n\r\nNew config ([strip_dqm_test_xml_cfg.py](https://github.com/cms-sw/cmssw/compare/master...CTPPS:cmssw:raw_to_digi_updates#diff-59e872634532ac0d26ee88ec4b59dd48d6ddca7dc15965feeb025016c3a7d278)) to read mappings from XML instead of GT (just for test and internal use)\r\n\r\n#### PR validation:\r\n\r\n<p dir=\"auto\" style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(14, 17, 22); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\">We have created Tags containing records with mappings for each detector. Created Tags:</p>\r\n\r\nTAG | Record\r\n-- | --\r\nPPSDAQMapping_TrackingStrip_test_v1 | TotemReadoutRcd\r\nPPSDAQMapping_TimingDiamond_test_v1 | TotemReadoutRcd\r\nPPSDAQMapping_TotemTiming_test_v1 | TotemReadoutRcd\r\nPPSDAQMapping_TotemT2_test_v1 | TotemReadoutRcd\r\nPPSAnalysisMask_test_v1 | TotemAnalysisMaskRcd\r\n\r\n<p dir=\"auto\" style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(14, 17, 22); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\">To validate changes in TotemVFATRawToDigi I ran the rawToDigi and the reconstruction (<code class=\"notranslate\" style=\"box-sizing: border-box; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Menlo, Consolas, &quot;Liberation Mono&quot;, monospace; font-size: 11.9px; padding: 0.2em 0.4em; margin: 0px; white-space: break-spaces; background-color: var(--bgColor-neutral-muted, var(--color-neutral-muted)); border-radius: 6px;\">process.ctppsRawToDigi</code><span></span>and<span></span><code class=\"notranslate\" style=\"box-sizing: border-box; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Menlo, Consolas, &quot;Liberation Mono&quot;, monospace; font-size: 11.9px; padding: 0.2em 0.4em; margin: 0px; white-space: break-spaces; background-color: var(--bgColor-neutral-muted, var(--color-neutral-muted)); border-radius: 6px;\">process.recoCTPPS</code><span></span>in config's<span></span><code class=\"notranslate\" style=\"box-sizing: border-box; font-family: ui-monospace, SFMono-Regular, &quot;SF Mono&quot;, Menlo, Consolas, &quot;Liberation Mono&quot;, monospace; font-size: 11.9px; padding: 0.2em 0.4em; margin: 0px; white-space: break-spaces; background-color: var(--bgColor-neutral-muted, var(--color-neutral-muted)); border-radius: 6px;\">process.path</code>) with the use of Tags and then with the use of XML files. Because TotemAnalysisMaskRcd cannot be taken from XML in both cases it was loaded from a Tag - but it shouldn't make any difference since this record contains empty object and no data.</p><p dir=\"auto\" style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(14, 17, 22); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\">Then I compared plots generated with the use of Tags with plots generated with the use of XMLs. They looked the same.</p><p dir=\"auto\" style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(14, 17, 22); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\">This test has been done for all detectors (TimingDiamond, TrackingStrips, TotemT2, TotemTiming) and here are the resulting plots:<span></span><a href=\"https://cernbox.cern.ch/s/jQ1ofbYnBNbiCOs\" rel=\"nofollow\" style=\"box-sizing: border-box; background-color: transparent; color: var(--fgColor-accent, var(--color-accent-fg)); text-decoration: underline; text-underline-offset: 0.2rem;\">https://cernbox.cern.ch/s/jQ1ofbYnBNbiCOs</a></p>", "branch": "master", "changed_files": 10, "comments": 1, "commits": 5, "created_at": "1699283872", "deletions": 144, "labels": ["reconstruction-pending", "dqm-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-rejected"], "milestone": "CMSSW_13_3_X", "number": 43203, "release-notes": [], "review_comments": 0, "state": "open", "title": "PPS - RawToDigi update to handle mappings from CondDB [update of PR 42711]", "updated_at": "1699284425", "user": "grzanka"}
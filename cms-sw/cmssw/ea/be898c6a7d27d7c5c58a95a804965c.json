{"additions": 186, "auther_ref": "CMSSW_9_2_X_2017-05-17-1100/sign908/ecalMFspeedup", "auther_sha": "670bfda05db3bdf761548c4c0d9f20cc2b546480", "author": "slava77", "body": "From #18600 \r\n\r\n```\r\nloop over DIGIs inside EcalUncalibRecHitWorker*::run()\r\ncompile EcalRecProducers and EcalRecAlgos with -O3 <== SK: this became just a default flag during review of #18600\r\n\r\nfrom @felicepantaleo :\r\n\r\n    faster check for a positive vector\r\n    increase threshold with a smoother granularity\r\n\r\nfrom @VinInn :\r\n\r\n    use lazyProduct() and noalias() in NNLS\r\n\r\n```\r\n\r\nThe original was not signed off due to remaining duplication of rechit creation implementation in EcalUncalibRecHitWorkerMultiFit.\r\n\r\n\r\nAs a follow up to the original submission, the following changes were made https://github.com/cms-sw/cmssw/compare/158d3b699bee13299384f2a3df528013a00cc3d9...670bfda05db3bdf761548c4c0d9f20cc2b546480:\r\n- treat the proposed ::run method using all digis as the new main default for running workers as seen by EcalUncalibRecHitProducer\r\n    - this becomes the only ::run method for EcalUncalibRecHitWorkerBaseClass and its direct descendants. This automatically allows to remove the single-digi ::run method from EcalUncalibRecHitWorkerMultiFit.\r\n    -  introduce a compatibility base EcalUncalibRecHitWorkerRunOneDigiBase  which calls this for old methods running on their individual digi ::run\r\n- cleanup of leftover commented out lines\r\n\r\nTested with regular short matrix (includes non-multiFit ecal reco)\r\nand also for timing in JetHT run 282730 LS 160 (PU~45). There are no differences in reconstructed objects.\r\nFor the timing of ecalMultiFitUncalibRecHit\r\n-  there are no significant difference in CPU time  compared to #18600  (I also checked re-HLT of the same input and time of hltEcalUncalibRecHit to be sure)\r\n- there is about 12% improvement compared to the baseline CMSSW_9_2_X_2017-05-17-1100; in agreement with https://patatrack.web.cern.ch/content/ecal-multifit-hlt-optimization\r\n\r\n\r\n@argiro @fwyzard \r\nplease check if this update is acceptable to you\r\n\r\n", "branch": "master", "changed_files": 19, "closed_at": "1495274720", "comments": 11, "commits": 8, "created_at": "1495138666", "deletions": 216, "labels": ["comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "04ccfa2ea4707431582736bea70f22e318d79c84", "merged_at": "1495274720", "merged_by": "cmsbuild", "milestone": "CMSSW_9_2_X", "number": 18840, "release-notes": [], "review_comments": 0, "state": "closed", "title": "optimize ECAL uncalibRecHit multifit (follow up to #18600)", "updated_at": "1495274720", "user": "slava77"}
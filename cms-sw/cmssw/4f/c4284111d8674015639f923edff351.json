{"additions": 946, "auther_ref": "run2_miniAOD_AA_fix_egamma_assoPF", "auther_sha": "a3ca1c4482a4a9b16e1499d8b4f953617e1db0a5", "author": "ttrk", "body": "Associated PF candidates for a GED electron/photon are necessary to avoid double counting energy in PF isolation.\r\n\r\nIn AOD, the association is stored in `particleBasedIsolation` object. In miniAOD, association is accessible via `associatedPackedPFCandidates()` of a pat electron/photon (e.g. [here](https://github.com/cms-sw/cmssw/blob/4883b2eac701c829419f974811c1cd2f6550bd56/DataFormats/PatCandidates/interface/Photon.h#L314)), the AOD-2-miniAOD process transfers the association between objects.\r\n\r\nCurrently, the transfer does not work correctly for 2018 PbPb data, i.e. `run2_miniAOD_pp_on_AA_103X` process. This is understood as packedPFcandidates in this workflow is made from an intermediate, \"cleaned\" PF collection (created via [this](https://github.com/cms-sw/cmssw/pull/31668)) and while references in `particleBasedIsolation` are still the ones from original PF collection. The `associatedPackedPFCandidates` collection created in current code is not correct.\r\n\r\nThis PR fixes the problem by producing a map between original (old) and the cleaned (new) PF candidate references and updating the references in particleBasedIsolation from old to new ones.\r\n\r\nTests pass wf 140.5611 and give correct output.\r\n\r\n@mandrenguyen ", "branch": "master", "changed_files": 28, "closed_at": "1647530312", "comments": 1, "commits": 11, "created_at": "1647530236", "deletions": 161, "labels": ["reconstruction-pending", "dqm-pending", "hlt-pending", "alca-pending", "db-pending", "pending-signatures", "tests-pending", "orp-pending", "pdmv-pending", "upgrade-pending", "code-checks-rejected"], "milestone": "CMSSW_12_4_X", "number": 37261, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix Egamma PF linking in 2018 PbPb mAOD", "updated_at": "1647530761", "user": "ttrk"}
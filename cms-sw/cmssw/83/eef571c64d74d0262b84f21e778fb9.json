{"additions": 15, "auther_ref": "CPEProbQMsg", "auther_sha": "b880d3cd3ac66a79d198472553f4c8a5605e9f22", "author": "tvami", "body": "#### PR description:\r\n\r\nWhen doing some refitting I notice this MSG\r\n```\r\n%MSG-w OutOfBounds:  TrackRefitter:RefitterForDeDx 13-Nov-2021 21:07:38 CET  Run: 319450 Event: 228163659\r\nProb Q outside the bounds of the quality word. Defaulting to Prob=0. Prob = 1 QualityWord = 1\r\n%MSG\r\n```\r\n\r\nWhich seems to be due to machine precision error in the comparison. This PR adds an epsilon to the comparison to 1. \r\n\r\nEDIT: the PR also fixes an edge case when TemplateID can be 0. And then if the probs are 1+epsilon they are set to 1, otherwise the original warning, with an improved msg is brought back.\r\n\r\n#### PR validation:\r\n\r\n\r\nReran the code that gave the warning msg above --> Now it's gone.\r\nI'm not sure these are the correct timing value to look at but\r\n```\r\nBefore\r\nTimeReport ---------- Event  Summary ---[sec]----\r\nTimeReport       event loop CPU/event = 0.558920\r\nTimeReport      event loop Real/event = 0.959158\r\nTimeReport     sum Streams Real/event = 0.909626\r\nTimeReport efficiency CPU/Real/thread = 0.582719\r\n\r\nTimeReport ---------- Modules in Path: p ---[Real sec]----\r\nTimeReport   0.200814     0.200814  RefitterForDeDx\r\n```\r\n\r\nAfter PR\r\n```\r\nTimeReport ---------- Event  Summary ---[sec]----\r\nTimeReport       event loop CPU/event = 0.550824\r\nTimeReport      event loop Real/event = 0.952079\r\nTimeReport     sum Streams Real/event = 0.910521\r\nTimeReport efficiency CPU/Real/thread = 0.578549\r\n\r\n\r\nTimeReport ---------- Modules in Path: p ---[Real sec]----\r\nTimeReport   0.193779     0.193779  RefitterForDeDx\r\n```\r\n\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nI'd like to have a backport to 10_6_X, this could actually have a (prob little) effect on Physics analysis", "branch": "master", "changed_files": 3, "closed_at": "1638217884", "comments": 55, "commits": 2, "created_at": "1636843216", "deletions": 12, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "22ddbab222355efd0b61b7458849574173ea8084", "merged_at": "1638217884", "merged_by": "cmsbuild", "milestone": "CMSSW_12_2_X", "number": 36120, "release-notes": [], "review_comments": 13, "state": "closed", "title": "Add epsilon in comparison of probabilities in SiPixelRecHitQuality", "updated_at": "1638217885", "user": "tvami"}
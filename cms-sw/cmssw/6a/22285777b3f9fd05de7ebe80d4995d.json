{"additions": 371, "auther_ref": "dev/hackathon_clean_config_15X", "auther_sha": "3d24632a7bc0ca2c237e9d61c62772071bb30b12", "author": "CMS-HGCAL", "body": "# PR description\r\n\r\nThis PR cleans up the HGCal electronics configuration & calibration to facilitate system tests in the lab and at test beams, as well as for producing simulation of the full-HGCal electronics.\r\n\r\nWe use JSONs to configure and calibrate the HGCal DIGIs. To make these JSONs more flexible and reusable both, we now allow patterns for the keys. (Note that that the JSONs are not final yet, so it is not written in CondDB _yet_.)\r\n\r\n### Related PR\r\n* Building on https://github.com/cms-sw/cmssw/pull/45665\r\n\r\n### Summary of changes:\r\n* The matching between a given module or FED ID to key patterns:\r\n  * Updated ESProducers\r\n    * [`RecoLocalCalo/HGCalRecAlgos/plugins/HGCalConfigurationESProducer.cc`](https://github.com/cms-sw/cmssw/blob/master/RecoLocalCalo/HGCalRecAlgos/plugins/HGCalConfigurationESProducer.cc)\r\n    * [`RecoLocalCalo/HGCalRecAlgos/plugins/alpaka/HGCalRecHitCalibrationESProducer.cc`](https://github.com/cms-sw/cmssw/blob/master/RecoLocalCalo/HGCalRecAlgos/plugins/alpaka/HGCalRecHitCalibrationESProducer.cc)\r\n  * Using help functions in [`CondFormats/HGCalObjects/interface/HGCalESProducerTools.h`](https://github.com/CMS-HGCAL/cmssw/blob/4716efb1944551431d0ffc1396c66223fa2963de/CondFormats/HGCalObjects/interface/HGCalESProducerTools.h).\r\n  * Allowed patterns:\r\n    * Glob/fnmatch patterns (like `ML-*`) as keys for module typecodes in JSON, and similar for FED ID (like `*` or `[0-9]`).\r\n    * Numerical ranges (like `10-55`) for FED IDs.\r\n  * You can find examples of the new JSON format in [this commit](https://gitlab.cern.ch/hgcal-dpg/calibrations/-/commit/da6c82bb467a74428bf8c38a375de5026f997010).\r\n* Remove redundant/commented-out fields in FED/ECON-D config JSONs, as well as in `CondFormats/HGCalObjects/interface/HGCalConfiguration.h`:\r\n  * `econds` list\r\n  * `Gain` list\r\n  * `passthrough`\r\n* Remove redundant `HGCalConfigParam` SoA / ESProducer (it was only propagating gain. We do not need to track the HGCROC gain anymore, as the gain settings are expected to be stable, and we will have regular automized local calibrations to match the data):\r\n  * [`RecoLocalCalo/HGCalRecAlgos/plugins/alpaka/HGCalRecHitConfigurationESProducer.cc`](https://github.com/cms-sw/cmssw/blob/master/RecoLocalCalo/HGCalRecAlgos/plugins/alpaka/HGCalRecHitConfigurationESProducer.cc)\r\n  * [`CondFormats/HGCalObjects/interface/HGCalConfigParamSoA.h`](https://github.com/cms-sw/cmssw/blob/master/CondFormats/HGCalObjects/interface/HGCalConfigParamSoA.h#L17)\r\n* Add/rename ModuleIndexer functions for specific ECON-D modules:\r\n  * `getNFED()`  `getNumFEDs()`\r\n  * `getMaxModuleSize(typecode)`  `getNumModules(typecode)`\r\n  * `getMaxERxSize(typecode)`  `getNumERxs(typecode)`\r\n  * ...\r\n* Updated tester for the ESProducers (see below).\r\n\r\n# PR validation\r\n\r\nValidated with a standalone tester for the config & calibration ESProducers in `RecoLocalCalo/HGCalRecAlgos/`\r\n```bash\r\ncmsRun $CMSSW_BASE/src/RecoLocalCalo/HGCalRecAlgos/test/testHGCalRecHitESProducers_cfg.py\r\n```\r\n\r\nValidated with the full RAW  FedRaw  DIGI  RecHit data processing chain on September 2024 testbeam data:", "branch": "master", "changed_files": 17, "comments": 7, "commits": 5, "created_at": "1747832767", "deletions": 403, "labels": ["reconstruction-pending", "alca-pending", "db-pending", "pending-signatures", "orp-pending", "tests-started", "upgrade-pending", "code-checks-approved", "hgcal-dpg-pending", "changes-dataformats"], "milestone": "CMSSW_15_1_X", "number": 48137, "release-notes": [], "review_comments": 0, "state": "open", "title": "[HGCAL] Clean HGCal configuration & calibration", "updated_at": "1747840773", "user": "IzaakWN"}
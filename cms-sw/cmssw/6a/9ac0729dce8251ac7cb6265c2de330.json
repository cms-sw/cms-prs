{"additions": 2, "auther_ref": "fixeMerge942", "auther_sha": "9a900daf2571bba9e21ee441ee8321a96f5b5c25", "author": "arizzi", "body": "This forces Merge.py to read the eventcontent definition (for NanoAOD) so that the correct compression settings are set.\r\n\r\nThis is needed because merging for nanoaod is NOT simply a fastmerge.\r\n\r\nThe event content is set in the OutputModule in the same way as in cmsDriver\r\nhttps://github.com/cms-sw/cmssw/blob/master/Configuration/Applications/python/ConfigBuilder.py#L557-L558\r\n\r\nAs there is no test of Merge.py I simply did the following in interactive python (and seem to give the expected result)\r\n<pre>\r\n>>> import Merge\r\n>>> p=Merge.mergeProcess([\"afile.root\"],mergeNANO=True)\r\n>>> print p.dumpPython()\r\nimport FWCore.ParameterSet.Config as cms\r\n\r\nprocess = cms.Process(\"Merge\")\r\n\r\nprocess.source = cms.Source(\"PoolSource\",\r\n    fileNames = cms.untracked.vstring(\"[\\'afile.root\\']\")\r\n)\r\nprocess.Merged = cms.OutputModule(\"NanoAODOutputModule\",\r\n    compressionAlgorithm = cms.untracked.string('LZMA'),\r\n    compressionLevel = cms.untracked.int32(9),\r\n    fileName = cms.untracked.string('Merged.root'),\r\n    outputCommands = cms.untracked.vstring('drop *', \r\n        'keep nanoaodFlatTable_*Table_*_*', \r\n        'keep edmTriggerResults_*_*_*', \r\n        'keep nanoaodMergeableCounterTable_*Table_*_*', \r\n        'keep nanoaodUniqueString_nanoMetadata_*_*')\r\n)\r\n\r\n\r\nprocess.outputPath = cms.EndPath(process.Merged)\r\n\r\n</pre> \r\n\r\n(similar PR will follow asap on master)", "branch": "CMSSW_9_4_X", "changed_files": 1, "closed_at": "1517306526", "comments": 10, "commits": 1, "created_at": "1516185235", "deletions": 1, "labels": ["comparison-available", "fully-signed", "operations-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "fedf7543fa1be7b75af4026c01f4b18c89458aa3", "merged_at": "1517306526", "merged_by": "cmsbuild", "milestone": "CMSSW_9_4_X", "number": 21873, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix compression level in NANOAOD production", "updated_at": "1517306527", "user": "arizzi"}
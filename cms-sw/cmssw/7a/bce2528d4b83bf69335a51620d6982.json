{"additions": 434, "auther_ref": "adding-angle-utilities", "auther_sha": "c1b271df76a6b914fad0e9efeef1233fa995e258", "author": "cvuosalo", "body": "#### PR description:\r\n\r\nIn many spots in CMSSW, code like the following appears:\r\n```\r\nif (pointphi >= twopi)\r\n     pointphi -= twopi;\r\nif(pointphi < 0)\r\n     pointphi += twopi;\r\n```\r\nThe intent is to constrain the angle to the range 0<= angle < 2pi, but the code, as in this example, sometimes doesn't handle the case of an |angle| >= 4pi.\r\n\r\n`DataFormats/Math/interface/deltaPhi.h` provides a `reduceRange()` function for this purpose, but tests show this function is not as fast as it could be, and it suffers from sensitivity in its `if` statement to small deviations from pi.\r\n\r\nThis PR adds a new function `make0to2pi`, that can be significantly faster than `reduceRange()` and that greatly reduces value drift due to floating-point comparisons. This new function is added without changing the implementation of `reduceRange()` because changing `reduceRange()` could cause slight differences in program behavior. Usage of `reduceRange()` can later be replaced on a case-by-case basis where better performance and precision is required.\r\n\r\nFor developer convenience, this PR also provides a class `Angle0to2pi<>` that automatically maintains a value >=0 and < 2pi. Class objects are the same size as base type variables, and with the O2 compiler optimization used by default by CMSSW, there is usually no significant difference in performance compared with base type angle variables. However, in certain use cases, there could be CPU performance costs from using this class.\r\n\r\nIn addition, the generic angle utilities in the `GeantUnits.h` file are moved to `deltaPhi.h` because they are not Geant-specific and should be usable without subjecting code to Geant conventions.\r\n\r\n#### PR validation:\r\n\r\nA unit test program is included in this PR, and it verifies basic functions of the code and gives some rough performance measures.\r\n\r\nSome performance results comparing `reduceRange()` and `make0to2pi` are shown below.\r\n\r\nNo backport is needed.", "branch": "master", "changed_files": 9, "comments": 35, "commits": 10, "created_at": "1553115839", "deletions": 101, "labels": ["code-checks-pending", "comparison-pending", "geometry-pending", "orp-pending", "pending-signatures", "reconstruction-pending", "simulation-pending", "tests-pending", "upgrade-pending"], "milestone": "CMSSW_10_6_X", "number": 26227, "release-notes": [], "review_comments": 0, "state": "open", "title": "Adding angle utilities", "updated_at": "1555443018", "user": "cvuosalo"}
{"additions": 918, "auther_ref": "phaseII_patatrack_local_123X", "auther_sha": "f18d8fe0a57a49f9f22b3248248bad09671ddc01", "author": "AdrianoDee", "body": "#### PR description:\r\n\r\nAllowing Patatrack tracker local reco to run on Phase2 tracker. A summary:\r\n\r\n- rising `maxNumModules` to 4000 to allow for Phase2 tracker geometry to be accommodated;\r\n- introducing `maxNumDigis` (set based on ttbar events @ <PU>=200);\r\n- rising number of layers to `28` for `TrackingRecHit2DSOAView:: PhiBinner`. This in principle could be templated but seems to me it would mess up with too many specialized definitions.\r\n- adding `m_nMaxModules` (and it's getter `nMaxModules()` for `TrackingRecHit2DSOAView` and  `TrackingRecHit2DHeterogeneous` to determine hits module structures sizes; added in the constructor for `TrackingRecHit2DHeterogeneous`.\r\n- renamed `phase1PixelTopology` to `pixelTopology` and separating the two topologies in two namespaces (namely `phase1PixelTopology` and `phase2PixelTopology`);\r\n- splitting `SiPixelRawToClusterCUDA` in two branches to account for digis already being there for Phase2;\r\n- adding Phase2 digi calibrations in `gpuCalibPixel`\r\n- extending `pixelCPEforGPU::CommonParams` to include `maxModuleStride` and `numberOfLaddersInBarrel ` to have them propagated around being different for Phase1 and Phase2;\r\n- extending `pixelCPEforGPU::DetParams` to include `nRowsRoc`, `nColsRoc`, `nRows`, `nCols` and `numPixsInModule` being not constant among modules for Phase2;\r\n- fixing tests all around to take into account the changes;\r\n- adding `isUpgrade_` flag or template all around;\r\n\r\n#### PR validation:\r\n\r\nAttaching in the first comment a validation run via [cms-patatrack/patatrack-validation](https://github.com/cms-patatrack/patatrack-validation) on a P100 at T2@Bari.\r\n\r\nLocal tracker validation for Run3 samples (comparison `12_2_0_pre2` vs this PR for CPU/GPU):\r\n- https://adiflori.web.cern.ch/adiflori/run3_localtracker_plots/\r\n\r\nLocal tracker validation for Phase2 samples (comparison legacy reco from `12_2_0_pre2` vs this PR for CPU/GPU):\r\n- https://adiflori.web.cern.ch/adiflori/phase2_localtracker_plots/\r\n\r\nA simple customization function to run the new local reco on top of a generic wf [here](https://github.com/AdrianoDee/warehouse/blob/master/configs/customisePatatrackPixelLocalRecoUpgrade.py). This may be tested, e.g., on top of `38634.1` workflow (on `step3`).\r\n\r\nThis will conflict with #36215 and #36176. As soon as those are merged a fix will be committed here. In a following PR the modifications to Pixel Tracks reco will be addressed.\r\n\r\ncc: @mtosi @vmariani @mmusich @VinInn \r\n(probably you will be notified anyway)", "branch": "master", "changed_files": 27, "comments": 31, "commits": 3, "created_at": "1637761142", "deletions": 383, "labels": ["reconstruction-pending", "alca-pending", "geometry-approved", "pending-signatures", "tests-approved", "orp-pending", "code-checks-approved", "heterogeneous-pending"], "milestone": "CMSSW_12_2_X", "number": 36235, "release-notes": [], "review_comments": 21, "state": "open", "title": "Phase II Patatrack Pixel Local Reco", "updated_at": "1638000837", "user": "AdrianoDee"}
{"additions": 5, "auther_ref": "find_ntuplets_abort_on_recursion_overflow", "auther_sha": "ffd34438856b1bc3d75fd3a97cc8b9a817790c27", "author": "fwyzard", "body": "#### PR description:\r\n\r\nUse the `__trap()` builtin to abort the execution from within a GPU kernel if the  `GPUCACell::find_ntuplets` recusrions overflows.\r\n\r\nThis should not be possible in Phase-1 code, and is not yet been used in Phase-2 code, but is added for extra robustness.\r\n\r\n#### PR validation:\r\n\r\nRunning with the standard configuration does not show any regressions, not even on performance:\r\n\r\nmeasurement     |   #35473     |  #35473 with `__trap()`  \r\n----------------|-------------------|-------------------\r\nI/O throughput  |        ~ 2 kev/s  |        ~ 2 kev/s  \r\nquadruplets     |   1289   3 ev/s  |   1292   4 ev/s  \r\ntriplets        |    724   3 ev/s  |    720   2 ev/s  \r\n\r\n.\r\n\r\nForcing the overflow to happen by artificially reducing the maximum recursion fails as expected:\r\n```\r\nBegin processing the 1st record. Run 1, Event 1602, LumiSection 17 on stream 0 at 05-Oct-2021 15:15:12.381 CEST\r\nERROR: GPUCACell::find_ntuplets reached full depth!\r\n... (repeated 819 times)\r\nERROR: GPUCACell::find_ntuplets reached full depth!\r\nterminate called after throwing an instance of 'std::runtime_error'\r\n  what():  \r\n/data/user/fwyzard/CMSSW_12_1_0_pre3/src/HeterogeneousCore/CUDAUtilities/src/CachingDeviceAllocator.h, line 617:\r\ncudaCheck(error = cudaEventRecord(search_key.ready_event, search_key.associated_stream));\r\ncudaErrorLaunchFailure: unspecified launch failure\r\n```\r\nfollowed by the usual stack trace.\r\n", "branch": "master", "changed_files": 1, "closed_at": "1633620448", "comments": 15, "commits": 1, "created_at": "1633433933", "deletions": 1, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved", "heterogeneous-approved"], "merge_commit_sha": "45dd416d694649e8bdba46787b66ba596c30d52a", "merged_at": "1633620448", "merged_by": "cmsbuild", "milestone": "CMSSW_12_1_X", "number": 35542, "release-notes": [], "review_comments": 1, "state": "closed", "title": "GPUCACell::find_ntuplets abort on recursion overflow", "updated_at": "1633620449", "user": "fwyzard"}
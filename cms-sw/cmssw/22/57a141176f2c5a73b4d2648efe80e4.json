{"additions": 427, "auther_ref": "preselect_electron_track_iso", "auther_sha": "ec0a7acc2563b5a6aea5f2bb33408aefd84d271e", "author": "guitargeek", "body": "#### PR description:\r\n\r\nI had a closer look at the profiling reports linked in https://github.com/cms-sw/cmssw/pull/30179 for Phase II reconstruction with PU 200. One thing I noticed was that the GsfElectronAlgo [spends a lot of time](https://dpiparo.web.cern.ch/dpiparo/cgi-bin/igprof-navigator/step3_RAW2DIGI_L1Reco_RECO_RECOSIM_200_opt.pp/67) computing track isolation variables, amounting to 1.4 % of the total run time (look for `EleTkIsolFromCands::calIsol`):\r\n\r\nIt turns out that it takes so much time because  `.eta()` is called for each track, and this for each electron. This results in a bit too many calls to `atan2` and `log`. The obvious solution to this (proposed in this PR) would be to cache the track parameters relevant for electron matching in some simple data structure. Furthermore, one can already preselect the tracks which are stored in this cache because many of the selection criteria tor including a track in the isolation don't depend on the electron.\r\n\r\nI checked if this works by profiling step3 workflow 20634.21 (Phase II TTBar with PU). The absolute percentages don't exactly match the reports in https://github.com/cms-sw/cmssw/pull/30179, because the workflow I used didn't produce the LowPtGsfElectrons. Still, one can clearly see that `EleTkIsolFromCands::calIsol` goes from dominating the GsfElectronAlgo to a negligible position:\r\n\r\n* **Phase II** representative workflow **20634.21 step3** [before](https://rembserj.web.cern.ch/rembserj/cgi-bin/igprof-navigator/wf_20634p21_igreport_perf/174) and [after](https://rembserj.web.cern.ch/rembserj/cgi-bin/igprof-navigator/wf_20634p21_preselect_electron_track_iso_igreport_perf/265) this PR\r\n* **Run 2** representative workflow **10224.0 step3** [before](https://rembserj.web.cern.ch/rembserj/cgi-bin/igprof-navigator/wf_10224p0_igreport_perf/1693) and [after](https://rembserj.web.cern.ch/rembserj/cgi-bin/igprof-navigator/wf_10224p0_preselect_electron_track_iso_igreport_perf/2084) this PR\r\n* For each profiling 100 events were processed\r\n* HLT has its own track isolation producers and therefore no steps with HLT were profiled\r\n\r\nNote that with this PR  `EleTkIsolFromCands::calIsol` got renamed to `EleTkIsolFromCands::operator()`.\r\n\r\n\r\n#### PR validation:\r\n\r\nCMSSW compiles and local matrix tests pass.\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nNo backport intended.\r\n", "branch": "master", "changed_files": 18, "closed_at": "1592987107", "comments": 86, "commits": 16, "created_at": "1591954455", "deletions": 299, "labels": ["analysis-approved", "code-checks-approved", "comparison-available", "core-approved", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "539dc9b62a5ecea361f3cf9ab75ec6428bedeb7c", "merged_at": "1592987107", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 30209, "release-notes": [], "review_comments": 39, "state": "closed", "title": "Preselect tracks for electron track isolation computation in reco", "updated_at": "1592987107", "user": "guitargeek"}
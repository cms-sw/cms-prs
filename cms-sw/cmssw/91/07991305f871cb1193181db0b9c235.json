{"additions": 624, "auther_ref": "primaryVertexAssociationJME120", "auther_sha": "d216e83ddb3f0bae19a77ad33479a84f72d162a5", "author": "ahinzmann", "body": "#### PR description:\r\n\r\nTrack-vertex association handling is quite inhomogeneous across CMSSW.\r\nWhile the ultimate goal is to fully unify vertex association across CHS and PUPPI for Run3 and the use of timing information in CHS and PUPPI for Phase-2, this PR enables technically to study+synchronize them, while not significantly changing the current behavior of CHS and PUPPI.\r\n\r\n1. Use a single module in CMSSW for all track-vertex association done for PackedCandidates and CHS and PUPPI: \r\n\"CommonTools/RecoAlgos/src/PrimaryVertexAssignment.cc\"\r\n2. Move \"PhysicsTools.PatAlgos.slimming.primaryVertexAssociation_cfi\" to \"CommonTools.RecoAlgos.primaryVertexAssociation_cfi\"\r\n3. Remove usage of fromPV for CHS and PUPPI, and instead make use of a common track vertex association map in a common config file:\r\n\"packedPrimaryVertexAssociationJME\"\r\n\"CommonTools/ParticleFlow/python/pfCHS_cff.py\"\r\n4. Enable CHS to use advanced track-vertex association via a map like PackedCandidates and PUPPI, via two producers at AOD and MiniAOD level:\r\n\"CommonTools/ParticleFlow/plugins/PFPileUp.cc\" (AOD)\r\n\"CommonTools/ParticleFlow/plugins/PFNoPileUpPacked.cc\" (MiniAOD)\r\n5. The behavior of CHS is slightly modified by applying a criterion to recover cases where the primary vertex is split in sync with PUPPI (Now L71 in CommonTools/RecoAlgos/src/PrimaryVertexAssignment.cc). In this way, vertex association based on UsedInFit is the same for PUPPI and CHS and they only differ (until further unified) in additional requirements based on dz for PUPPI.\r\n\r\nPerformance tested in CMSSW_11_1_8 using HLT-TDR samples with this backport:\r\nhttps://github.com/cms-sw/cmssw/compare/CMSSW_11_1_X...ahinzmann:primaryVertexAssociationJME?expand=1\r\nValidation presented at RECO on Aug 20th and PF meetings on June 4th:\r\nhttps://indico.cern.ch/event/1067481/#67-unified-vertex-association\r\nhttps://indico.cern.ch/event/1045967/#40-track-primary-vertex-associ\r\n  \r\n#### PR validation:\r\n\r\nscram b runtests\r\n\r\nrunTheMatrix -l limited\r\n\r\nMiniAOD output of 25202.0 CHS jets were found to agree 100%. PUPPI jets were found to agree within <1%.\r\n\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nNo backport planned.\r\nWill provide a synchronized analysis recipe for studies based on HLT-TDR samples.", "branch": "master", "changed_files": 34, "closed_at": "1631594818", "comments": 76, "commits": 19, "created_at": "1622209734", "deletions": 158, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "2c93e5996c609e25ad301b1578b4b6103c9510be", "merged_at": "1631594818", "merged_by": "cmsbuild", "milestone": "CMSSW_12_1_X", "number": 33885, "release-notes": [], "review_comments": 40, "state": "closed", "title": "Unify vertex association between CHS and PUPPI", "updated_at": "1631594818", "user": "ahinzmann"}
{"additions": 259, "auther_ref": "reduceInputFileCatalogMemory", "auther_sha": "5744eaa1862738f0934b26a6a209c181376faaa7", "author": "makortel", "body": "#### PR description:\r\n\r\nIn https://github.com/cms-sw/cmssw/issues/46975#issuecomment-2552441759 I discovered the `InputFileCatalog` took ~488 MB memory per stream in a production DIGI job overlaying premixed pileup, where the job was configured with nearly 500k pileup files. A quick look in `InputFileCatalog` showed the input file names are more or less stored three times\r\n* in `fileNames_` to communicate a copy of the input file names from constructor to `init()`\r\n  * I think this copy is completely unnecessary, and is removed in the second commit\r\n* in `logicalFileNames_` to partly communicate input file names from constructor to `init()`, and partly to allow cheap `logicalFileNames()` getter to them\r\n  * I noticed the `logicalFileNames()` function is not really used, so in order to avoid storing the file names in member data, I decided to remove the member function and the `logicalFileNames_` member in the third commit\r\n* in `FileCatalogItem::lfn_` stored in `fileCatalogItems_` member\r\n  * This copy of the `lfn_` is being used\r\n\r\nAn alternative to the second commit could be to keep the `logicalFileNames_`, and store the `FileCatalogItem::lfn_` as `string_view`, but I felt that to be a tiny bit more complex.\r\n\r\nThe fourth commit avoids one copy of the `std::vector<std::string>` of the file names when the `InputFileCatalog` is constructed from a temporary `vector`, which is the case with all Sources that use `InputFileCatalog`.\r\n \r\nThe first commit adds a unit test for `InputFileCatalog`\r\n\r\nResolves https://github.com/cms-sw/framework-team/issues/1113\r\n\r\n#### PR validation:\r\n\r\nUnit tests passed in CMSSW_14_0_18. With example job https://github.com/cms-sw/cmssw/issues/46975#issuecomment-2552359306 MaxMemoryPreload showed 197 MB reduction in peak allocated memory on 1 thread.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nTo be backported to 14_1_X and 14_0_X.", "branch": "master", "changed_files": 9, "closed_at": "1736403971", "comments": 22, "commits": 4, "created_at": "1734615097", "deletions": 108, "labels": ["core-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "c50460918f8e6275668baea57ba26d715b84fca6", "merged_at": "1736403971", "merged_by": "cmsbuild", "milestone": "CMSSW_15_0_X", "number": 47013, "release-notes": [], "review_comments": 2, "state": "closed", "title": "Remove redundant data members from InputFileCatalog to reduce memory use", "updated_at": "1736403972", "user": "makortel"}
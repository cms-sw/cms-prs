{"additions": 454, "auther_ref": "from-CMSSW_12_0_X_2021-07-08-1100-CCLUT-rearrangment-pattern-finding", "auther_sha": "000921285420bbdd97346c5cdc1724ae44b0e43c", "author": "dildick", "body": "#### PR description:\r\n\r\n* Last week we took at long cosmic run, 115k events, with the B904 GEM-CSC test stand (http://cmsonline.cern.ch/cms-elog/1118979). I analyzed the CSC trigger primitives. I determined that there was a minor disagreement between firmware and emulation for the CLCT algorithm. When CCLUT is applied, the deadzone around a CLCT takes into account possible correction of the CLCT half-strip position. This has a particular effect when CLCTs are around 5 half-strips apart from each other. The CCLUT correction on CLCT1 can move them apart (in which case CLCT2 would be kept) or closer together (in which case CLCT2 is eliminated)\r\n   - Previously: 1) find CLCT1, 2) find CLCT2, 3) apply CCLUT to CLCT1, 4) apply CCLUT to CLCT2.\r\n   - Currently: 1) find CLCT1, 2) apply CCLUT to CLCT1, 3) find CLCT2,  4) apply CCLUT to CLCT2.\r\n* Other changes:\r\n   - A `PulseArray` class was introduced, largely to hide the 2D array and some of the trigger logic. This should not change anything.\r\n   - A redundant ghost cancellation function was removed. Only the ghost cancellation function that operates on each wiregroup remains. This is also how it's done in the firmware - in parallel on each wiregroup.\r\n   - A CLCT median timing logic was removed -  we cannot implement this in the OTMB firmware anyway.\r\n   - Pieces of the logic in the findCLCT function or pretrigger function were put in separate functions (`markPreTriggerZone`, `markBusyZone`, `constructCLCT`, `constructPreCLCT`, `clearPreTriggers`) to make it easier to understand and maintain the code.\r\n* Disagreements for ALCTs and CLCTs are now at the same level: about 1 in 17,000 to 20,0000 trigger primitives is off. (Although this is with cosmics.) The CCLUT code calculation is well understood. In all, there are just  7 CLCTs different. Those may be worth investigating further. Most likely, there are small differences in other parts of the CLCT algorithm (other than CCLUT).\r\n\r\n#### PR validation:\r\n\r\nTested so far on the cosmic data. \r\n\r\nResults from short run 10k events:\r\n[CSC_dataVsEmul_B904_Cosmic_Run_210609_142357_ArrangePatFinderAndCCLUT.pdf](https://github.com/cms-sw/cmssw/files/6789029/CSC_dataVsEmul_B904_Cosmic_Run_210609_142357_ArrangePatFinderAndCCLUT.pdf)\r\n\r\nResults from long run 115k events:\r\n[CSC_dataVsEmul_B904_Cosmic_Run_210701_135109.pdf](https://github.com/cms-sw/cmssw/files/6789033/CSC_dataVsEmul_B904_Cosmic_Run_210701_135109.pdf)\r\n\r\nI will test it on 25k Run-2 data events tomorrow and attach the plots (excluding ME+1/1/9, ME+1/1/10, ME+1/1/11). There are no differences compared to https://github.com/cms-sw/cmssw/pull/34245\r\n[CSC_dataVsEmul_CMS_Run_322022_PostAlctClctWork.pdf](https://github.com/cms-sw/cmssw/files/6793716/CSC_dataVsEmul_CMS_Run_322022_PostAlctClctWork.pdf)\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nN/A\r\n\r\nBefore submitting your pull requests, make sure you followed this checklist:\r\n- verify that the PR is really intended for the chosen branch\r\n- verify that changes follow [CMS Naming, Coding, And Style Rules](http://cms-sw.github.io/cms_coding_rules.html)\r\n- verify that the PR passes the basic test procedure suggested in the [CMSSW PR instructions](https://cms-sw.github.io/PRWorkflow.html)\r\n\r\n@tahuang1991 \r\n", "branch": "master", "changed_files": 12, "closed_at": "1626044880", "comments": 11, "commits": 11, "created_at": "1625803042", "deletions": 602, "labels": ["l1-approved", "simulation-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "2f7e7613befa911f53790dcf11ea7037d70a3700", "merged_at": "1626044880", "merged_by": "cmsbuild", "milestone": "CMSSW_12_0_X", "number": 34417, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Improvements to CSC trigger primitives following long cosmic run at B904 (CCLUT-16)", "updated_at": "1637182950", "user": "dildick"}
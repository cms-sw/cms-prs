{"additions": 9, "auther_ref": "initRootHandlersAutoClassParser", "auther_sha": "0e6ed21f5ae810692e08b5ec82fdcacc3f683f6a", "author": "makortel", "body": "#### PR description:\r\n\r\nIn the CUDA-to-Alpaka code migration it has happened a few times that a necessary ROOT dictionary has been missing, but the error message is along\r\n```\r\nIn file included from DataFormatsSiPixelDigiSoACudaAsync_xr dictionary payload:75:\r\nIn file included from ./DataFormats/SiPixelDigiSoA/interface/alpaka/SiPixelDigisCollection.h:5:\r\nIn file included from /cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/alpaka.hpp:28:\r\nIn file included from /cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/acc/AccGpuCudaRt.hpp:14:\r\nIn file included from /cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/acc/AccGpuUniformCudaHipRt.hpp:21:\r\nIn file included from /cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/idx/bt/IdxBtUniformCudaHipBuiltIn.hpp:23:\r\nIn file included from /cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/core/Cuda.hpp:14:\r\n/cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/core/CudaHipCommon.hpp:26:18: remark: could not acquire lock file for module 'cuda': failed to create unique file /cvmfs/cms.cern.ch/slc7_amd64_gcc11/lcg/root/6.26.11-4495a4f41e988b20bdba1ccedda069c3/lib/cuda.pcm.lock-bf417c89: Read-only file system [-Rmodule-build]\r\n#        include <cuda_runtime.h>\r\n                 ^\r\n/cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/core/CudaHipCommon.hpp:26:18: remark: building module 'cuda' as '/cvmfs/cms.cern.ch/slc7_amd64_gcc11/lcg/root/6.26.11-4495a4f41e988b20bdba1ccedda069c3/lib/cuda.pcm' [-Rmodule-build]\r\nerror: unable to open output file '/cvmfs/cms.cern.ch/slc7_amd64_gcc11/lcg/root/6.26.11-4495a4f41e988b20bdba1ccedda069c3/lib/cuda.pcm': 'Read-only file system'\r\n/cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/core/CudaHipCommon.hpp:26:18: remark: finished building module 'cuda' [-Rmodule-build]\r\n/cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/alpaka/develop-20230215-1b72c1c284fb9ec0aa4ade70e3a15b56/include/alpaka/core/CudaHipCommon.hpp:26:18: fatal error: could not build module 'cuda'\r\n#        include <cuda_runtime.h>\r\n         ~~~~~~~~^\r\n----- Begin Fatal Exception 14-Apr-2023 00:30:34 CEST-----------------------\r\nAn exception of category 'FatalRootError' occurred while\r\n   [0] Constructing the EventProcessor\r\n   [1] Constructing module: class=SiPixelRawToCluster@alpaka label='siPixelRawToCluster'\r\n   Additional Info:\r\n      [a] Fatal Root Error: @SUB=TInterpreter::AutoParse\r\nError parsing payload code for class edm::DeviceProduct with content:\r\n\r\n#line 1 \"DataFormatsSiPixelDigiSoACudaAsync_xr dictionary payload\"\r\n\r\n```\r\nwhich isn't very helpful to figure out which dictionary is missing.\r\n\r\nThis PR adds a configuration option to `InitRootHandlers` to disable the automatic header parsing, in which case the framework reports a useful error message along\r\n```\r\n----- Begin Fatal Exception 14-Apr-2023 00:38:42 CEST-----------------------\r\nAn exception of category 'DictionaryNotFound' occurred while\r\n   [0] Constructing the EventProcessor\r\n   [1] Constructing module: class=SiPixelRawToCluster@alpaka label='siPixelRawToCluster'\r\n   [2] Calling ProductRegistryHelper::addToRegistry, checking dictionaries for produced types\r\nException Message:\r\nNo data dictionary found for the following classes:\r\n\r\n  edm::DeviceProduct<SiPixelClustersDevice<alpaka::DevUniformCudaHipRt<alpaka::ApiCudaRt> > >\r\n  edm::DeviceProduct<SiPixelDigiErrorsDevice<alpaka::DevUniformCudaHipRt<alpaka::ApiCudaRt> > >\r\n  edm::Wrapper<edm::DeviceProduct<SiPixelClustersDevice<alpaka::DevUniformCudaHipRt<alpaka::ApiCudaRt> > > >\r\n  edm::Wrapper<edm::DeviceProduct<SiPixelDigiErrorsDevice<alpaka::DevUniformCudaHipRt<alpaka::ApiCudaRt> > > >\r\n\r\nMost likely each dictionary was never generated, but it may\r\n<snip>\r\n```\r\n\r\nEventually I'd like to understand if it would make sense for us to disable the header parsing by default (we want to compile the dictionaries beforehand, and the header parsing has given us trouble in the past).\r\n\r\n#### PR validation:\r\n\r\nChecked with a reproducer that the reported error is useful as described above.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nTo be backported to 13_0_X to aid future Alpaka module use there.", "branch": "master", "changed_files": 1, "comments": 8, "commits": 1, "created_at": "1681428941", "deletions": 0, "labels": ["core-pending", "pending-signatures", "tests-approved", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_13_2_X", "number": 41343, "release-notes": [], "review_comments": 0, "state": "open", "title": "Add an option in InitRootHandlers to disable automatic class parsing", "updated_at": "1683178072", "user": "makortel"}
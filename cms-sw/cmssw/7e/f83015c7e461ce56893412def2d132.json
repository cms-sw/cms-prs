{"additions": 24, "auther_ref": "patch-4", "auther_sha": "ee6037b17e7a97e83ffe8906e3350a4bd8e37e13", "author": "iarspider", "body": "#### PR description:\r\n\r\ndasgoclient doesn't print all errors to stderr, some go to stdout. Since the errors are not proper JSON, edmPickEvents script will raise JSONDecodeError, but will not show the actual error. The following changes were added to get a better error message:\r\n1) An early detection of failure (test if exit_code != 0) \r\n2) A failsafe (catching JSONDecodeError)\r\n\r\n#### PR validation:\r\n\r\nRan modified code locally. \r\nExample command: `edmPickEvents.py Cosmics/Run2011A-v1/RAW 160960:277:10001082,160960:277:10001058,160960:277:10001650`\r\n\r\nExample output from original code:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/build/razumov2/CMSSW_12_3_X_2022-03-10-2300/./edmPickEvents.py\", line 334, in <module>\r\n    eventFiles = getFileNames(event, options.das_cli)\r\n  File \"/build/razumov2/CMSSW_12_3_X_2022-03-10-2300/./edmPickEvents.py\", line 95, in getFileNames\r\n    return getFileNames_dasgoclient(event)\r\n  File \"/build/razumov2/CMSSW_12_3_X_2022-03-10-2300/./edmPickEvents.py\", line 134, in getFileNames_dasgoclient\r\n    for row in json.loads(res):\r\n  File \"/cvmfs/cms-ib.cern.ch/week1/slc7_amd64_gcc10/external/python3/3.9.6-67e5cf5b4952101922f1d4c8474baa39/lib/python3.9/json/__init__.py\", line 346, in loads\r\n    return _default_decoder.decode(s)\r\n  File \"/cvmfs/cms-ib.cern.ch/week1/slc7_amd64_gcc10/external/python3/3.9.6-67e5cf5b4952101922f1d4c8474baa39/lib/python3.9/json/decoder.py\", line 337, in decode\r\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n  File \"/cvmfs/cms-ib.cern.ch/week1/slc7_amd64_gcc10/external/python3/3.9.6-67e5cf5b4952101922f1d4c8474baa39/lib/python3.9/json/decoder.py\", line 355, in raw_decode\r\n    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\njson.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n```\r\n\r\nExample output with proposed changes:\r\n```\r\nDAS query error: return code 18\r\n--- Standard output---\r\nValidation error: unmatched dataset pattern\r\n\r\n--- Standard error---\r\n\r\n--- End ---\r\n```", "branch": "master", "changed_files": 1, "comments": 7, "commits": 3, "created_at": "1646990356", "deletions": 8, "labels": ["analysis-pending", "pending-signatures", "tests-rejected", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_12_4_X", "number": 37208, "release-notes": [], "review_comments": 0, "state": "open", "title": "edmPickEvents improvements", "updated_at": "1647241774", "user": "iarspider"}
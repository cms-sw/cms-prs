{"additions": 2034, "auther_ref": "jgs_ph2_pixelTracking_addSimDoublets", "auther_sha": "dad641b5c4f72d0139902a89cca6320ca2f6ff30", "author": "JanGerritSchulz", "body": "### PR description:\r\nThis PR proposes the addition of a new class of truth information for Pixel Tracking called `SimDoublets`. \r\n\r\n#### Description of the class `SimDoublets`\r\nThe purpose of `SimDoublets` is to improve the validation of Patatrack Pixel Tracking and to facilitate its optimization. The focus lies on the first step of Patatrack Pixel Tracking which is connecting Pixel RecHits from close by layers to form doublets of compatible hits. The compatibility of two RecHits is defined by a number of cuts on $\\phi$, $z$ and cluster sizes. Each of those cuts has one cut parameter that should be tuned for achieving optimal performance. The new `SimDoublets` are the true doublets of RecHits coming from the same TrackingParticle and, therefore in this context, represent the ideal target outcome of the doublet creation. Hence, having the `SimDoublets` at hand, one can plot the distributions of all variables that are cut on during the doublet creation and apply those cuts on the true doublets alone. This enables efficiency determination on the doublet level, helping quantifying the performance and optimizing the cut values according to the true distributions.\r\n*Additional material:* [Presentation on SimDoublets](https://indico.cern.ch/event/1498184/contributions/6361871/attachments/3012989/5313856/AlpakaPixelTrackingPhase2_TrackingPOG.pdf).\r\n\r\n#### Proposed code changes\r\nIn order to implement this new class of `SimDoublets`, we propose the following changes:\r\n1. **Addition of a persistent reference to `SiPixelRecHit` in `SiPixelRecHitFwd.h`:**\r\n   Since the `SimDoublets` are essentially pairs of `SiPixelRecHit`s, we would like to store two persistent references to the RecHit objects in the `SiPixelRecHitCollection`. The reason why we prefer RecHits over clusters is that this is what is used in the Patatrack reconstruction.\r\n2. **New class `SimDoublets` under `SimDataFormats/TrackingAnalysis` including EDProducer and EDAnalyzer:**\r\n   The new class that stores references to the RecHits of a TrackingParticle and is able to produce of vector of RecHit doublets on the fly. The class comes alongside its own EDProducer (under `SimTracker/TrackerHitAssociation`) and DQM EDAnalyzer (under `Validation/TrackingMCTruth`). There is one producer and one analyzer for Phase 1 and Phase 2 respectively. We also added respective config files for testing the developments in `Validation/TrackingMCTruth/test`.\r\n3. **Extension of the cmsDriver options to have `hltPixelTrackingOnlyValidation`:**\r\n   To be used as `VALIDATION:@hltPixelTrackingOnlyValidation`, allows to only run the Pixel Tracking part of the MultiTrackValidator with HLT objects.\r\n4. **Adding a `SingleMuPt15Eta0_0p4_cfi` workflow:**\r\n   For testing purposes, we added this useful workflow to produce a pair of back-to-back muons of $p_T=15$ GeV in the barrel region of the Pixel Tracker with up to $|\\eta|<0.4$.\r\n\r\n#### Expected output changes\r\n- No changes in output expected since `SimDoublets` are not part of any sequence or workflow.\r\n\r\n#### Dependencies\r\n- This PR does not depend on other PRs or externals.\r\n\r\n### PR validation:\r\nThe following tests were performed succesfully.\r\n\r\n#### 1. SimDoublets\r\nThe added test files in `Validation/TrackingMCTruth/test` were used to validate the `SimDoublets` code. For this the used data files were step-2 output files for `SingleMu` and `TTbar`. You can test the e.g. by producing `TTbar` samples with:\r\n```bash\r\nrunTheMatrix.py --what upgrade -l 29634.0 --nThreads 10 --nEvents 10\r\n```\r\nAfterwards, go in `cd 29634.0_TTbar_14TeV+Run4D110` and run first:\r\n```bash\r\ncmsRun PathToCMSSW/src/Validation/TrackingMCTruth/test/simDoubletsPhase2_TEST.py\r\n```\r\nAnd then:\r\n```bash\r\ncmsRun PathToCMSSW/src/Validation/TrackingMCTruth/test/simDoubletsPhase2_HARVESTING.py\r\n```\r\n\r\n#### 2. Single muons workflow and cmsDriver option `hltPixelTrackingOnlyValidation`\r\nGenerate a `step1.root` file with the new `SingleMuPt15Eta0_0p4_cfi` workflow:\r\n```bash\r\ncmsDriver.py SingleMuPt15Eta0_0p4_cfi -s GEN,SIM -n 10 --conditions auto:phase2_realistic_T33 --beamspot DBrealisticHLLHC --datatier GEN-SIM --eventcontent FEVTDEBUG --geometry ExtendedRun4D110 --era Phase2C17I13M9 --relval 9000,100 --fileout file:step1.root \r\n```\r\nUsing the produced `step1.root` file, run with adapted new driver command options for validation to test it:\r\n```bash\r\ncmsDriver.py step2 -s DIGI:pdigi_valid,L1TrackTrigger,L1,L1P2GT,DIGI2RAW,HLT:75e33,VALIDATION:@hltPixelTrackingOnlyValidation --conditions auto:phase2_realistic_T33 --datatier GEN-SIM-DIGI-RAW,DQMIO -n 10 --eventcontent FEVTDEBUGHLT,DQMIO --geometry ExtendedRun4D110 --era Phase2C17I13M9 --procModifiers alpaka --filein file:step1.root\r\n```\r\n\r\n#### Credits:\r\nAuthored together with with [@elenavernazza](https://github.com/elenavernazza), [@Parsifal-2045](https://github.com/Parsifal-2045) and [@mmusich](https://github.com/mmusich).\r\n\r\n", "branch": "master", "changed_files": 20, "comments": 10, "commits": 6, "created_at": "1740478927", "deletions": 1, "labels": ["reconstruction-pending", "simulation-pending", "dqm-pending", "generators-pending", "pending-signatures", "tests-pending", "orp-pending", "pdmv-pending", "upgrade-pending", "code-checks-pending", "tracking", "trk", "changes-dataformats", "ngt"], "milestone": "CMSSW_15_1_X", "number": 47441, "release-notes": [], "review_comments": 9, "state": "open", "title": "[NGT] Adding `SimDoublets` class for Pixel Tracking Validation including corresponding EDProducers and EDAnalyzers", "updated_at": "1740566498", "user": "JanGerritSchulz"}
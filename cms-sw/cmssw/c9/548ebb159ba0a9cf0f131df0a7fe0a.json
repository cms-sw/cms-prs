{"additions": 69, "auther_ref": "deeptau-empty-inputs", "auther_sha": "3de18b482b123155d55ccb6aa1e014e70422a5ac", "author": "valsdav", "body": "#### PR description:\r\n\r\nFix DeepTau issue https://github.com/cms-sw/cmssw/issues/44333. \r\nBackport to 14_0_X of #44455 .\r\n\r\n```\r\n[2] Calling method for module DeepTauId/'hltHpsPFTauDeepTauProducerForVBFIsoTau'\r\nException Message:\r\nerror while running session: INVALID_ARGUMENT: Incompatible shapes: [0,1,1,64] vs. [154]\r\n```\r\n\r\nThe number of `valid_grid_cells` [here](https://github.com/cms-sw/cmssw/blob/619b1aa756a2181a5d946f22b4bba8c96c57b84d/RecoTauTag/RecoTau/plugins/DeepTauId.cc#L1123) is 0 for some events and this is creating a `TF::Tensor` with shape [0, 1, 1, N].  \r\n\r\nWhen this input is passed to a TF model executed on a CPU without `AVX512F AVX512_VNNI`,  the model is executed and returns an empty output without complaining.  When `AVX512F AVX512_VNNI` instructions are present, the TF executor complains. \r\n\r\nThis PR avoids calling the TF inference if empty inputs are detected. \r\n\r\nThe grid should never be empty. The issue will be followed up with Tau experts (enter here issue number..)\r\n\r\n\r\n#### PR validation:\r\nWorks on the issue reproducer from https://github.com/cms-sw/cmssw/issues/44333#issuecomment-1989632992\r\n- lxplus901 for AVX512\r\n- Pick event:\r\n```\r\nedmCopyPickMerge outputFile=pickevents.root eventsToProcess=367131:196942831 inputFiles=/store/data/Run2023C/DisplacedJet/RAW/v1/000/367/131/00000/9f3f571f-6dc9-4bda-a68b-5d1b9a5fc3ac.root\r\n```\r\n- Run:\r\n```\r\ncmsDriver.py step2 --conditions auto:run3_hlt_relval --data --datatier FEVTDEBUGHLT --era Run3_2023 --eventcontent FEVTDEBUGHLT --filein file:pickevents.root --fileout file:step2.root --nStreams 4 --nThreads 8 --number -1 --process reHLT --python_filename step_2_cfg.py --step L1REPACK:Full,HLT:@relval2024 --accelerators cpu\r\n```", "branch": "CMSSW_14_0_X", "changed_files": 2, "comments": 15, "commits": 2, "created_at": "1710795177", "deletions": 56, "labels": ["reconstruction-pending", "hlt-approved", "pending-signatures", "tests-approved", "orp-pending", "bug-fix", "urgent", "ml-pending"], "milestone": "CMSSW_14_0_X", "number": 44456, "release-notes": [], "review_comments": 0, "state": "open", "title": "[backport] DeepTau - Do not call TF inference with empty grid", "updated_at": "1710879127", "user": "valsdav"}
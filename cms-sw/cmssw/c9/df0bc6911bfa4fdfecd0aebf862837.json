{"additions": 23, "auther_ref": "pr-fixSimToReco", "auther_sha": "e5a90008fcc2d7e9012f489329ad2887133e1935", "author": "tcuisset", "body": "#### PR description:\r\nWhen two CaloParticles were overlapping, the previous version of the simToReco score approached one. For example, in the case of two overlapping photons with same energy, where $f_{sim}=0.5$ for all hits, the score would be 1 (worst association). The new score would be zero (best association). The problem appears for example in $\\pi^0\\to\\gamma\\gamma$ where the two photons are collimated.\r\n\r\n$f_{sim}$ is the fraction of SimHit energy over RecHit energy. $f_{reco}$ is the fraction of rechit energy used by the trackster/layer cluster (always 0 or 1 currently).\r\nOld score:\r\n$$S(sim \\to reco) = \\frac{\\sum_{\\text{hits}} \\min (f_{sim}^2; (1-f_{sim})^2) E_{reco}^2}{\\sum_{\\text{hits}} (f_{sim}E_{reco})^2}$$\r\n\r\nNew score:\r\n$$S(sim \\to reco) = \\frac{\\sum_{\\text{hits}} \\max(0,f_{sim}-f_{reco})^2 E_{reco}^2}{\\sum_{\\text{hits}} (f_{sim}E_{reco})^2}$$\r\n\r\n##### Validation plots with Single $\\pi^0$ sample (0PU):\r\nOld score (left: all tracksters, center: best matched trackster, right : second best matched)\r\n![Old score](https://github.com/user-attachments/assets/759c88ee-1737-4c3d-918c-88a6b6c3e640)\r\nNew score\r\n![New score](https://github.com/user-attachments/assets/8c54fce4-922a-44d6-815b-57566bff6add)\r\n\r\n\r\nChanges are expected in SimToReco scores (significant only when there are overlapping caloparticles). No changes are expected in RecoToSim.\r\n\r\n#### PR validation:\r\nValidated on 29634.203,29693.203, 29834.203 and on Single Pi0 samples\r\n\r\nFYI @felicepantaleo ", "branch": "master", "changed_files": 2, "comments": 5, "commits": 1, "created_at": "1747912982", "deletions": 10, "labels": ["simulation-pending", "pending-signatures", "tests-approved", "orp-pending", "upgrade-pending", "code-checks-approved"], "milestone": "CMSSW_15_1_X", "number": 48148, "release-notes": [], "review_comments": 0, "state": "open", "title": "TICL: change Trackster SimToReco score, to fix overlapping CaloParticle issues", "updated_at": "1747920807", "user": "tcuisset"}
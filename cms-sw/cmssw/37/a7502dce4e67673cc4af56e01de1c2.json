{"additions": 2, "auther_ref": "cutparser-random-mem-bug", "auther_sha": "1ef5ad9b32674372bc89c79a0d6b046b1cc7bfad", "author": "davidlt", "body": "`edm::TypeWithDict::name()` returns a `std::string`. The code was\ntaking a pointer to temporary string. Thus causing CutParser to\nfail depending on random values in memory.\n\nGDB output below. Memory pattern was set to 0x04, thus the `name` is just a sequence of 0x04.\n\n```\nBreakpoint 3, reco::parser::ExpressionVarSetter::push (this=0x12fda930,\n    begin=0x12fd7b58 \"strip < 400000 && pixel < 40000 && (strip < 50000 + 10*pixel) && (pixel < 5000 + 0.1*strip)\",\n    end=0x12fd7b5d \" < 400000 && pixel < 40000 && (strip < 50000 + 10*pixel) && (pixel < 5000 + 0.1*strip)\")\n    at /build/davidlt/debug/CMSSW_7_5_0_pre4/src/CommonTools/Utils/src/ExpressionVarSetter.cc:17\n17        edm::TypeWithDict type = typeStack_.back();\n(gdb) n\n18        method::TypeCode retType = reco::typeCode(type);\n(gdb) p type\n$25 = {ti_ = 0x7ffff6546b20 <typeinfo for int>, class_ = 0x0, enum_ = 0x0, dataType_ = 0x3a0fd10, arrayDimensions_ = {myP = 0x0}, property_ = 0}\n(gdb) s\nreco::typeCode (t=...) at /build/davidlt/debug/CMSSW_7_5_0_pre4/src/CommonTools/Utils/src/returnType.cc:46\n46          const char* name = t.name().c_str();\n(gdb) n\n51            });\n(gdb) p name\n$26 = 0x12fda128 '\\004' <repeats 16 times>, \"\\061\"\n```\n\n```\n----- Begin Fatal Exception 25-May-2015 10:35:59 CEST-----------------------\nAn exception of category 'Configuration' occurred while\n   [0] Constructing the EventProcessor\n   [1] Constructing module: class=SeedGeneratorFromRegionHitsEDProducer label='initialStepSeedsPreSplitting'\nException Message:\nCut parser error:member \"strip\" has an invalid return type: \"int\" (char 0)\n----- End Fatal Exception -------------------------------------------------\n```\n\nSigned-off-by: David Abdurachmanov David.Abdurachmanov@cern.ch\n", "branch": "CMSSW_7_5_X", "changed_files": 1, "closed_at": "1432809601", "comments": 10, "commits": 1, "created_at": "1432541665", "deletions": 2, "labels": ["analysis-pending", "comparison-available", "orp-pending", "pending-signatures", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "2c015fe5474ae51c529bfbcdcd21ec5e877f494f", "merged_at": "1432809601", "merged_by": "davidlange6", "milestone": "CMSSW_7_5_X", "number": 9261, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix use-after-free bug in typeCode", "updated_at": "1432809601", "user": "davidlt"}
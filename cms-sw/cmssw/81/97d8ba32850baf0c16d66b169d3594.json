{"additions": 353, "auther_ref": "13_0_X_useFakeBSasFallBackInOnlineProducer2", "auther_sha": "991186be170060dbee10ee3b6912b247fce9fba4", "author": "mmusich", "body": "backport of https://github.com/cms-sw/cmssw/pull/41597 (partial)\r\n\r\n#### PR description:\r\n\r\nWhile working on https://github.com/cms-sw/cmssw/pull/41193/, I have noticed that despite `OnlineBeamSpotESProducer`  has a refined logic in order to put into the event setup a fake BeamSpot when certain conditions are not met:\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/a52f2d1ecf97bde0e9f10d45959c88337c481687/RecoVertex/BeamSpotProducer/plugins/OnlineBeamSpotESProducer.cc#L168-L174\r\n\r\nthe current `BeamSpotOnlineProducer` logic, if `useTransientRecord_` is true and the  `OnlineBeamSpotESProducer` returned a fake beamspot, just falls back to DB (reading the content of `BeamSpotObjectsRcd`, populated by the PCL in realtime workflows)  - which I have understood from the Beam Spot experts is not the right / expected behaviour.\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/a52f2d1ecf97bde0e9f10d45959c88337c481687/RecoVertex/BeamSpotProducer/plugins/BeamSpotOnlineProducer.cc#L104-L111\r\n\r\nIn this PR (in commit 5a3afffd4a64b32c6049cee8d8afd4beef9090cf) I change the current behaviour, such that instead now it will indeed produce a fake BS for consumption online (as it was originally devised).\r\n\r\nIn the master branch, I have found convenient to create a new plugin `BeamSpotOnlineFromOfflineConverter` that taking a `BeamSpotObject` in input creates an sqlite file in output containing a payload of the type `BeamSpotOnlineObjects`. This has been added in commit  0b2e1056426f5188428ea8b0708806e234d00fe1, while commits 6f1912eae5366630cd0543e704bf3c236fa16b47 and  5c011c8a90fbbebd3ac9f7a471538cd6b56123e0 add a utility accessor to the `BeamSpotOnlineObjects` condtion format to be able to readily copy from a `BeamSpotObjects` payload (friend class) all the common parameters. Finally commit 991186be170060dbee10ee3b6912b247fce9fba4 adds this converter to the battery of unit tests of the `CondTools/BeamSpot` package. \r\n\r\n**N.B.**\r\nI have NOT backported commits d5eedb8d39434b42da0a387b7478656d40a27ab0 and 63e821e6fe98cfc774029b4f7798053f21fd2153 in this PR as they are not needed. Indeed in 13.0.X the phase-2 HLT menu uses the offline BeamSpot directly, without using the fallback mechanism, see:\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/3dc3c13aa2c349c35c405a0fb3ba66b4abdb8e6f/HLTrigger/Configuration/python/HLT_75e33/modules/offlineBeamSpot_cfi.py#L1-L3\r\n\r\n(the move was done in https://github.com/cms-sw/cmssw/pull/41047 which was not backported)\r\n\r\n\r\n\r\n#### PR validation:\r\n\r\n`cmssw` complies. Passes back unit tests.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nThis is a backport of https://github.com/cms-sw/cmssw/pull/41597, to be backported down to 13.0.X for 2023 data-taking purposes.", "branch": "CMSSW_13_0_X", "changed_files": 6, "closed_at": "1684233445", "comments": 7, "commits": 5, "created_at": "1684140682", "deletions": 30, "labels": ["alca-approved", "reconstruction-approved", "fully-signed", "tests-approved", "db-approved", "orp-approved", "tracking"], "merge_commit_sha": "6e9ea6c2e0d5ccfb68f48345030633339c52d1b4", "merged_at": "1684233445", "merged_by": "cmsbuild", "milestone": "CMSSW_13_0_X", "number": 41674, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[13.0.X] Produce a fake `BeamSpot` object in `BeamSpotOnlineProducer` when using transient record logic and `OnlineBeamSpotESProducer` returned a fake", "updated_at": "1684233454", "user": "mmusich"}
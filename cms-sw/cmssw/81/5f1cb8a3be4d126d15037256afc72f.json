{"additions": 58, "auther_ref": "PluginLoadError", "auther_sha": "41c52ca4733c87b197b6a5cd18b1e92d1e29245a", "author": "guitargeek", "body": "#### PR description:\r\n\r\nThe error message that you get if you delete plugin that is in the realease in your work area, and then try to use that plugin, is not very informative. The way this is handled is by referring to \"poisoned\" libraries in the work area, which actually don't exist. So you get some error like this:\r\n\r\n```\r\n----- Begin Fatal Exception 04-Sep-2019 13:39:04 CEST-----------------------\r\nAn exception of category 'PluginLibraryLoadError' occurred while\r\n   [0] Constructing the EventProcessor\r\nException Message:\r\nunable to load /scratch/rembser/cmssw/dev/CMSSW_11_0_X_2019-09-02-2300/lib/slc7_amd64_gcc700/poisoned/plugin-poisoned-RecoEgammaElectronIdentificationPlugins.so because /scratch/rembser/cmssw/dev/CMSSW_11_0_X_2019-09-02-2300/lib/slc7_amd64_gcc700/poisoned/plugin-poisoned-RecoEgammaElectronIdentificationPlugins.so: cannot open shared object file: No such file or directory\r\n----- End Fatal Exception -------------------------------------------------\r\n```\r\n\r\nHowever, it would be great (in particular to catch mistakes in cleanup PRs) if the message told you the name of the plugin it tried to load in the first place. I propose to add this information as a context to the exception (thanks @Dr15Jones for the implementation idea). The error message would look like this then:\r\n\r\n```\r\n----- Begin Fatal Exception 04-Sep-2019 13:39:04 CEST-----------------------\r\nAn exception of category 'PluginLibraryLoadError' occurred while\r\n   [0] Constructing the EventProcessor\r\n   [1] While attempting to load plugin ElectronMVANtuplizer\r\nException Message:\r\nunable to load /scratch/rembser/cmssw/dev/CMSSW_11_0_X_2019-09-02-2300/lib/slc7_amd64_gcc700/poisoned/plugin-poisoned-RecoEgammaElectronIdentificationPlugins.so because /scratch/rembser/cmssw/dev/CMSSW_11_0_X_2019-09-02-2300/lib/slc7_amd64_gcc700/poisoned/plugin-poisoned-RecoEgammaElectronIdentificationPlugins.so: cannot open shared object file: No such file or directory\r\n----- End Fatal Exception -------------------------------------------------\r\n```\r\n\r\nWe talked a bit about this already a little bit in PR https://github.com/cms-sw/cmssw/pull/27522 (in particular https://github.com/cms-sw/cmssw/pull/27522#issuecomment-516534785).\r\n\r\nWhile investigating how to do that I \"git grepped\" for \"SharedLibrary\" and therefore found by chance many places where `SharedLibrary.h` is included but not used. We could also remove these as a little side effect of this PR.\r\n\r\n#### PR validation:\r\n\r\nCMSSW compiles, local matrix tests pass.\r\n\r\n#### if this PR is a backport please specify the original PR:\r\n\r\nNo backport intended.\r\n", "branch": "master", "changed_files": 17, "closed_at": "1568053492", "comments": 26, "commits": 4, "created_at": "1567235211", "deletions": 80, "labels": ["code-checks-approved", "comparison-available", "core-approved", "db-approved", "fully-signed", "orp-approved", "tests-approved"], "merge_commit_sha": "da056efffaccbbdde834a46bcc54926cd7a4e352", "merged_at": "1568053492", "merged_by": "cmsbuild", "milestone": "CMSSW_11_0_X", "number": 27908, "release-notes": [], "review_comments": 2, "state": "closed", "title": "More verbose error if plugin could not be loaded due to missing shared library", "updated_at": "1568053492", "user": "guitargeek"}
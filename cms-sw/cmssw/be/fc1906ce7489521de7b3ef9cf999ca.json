{"additions": 1, "auther_ref": "fix_custom_particle", "auther_sha": "9835277195179f3b6c9a843627dd97d2489a09d2", "author": "sarafiorendi", "body": "#### PR description:\r\n\r\nThis PR is to fix the behaviour of the CustomParticleFactory class in order to correctly include the corresponding anti-particle each time a new particle is added to the list.\r\nThe correct behaviour was somehow broken with [this commit](https://github.com/cms-sw/cmssw/commit/c3d2a3218041b3de169093b1c1df2d337fe1d74d#diff-3356a0227a88656afdbec257541eeac667962e40e2514de565256487d2ca9b32) which reverted the condition necessary to call the addCustomParticle() function (which should add the anti-particle to the particle table).\r\nSo in the current releases the function will be called only if the anti-particle is already there.\r\nAs an example, in my case I needed to add the stau and anti-stau particles, but only the stau was added, while the anti-stau was not, with a series of consequences in the following steps (e.g., charge was set to 0, anti-stau track non added to the SIM track collection, etc...)\r\n\r\nFYI @civanch \r\n\r\n#### PR validation:\r\n\r\nTesting locally. For example, I was previously getting this printout when checking particle info [here](https://github.com/cms-sw/cmssw/blob/CMSSW_12_4_11_patch3/SimG4Core/Generators/src/Generator.cc#L399)\r\n\r\n```\r\n==== PDGcode -1000015  Particle name  is not defined in G4.\r\n Assigned charge : 0\r\n     Momentum ( -208.984[GeV/c], 278.581[GeV/c], -974.195[GeV/c] )\r\n     kinetic Energy : 1.03457e+06 [GeV]\r\n     Mass is not assigned\r\n     Weight : 1\r\n```\r\nand with the fix I get the expected behaviour\r\n\r\n```\r\n==== PDGcode -1000015  Particle name anti_~tau_1\r\n Assigned charge : 1\r\n     Momentum ( -208.984[GeV/c], 278.58[GeV/c], -974.194[GeV/c] )\r\n     kinetic Energy : 939392 [GeV]\r\n     Mass : 100 [GeV]\r\n     Weight : 1\r\n```\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nI think we need to backport this change also to other release cycles, for sure to 12_4_X used for Run3Summer22(EE) MC production.\r\nThe behaviour is correct in the 10_6_X cycle used for UL MC production (see [here](https://github.com/cms-sw/cmssw/blob/CMSSW_10_6_X/SimG4Core/CustomPhysics/src/CustomParticleFactory.cc#L307)).\r\n\r\n", "branch": "master", "changed_files": 1, "comments": 7, "commits": 1, "created_at": "1696509028", "deletions": 1, "labels": ["simulation-approved", "fully-signed", "tests-approved", "orp-pending", "bug-fix", "code-checks-approved"], "milestone": "CMSSW_13_3_X", "number": 42957, "release-notes": [], "review_comments": 0, "state": "open", "title": "Fix condition to add anti-particle to G4ParticleTable", "updated_at": "1696568941", "user": "sarafiorendi"}
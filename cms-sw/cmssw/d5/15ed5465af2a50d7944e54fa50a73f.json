{"additions": 3, "auther_ref": "timestudy-bugfixes", "auther_sha": "a363542c31228bf870a3728b74c73206c4eb0421", "author": "dan131riley", "body": "#### PR description:\r\n\r\nTestFWCoreModules in FWCore/Modules has a rare failure mode, most recently seen in CMSSW_15_1_UBSAN_X_2025-03-26-2300, with UBSAN warnings\r\n```\r\n/data/cmsbld/jenkins/workspace/build-any-ib/w/el8_amd64_gcc12/external/gcc/12.3.1-40d504be6370b5a30e3947a6e575ca28/include/c++/12.3.1/bits/stl_iterator.h:1096:17: runtime error: reference binding to null pointer of type 'int'\r\n    #0 0x14b729a4d6ca in __gnu_cxx::__normal_iterator<int*, std::vector<int, std::allocator<int> > >::operator*() const /data/cmsbld/jenkins/workspace/build-any-ib/w/el8_amd64_gcc12/external/gcc/12.3.1-40d504be6370b5a30e3947a6e575ca28/include/c++/12.3.1/bits/stl_iterator.h:1096\r\n    #1 0x14b729a4d6ca in timestudy::SleepingServer::threadWork() src/FWCore/Modules/src/TimeStudyModules.cc:246\r\n    #2 0x14b7386d8a72 in execute_native_thread_routine ../../../../../libstdc++-v3/src/c++11/thread.cc:82\r\n    #3 0x14b737c061c9 in start_thread (/lib64/libpthread.so.0+0x81c9)\r\n    #4 0x14b7382638d2 in __GI___clone (/lib64/libc.so.6+0x398d2)\r\n\r\nsrc/FWCore/Modules/src/TimeStudyModules.cc:246:23: runtime error: load of null pointer of type 'int'\r\n    #0 0x14b729a4d742 in timestudy::SleepingServer::threadWork() src/FWCore/Modules/src/TimeStudyModules.cc:246\r\n    #1 0x14b7386d8a72 in execute_native_thread_routine ../../../../../libstdc++-v3/src/c++11/thread.cc:82\r\n    #2 0x14b737c061c9 in start_thread (/lib64/libpthread.so.0+0x81c9)\r\n    #3 0x14b7382638d2 in __GI___clone (/lib64/libc.so.6+0x398d2)\r\n```\r\nfollowed by a segmentation violation.  This PR corrects two issues (found by code inspection) where the vector size or capacity wasn't being correctly maintained, and one issue (found through additional debugging) where spurious wakeups could be triggered when there were no waiting streams to process.\r\n\r\nResolves https://github.com/cms-sw/framework-team/issues/1321\r\n\r\n#### PR validation:\r\n\r\nTechnical fix.  Without the change, the crash was moderately reproducible.  With these modifications, no test failures have been observed.", "branch": "master", "changed_files": 1, "comments": 4, "commits": 2, "created_at": "1743178866", "deletions": 1, "labels": ["core-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_15_1_X", "number": 47728, "release-notes": [], "review_comments": 0, "state": "open", "title": "fixes for vector size handling and spurious wakeups in TimeStudyModules", "updated_at": "1743179228", "user": "dan131riley"}
{"additions": 44, "auther_ref": "flush_at_1k", "auther_sha": "ab334b4608d914dd14ce7c861618ab00c7ebf689", "author": "bbockelm", "body": "ROOT will automatically add 16 bytes per branch buffer per event in the event cluster; in the case of NanoAOD files, we've seen up to 143k events per cluster (and 800 branches), resulting in an excess of 900MB of memory usage.\r\n\r\nWith this change, we explicitly optimize NanoAOD buffers after 1k events, then subsequently flush at more appropriate intervals.  To achieve this, we disable the ROOT auto-flush mechanism and explicitly optimize / flush from the NanoAOD output module itself.", "branch": "CMSSW_9_4_X", "changed_files": 1, "comments": 6, "commits": 1, "created_at": "1520097646", "deletions": 6, "labels": ["analysis-pending", "comparison-pending", "orp-pending", "pending-signatures", "tests-approved"], "milestone": "CMSSW_9_4_X", "number": 22445, "release-notes": [], "review_comments": 0, "state": "open", "title": "Optimize NanoAOD buffers at 1k events.", "updated_at": "1520868449", "user": "bbockelm"}
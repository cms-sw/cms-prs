{"additions": 2, "auther_ref": "FixHcalAmplifier", "auther_sha": "8e3f3a61b39d89d1daa6c0d0bd0d67c6748c205a", "author": "kpedro88", "body": "#### PR description:\r\n\r\nFollowup to #30829. The issue persisted because ZDC DetIds have subdet = 2, but det = Calo (not Hcal). Checking only the subdet was not sufficient.\r\n\r\nI determined this as follows:\r\n```\r\ncmsrel CMSSW_11_2_UBSAN_X_2020-07-31-2300\r\ncd CMSSW_11_2_UBSAN_X_2020-07-31-2300/src\r\ncmsenv\r\ngit cms-addpkg SimCalorimetry/HcalSimAlgos SimCalorimetry/HcalSimProducers\r\nUSER_CXXFLAGS=\"-g -fno-omit-frame-pointer\" scram b\r\nrunTheMatrix.py -l 11834.24\r\ncd 11834.24_TTbar_14TeV+TTbar_14TeV_TuneCP5_2021PU_GenSimFull_0T+DigiFullPU_0T_2021PU+RecoFullPU_0T_2021PU+HARVESTFullPU_0T_2021PU+NanoFull_2021PU\r\nUBSAN_OPTIONS=print_stacktrace=1 cmsRun step2_DIGI_L1_DIGI2RAW_HLT_PU.py\r\n```\r\nand then used `addr2line` on the UBSAN stack trace (which printed addresses like `CMSSW_11_2_UBSAN_X_2020-07-31-2300/lib/slc7_amd64_gcc820/libSimCalorimetryHcalSimAlgos.so+0xbdd68` rather than line numbers).\r\n\r\nThat produced the following:\r\n```\r\n#0 /uscms_data/d3/pedrok/phase2/CMSSW_11_2_UBSAN_X_2020-07-31-2300/src/SimCalorimetry/HcalSimAlgos/src/HcalAmplifier.cc:51\r\n#1 /uscms_data/d3/pedrok/phase2/CMSSW_11_2_UBSAN_X_2020-07-31-2300/src/SimCalorimetry/HcalSimAlgos/src/HcalElectronicsSim.cc:34\r\n#2 /uscms_data/d3/pedrok/phase2/CMSSW_11_2_UBSAN_X_2020-07-31-2300/src/SimCalorimetry/HcalSimAlgos/src/HcalElectronicsSim.cc:110\r\n#3 /uscms_data/d3/pedrok/phase2/CMSSW_11_2_UBSAN_X_2020-07-31-2300/src/SimCalorimetry/HcalSimAlgos/interface/HcalDigitizerTraits.h:55\r\n#4 /uscms_data/d3/pedrok/phase2/CMSSW_11_2_UBSAN_X_2020-07-31-2300/src/SimCalorimetry/HcalSimProducers/src/HcalDigitizer.cc:490\r\n#5 /uscms_data/d3/pedrok/phase2/CMSSW_11_2_UBSAN_X_2020-07-31-2300/src/SimCalorimetry/HcalSimProducers/src/HcalDigiProducer.cc:35\r\n```\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/e8703674b3fe9dc89fc03174d924c8d571440985/SimCalorimetry/HcalSimProducers/src/HcalDigitizer.cc#L490 points to ZDC, which allowed me to understand the problem.\r\n\r\n#### PR validation:\r\n\r\nRan 11834.24 in UBSAN IB and saw that the error message went away.", "branch": "master", "changed_files": 1, "closed_at": "1596608414", "comments": 14, "commits": 2, "created_at": "1596492380", "deletions": 2, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "62541ce6d6df48d3d7e11950006d19aea3c7af3f", "merged_at": "1596608414", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 31039, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix improper static_cast in HcalAmplifier (part 2)", "updated_at": "1596608414", "user": "kpedro88"}
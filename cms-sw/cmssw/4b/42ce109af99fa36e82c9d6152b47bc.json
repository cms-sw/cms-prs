{"additions": 72, "auther_ref": "backport-raw-skims-14-1-X", "auther_sha": "a03583e219f6754e476b3e44fdbd3785f01d01c3", "author": "LinaresToine", "body": "#### PR description:\r\n\r\n* Changes expected in the output:\r\n   * This is an implementation of the Reserved dataset discussed in https://its.cern.ch/jira/browse/CMSTZ-1048. The output RAW file from the Repack workflow does not contain all triggers in the HLT path `Dataset_ParkingDoubleMuonLowMass0`, in other words it is skimmed. This is a separate workflow than that of `ParkingDoubleMuonLowMass0`, so the original `ParkingDoubleMuonLowMass0/RAW` is still being created separately. The proposed implementation allows for other RAW skims to be created and used for any other dataset.\r\n*  This new functionality is triggered when T0 inserts an output module with `rawSkims`.  Ths implies changes in T0 code and WMCore code:\r\n   * T0: https://github.com/dmwm/T0/pull/5041\r\n   * WMCore:  https://github.com/dmwm/WMCore/pull/12298\r\n* Related documentation:\r\n   * [JIRA-CMSTZ-1048](https://its.cern.ch/jira/browse/CMSTZ-1048)\r\n   * [RAWSkims-google-docs](https://docs.google.com/presentation/d/1mL5FUriH746y8pLl0ZQymKoEPxkg-8H_-8LLGt5_akM/edit#slide=id.gc94ed6e110_0_14 )\r\n\r\n\r\n\r\n#### PR validation:\r\n\r\nThis PR was tested locally by running the `RunRepack.py` included in this PR, which has also been modified to support the use of raw skims. The command used is:\r\n\r\n```\r\n#source cmsset values\r\nsource /cvmfs/cms.cern.ch/cmsset_default.sh\r\n\r\n# define architecture\r\nexport SCRAM_ARCH \"el8_amd64_gcc12\"\r\n\r\n#create the project with CMSSW version\r\nscramv1 project CMSSW \"CMSSW_14_0_15_patch1\"\r\n\r\n# Move to src folder\r\ncd \"CMSSW_14_0_15_patch1/src/\" \r\ncmsenv\r\ngit cms-init\r\ngit cms-addpkg Configuration/DataProcessing\r\ngit cms-addpkg Configuration/Skimming\r\n\r\n### Apply changes presented in this PR ###\r\n\r\n# Build changes\r\nscram b\r\n\r\n#source cms environment variables\r\neval \"$(scramv1 runtime -sh)\"\r\n\r\npython3 \"Configuration/DataProcessing/test/RunRepack.py\" \\\r\n        --select-events \"Dataset_ParkingDoubleMuonLowMass0:HLT,Dataset_ParkingDoubleMuonLowMass0:HLT\" \\\r\n        --lfn \"file:/eos/cms/store/t0streamer/Data/ParkingDoubleMuonLowMass0/000/386/925/run386925_ls0001_streamParkingDoubleMuonLowMass0_StorageManager.dat\" \\\r\n        --raw-skim \"ReserveDMu\" \\\r\n        --global-tag \"141X_dataRun3_Prompt_v4\" || { echo \"Unable to create PSet\"; exit 1; }\r\n\r\n```\r\n\r\nThe `Repack.py` file takes a set of arguments `**args`. T0 provides a list of `outputs` and a `dataTier`. The `list` of `outputs` will have dictionaries, each containing relevant output modules for each dataset. This new feature requires that a `rawSkim` is provided within each `output` that requires skimming, and a new `arg` `globalTag` in order to access the paths in the selected `rawSkim`. For this test we used `rawSkim = \"ReserveDMu\"` and `globalTag = \"141X_dataRun3_Prompt_v4\"`. The workflow creates two output modules in `outputs`, one will have the `rawSkim` and the other wont. Both will take the same HLT Path `Dataset_ParkingDoubleMuonLowMass0`. The streamer file is the same, with 200 events tota: 103 events from `Dataset_ParkingDoubleMuonLowMass0` and 97 from `Dataset_ParkingDoubleMuonLowMass1`. The first output, since it has the raw skim, will filter out events out of the total 200 events. This output is a RAW file with 114 events. The second output does not have a `rawSkim`, so it will only take events from the `Dataset_ParkingDoubleMuonLowMass0`, which is 103. Such second output is as predicted, with 103 events.\r\n\r\nFor transparency, the `RunRepackCfg.py` as well as both outputs `write_PrimDS_skimmed.root` and `write_PrimDS_unskimmed.root` have been placed in\r\n```\r\n/eos/home-c/cmst0/public/RawSkimTest/write_PrimDS_skimmed.root\r\n```\r\n\r\nThis is a backport to CMSSW_14_1_X. We require this backport in order to use the new feature with Run2024 data. The master PR is [cms-sw/cmssw#47525](https://github.com/cms-sw/cmssw/pull/47525)\r\n", "branch": "CMSSW_14_1_X", "changed_files": 3, "closed_at": "1742542046", "comments": 23, "commits": 4, "created_at": "1741898058", "deletions": 29, "labels": ["operations-approved", "fully-signed", "tests-approved", "pdmv-approved", "orp-approved"], "merge_commit_sha": "16549640d737ff027378106cf56f36e88c327fd6", "merged_at": "1742542046", "merged_by": "cmsbuild", "milestone": "CMSSW_14_1_X", "number": 47596, "release-notes": [], "review_comments": 0, "state": "closed", "title": "backport Raw Skims to CMSSW_14_1_X", "updated_at": "1742542049", "user": "LinaresToine"}
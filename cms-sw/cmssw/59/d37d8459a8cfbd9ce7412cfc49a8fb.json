{"additions": 74, "auther_ref": "for-mkFit-reincarnated/logWarningsDet", "auther_sha": "4af14417245e6073961e0d3a4f6628d6cdec1ca0", "author": "slava77", "body": "This PR intends to address #35798, to reduce warnings about bad track states downstream of mkFit track building.\r\n\r\nIn addition to already present check for positive-definiteness of the covariance based on the diagonal elements, more selections were added to MkFitOutputConverter in order to send only trackable candidates:\r\n- the covariance matrix is checked using the Sylvester's criterion to have a full check of positive-definiteness\r\n- \"sanity\" checks for the track candidate parameters:\r\n    - pt > 10 MeV\r\n    -   [0.01, 0.01]\r\n    - state position inside the tracker: r < 120 cm and |z| < 280 cm; position uncertainty below 100 cm\r\n\r\nThe CPU cost in the converter goes up by about 0.02% of the reco time based on wf 136.874: [before](https://slava77sk.web.cern.ch/slava77sk/reco/cgi-bin/igprof-navigator/sw-123X/CMSSW_12_3_0_pre1-sign1131.pass-e731805.136.874.step3.100.pp/1873) vs [after](https://slava77sk.web.cern.ch/slava77sk/reco/cgi-bin/igprof-navigator/sw-123X/CMSSW_12_3_0_pre1-sign1131.pass-bce63d6.136.874.step3.100.pp/1716)\r\n\r\nThe number of logWarnings went down, focusing on the ones with ` not pos` in the warning message (using `CMSSW_12_3_0_pre1` as a reference):\r\n- in 136.874 on 100 events: baseline 112, noMkFit baseline 3, this PR 12.\r\n    - the warnings are in modules not directly reading mkFit track candidates\r\n- in wf 11834.21 on 400 events: baseline 2636, noMkFit 31, this PR 19\r\n    - the warnings are in modules not directly reading mkFit track candidates\r\n- in a trackingOnly test similar to 11834.21 with PU50 on 1000 events: baseline 2209, noMkFit 19, this PR 17\r\n    - here 14 warnings are in modules reading mkFit track candidates\r\n\r\nOn average, it seems that the number of warnings is roughly back to the rate seen with the  old setup using just the CKF builder.\r\n\r\nSmall changes are expected due to rejection of mainly bad tracks.\r\n@leonardogiannini checked in a sample with pileup 50 on 1000 evens, there are negligible or [no differences in the MTV plots](http://uaf-10.t2.ucsd.edu/~legianni/plotsMTV-FebTRKPOG/checkDeterminant/checkWarnings-final/plots_ootb.html):\r\nlooking at all tracks\r\n<img width=\"696\" alt=\"image\" src=\"https://user-images.githubusercontent.com/4676718/156694265-3b08286a-538b-419b-8b6d-0e3e077ce3e9.png\">\r\nThe effect is a bit more visible in the pixelLess iteration, the most affected iteration\r\n<img width=\"696\" alt=\"image\" src=\"https://user-images.githubusercontent.com/4676718/156839098-46d6a4af-05d9-46aa-b116-a080abf45811.png\">\r\n\r\n\r\n@osschar @makortel @mmasciov \r\n@cms-sw/tracking-pog-l2 ", "branch": "master", "changed_files": 1, "comments": 7, "commits": 3, "created_at": "1646361524", "deletions": 26, "labels": ["reconstruction-pending", "pending-signatures", "tests-approved", "orp-pending", "urgent", "code-checks-approved"], "milestone": "CMSSW_12_3_X", "number": 37139, "release-notes": [], "review_comments": 0, "state": "open", "title": "add quality selections in MkFitOutputConverter", "updated_at": "1646659709", "user": "slava77"}
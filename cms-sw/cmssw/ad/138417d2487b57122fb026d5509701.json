{"additions": 195, "auther_ref": "furtherOptSiPixelLorentzAnglePCLWorker", "auther_sha": "11af8f80bed7bbdd0f3d28b4f7199d74d4dae5a6", "author": "mmusich", "body": "#### PR description:\r\n\r\nThis PR builds on top of https://github.com/cms-sw/cmssw/pull/36538 and proposes some further optimization and bug-fixes to the   SiPixel Lorentz Angle PCL workflow:\r\n   * further memory footprint reduction is achieved in commit 69b9256f3d0be42121c826f63094094fee22375a by loading the `SiPixelTemplate` object in memory on demand in the case in which the module `SiPixelLorentzAnglePCLWorker` is not run in PCL mode (`notInPCL_ = True`) and by reducing the number of bins of the 2D drift vs depth maps.\r\n   * for Run2 replays the list of \"new\" modules is different. That is dealt with via era modifiers in commit c9aa27ab2e045b958c5294d753eaee9ccae6a8a0\r\n   * a bug that was messing up the computation of the value of the Lorentz Angle for the \"new\" modules is addressed at fb4f1262f51a74929275b33e29e4d5c795b84bda\r\n   * monitoring of the input number of clusters and output Lorentz Angle (and fit chi2/ndf) is introduced at 0cfb6bf446943c82b59b37bd66c4062fd3b8c080\r\n   * `std::endl` at the end of LogMessages is removed as requested at https://github.com/cms-sw/cmssw/pull/36538#issuecomment-998643023 in commit 0cfb6bf446943c82b59b37bd66c4062fd3b8c080\r\n   * some documentation is added in commit 199bcd689cdd6619718a85d496022abb7e5031e8\r\n    \r\n#### PR validation:\r\n\r\nPrivately run:\r\n\r\n```console\r\n cmsDriver.py testReAlCa -s ALCA:PromptCalibProdSiPixelLorentzAngle --conditions 121X_dataRun3_Express_TIER0_REPLAY_Run2_v1 --scenario pp --data --era Run2_2018 --datatier ALCARECO --eventcontent ALCARECO --processName=ReAlCa -n 100000 --dasquery='file dataset=/StreamExpress/Tier0_REPLAY_2021-SiPixelCalSingleMuon-Express-v1/ALCARECO' --customise_commands='process.ALCARECOCalSignleMuonFilterForSiPixelLorentzAngle.TriggerResultsTag = cms.InputTag ( \"TriggerResults\",\"\",\"HLT\" ) ; process.ALCARECOCalSignleMuonFilterForSiPixelLorentzAngle.HLTPaths = [\"*\"]' --nThreads=4 \r\n```\r\n\r\nfollowed by:\r\n\r\n```console\r\n cmsDriver.py stepHarvest -s ALCAHARVEST:SiPixelLA --conditions 121X_dataRun3_Express_TIER0_REPLAY_Run2_v1 --scenario pp --data --era Run2_2018 --filein file:PromptCalibProdSiPixelLorentzAngle.root -n -1\r\n```\r\nthe results are uploaded to a private DQM GUI at https://tinyurl.com/y52qktrd:\r\n   * necessitates tunneling (`ssh -NL 8060:localhost:8060 <USER>@lxplus723.cern.ch`). \r\n\r\nProfiling the RSS vs time of the job containing the `ALCA:PromptCalibProdSiPixelLorentzAngle` (run on 4 threads and 4 stream) shows a reduction of about half:\r\n\r\n![memory_target_PCLReduction](https://user-images.githubusercontent.com/5082376/146970858-32720d93-5e11-4c7a-bc24-d2b8ceafdc79.png)\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nNot a backport, but might be backported together with https://github.com/cms-sw/cmssw/pull/36538 to CMSSW_12_2_X as agreed at https://github.com/cms-sw/cmssw/pull/36538#issuecomment-997386926", "branch": "master", "changed_files": 6, "comments": 13, "commits": 10, "created_at": "1640104463", "deletions": 105, "labels": ["alca-pending", "pending-signatures", "tests-pending", "orp-pending", "bug-fix", "code-checks-approved"], "milestone": "CMSSW_12_3_X", "number": 36565, "release-notes": [], "review_comments": 5, "state": "open", "title": "Further optimization of the SiPixel LA PCL workflow", "updated_at": "1640206347", "user": "mmusich"}
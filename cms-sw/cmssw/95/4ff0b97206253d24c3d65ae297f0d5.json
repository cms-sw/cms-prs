{"additions": 105, "auther_ref": "ecal_condobject_container_iterator_fix", "auther_sha": "e20409eb86ed70ef589bd9d8fe8d4a718a2e5542", "author": "b-fontana", "body": "Backport from #33573 for the next mid week global run.\r\n\r\n#### PR description:\r\n\r\n- The ```EcalCondObjectContainer``` class currently contains a ```begin()``` and an ```end()``` functions that return ```const_iterator```s. However, these must not be used to iterate over the container. This is because internally the container is made out of two independent ```std::vectors```, and while the ```begin()``` gives back an iterator to the begin of the first vector, the ```end()``` gives an iterator to the end of the second vector. Up to recently an iteration over the container was only used in ```CalibCalorimetry/EcalTPGTools/plugins/EcalTPGParamBuilder.cc``` to print debug messages and it was protected by counters that only allowed the first 10 iterations, effectively iterating only on the first internal vector. Only recently, with the addition of the ECAL local reconstruction on GPU, iterations over the full container range were attempted (using ```std::copy```) and this resulted in segmentation violations, together with the incorrect usage of ```std::vector::reserve()``` before ```std::copy()```. In order to prevent this issue from happening again we decided that the best way is to remove the ```begin()``` function from the ```EcalCondObjectContainer``` class (a custom iterator approach was considered but deemed too complex for the problem at hand and potentially less efficient). This PR does this and replaces the existing iterations with iterations over the two internal vectors separately.\r\n\r\n- The ```EcalTPGParamBuilder``` was modernised to be a one module and use ```esConsumes```.\r\n\r\n#### PR validation:\r\n\r\n```\r\ncmsRun RecoLocalCalo/EcalRecProducers/test/testEcalRechitProducer_cfg.py\r\n```", "branch": "CMSSW_11_3_X", "changed_files": 8, "closed_at": "1620294798", "comments": 10, "commits": 3, "created_at": "1619688752", "deletions": 187, "labels": ["alca-approved", "backport-ok", "db-approved", "fully-signed", "l1-approved", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "056b3917406667cc1c151d3ae14c19dad8247126", "merged_at": "1620294798", "merged_by": "cmsbuild", "milestone": "CMSSW_11_3_X", "number": 33574, "release-notes": [], "review_comments": 0, "state": "closed", "title": "EcalCondObject container iteration fix", "updated_at": "1620294799", "user": "b-fontana"}
{"additions": 16914, "auther_ref": "exception-eols-fix-80X", "auther_sha": "18bd2d7a18f04c4d096a0a72390cffd268681a35", "author": "smorovic", "body": "Port of #12200 (75X) and #12201 (76X)\n\nA rare race condition occurs when exception is thrown during processing of last few events in a file and LS. In this case, another thread can already request next event from the source. If next event belongs to the next LS, input source reports to the FastMonitoringService a total number of events in previous LS.\n\nNormally in case of exception, we skip writing JSON stream output (catching exception action callback in the FastMonitoringService), and subsequently hltd assigns missing events as error events to close micro-merge of that LS. However, suppression was not happening after input source already reported the total number of events to the FastMonitoringService. This lead to incomplete micromerge for some streams. The problem is present only in multithreading, as in the single-threaded mode source can get a request for next event before exception on currently processed event is thrown (i.e. event requests are aborted and run/LS get closed).\n\nIn this update, JSON output is suppressed if exception has been thrown, regardless of input source report.\n", "branch": "CMSSW_8_0_X", "changed_files": 806, "closed_at": "1446742386", "comments": 24, "commits": 318, "created_at": "1446200221", "deletions": 12758, "labels": ["alca-pending", "analysis-pending", "comparison-pending", "db-pending", "dqm-pending", "generators-pending", "geometry-pending", "l1-pending", "operations-pending", "orp-pending", "pdmv-pending", "pending-signatures", "tests-pending"], "milestone": "CMSSW_8_0_X", "number": 12202, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix race condition in DAQ modules when exception is thrown in event processing (only affecting multithreading) - 80X", "updated_at": "1447407901", "user": "smorovic"}
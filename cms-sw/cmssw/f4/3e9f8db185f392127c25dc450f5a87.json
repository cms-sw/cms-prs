{"additions": 194, "auther_ref": "ak_update_lhc_info_direct_sim", "auther_sha": "533fb37adbc456b50c6e1b918f131448a6d9f702", "author": "CTPPS", "body": "This is a draft PR; Work In Progress\r\n#### PR description:\r\n\r\nA followup PR to https://github.com/cms-sw/cmssw/pull/42515, this PR updates `Direct Simulation` to be able to use both new `LHCInfoPer*` and old `LHCInfo` records for possible future updates. \r\nMoreover it introduces a new Era modifier `Era_Run3_CTPPS_directSim` to use when `Direct Simulation` is ran in Run3. This is needed because this simulation uses old `LHCInfo` no matter the run number.\r\nWhat's also added is a backup mechanism for the selection inside `LHCInfoCombined` - one using `isRealData()` from `edm::Event()`: If `IsRealData()` returns `false`, always take old `LHCInfo`. This mechanism will only be useful if `Direct Simulation` would be ran without `Era_Run3_CTPPS_directSim`  modifier.\r\nThe 2 modules that don't have access to edm::Event are problematic, since they can't access `isRealData()` and will make `LHCInfoCombined` look for new records (if ran without `Era_Run3_CTPPS_directSim`  modifier) even during `Direct Simulation`, leading to an Exception being raised.\r\nThese modules are:\r\n* CalibPPS/ESProducers/plugins/CTPPSInterpolatedOpticalFunctionsESSource.cc\r\n* CalibPPS/ESProducers/plugins/CTPPSBeamParametersFromLHCInfoESSource.cc\r\n\r\nIts worth noting they are both `ESProducers`. So far the proper solution has not been found\r\n\r\n\r\n<!-- Please replace this text with a description of the feature proposed or problem addressed, specifying:\r\n  - what changes are expected in the output if any, \r\n  - what other PRs or externals it depends upon if any,\r\n  - link to any additional material useful to provide a documentation for this PR (slides, JIRA tickets, related pull requestes, hypernews, TWiki or Indico pages)  -->\r\n\r\n#### PR validation:\r\n\r\nTo validate please run Validation/CTPPS/test/simu/run_multiple\r\n\r\n", "branch": "master", "changed_files": 25, "comments": 2, "commits": 1, "created_at": "1695819235", "deletions": 65, "labels": ["reconstruction-pending", "simulation-pending", "dqm-pending", "alca-pending", "db-pending", "operations-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_13_3_X", "number": 42890, "release-notes": [], "review_comments": 13, "state": "open", "title": "CTPPS update Run3 Direct Simulation to use old LHCInfo after LHCInfo update", "updated_at": "1695904411", "user": "Glitchmin"}
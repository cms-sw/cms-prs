{"additions": 103, "auther_ref": "ebrondol_tracking_fixQualityClus", "auther_sha": "330377f3887d2f7c16cde8089dd9fdf5aaf3c24a", "author": "makortel", "body": "This PR fixes a long-standing bug in QuickTrackAssociatorByHits regarding composite hits (=hits having >= 2 clusters). Currently the \"matched hit fraction\" is in fact calculated as\r\n```\r\nN(clusters of track matched to a TrackingParticle)\r\n--------------------------------------------------\r\n                N(hits of track)\r\n```\r\nso hits with 2 cluster are ounted as 2 in the numerator and 1 in denominator. The bug does not affect the offline track monitoring as in offline the strip matched hits are split in the final fit. The affected cases are\r\n- HLT track monitoring (strip matched hits are not split)\r\n- Strip seed monitoring (strip matched hits are not split)\r\n- VectorHits when they get integrated (in fact this was the context that revealed the bug)\r\n\r\nThe fix is to change the denominator to `N(clusters of track)` so one could say that the association is now actually done \"by clusters\". Note that this is done only for `ClusterTPAssociation` mode, the `TrackerHitAssociator` mode is kept in counting hits.\r\n\r\nHere are MTV plots for phase1\r\nhttps://cms-tracking-validation.web.cern.ch/cms-tracking-validation/PR/CMSSW_9_3_0_pre3_PR20364/\r\nshowing no effect for tracks\r\nhttps://cms-tracking-validation.web.cern.ch/cms-tracking-validation/PR/CMSSW_9_3_0_pre3_PR20364/phase1_ttbar_pu35_summary/summary.pdf\r\nand decrease in efficiency of seeds with strip hits\r\nhttps://cms-tracking-validation.web.cern.ch/cms-tracking-validation/PR/CMSSW_9_3_0_pre3_PR20364/phase1_ttbar_pu35_seeding_summary_seeds/summary.pdf\r\n\r\nPlots for HLT (thanks to @JanFSchulte) can be found from\r\nhttps://cms-tracking-validation.web.cern.ch/cms-tracking-validation/PR/CMSSW_9_3_0_pre3_PR20364_HLT/\r\nshowing decrease in efficiency (especially in |eta| > 1) and increase in fake rates.\r\n\r\nTested in 9_3_0_pre3, expecting no changes in offline track plots, and decrease in efficiency and increase in fake rates for HLT track plots.\r\n\r\n@rovere @VinInn @ebrondol @JanFSchulte @mtosi @slava77 @perrotta ", "branch": "master", "changed_files": 2, "closed_at": "1504597831", "comments": 22, "commits": 5, "created_at": "1504510755", "deletions": 54, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "4998ca6b8b3cad802ef5a1a9e267a8b00fa901df", "merged_at": "1504597831", "merged_by": "cmsbuild", "milestone": "CMSSW_9_3_X", "number": 20364, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix QuickTrackAssociatorByHits for composite hits", "updated_at": "1504597831", "user": "makortel"}
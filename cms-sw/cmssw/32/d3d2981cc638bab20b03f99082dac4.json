{"additions": 2, "auther_ref": "fix-fmt-10", "auther_sha": "232f783f09d1ad33483e88dfded44c914b0056a3", "author": "iarspider", "body": "#### PR description:\r\n\r\nTitle says it all. When testing https://github.com/cms-sw/cmsdist/pull/9293, the following errors are reported:\r\n\r\n```\r\nIn file included from /data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/format.h:49,\r\n                 from src/FWCore/MessageLogger/interface/ErrorObj.h:28,\r\n                 from src/FWCore/MessageLogger/interface/MessageSender.h:5,\r\n                 from src/FWCore/MessageLogger/interface/MessageLogger.h:30,\r\n                 from src/FWCore/Framework/interface/maker/Worker.h:37,\r\n                 from src/FWCore/Framework/interface/maker/WorkerT.h:13,\r\n                 from src/FWCore/Framework/interface/maker/WorkerMaker.h:8,\r\n                 from src/FWCore/Framework/interface/MakerMacros.h:5,\r\n                 from src/DQM/SiPixelHeterogeneous/plugins/SiPixelPhase1RawDataErrorComparator.cc:24:\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h: In instantiation of 'constexpr fmt::v10::detail::value<Context> fmt::v10::detail::make_arg(T&) [with bool PACKED = true; Context = fmt::v10::basic_printf_context<char>; T = const {anonymous}::SiPixelFEDErrorCodes; typename std::enable_if<PACKED, int>::type <anonymous> = 0]':\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:1842:51:   required from 'constexpr fmt::v10::format_arg_store<Context, Args>::format_arg_store(T& ...) [with T = {const {anonymous}::SiPixelFEDErrorCodes}; Context = fmt::v10::basic_printf_context<char>; Args = {{anonymous}::SiPixelFEDErrorCodes}]'\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:1860:18:   required from 'constexpr fmt::v10::format_arg_store<Context, typename std::remove_cv<typename std::remove_reference<T>::type>::type ...> fmt::v10::make_format_args(T& ...) [with Context = basic_printf_context<char>; T = {const {anonymous}::SiPixelFEDErrorCodes}]'\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/printf.h:614:68:   required from 'std::__cxx11::basic_string<Char> fmt::v10::sprintf(const S&, const T& ...) [with S = char [14]; T = {{anonymous}::SiPixelFEDErrorCodes}; Char = char]'\r\nsrc/DQM/SiPixelHeterogeneous/plugins/SiPixelPhase1RawDataErrorComparator.cc:287:61:   required from here\r\n  /data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:1600:63: error: 'fmt::v10::detail::type_is_unformattable_for<const {anonymous}::SiPixelFEDErrorCodes, char> _' has incomplete type\r\n  1600 |     type_is_unformattable_for<T, typename Context::char_type> _;\r\n      |                                                               ^\r\n  /data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:1604:7: error: static assertion failed: Cannot format an argument. To make type T formattable provide a formatter<T> specialization: https://fmt.dev/latest/api.html#udt\r\n  1604 |       formattable,\r\n      |       ^~~~~~~~~~~\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:1604:7: note: 'formattable' evaluates to false\r\n```\r\n\r\nThis worked before because of a bug in fmt, where `enum` was silently cast to `int`\r\n\r\n```\r\nIn file included from /data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/format.h:49,\r\n                 from src/FWCore/MessageLogger/interface/ErrorObj.h:28,\r\n                 from src/FWCore/MessageLogger/interface/MessageSender.h:5,\r\n                 from src/FWCore/MessageLogger/interface/MessageLogger.h:30,\r\n                 from src/FWCore/Framework/interface/maker/Worker.h:37,\r\n                 from src/FWCore/Framework/interface/maker/WorkerT.h:13,\r\n                 from src/FWCore/Framework/interface/maker/WorkerMaker.h:8,\r\n                 from src/FWCore/Framework/interface/MakerMacros.h:5,\r\n                 from src/SimCalorimetry/HGCalAssociatorProducers/plugins/SimTauCPLinkProducer.cc:17:\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h: In instantiation of 'constexpr decltype (ctx.begin()) fmt::v10::detail::parse_format_specs(ParseContext&) [with T = CaloParticle; ParseContext = compile_parse_context<char>; decltype (ctx.begin()) = const char*]':\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2684:51:   required from here\r\nsrc/SimCalorimetry/HGCalAssociatorProducers/plugins/SimTauCPLinkProducer.cc:82:40:   in 'constexpr' expansion of 'fmt::v10::basic_format_string<char, long int&, const CaloParticle&>(\" CP {} {}\")'\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2787:40:   in 'constexpr' expansion of 'fmt::v10::detail::parse_format_string<true, char, format_string_checker<char, long int, CaloParticle> >(((fmt::v10::basic_format_string<char, long int&, const CaloParticle&>*)this)->fmt::v10::basic_format_string<char, long int&, const CaloParticle&>::str_, fmt::v10::detail::format_string_checker<char, long int, CaloParticle>(fmt::v10::basic_string_view<char>(((const char*)s))))'\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2534:44:   in 'constexpr' expansion of 'fmt::v10::detail::parse_replacement_field<char, format_string_checker<char, long int, CaloParticle>&>((p + -1), end, (* & handler))'\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2502:33:   in 'constexpr' expansion of '(& handler)->fmt::v10::detail::format_string_checker<char, long int, CaloParticle>::on_replacement_field((& handler)->fmt::v10::detail::format_string_checker<char, long int, CaloParticle>::on_arg_id(), begin)'\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2677:20:   in 'constexpr' expansion of '((fmt::v10::detail::format_string_checker<char, long int, CaloParticle>*)this)->fmt::v10::detail::format_string_checker<char, long int, CaloParticle>::on_format_specs(id, begin, begin)'\r\n  /data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2593:45: error: 'fmt::v10::detail::type_is_unformattable_for<CaloParticle, char> _' has incomplete type\r\n  2593 |     type_is_unformattable_for<T, char_type> _;\r\n      |                                             ^\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h: In member function 'void SimTauProducer::buildSimTau(SimTauCPLink&, uint8_t, int, const reco::GenParticle&, int, edm::Handle<std::vector<CaloParticle> >, const std::vector<int>&) const':\r\n  /data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2684:51: error: 'constexpr decltype (ctx.begin()) fmt::v10::detail::parse_format_specs(ParseContext&) [with T = CaloParticle; ParseContext = compile_parse_context<char>; decltype (ctx.begin()) = const char*]' called in a constant expression\r\n  2684 |     return id >= 0 && id < num_args ? parse_funcs_[id](context_) : begin;\r\n      |                                       ~~~~~~~~~~~~^\r\n/data/cmsbld/jenkins/workspace/ib-run-pr-tests/testBuildDir/el8_amd64_gcc12/external/fmt/10.2.1-76ef466f9d9d21f087f9b7e4e843a9d9/include/fmt/core.h:2580:20: note: 'constexpr decltype (ctx.begin()) fmt::v10::detail::parse_format_specs(ParseContext&) [with T = CaloParticle; ParseContext = compile_parse_context<char>; decltype (ctx.begin()) = const char*]' is not usable as a 'constexpr' function because:\r\n 2580 | FMT_CONSTEXPR auto parse_format_specs(ParseContext& ctx)\r\n      |                    ^~~~~~~~~~~~~~~~~~\r\n```\r\n\r\nNo idea why it stopped working. @cms-sw/simulation-l2 could you please verify that the code is supposed to print `pdgId`, and not some other property of `CaloParticle`?\r\n\r\n#### PR validation:\r\n\r\nBot tests\r\n", "branch": "master", "changed_files": 2, "comments": 8, "commits": 1, "created_at": "1721066566", "deletions": 2, "labels": ["dqm-pending", "simulation-approved", "pending-signatures", "tests-approved", "orp-pending", "upgrade-approved", "code-checks-approved", "trk"], "milestone": "CMSSW_14_1_X", "number": 45467, "release-notes": [], "review_comments": 0, "state": "open", "title": "Fix compatibility with FMT 10", "updated_at": "1721681485", "user": "iarspider"}
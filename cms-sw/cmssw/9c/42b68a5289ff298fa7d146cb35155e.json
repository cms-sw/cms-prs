{"additions": 502, "auther_ref": "DebugCaloSamples", "auther_sha": "66438d5d72fb8350ed769b799b5d3fd5193b3d84", "author": "kpedro88", "body": "This PR adds several tools for debugging the HCAL digitization simulation.\r\n1. Ability to save the `CaloSamples` objects created by the different `CaloHitResponse`-derived classes as an event product.\r\n2. If `CaloSamples` are saved as an event product, precise samples for the HPD simulation are generated with 1ns binning. (Otherwise, only the usual samples are generated.)\r\n3. An option to ignore the `PCaloHit` time assigned by Geant4 in the `CaloHitResponse` classes, in order to study tails introduced by slow neutrons, etc.\r\n4. An analyzer to create a simple tree, with one entry per channel per event (associating info from `CaloSamples` and `PCaloHit`). In order to take my own advice and avoid tracking test configs that immediately become outdated, this analyzer can be added to any `cmsDriver` command using `--customise=SimCalorimetry/HcalSimAlgos/AddCaloSamplesAnalyzer`. This customize automatically enables output of `CaloSamples`. The analyzer does not get access to all of the internals of the `CaloHitResponse` classes as I have done privately using mountains of debug printouts, but it is still quite useful to see the precise output pulses before any pedestal, etc. is added, and to be able to compare vs `PCaloHit` energy and time values.\r\n5. An option to inject `PCaloHit`s of specified energy (and optionally time) into `HcalDigitizer`. The new `PCaloHit` collection is output as an event product when this option is enabled. The injection is specified on a per-cell basis (or alternatively for an entire subdetector). Users should keep in mind that `PCaloHit` energy is in units of sensitive layer energy, which is equivalent to \"total\" energy divided by the sampling factor (or photoelectrons for HF).\r\n\r\nAn example of running the analyzer (using a premade sample of 500 GeV pions):\r\n```\r\ncmsDriver.py step2 --conditions auto:phase1_2017_realistic -s DIGI --datatier GEN-SIM-DIGI-RAW -n 10 --geometry DB:Extended --era Run2_2017 --eventcontent FEVTDEBUGHLT --filein file:step1_SinglePiE500_10K.root --fileout file:step2.root --customise=SimCalorimetry/HcalSimAlgos/AddCaloSamplesAnalyzer\r\n```\r\nA flat tree is created in a file with default name `debugcalosamples.root`:\r\n```\r\nroot -l debugcalosamples.root\r\nCaloSamplesAnalyzer->cd()\r\ntree->Draw(\"Iteration$*0.5>>htemp(250,0,250)\",\"signalTotPrecise[]*(subdet==2)\",\"hist\");\r\n```\r\nproduces the plot:\r\n![plot_debugcalosamples](http://kjplanet.com/pr/plot_debugcalosamples.png)\r\nsimilar to the plots that motivated #16825.\r\n\r\nNB: because the new collections produced (`CaloSamples`, injected `PCaloHit`s) are optional, they can't be added to the `EDAlias` for `simHcalUnsuppressedDigis`, so their tag is just `mix`.\r\n\r\nattn: @abdoulline, @mariadalfonso ", "branch": "CMSSW_9_0_X", "changed_files": 17, "closed_at": "1481553429", "comments": 19, "commits": 10, "created_at": "1481147320", "deletions": 21, "labels": ["alca-approved", "comparison-available", "fully-signed", "orp-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "521212babd002b49741e2047ab9de9c3defb69ec", "merged_at": "1481553429", "merged_by": "cmsbuild", "milestone": "CMSSW_9_0_X", "number": 16907, "release-notes": [], "review_comments": 2, "state": "closed", "title": "HCAL digi simulation debugging tools", "updated_at": "1481553429", "user": "kpedro88"}
{"additions": 32, "auther_ref": "NoiseCorrelation_v2", "auther_sha": "ad8a0a59b5b22455b29c0a258ab1d8561152961d", "author": "TaeunKwon", "body": "#### PR description:\r\n\r\nThis PR is a follow-up of the previous [PR #310614](https://github.com/cms-sw/cmssw/pull/31064). The previous updates, adding a noise correlation factor between adjacent time slices for MAHI was not fully self-consistent by [the previous study](https://indico.cern.ch/event/936151/contributions/3933432/attachments/2070567/3476700/pedestal.pdf) because the algorithm takes overall noise terms (pedestal + ADC + photostatistics) to calculate noise correlation while noise correlation factors between adjacent noise terms are obtained from minimum Bias which is not related to photostatistics term. So, in this PR, codes are updated to obtain noise correlation using only pedestal noise terms for self-consistency. The effect of this change is shown in [this presentation by Taeun Kwon](https://indico.cern.ch/event/954817/contributions/4012017/attachments/2101359/3532785/pedestal.pdf). Also, minor changes in MAHI are introduced in this PR for the speed-up of the algorithm. \r\n\r\nigprof reports for DIGI and RECO before and after this PR are given below for the measurment of CPU costs.\r\nThe sample used here : TTbar RelVal\r\nCMSSW_release : CMSSW_11_2_0_pre6\r\nGlobal tags : phase1_2024_realistic\r\nPU input : /RelValMinBias_14TeV/CMSSW_10_6_1-106X_mcRun3_2021_realistic_v1_rsb-v1/GEN-SIM \r\n\r\nigprof report for DIGI before the change:\r\n41.96 sec / 1000 evts taken for mahiFit:minimization module.\r\n[https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_before_woPU_step2](https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_before_woPU_step2)\r\n\r\nigprof report for DIGI after the change:\r\n39.04 sec / 1000 evts taken for mahiFit:minimization module.\r\n[https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_after_woPU_step2](https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_after_woPU_step2)\r\n\r\nigprof report for RECO before the change w/o PU:\r\n43.37 sec / 1000 evts taken for mahiFit:minimization module.\r\n[https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_before_woPU_step3](https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_before_woPU_step3)\r\n\r\nigprof report for RECO after the change w/o PU:\r\n39.95 sec / 1000 evts taken for mahiFit:minimization module.\r\n[https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_after_woPU_step3](https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_after_woPU_step3)\r\n\r\nigprof report for RECO before the change w/ PU:\r\n49.19 sec / 1000 evts taken for mahiFit:minimization module.\r\n[https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_before_wPU_step3](https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_before_wPU_step3)\r\n\r\nigprof report for RECO after the change w/ PU:\r\n47.69 sec / 1000 evts taken for mahiFit:minimization module.\r\n[https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_after_wPU_step3](https://ktaeun.web.cern.ch/ktaeun/cgi-bin/igprof-navigator/igreport_perf_after_wPU_step3)\r\n\r\nThis PR is expected to decrease the timing cost by 5~10% of time spent on mahiFit:minimization module.\r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\nA basic technical test was performed: `runTheMatrix.py -l limited -i all --ibeos`\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nThis PR is not a backport and shouldn't be backported.\r\n\r\n<!-- Please replace this text with any link to  -->\r\n", "branch": "master", "changed_files": 2, "closed_at": "1601077417", "comments": 31, "commits": 7, "created_at": "1600447845", "deletions": 21, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "d4cfbbbca6c85b7b56fe385093be0ca49b845fae", "merged_at": "1601077417", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 31513, "release-notes": [], "review_comments": 7, "state": "closed", "title": "HCAL MAHI code update to take only pedestal noise terms for correlation terms of a noise covariance matrix", "updated_at": "1601077418", "user": "TaeunKwon"}
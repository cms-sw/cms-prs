{"additions": 49, "auther_ref": "mm_dev_SiStripObjectTests", "auther_sha": "e6a6d0e140f7f51b9552dbc67c12ae51eb77a526", "author": "CMSTrackerDPG", "body": "#### PR description:\r\n\r\nDuring the SiStrip DAQ O2O tests performed on [23-09-2024](https://cms-conddb.cern.ch/cmsDbBrowser/logs/O2O_logs/Prod/2024-09-22/2024-09-30/SiStrip/1) in order to update the release `CMSSW_14_0_16` (to allow for the cmsweb migration, see details [here](https://indico.cern.ch/event/1451586/contributions/6146763/attachments/2932960/5150937/23.09.24%20AlCa%20meeting.pdf)), few O2O tests failed with a segmentation fault:\r\n\r\n```\r\nThread 1 (Thread 0x7f6c4e300640 (LWP 745397) \"cmsRun\"):\r\n#0  0x00007f6c4f0cf0e1 in poll () from /lib64/libc.so.6\r\n#1  0x00007f6c4a8e643f in full_read.constprop () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/pluginFWCoreServicesPlugins.so\r\n#2  0x00007f6c4a89b4bc in edm::service::InitRootHandlers::stacktraceFromThread() () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/pluginFWCoreServicesPlugins.so\r\n#3  0x00007f6c4a89b640 in sig_dostack_then_abort () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/pluginFWCoreServicesPlugins.so\r\n#4  <signal handler called>\r\n#5  0x00007f6c435d7e67 in SiStripLatency::singleMode() const () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libCondFormatsSiStripObjects.so\r\n#6  0x00007f6c435d819e in SiStripLatency::singleReadOutMode() const () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libCondFormatsSiStripObjects.so\r\n#7  0x00007f6c435d86d9 in SiStripLatency::printSummary(std::__cxx11::basic_stringstream<char, std::char_traits<char>, std::allocator<char> >&, TrackerTopology const*) const () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libCondFormatsSiStripObjects.so\r\n#8  0x00007f6c43922a41 in SiStripCondObjBuilderFromDb::buildFECRelatedObjects(SiStripConfigDb*, std::vector<std::pair<unsigned int, std::vector<std::pair<unsigned int, FedChannelConnection>, std::allocator<std::pair<unsigned int, FedChannelConnection> > > >, std::allocator<std::pair<unsigned int, std::vector<std::pair<unsigned int, FedChannelConnection>, std::allocator<std::pair<unsigned int, FedChannelConnection> > > > > > const&) () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libOnlineDBSiStripESSources.so\r\n#9  0x00007f6c43929940 in SiStripCondObjBuilderFromDb::buildCondObj() () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libOnlineDBSiStripESSources.so\r\n#10 0x00007f6c12e9fef5 in SiStripCondObjBuilderFromDb::getValue(SiStripBadStrip*&) [clone .constprop.0] () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/pluginOnlineDBSiStripO2OPlugins.so\r\n#11 0x00007f6c12e97b2a in SiStripPayloadHandler<SiStripBadStrip>::analyze(edm::Event const&, edm::EventSetup const&) () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/pluginOnlineDBSiStripO2OPlugins.so\r\n#12 0x00007f6c51b12762 in edm::one::EDAnalyzerBase::doEvent(edm::EventTransitionInfo const&, edm::ActivityRegistry*, edm::ModuleCallingContext const*) () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#13 0x00007f6c51afdd9e in edm::WorkerT<edm::one::EDAnalyzerBase>::implDo(edm::EventTransitionInfo const&, edm::ModuleCallingContext const*) () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#14 0x00007f6c51a8f639 in std::__exception_ptr::exception_ptr edm::Worker::runModuleAfterAsyncPrefetch<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(std::__exception_ptr::exception_ptr, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::TransitionInfoType const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*) () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#15 0x00007f6c51a9070f in edm::SerialTaskQueue::QueuedTask<edm::SerialTaskQueueChain::push<edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1}&>(tbb::detail::d1::task_group&, edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1}&)::{lambda()#1}>::execute() () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#16 0x00007f6c51c43650 in tbb::detail::d1::function_task<edm::SerialTaskQueue::spawn(edm::SerialTaskQueue::TaskBase&)::{lambda()#1}>::execute(tbb::detail::d1::execution_data&) () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreConcurrency.so\r\n#17 0x00007f6c50249281 in tbb::detail::r1::task_dispatcher::local_wait_for_all<false, tbb::detail::r1::external_waiter> (waiter=..., t=<optimized out>, this=0x7f6c4ccdfe00) at /data/cmsbld/jenkins/workspace/auto-builds/CMSSW_14_1_0_pre1-el8_amd64_gcc12/build/CMSSW_14_1_0_pre1-build/BUILD/el8_amd64_gcc12/external/tbb/v2021.9.0-c3903c50b52342174dbd3a52854a6e6d/tbb-v2021.9.0/src/tbb/task_dispatcher.h:322\r\n#18 tbb::detail::r1::task_dispatcher::local_wait_for_all<tbb::detail::r1::external_waiter> (waiter=..., t=<optimized out>, this=0x7f6c4ccdfe00) at /data/cmsbld/jenkins/workspace/auto-builds/CMSSW_14_1_0_pre1-el8_amd64_gcc12/build/CMSSW_14_1_0_pre1-build/BUILD/el8_amd64_gcc12/external/tbb/v2021.9.0-c3903c50b52342174dbd3a52854a6e6d/tbb-v2021.9.0/src/tbb/task_dispatcher.h:458\r\n#19 tbb::detail::r1::task_dispatcher::execute_and_wait (t=<optimized out>, wait_ctx=..., w_ctx=...) at /data/cmsbld/jenkins/workspace/auto-builds/CMSSW_14_1_0_pre1-el8_amd64_gcc12/build/CMSSW_14_1_0_pre1-build/BUILD/el8_amd64_gcc12/external/tbb/v2021.9.0-c3903c50b52342174dbd3a52854a6e6d/tbb-v2021.9.0/src/tbb/task_dispatcher.cpp:168\r\n#20 0x00007f6c51a12cfb in edm::FinalWaitingTask::wait() () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#21 0x00007f6c51a1c66a in edm::EventProcessor::processRuns() () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#22 0x00007f6c51a1cbc1 in edm::EventProcessor::runToCompletion() () from /opt/offline/el8_amd64_gcc12/cms/cmssw/CMSSW_14_0_16/lib/el8_amd64_gcc12/libFWCoreFramework.so\r\n#23 0x00000000004074ef in tbb::detail::d1::task_arena_function<main::{lambda()#1}::operator()() const::{lambda()#1}, void>::operator()() const ()\r\n#24 0x00007f6c502359ad in tbb::detail::r1::task_arena_impl::execute (ta=..., d=...) at /data/cmsbld/jenkins/workspace/auto-builds/CMSSW_14_1_0_pre1-el8_amd64_gcc12/build/CMSSW_14_1_0_pre1-build/BUILD/el8_amd64_gcc12/external/tbb/v2021.9.0-c3903c50b52342174dbd3a52854a6e6d/tbb-v2021.9.0/src/tbb/arena.cpp:688\r\n#25 0x0000000000408ed2 in main::{lambda()#1}::operator()() const ()\r\n#26 0x000000000040517c in main ()\r\n```\r\n\r\nWhile these tests have been issued with a wrong (empty) input list of configuration lines, it would be nicer if they end more gracefully than with a segmentation fault. \r\nThe issue is traced to the fact that the methods `SiStripLatency::singleLatency()` and `SiStripLatency::singleMode()` try to access the first element of the `latencies_` member vector, while it wasn't filled, ending in a segmentation violation.\r\nThe issue is reproducible, when trying to execute the unit test introduced in this PR without the fixt.\r\n\r\n#### PR validation:\r\n\r\nRelies on the new unit test: `scram b runtest_test_catch2_SiStripLatency` runs fine\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nN/A", "branch": "master", "changed_files": 3, "comments": 3, "commits": 1, "created_at": "1727672209", "deletions": 1, "labels": ["alca-pending", "db-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_14_2_X", "number": 46149, "release-notes": [], "review_comments": 0, "state": "open", "title": "fix `SiStripLatency` methods when object is empty", "updated_at": "1727672540", "user": "mmusich"}
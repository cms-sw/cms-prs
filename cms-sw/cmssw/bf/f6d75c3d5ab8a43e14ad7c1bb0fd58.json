{"additions": 375, "auther_ref": "premixRePileup", "auther_sha": "15f86e550b119c2dbecdbd8ae643c0bc1e3753e6", "author": "makortel", "body": "This PR adds a mechanism to adjust the pileup distribution of the premixed pileup library in premixing stage2 (pileup overlay). The mechanism (that is off by default) is the following\r\n* For each true pileup value, a probability is defined in the configuration (see example below)\r\n* When `PreMixingModule` reads an event from the  pileup library\r\n  1. read the true pileup value from the pileup event\r\n  2. generate a (0,1) random number\r\n  3. if \"number > prob(true pileup)\", discard the pileup event and continue on i., otherwise use the pileup event as usual\r\n\r\nIf a pileup event is encountered with a true pileup value outside of the range in configuration, the probability is considered to be 0. Naively this would lead to an infinite loop on misconfiguration (if the configured pileup range would not cover at all the generated pileup), so a following protection is included: an exception is thrown if N consecutive pileup events landing outside of the configured pileup range are encountered (N is configurable, the exception can also be disabled).\r\n\r\nThis mechanism required adding a way to skip events in `VectorInputSource`.\r\n\r\nExample configuration\r\n```python\r\nmixData = cms.EDProducer(\"PreMixingModule\",\r\n    ...\r\n    adjustPileupDistribution = cms.VPSet(\r\n        cms.PSet(\r\n            firstRun = cms.uint32(1), # first run of which this snippet is active\r\n            firstBinPileup = cms.uint32(10), # pileup of the first probability bin\r\n            pileupProbabilities = cms.vdouble(0.1, 0.5, 1.0, 0.4) # probabilities for pileups 10,11,12,14\r\n        ),\r\n        cms.PSet(\r\n            firstRun = cms.uint32(2),\r\n            firstBinPileup = cms.uint32(10),\r\n            pileupProbabilities = cms.vdouble(0.2, 0.3, 0.5, 1.0)\r\n        ),\r\n    ),\r\n    ...\r\n)\r\n```\r\nTested in 10_4_0, no changes expected.", "branch": "master", "changed_files": 25, "comments": 17, "commits": 5, "created_at": "1548454702", "deletions": 59, "labels": ["code-checks-approved", "comparison-pending", "core-pending", "dqm-pending", "orp-pending", "pending-signatures", "simulation-pending", "tests-approved"], "milestone": "CMSSW_10_5_X", "number": 25770, "release-notes": [], "review_comments": 7, "state": "open", "title": "Add a mechanism to adjust the pileup distribution in PreMixingModule", "updated_at": "1548782706", "user": "makortel"}
{"additions": 360, "auther_ref": "cpefast_wo_track_angle_30_06_2021", "auther_sha": "a80a100f5022dca25155aa49677b781503dfaa13", "author": "CMSTrackerDPG", "body": "#### PR description:\r\n\r\n##### By @VinInn at [cms-patatrack/cmssw #528](https://github.com/cms-patatrack/cmssw/pull/528)\r\n\r\nThis PR improves the error estimation in CPEFast used on GPU providing a simple and fast parameterization in terms of charge, position in x and size in y.\r\n\r\nThe result is very close to what CPEGeneric provides w/o track-angle (actually a bit more accurate thanks to the estimation of the y-error using the cluster size in y (itself improved with information from the charge unbalance).\r\n\r\nIt includes also code to recompute y-error using the track-able prior to fit (off by default)\r\n\r\nThe main effect is a reduction and flattening of the chi2 and a reduction of the tails of the pulls.\r\nGiven this improvements I have (for the the being) simplified the cut in chi2 to a single value.\r\n\r\nIn my opinion further tuning of eff vs fakerate shall be implemented elsewhere (eventually in client code)\r\nIt would be also useful to test it against some Simulation with \"realistic\" APE (such those in the \"Legacy Reprocessing\")\r\n\r\n#### PR validation:\r\n\r\nAt http://aczirkos.web.cern.ch/aczirkos/cpefast_wo_track_angle_10_06_2021/new/\r\n\r\n### Summary\r\n\r\n`plots/plots_pixel_pixelHP/effandfakePtEtaPhi`\r\n![effandfakePtEtaPhi (1)-1](https://user-images.githubusercontent.com/33939088/123966562-d58c9400-d9b5-11eb-9448-0795d1f871d2.png)\r\n\r\n\r\n## Prerequisites\r\nRun on a GPU equipped machine. This validation was run on the cmg-gpu1080 machine, [see this website for more information](https://patatrack.web.cern.ch/patatrack/private/systems/cmg-gpu1080.html).\r\n\r\n### before\r\nBenchmark release:\r\n`CMSSW_12_0_X_2021-06-22-2300`\r\n\r\n### after\r\n\r\nbranch [cpefast_wo_track_angle_30_06_2021](https://github.com/czangela/cmssw/tree/cpefast_wo_track_angle_30_06_2021)\r\n\r\nThe validation compares these two versions, which have the labels before and after in the plots.\r\n\r\n## Validation\r\n### 2018\r\n\r\n#### Dataset, filelist:\r\n```sh\r\ndas_client --limit 0 --query \"file dataset=/RelValTTbar_13/CMSSW_11_2_0_pre7-PU25ns_112X_upgrade2018_realistic_v3-v1/GEN-SIM-DIGI-RAW\" > files.txt\r\n```\r\n#### Steps 3 and 4\r\n```sh\r\n# step3\r\ncmsDriver.py step3  --conditions auto:phase1_2018_realistic -n 1000 --era Run2_2018 --eventcontent RECOSIM,DQM --procModifiers pixelNtupletFit,gpu -s RAW2DIGI:RawToDigi_pixelOnly,RECO:reconstruction_pixelTrackingOnly,VALIDATION:@pixelTrackingOnlyValidation,DQM:@pixelTrackingOnlyDQM --datatier GEN-SIM-RECO,DQMIO --geometry DB:Extended --filein filelist:files.txt  --fileout file:step3.root --nThreads=8 > step3.log  2>&1\r\n\r\n# step4\r\ncmsDriver.py step4  --conditions auto:phase1_2018_realistic -s HARVESTING:@trackingOnlyValidation+@pixelTrackingOnlyDQM --scenario pp --filetype DQM --geometry DB:Extended --era Run2_2018 --mc  -n 1000 --filein file:step3_inDQM.root --fileout file:step4.root  > step4.log  2>&1\r\n```\r\n\r\n### 2021\r\n\r\n#### Dataset, filelist:\r\n```sh\r\ndas_client --limit 0 --query \"file dataset=/RelValTTbar_14TeV/CMSSW_12_0_0_pre2-PU_113X_mcRun3_2021_realistic_v10-v1/GEN-SIM-DIGI-RAW\" > files.txt\r\n```\r\n#### Steps 3 and 4\r\n```sh\r\n# step3\r\ncmsDriver.py step3 --conditions auto:phase1_2021_realistic -n 1000 --era Run3 --eventcontent RECOSIM,DQM --procModifiers pixelNtupletFit,gpu -s RAW2DIGI:RawToDigi_pixelOnly,RECO:reconstruction_pixelTrackingOnly,VALIDATION:@pixelTrackingOnlyValidation,DQM:@pixelTrackingOnlyDQM --datatier GEN-SIM-RECO,DQMIO --geometry DB:Extended --filein filelist:files.txt --nThreads=8 > step3.log 2>&1\r\n\r\n# step4\r\ncmsDriver.py step4  --conditions auto:phase1_2021_realistic -s HARVESTING:@trackingOnlyValidation+@pixelTrackingOnlyDQM --scenario pp --filetype DQM --geometry DB:Extended --era Run3 --mc  -n 1000  --filein file:step3_RAW2DIGI_RECO_VALIDATION_DQM_inDQM.root --fileout file:step4.root > step4.log 2>&1\r\n```\r\n\r\n### 2024\r\n\r\n#### Dataset, filelist:\r\n```sh\r\ndas_client --limit 0 --query \"file dataset=/RelValTTbar_14TeV/CMSSW_11_3_0-PU_113X_mcRun3_2024_realistic_v8_rsb-v1/GEN-SIM-DIGI-RAW\" > files.txt\r\n```\r\n#### Steps 3 and 4\r\n```sh\r\n# step3\r\ncmsDriver.py step3 --conditions auto:phase1_2024_realistic -n 1000 --era Run3 --eventcontent RECOSIM,DQM --procModifiers pixelNtupletFit,gpu -s RAW2DIGI:RawToDigi_pixelOnly,RECO:reconstruction_pixelTrackingOnly,VALIDATION:@pixelTrackingOnlyValidation,DQM:@pixelTrackingOnlyDQM --datatier GEN-SIM-RECO,DQMIO --geometry DB:Extended --filein filelist:files.txt --nThreads=8 > step3.log 2>&1\r\n\r\n# step4\r\ncmsDriver.py step4  --conditions auto:phase1_2024_realistic -s HARVESTING:@trackingOnlyValidation+@pixelTrackingOnlyDQM --scenario pp --filetype DQM --geometry DB:Extended --era Run3 --mc  -n 1000  --filein file:step3_RAW2DIGI_RECO_VALIDATION_DQM_inDQM.root --fileout file:step4.root > step4.log 2>&1\r\n```\r\n\r\n## Compare DQM files\r\nUse http://musich.web.cern.ch/musich/forAdinda/multi_loopAndPlot.C\r\n\r\nOpen interactive root session and compile file\r\n\r\n```sh\r\nroot -b\r\n.L multi_LoopAndPlot.C++\r\nmulti_loopAndPlot(\"file1.root=before,file2.root=after,false)\r\n```\r\n\r\nMTV:\r\n```sh\r\nmakeTrackValidationPlots.py before.root after.root\r\n```\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\n", "branch": "master", "changed_files": 14, "closed_at": "1625745946", "comments": 41, "commits": 14, "created_at": "1625051721", "deletions": 116, "labels": ["allow-czangela", "code-checks-approved", "fully-signed", "heterogeneous-approved", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "b44af670d61ddd7b4278c94042b7536aba4cd836", "merged_at": "1625745946", "merged_by": "cmsbuild", "milestone": "CMSSW_12_0_X", "number": 34286, "release-notes": [], "review_comments": 42, "state": "closed", "title": "make CPEFast to better reproduce Generic (w/o track angle)", "updated_at": "1625745946", "user": "czangela"}
{"additions": 283, "auther_ref": "dd4hep-dd-singleton", "auther_sha": "dac350aecefbab7e10b78cf6d8fbc3c74f482b69", "author": "ianna", "body": "* Simple to reuse the same implementation across all singletons use cases\r\n* More than a single singleton can be constructed for the same type\r\n* A singleton can be applied to any type which one can construct, not necessarily with a default constructor\r\n* Defer the singleton initialization until the first use\r\n* The singleton initialization is thread safe:\r\n    * Only a single thread will initialize the singleton\r\n    * All the threads will use the same initialized instance\r\n* Using  the singleton is as fast as direct pointer access\r\n* Add unit test and a couple of tests for valgrind\r\n\r\n```\r\n$ valgrind --leak-check=full --show-leak-kinds=all ../../../test/slc6_amd64_gcc630/testSingleton\r\n==16045== Memcheck, a memory error detector\r\n==16045== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==16045== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\r\n==16045== Command: ../../../test/slc6_amd64_gcc630/testSingleton\r\n==16045== \r\nHello world\r\n==16045== \r\n==16045== HEAP SUMMARY:\r\n==16045==     in use at exit: 0 bytes in 0 blocks\r\n==16045==   total heap usage: 2 allocs, 2 frees, 72,736 bytes allocated\r\n==16045== \r\n==16045== All heap blocks were freed -- no leaks are possible\r\n==16045== \r\n==16045== For counts of detected and suppressed errors, rerun with: -v\r\n==16045== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 4 from 4)\r\n\r\n```\r\n```\r\n$ valgrind --leak-check=full --show-leak-kinds=all ../../../test/slc6_amd64_gcc630/testSingletonInit \r\n==2464== Memcheck, a memory error detector\r\n==2464== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==2464== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\r\n==2464== Command: ../../../test/slc6_amd64_gcc630/testSingletonInit\r\n==2464== \r\nInitialized\r\nHello\r\n==2464== \r\n==2464== HEAP SUMMARY:\r\n==2464==     in use at exit: 0 bytes in 0 blocks\r\n==2464==   total heap usage: 2 allocs, 2 frees, 72,736 bytes allocated\r\n==2464== \r\n==2464== All heap blocks were freed -- no leaks are possible\r\n==2464== \r\n==2464== For counts of detected and suppressed errors, rerun with: -v\r\n==2464== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 4 from 4)\r\n```\r\nNote, test1 uses getInstance():\r\n```\r\nPackage DetectorDescription/DDCMS: Running test testSingletonBenchmark\r\n \r\n===== Test \"testSingletonBenchmark\" ====\r\nBenchmark 'test1' took 0.000699 millis\r\nBenchmark 'test2' took 0.001109 millis\r\nBenchmark 'test3' took 0.001125 millis\r\nBenchmark 'test4' took 0.000953 millis\r\nBenchmark 'test5' took 0.000975 millis\r\nBenchmark 'test6' took 0.001117 millis\r\n\r\n---> test testSingletonBenchmark succeeded\r\n```", "branch": "master", "changed_files": 6, "closed_at": "1525875681", "comments": 21, "commits": 5, "created_at": "1525439380", "deletions": 0, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "geometry-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "43880800aa9f54eccbe1888ee6cb6db5440d7b8d", "merged_at": "1525875681", "merged_by": "cmsbuild", "milestone": "CMSSW_10_2_X", "number": 23147, "release-notes": [], "review_comments": 0, "state": "closed", "title": "DD Generic Singleton Pattern", "updated_at": "1525875681", "user": "ianna"}
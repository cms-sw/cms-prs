{"additions": 7, "auther_ref": "fixClusterSorterForVectorHits_take2_12_5_X", "auther_sha": "2c515df9cf179b9ac4c4480194d8522fa80b02f7", "author": "mmusich", "body": "This is a follow-up to https://github.com/cms-sw/cmssw/pull/40395.\r\nIn the specialization of `ClusterStorer::ClusterHitRecord<T>::rekey` for `VectorHit`s introduced there, I overlooked that `VectorHit::ClusterRef` and `Phase2TrackerRecHit1D::ClusterRef` are `typedefs` of the exact same object:\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/815452524d636d715e5510d21783744aeb669031/DataFormats/TrackerRecHit2D/interface/Phase2TrackerRecHit1D.h#L13\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/815452524d636d715e5510d21783744aeb669031/DataFormats/TrackerRecHit2D/interface/VectorHit.h#L30\r\n\r\nThis leads to the fact that when this function was called here:\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/7661a799a8f287528cd57181b295bd84fab1979c/CommonTools/RecoAlgos/src/ClusterStorer.cc#L133\r\n\r\nwith  `Phase2TrackerRecHit1D::ClusterRef` specialization, it didn't capture any cluster reference but was just returning:\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/7661a799a8f287528cd57181b295bd84fab1979c/CommonTools/RecoAlgos/src/ClusterStorer.cc#L198-L200\r\n\r\nThis leads to broken cluster reference for `Phase2TrackerRecHit1D` in Phase-2 workflows.\r\n\r\n#### PR validation:\r\n\r\nRun successfully:\r\n\r\n```\r\n  runTheMatrix.py --what upgrade -l 11634.0,20818.9,20834.0 -t 4 -j 8 --ibeos\r\n```\r\n\r\nand tested that I can correctly refit the resulting tracks with the machinery introduced at https://github.com/cms-sw/cmssw/pull/40542.  \r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nVerbatim backport of https://github.com/cms-sw/cmssw/pull/40548. Needed to backport all the way down to 12.5.X for phase-2 related samples productions.\r\n", "branch": "CMSSW_12_5_X", "changed_files": 1, "closed_at": "1674298345", "comments": 8, "commits": 1, "created_at": "1674033982", "deletions": 7, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "bug-fix", "orp-approved", "backport-ok", "tracking"], "merge_commit_sha": "ce51745e93d229e1b87677594d519b87b99152ec", "merged_at": "1674298345", "merged_by": "cmsbuild", "milestone": "CMSSW_12_5_X", "number": 40559, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[12.5.X] fix `ClusterStorer::ClusterHitRecord<T>::rekey` for `Phase2TrackerRecHit1D`", "updated_at": "1674298346", "user": "mmusich"}
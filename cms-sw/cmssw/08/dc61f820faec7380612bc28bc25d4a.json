{"additions": 83, "auther_ref": "alca-BeamSpotOnline_logic_12_1_X", "auther_sha": "19fc9ec2b1dd215c11195e92c99fed400c595026", "author": "francescobrivio", "body": "#### PR description:\r\nThis PR adds a real logic in `OnlineBeamSpotESProducer` to discriminate between the two different BeamSpot workflows.\r\nThe logic is based on two parameters `timeThreshold` (hours) and `sigmaZThreshold` (cm) which are both configurable.\r\nThe logic is the following:\r\n1. If both BeamSpots are older than the `timeThreshold` (by default `48 hours`) retuns a fake BeamSpot\r\n2. If one one of the two BeamSpots is newer than then `timeThreshold` returns it only if it the fit converged \r\n  (has `BeamType == 2`) and sigmaZ is larger than the threshold (by default `2 cm`)\r\n3. If both BeamSpots are newer  than the `timeThreshold` returns the one that converges and has larger sigmaZ \r\n\r\nThe checks on sigmaZ, on the creation time and on the convergence of the fit are also applied to the cases where the ESProducer was able to fetch from the DB only one of the two BeamSpot payloads.\r\n\r\nThe test `RecoVertex/BeamSpotProducer/test/test_scalars.py` was also updated to use a file available on eos and to comply with the changes made in #34348 (inclusion of the BS online tags in the GTs).\r\n\r\n#### PR validation:\r\nTested locally using `RecoVertex/BeamSpotProducer/test/test_scalars.py`.\r\n\r\n#### Backport\r\nA backport to 12_0_X is provided in #35334\r\n\r\nFYI @gennai @dzuolo", "branch": "master", "changed_files": 3, "comments": 28, "commits": 3, "created_at": "1632057823", "deletions": 36, "labels": ["alca-pending", "reconstruction-approved", "pending-signatures", "tests-approved", "orp-pending", "urgent", "code-checks-approved"], "milestone": "CMSSW_12_1_X", "number": 35333, "release-notes": [], "review_comments": 16, "state": "open", "title": "Add logic in OnlineBeamSpotESProducer", "updated_at": "1632323379", "user": "francescobrivio"}
{"additions": 125, "auther_ref": "premixingMuonSimHits", "auther_sha": "3299fc3689c4323942a9be4a9e7e2c88d53f0d7a", "author": "makortel", "body": "This PR changes the treatment of muon detectors in premixing to use SimHits instead of SimDigis in the premixing library and in the pileup overlay. This change brings the treatment of muon detectors in premixing closer to classical mixing (where SimHits are mixed, and SimDigi producers are run with the signal+pileup SimHit input). In phase2 the SimHits were needed anyway for ME0 in addition to digis (see #23065 and https://indico.cern.ch/event/711343/#54-phase-2-premixing-status).\r\n\r\nThe effect on the event size is a slight decrease. Below is a detailed comparison for 2018 (100 TTbar events with average pileup 50)\r\n\r\n| subdetector | IB (kB) | this PR (kB) | effect |\r\n| --- | --- | --- | --- |\r\n| DT | 0.67 | 5.4 | + 8x |\r\n| CSC | 64 | 35 | - 45 % |\r\n| RPC | 0.44 | 1.3 | + 3x |\r\n| GEM | 0.38 | 0.53 | + 40 % |\r\n| total | 65.5 | 41.6 | - 36 % |\r\n\r\nThe total pileup event size decreases by 0.7 % (production, i.e. without tracking MC truth). \r\n\r\nSince the stage where the digitization is done in changed completely, changes are expected for anything depending on muon detectors, but they should be (close to) statistical fluctuations. For GEM in phase2 workflows larger differences are seen (caused by premixing treatment becoming closer to classical mixing), see comments below for details. In fact earlier GEM was disabled for < phase2 premixing, and this PR enables it in premixing everywhere GEM is enabled.\r\n\r\nHere are links to 100 event comparison of 250202.181 (2018 ttbar+PU FullSim) (to my private DQM GUI using an ssh tunnel recipe shown further below; black is the IB and blue this PR)\r\nhttp://127.0.0.1:8081/dqm/relval/start?runnr=1;dataset=/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU50_2018_premixing_100ev_orig_v1-v1/DQMIO;sampletype=offline_relval;filter=all;referencepos=ratiooverlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU50_2018_premixing_100ev_dev_v2-v1/DQMIO%3A%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=;focus=;zoom=no;\r\n\r\n10-event for 250202.171 (2017)\r\nhttp://127.0.0.1:8081/dqm/relval/start?runnr=1;dataset=/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2017_premixing_10ev_orig_v1-v1/DQMIO;sampletype=offline_relval;filter=all;referencepos=ratiooverlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2017_premixing_10ev_dev_v2-v1/DQMIO%3A%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=;focus=;zoom=no;\r\n\r\nfor 250202.1 (2016)\r\nhttp://127.0.0.1:8081/dqm/relval/start?runnr=1;dataset=/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2016_premixing_10ev_orig_v1-v1/DQMIO;sampletype=offline_relval;filter=all;referencepos=ratiooverlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2016_premixing_10ev_dev_v2-v1/DQMIO%3A%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=;focus=;zoom=no;\r\n\r\nfor 20234.99 (2023 D17 PU35)\r\nhttp://127.0.0.1:8081/dqm/relval/start?runnr=1;dataset=/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2023d17_premixing_10ev_orig_v1-v1/DQMIO;sampletype=offline_relval;filter=all;referencepos=ratiooverlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2023d17_premixing_10ev_dev_v2-v1/DQMIO%3A%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=;focus=;zoom=no;\r\n\r\nfor 250402.1 (2016 FastSim)\r\nhttp://127.0.0.1:8081/dqm/relval/start?runnr=1;dataset=/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2016_fastsim_premixing_10ev_orig_v1-v1/DQMIO;sampletype=offline_relval;filter=all;referencepos=ratiooverlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A/RelValTTbar_13/CMSSW_10_3_X_2018_09_26_1100-PU35_2016_fastsim_premixing_10ev_orig_v1-v1/DQMIO%3A%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=;focus=;zoom=no;\r\n\r\nwith the following SSH tunnel recipe\r\n\r\n```\r\nssh -L8081:mkdev7.cern.ch:8081 lxplus.cern.ch\r\nhttp://127.0.0.1:8081/dqm/relval/\r\n```\r\n\r\nTested in CMSSW_10_3_X_2018-09-26-1100 (rebased on top of 10_3_0_pre6), expecting changes in muon detectors etc. in premxing workflows. Because the premixing library format changes (for muons), this PR breaks all stage2-only premixing workflows.\r\n\r\n@kpedro88 @mdhildreth ", "branch": "master", "changed_files": 23, "closed_at": "1540573772", "comments": 39, "commits": 2, "created_at": "1539006302", "deletions": 243, "labels": ["code-checks-approved", "comparison-available", "dqm-approved", "fastsim-approved", "fully-signed", "operations-approved", "orp-approved", "reconstruction-approved", "simulation-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "707e8909f912e55ac9b0a5d727517143f7129bb5", "merged_at": "1540573772", "merged_by": "cmsbuild", "milestone": "CMSSW_10_4_X", "number": 24827, "release-notes": [], "review_comments": 2, "state": "closed", "title": "Use SimHits instead of digis for muon detectors in premixing", "updated_at": "1540573773", "user": "makortel"}
{"additions": 120, "auther_ref": "accept_const_tf_session", "auther_sha": "fcaa742fd7f0c4a237d33eabc11dde277368b3c1", "author": "riga", "body": "#### PR description\r\n\r\nThis PR adds five new functions to the TensorFlow interface in PhysicsTools that accept `const` sessions, four of which are related to performing model inference and one function handles the session deletion. There's also an additional test case that covers the handling of const sessions.\r\n\r\nWith this PR, there is no need for them to be stored once per stream module instance, but they can rather be moved to global caches (as is the case for tf graphs at the moment), reducing copies in memory.\r\n\r\nThe latter changes are not contained in this PR, but are subject to a future one(s). For completeness, in the following there are three lists of files where they'd need to happen (with the latter one being optional) and I can open a dedicated PR for them once _this_ one is merged (or a separate PR per subsystem, depending on what's easier to sign off on).\r\n\r\n###### Move sessions to global cache\r\n\r\n- L1Trigger/Phase2L1ParticleFlow/src/TauNNId.cc\r\n- RecoMET/METPUSubtraction/plugins/DeepMETProducer.cc\r\n- RecoTauTag/HLTProducers/src/L2TauTagNNProducer.cc\r\n- RecoTauTag/RecoTau/plugins/DeepTauId.cc\r\n- RecoTracker/TkSeedGenerator/plugins/DeepCoreSeedGenerator.cc\r\n\r\n\r\n###### Remove now obsolete `const_cast`'s\r\n\r\n- RecoHGCal/TICL/plugins/PatternRecognitionbyCA.cc\r\n- RecoHGCal/TICL/plugins/PatternRecognitionbyCLUE3D.cc\r\n- RecoHGCal/TICL/plugins/PatternRecognitionbyFastJet.cc\r\n- RecoHGCal/TICL/plugins/TrackstersMergeProducer.cc\r\n- RecoHGCal/TICL/plugins/TrackstersMergeProducerV3.cc\r\n- RecoTracker/FinalTrackSelectors/plugins/TrackTfClassifier.cc\r\n- RecoTracker/MkFit/plugins/MkFitOutputConverter.cc\r\n\r\n\r\n###### Use const session (only if needed)\r\n\r\n- DQM/DTMonitorClient/src/DTOccupancyTestML.cc\r\n- L1Trigger/L1THGCal/src/concentrator/HGCalConcentratorAutoEncoderImpl.cc\r\n- L1Trigger/L1TMuonEndCap/src/PtAssignmentEngineDxy.cc\r\n- PhysicsTools/PatAlgos/interface/BaseMVAValueMapProducer.h\r\n- RecoEcal/EgammaCoreTools/src/DeepSCGraphEvaluation.cc\r\n- RecoMuon/TrackerSeedGenerator/plugins/TSGForOIDNN.cc\r\n\r\n\r\n#### PR validation\r\n\r\nI added test cases for handling const sessions.\r\n\r\n\r\n@valsdav @yongbinfeng @jeongeun @jpata @clacaputo ", "branch": "master", "changed_files": 9, "comments": 3, "commits": 1, "created_at": "1669564106", "deletions": 7, "labels": ["reconstruction-pending", "pending-signatures", "orp-pending", "tests-started", "code-checks-approved"], "milestone": "CMSSW_13_0_X", "number": 40161, "release-notes": [], "review_comments": 1, "state": "open", "title": "Accept const session in TF interface.", "updated_at": "1669647514", "user": "riga"}
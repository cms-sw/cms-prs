{"additions": 3, "auther_ref": "bqueue-warn", "auther_sha": "b9474e186d28a501cdb35796b063b4520f0c9b54", "author": "smuzaffar", "body": "This should fix the warnings [a] for NONLTO based cmssw IBs. @dan131riley hint [here](https://github.com/cms-sw/cmssw/issues/42404#issuecomment-1808594808) helped to identify the issue. We are passing `tail` by value and on 2nd iteration copy of `tail` gets deleted (as its ref count reaches 0).\r\n\r\nLocally building this changes for nonlto IB does not trigger this warning\r\n\r\n\r\n[a]\r\n```\r\n  CMSSW_14_0_NONLTO_X_2023-12-10-0000/src/TrackingTools/PatternTools/interface/bqueue.h:57:14: warning: pointer used after 'void operator delete(void*, std::size_t)' [-Wuse-after-free]\r\n    57 |       if ((--refCount) == 0)\r\n      |              ^~~~~~~~\r\nIn member function 'void cmsutils::_bqueue_item<T>::delRef() [with T = std::unique_ptr<int>]',\r\n    inlined from 'void cmsutils::_bqueue_item<T>::delRef() [with T = std::unique_ptr<int>]' at CMSSW_14_0_NONLTO_X_2023-12-10-0000/src/TrackingTools/PatternTools/interface/bqueue.h:56:10,\r\n    inlined from 'void cmsutils::intrusive_ptr_release(_bqueue_item<T>*) [with T = std::unique_ptr<int>]' at CMSSW_14_0_NONLTO_X_2023-12-10-0000/src/TrackingTools/PatternTools/interface/bqueue.h:82:15,\r\n    inlined from 'boost::intrusive_ptr<T>::~intrusive_ptr() [with T = cmsutils::_bqueue_item<std::unique_ptr<int> >]' at boost/smart_ptr/intrusive_ptr.hpp:98:44,\r\n    inlined from 'boost::intrusive_ptr<T>& boost::intrusive_ptr<T>::operator=(boost::intrusive_ptr<T>&&) [with T = cmsutils::_bqueue_item<std::unique_ptr<int> >]' at boost/smart_ptr/intrusive_ptr.hpp:122:9,\r\n    inlined from 'void cmsutils::bqueue<T>::push_back(T&&) [with T = std::unique_ptr<int>]' at CMSSW_14_0_NONLTO_X_2023-12-10-0000/src/TrackingTools/PatternTools/interface/bqueue.h:169:14:\r\nCMSSW_14_0_NONLTO_X_2023-12-10-0000/src/TrackingTools/PatternTools/interface/bqueue.h:58:9: note: call to 'void operator delete(void*, std::size_t)' here\r\n   58 |         delete this;\r\n\r\n```", "branch": "master", "changed_files": 2, "comments": 0, "commits": 1, "created_at": "1702218572", "deletions": 4, "labels": ["reconstruction-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-pending", "tracking"], "milestone": "CMSSW_14_0_X", "number": 43540, "release-notes": [], "review_comments": 0, "state": "open", "title": "NONLTO: Fix use after delete warning for bqueue", "updated_at": "1702218596", "user": "smuzaffar"}
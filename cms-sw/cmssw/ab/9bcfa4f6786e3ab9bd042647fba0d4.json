{"additions": 27, "auther_ref": "fixEcalDigiProducer", "auther_sha": "b5e8e5944b2fc3435da22e9332a73ab6048aeca3", "author": "makortel", "body": "The `consumes` for EB/EE/ES `PCaloHit`s is controlled with `doEB`/`doEE`/`doES`, but the `getByLabel()` for signal and pileup events were called for all EB/EE/ES regardless of the `doEX` flags. In phase2 premixing stage2 (in `DataMixingModule`/`PreMixingModule`) these would lead to \"get products without calling consumes\" exception (I don't know why the regular mixing works), so this PR calls `getByLabel()` only for the enabled subdetectors.\r\n\r\nIn addition I use the occasion to reduce the duplicated code in the constructors by removing almost everything from one of them and calling the other one from it. This change also fixes a bug in APD simulation that was fixed in #17300 for classical mixing for premixing (I presume this effect won't be seen in PR tests quoting from #17300 \"the code that's not used in the standard sequences\" (needed only if one wants to simulate ECAL barrel \"spike\" noise)\".\r\n\r\nTested in CMSSW_10_1_X_2018-03-05-2300, no changes expected.\r\n\r\n@mdhildreth @kpedro88 ", "branch": "master", "changed_files": 1, "comments": 7, "commits": 2, "created_at": "1520843986", "deletions": 228, "labels": ["code-checks-approved", "comparison-pending", "orp-pending", "pending-signatures", "simulation-pending", "tests-approved"], "milestone": "CMSSW_10_1_X", "number": 22581, "release-notes": [], "review_comments": 0, "state": "open", "title": "Fix consumes for phase2 premixing and reduce code duplication in EcalDigiProducer", "updated_at": "1520850314", "user": "makortel"}
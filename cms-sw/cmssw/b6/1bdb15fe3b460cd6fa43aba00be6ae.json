{"additions": 138, "auther_ref": "fixMtvEfficiencySummary_v2", "auther_sha": "238a2c7538d15591aada36ed99c46af47362bab4", "author": "makortel", "body": "The recently (#9201) added efficiency summary plot (average efficiency for each input track collection) in MultiTrackValidator has a bug in putting also out-of-time TrackingParticles to the denominator. Also the computation of the DeltaR of minimum distance between any TP pair includes OOT TPs. This PR fixes both with the following developments (superseding #9956)\n- Add new `intimeOnly` flag to TrackingParticleSelector (with value False set to everywhere to not to change current behaviour)\n- Switch this flag to True for the TP selector used in MTV loop over TPs for efficiency plots to reject OOT TPs there\n  - The efficiency denominators themselves are fine already, as all TP selectors used in `MTVHistoProducerAlgoForTracker::fill_recoAssociated_simTrack_histos()` already have `signalOnly=True`\n  - This change alone would be enough to fix both of the issues with OOT TPs, but has a knock-on effect on histograms in `Tracking/Track/<iter>/simulation` which have also been filled from OOT TPs, and actually for those keeping more or less the current behaviour would be nice. Therefore, \n- The histograms in `Tracking/Track/<iter>/simulation` are moved to `Tracking/Track/simulation` and filled only once per MTV instance (they are anyway the same for each iteration), and now from the set of all TPs without any selection (previously only those passing the TP selector in bullet 2 were used)\n  - `bunchxSIM` is filled from both OOT and in-time TPs, while the others are filled only from IT TPs\n- In addition, the same selection as for efficiency vs. DeltaR (same as efficiency vs. eta) is applied for efficiency summary plot, but now in two flavours: one with the pT cut (pT > 0.9 GeV) and other without pT cut.\n\nTested in 750pre6, expecting changes in `effic_vs_coll`, `num_simul_coll`, `num_assoc(simToReco)_coll`, and `globalEfficiencies` under `Tracking/Track` folder (`num_*_coll` also in other MTV instances), and `effic_vs_dr`, `num_simul_dr`, and `num_assoc(simToReco)_dr` in all MTV instances (in this case there is no change in the corresponding `globalEfficiencies`, as the integrals of numerator and denominator stay the same, only the DeltaR values change).\n\nIn noPU samples the efficiency summary plots should change like (black=old, red=new)\n![image](https://cloud.githubusercontent.com/assets/33993/8374446/b28d6e54-1bf5-11e5-8770-7d5375aca394.png)\n\nand in pileup samples like\n![image](https://cloud.githubusercontent.com/assets/33993/8374430/8ce7f2c8-1bf5-11e5-97c1-7308acd3d9a7.png)\n\nIn pileup samples the number of TPs and efficiency vs. DeltaR should change like (no changes expected in noPU samples)\n![image](https://cloud.githubusercontent.com/assets/33993/8474440/53cb2306-20b0-11e5-890e-1c6dfd266246.png)\n![image](https://cloud.githubusercontent.com/assets/33993/8474451/660583a4-20b0-11e5-99f2-8ce21013ca2d.png)\n\n@rovere @VinInn \n", "branch": "CMSSW_7_6_X", "changed_files": 22, "closed_at": "1436417840", "comments": 24, "commits": 5, "created_at": "1435822861", "deletions": 64, "labels": ["analysis-pending", "comparison-available", "dqm-approved", "geometry-approved", "orp-pending", "pending-signatures", "reconstruction-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "981675e6991908e7d2c8d5815f1df859446a271b", "merged_at": "1436417840", "merged_by": "davidlange6", "milestone": "CMSSW_7_6_X", "number": 10014, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix MultiTrackValidator efficiency summary and efficiency vs. deltaR plots", "updated_at": "1476956437", "user": "makortel"}
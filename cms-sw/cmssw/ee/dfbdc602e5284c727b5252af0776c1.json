{"additions": 545, "auther_ref": "conditionalTaskSwitchProducer", "auther_sha": "20a454908cce695d160c16e798cde6a2d84ebf0d", "author": "makortel", "body": "#### PR description:\r\n\r\nFurther testing of `ConditionalTask` (https://github.com/cms-sw/cmssw/pull/37305) for HLT revealed that it and `SwitchProducer` mechanism didn't work together at all (as discussed in https://github.com/cms-sw/cmssw/issues/36938#issuecomment-1090262706 onwards). This PR makes the `SwitchProducer` to work with `ConditionalTask` with the following changes\r\n* `SwitchProducer` case module objects get now their module labels set (previously they were not).\r\n  * This change lead to #37562. I checked all other uses of `SwitchProducerCUDA` and the case modules were always either defined inline or cloned from other module objects\r\n* In python, if `SwitchProducer` is on a `ConditionalTask` or in a `Path`, the case modules get treated as if they were in an anonymous `ConditionalTask` associated with the `ConditionalTask`/`Path`\r\n* `SwitchProducer` with an `EDAlias` as a chosen case required adding those `EDAlias`es into the `ProductRegistry` so that the `callWhenNewProductsRegistered()` callbacks in `SwitchProducer` get called, that lead to data product consumption being properly registered, that is needed for the module dependence checks in `StreamSchedule::tryToPlaceConditionalModules()`\r\n  * This step required moving `processEDAliases()` function out from `Schedule.cc`\r\n* The tests I added for `SwitchProducer` with `EDAlias` also revealed that the `EDAlias` treatment was generally broken for `ConditionalTask`. \r\n\r\n#### PR validation:\r\n\r\nFramework unit tests run. The HLT test in https://github.com/cms-sw/cmssw/issues/36938#issuecomment-1090262706 runs as well.", "branch": "master", "changed_files": 13, "comments": 14, "commits": 6, "created_at": "1649888463", "deletions": 234, "labels": ["core-pending", "pending-signatures", "tests-rejected", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_12_4_X", "number": 37563, "release-notes": [], "review_comments": 24, "state": "open", "title": "Make SwitchProducer work with ConditionalTask", "updated_at": "1650377254", "user": "makortel"}
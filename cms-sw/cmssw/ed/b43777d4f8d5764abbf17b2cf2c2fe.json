{"additions": 60, "auther_ref": "mc-simETL-update", "auther_sha": "469225aa6eba285ec360daa4ee911fe19bc1e5bb", "author": "casarsa", "body": "#### PR description:\r\n\r\nThis is an update of the ETL simulation. The contents of this PR were presented at the MTD DPG Meeting on 15/05/2020 ([slides](https://indico.cern.ch/event/919571/contributions/3865744/attachments/2039827/3415899/casarsa_simETL.pdf)).\r\nIn summary, the changes are:\r\n- a small fix to the saturation of ETL ADC and TDC counts;\r\n- the energy of DIGI hits is now expressed in fC instead of MIP units;\r\n- a more realistic parameterization of the ETL resolution is introduced as a function of the LGAD sensor gain, which depends on the fluence at the sensor radial position. \r\n\r\n----------------------------------------------------------------------------------------------------------\r\n\r\n#### PR validation:\r\n\r\nThe new code has been run in CMSSW_11_1_X_2020-05-17-2300 for the WFs 23434.0 and 23434.99.\r\n\r\n\r\n**Memory and time reports for WF 23434.0**\r\n\r\nstep 2:\r\n\r\nMemoryReport> Peak virtual size 5611.59 Mbytes                                                                                    \r\n Key events increasing vsize:                                                                                                     \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0                                                           \r\n[1] run: 1 lumi: 1 event: 1  vsize = 5099.55 deltaVsize = 0 rss = 3257.18 delta = 0                                               \r\n[2] run: 1 lumi: 1 event: 2  vsize = 5611.55 deltaVsize = 512.004 rss = 3227.38 delta = -29.8047                                  \r\n[3] run: 1 lumi: 1 event: 3  vsize = 5611.58 deltaVsize = 0.0234375 rss = 3361.9 delta = 134.527                                  \r\n[6] run: 1 lumi: 1 event: 6  vsize = 5611.59 deltaVsize = 0.0078125 rss = 3244.89 delta = -117.012                                \r\n[8] run: 1 lumi: 1 event: 8  vsize = 5611.59 deltaVsize = 0 rss = 3337.38 delta = 92.4922                                         \r\n[7] run: 1 lumi: 1 event: 7  vsize = 5611.59 deltaVsize = 0 rss = 3220.32 delta = -24.5664                                        \r\n[6] run: 1 lumi: 1 event: 6  vsize = 5611.59 deltaVsize = 0.0078125 rss = 3244.89 delta = -117.012                                \r\nTimeReport> Time report complete in 1298.63 seconds                                                                               \r\n Time Summary:                                                                                                                    \r\n - Min event:   110.279                                                                                                           \r\n - Max event:   129.325                                                                                                           \r\n - Avg event:   118.313                                                                                                           \r\n - Total loop:  1265.45                                                                                                           \r\n - Total init:  32.6732                                                                                                           \r\n - Total job:   1298.63                                                                                                           \r\n - EventSetup Lock:   0.000230551                                                                                                 \r\n - EventSetup Get:   140.65                                                                                                       \r\n Event Throughput: 0.0079023 ev/s                                                                                                 \r\n CPU Summary:                                                                                                                     \r\n - Total loop:  1206.82                                                                                                           \r\n - Total init:  15.8521                                                                                                           \r\n - Total extra: 0                                                                                                                 \r\n - Total job:   1223.1                                                                                                            \r\n Processing Summary:                                                                                                              \r\n - Number of Events:  10                                                                                                          \r\n - Number of Global Begin Lumi Calls:  1                                                                                          \r\n - Number of Global Begin Run Calls: 1 \r\n\r\nstep 3:\r\n\r\nMemoryReport> Peak virtual size 11848.2 Mbytes                                                                                    \r\n Key events increasing vsize:                                                                                                     \r\n[1] run: 1 lumi: 1 event: 1  vsize = 10789 deltaVsize = 0 rss = 7388.9 delta = 0                                                  \r\n[2] run: 1 lumi: 1 event: 2  vsize = 10789 deltaVsize = 0.0234375 rss = 7227.34 delta = -161.562                                  \r\n[3] run: 1 lumi: 1 event: 3  vsize = 11813.2 deltaVsize = 1024.16 rss = 8005.51 delta = 778.172                                   \r\n[6] run: 1 lumi: 1 event: 6  vsize = 11845.2 deltaVsize = 32 rss = 7514.96 delta = -490.551                                       \r\n[8] run: 1 lumi: 1 event: 8  vsize = 11848.2 deltaVsize = 3 rss = 7921.5 delta = 406.539                                          \r\n[9] run: 1 lumi: 1 event: 9  vsize = 11847.2 deltaVsize = -1 rss = 7731.43 delta = -190.066                                       \r\n[10] run: 1 lumi: 1 event: 10  vsize = 11847.2 deltaVsize = -0.984375 rss = 7768.05 delta = -153.453                              \r\n[8] run: 1 lumi: 1 event: 8  vsize = 11848.2 deltaVsize = 3 rss = 7921.5 delta = 406.539                                          \r\nTimeReport> Time report complete in 3943.92 seconds                                                                               \r\n Time Summary:                                                                                                                    \r\n - Min event:   269.565                                                                                                           \r\n - Max event:   489.927                                                                                                           \r\n - Avg event:   360.594                                                                                                           \r\n - Total loop:  3736.06                                                                                                           \r\n - Total init:  195.717                                                                                                           \r\n - Total job:   3943.92                                                                                                           \r\n - EventSetup Lock:   0.00048089                                                                                                  \r\n - EventSetup Get:   211.613                                                                                                      \r\n Event Throughput: 0.00267662 ev/s                                                                                                \r\n CPU Summary:                                                                                                                     \r\n - Total loop:  3525.64                                                                                                           \r\n - Total init:  153.563                                                                                                           \r\n - Total extra: 0                                                                                                                 \r\n - Total job:   3691.01                                                                                                           \r\n Processing Summary:                                                                                                              \r\n - Number of Events:  10                                                                                                          \r\n - Number of Global Begin Lumi Calls:  1                                                                                          \r\n - Number of Global Begin Run Calls: 1 \r\n\r\n\r\n**Memory and time reports for WF 23434.99**\r\n\r\nstep 2:\r\n\r\nMemoryReport> Peak virtual size 10251.1 Mbytes                                                                                    \r\n Key events increasing vsize:                                                                                                     \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0                                                           \r\n[1] run: 1 lumi: 1 event: 1  vsize = 8459.01 deltaVsize = 0 rss = 3910.97 delta = 0                                               \r\n[2] run: 1 lumi: 1 event: 2  vsize = 10251 deltaVsize = 1792.02 rss = 4521.15 delta = 610.18                                      \r\n[3] run: 1 lumi: 1 event: 3  vsize = 10251.1 deltaVsize = 0.0273438 rss = 5960.33 delta = 1439.18                                 \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0                                                           \r\n[5] run: 1 lumi: 1 event: 5  vsize = 10251.1 deltaVsize = 0 rss = 4283.99 delta = -1676.34                                        \r\n[4] run: 1 lumi: 1 event: 4  vsize = 10251.1 deltaVsize = 0 rss = 5861.37 delta = -98.957                                         \r\n[3] run: 1 lumi: 1 event: 3  vsize = 10251.1 deltaVsize = 0.0273438 rss = 5960.33 delta = 1439.18                                 \r\nTimeReport> Time report complete in 1155.37 seconds                                                                               \r\n Time Summary:                                                                                                                    \r\n - Min event:   88.3925                                                                                                           \r\n - Max event:   113.659                                                                                                           \r\n - Avg event:   95.0481                                                                                                           \r\n - Total loop:  1121.69                                                                                                           \r\n - Total init:  33.4398                                                                                                           \r\n - Total job:   1155.37                                                                                                           \r\n - EventSetup Lock:   0.00013113                                                                                                  \r\n - EventSetup Get:   149.902                                                                                                      \r\n Event Throughput: 0.00891514 ev/s                                                                                                \r\n CPU Summary:                                                                                                                     \r\n - Total loop:  1070.38                                                                                                           \r\n - Total init:  11.5136                                                                                                           \r\n - Total extra: 0                                                                                                                 \r\n - Total job:   1082.07                                                                                                           \r\n Processing Summary:                                                                                                              \r\n - Number of Events:  10                                                                                                          \r\n - Number of Global Begin Lumi Calls:  1                                                                                          \r\n - Number of Global Begin Run Calls: 1    \r\n\r\nstep 3:\r\n\r\nMemoryReport> Peak virtual size 7945.79 Mbytes                                                                                    \r\n Key events increasing vsize:                                                                                                     \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0                                                           \r\n[1] run: 1 lumi: 1 event: 1  vsize = 7483.72 deltaVsize = 0 rss = 4517.23 delta = 0                                               \r\n[2] run: 1 lumi: 1 event: 2  vsize = 7945.72 deltaVsize = 462 rss = 4449.54 delta = -67.6914                                      \r\n[4] run: 1 lumi: 1 event: 4  vsize = 7945.76 deltaVsize = 0.0351562 rss = 4523.5 delta = 73.957                                   \r\n[8] run: 1 lumi: 1 event: 8  vsize = 7945.77 deltaVsize = 0.015625 rss = 4523.7 delta = 0.203125                                  \r\n[8] run: 1 lumi: 1 event: 8  vsize = 7945.77 deltaVsize = 0.015625 rss = 4523.7 delta = 0.203125                                  \r\n[9] run: 1 lumi: 1 event: 9  vsize = 7945.79 deltaVsize = 0.0117188 rss = 4427.04 delta = -96.6562                                \r\n[10] run: 1 lumi: 1 event: 10  vsize = 7945.79 deltaVsize = 0.0078125 rss = 4572.27 delta = 145.223                               \r\nTimeReport> Time report complete in 724.497 seconds                                                                               \r\n Time Summary:                                                                                                                    \r\n - Min event:   57.2656                                                                                                           \r\n - Max event:   71.7829                                                                                                           \r\n - Avg event:   62.375                                                                                                            \r\n - Total loop:  703.033                                                                                                           \r\n - Total init:  20.9152                                                                                                           \r\n - Total job:   724.497                                                                                                           \r\n - EventSetup Lock:   0.000170231                                                                                                 \r\n - EventSetup Get:   146.07                                                                                                       \r\n Event Throughput: 0.0142241 ev/s                                                                                                 \r\n CPU Summary:                                                                                                                     \r\n - Total loop:  661.372                                                                                                           \r\n - Total init:  15.7546                                                                                                           \r\n - Total extra: 0                                                                                                                 \r\n - Total job:   677.598                                                                                                           \r\n Processing Summary:                                                                                                              \r\n - Number of Events:  10                                                                                                          \r\n - Number of Global Begin Lumi Calls:  1                                                                                          \r\n - Number of Global Begin Run Calls: 1  \r\n\r\nstep 4:\r\n\r\nMemoryReport> Peak virtual size 6853.92 Mbytes                                                                                    \r\n Key events increasing vsize:                                                                                                     \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0                                                           \r\n[1] run: 1 lumi: 1 event: 1  vsize = 6181.48 deltaVsize = 0 rss = 4517.5 delta = 0                                                \r\n[2] run: 1 lumi: 1 event: 2  vsize = 6821.49 deltaVsize = 640.016 rss = 4441.75 delta = -75.75                                    \r\n[6] run: 1 lumi: 1 event: 6  vsize = 6853.63 deltaVsize = 32 rss = 4492.17 delta = 50.4141                                        \r\n[10] run: 1 lumi: 1 event: 10  vsize = 6853.92 deltaVsize = 0.238281 rss = 4574.88 delta = 82.707                                 \r\n[6] run: 1 lumi: 1 event: 6  vsize = 6853.63 deltaVsize = 32 rss = 4492.17 delta = -23.4961                                       \r\n[9] run: 1 lumi: 1 event: 9  vsize = 6853.68 deltaVsize = 0.0507812 rss = 4500.19 delta = 8.01953                                 \r\n[10] run: 1 lumi: 1 event: 10  vsize = 6853.92 deltaVsize = 0.238281 rss = 4574.88 delta = 74.6875                                \r\nTimeReport> Time report complete in 2464.96 seconds                                                                               \r\n Time Summary:                                                                                                                    \r\n - Min event:   192.316                                                                                                           \r\n - Max event:   253.524                                                                                                           \r\n - Avg event:   217.986                                                                                                           \r\n - Total loop:  2288.57                                                                                                           \r\n - Total init:  164.638                                                                                                           \r\n - Total job:   2464.96                                                                                                           \r\n - EventSetup Lock:   0.000385284                                                                                                 \r\n - EventSetup Get:   207.967                                                                                                      \r\n Event Throughput: 0.00436954 ev/s                                                                                                \r\n CPU Summary:                                                                                                                     \r\n - Total loop:  2212.66                                                                                                           \r\n - Total init:  148.033                                                                                                           \r\n - Total extra: 0                                                                                                                 \r\n - Total job:   2372.13                                                                                                           \r\n Processing Summary:                                                                                                              \r\n - Number of Events:  10                                                                                                          \r\n - Number of Global Begin Lumi Calls:  1                                                                                          \r\n - Number of Global Begin Run Calls: 1                                                                                            \r\n", "branch": "master", "changed_files": 3, "closed_at": "1591107966", "comments": 56, "commits": 8, "created_at": "1589810482", "deletions": 15, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "simulation-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "468ef6a939fc764262d21b45bfe76703cba03945", "merged_at": "1591107966", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 29898, "release-notes": [], "review_comments": 4, "state": "closed", "title": "MTD simulation: ETL update", "updated_at": "1591107966", "user": "casarsa"}
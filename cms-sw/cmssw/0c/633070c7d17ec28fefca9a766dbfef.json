{"additions": 168, "auther_ref": "15_1_0_pre3_LHCInfoXxxx_analyzer_tests", "auther_sha": "2a523968830a32811e336aa6f078bd6d629b124f", "author": "Alejandro1400", "body": "#### PR description:\r\n\r\nThis PR has tests for lhcinfo_analyzer for both PerFill and PerLS. This have been created after in pull request #48678 the tests that were manually analyzing that the values introduced by the writer are the same ones as returned to tester. The tests defined for this one are instead more generalized, where we want to print the result and check that the number of fields for CondFormats/RunInfo/interface/LHCInfoPerFill.h is correspondent to the number of lines from the print. \r\n\r\nThe number for assertion for the testcase in writer (one analyzed) for PerFill is 31 lines, due to the print of both the IOV and the line *LHCInfoPerFill retrieved:\\n* \" with the content for  **\"CondFormats/RunInfo/interface/LHCInfoPerFill.h\"** for the specific case.\r\n\r\nMeanwhile for PerLS the number of lines is 2 as we test the csv format\r\n\r\nAdditionally, this PR includes tests for the `printLHCInfoPerPayloads.py` utility with 5 test cases covering different usage scenarios:\r\n1. PerLS duringFill with CSV format and header\r\n2. PerFill duringFill with default output format\r\n3. PerFill duringFill with field filtering (LHC fill and Energy)\r\n4. PerFill endFill with timestamp IOVs from file input and filtered fields\r\n5. PerLS duringFill without CSV format or header\r\n\r\nThese tests validate various input methods (string input, file input), output formats (CSV, verbose), and field filtering capabilities.\r\n\r\nThe PR is also related to issue [ts-coordination#56](https://gitlab.cern.ch/cms-ppd/technical-support/ts-coordination/-/issues/56)\r\n\r\nAlso both tests are named in BuildFile.xml\r\n\r\n#### PR validation:\r\n\r\nFor validation, the tests were run, where the values that are inserted are through writer and obtained later from the SQLite file that is created. The results were working.\r\n\r\nThe number of lines requested was modified (as to test if it produced a mistake) to confirm that the exceptions were handled correctly for both files, which produces an output like this):\r\n\r\n\r\n## Failure Test Case For PerFill:\r\n\r\n```\r\n[asalgado@lxplus976 test]$ /bin/sh ./test_lhcInfo_analyzer.sh\r\nBegin processing the 1st record. Run 1, Event 1, LumiSection 1 on stream 0 at 26-Aug-2025 17:29:16.133 CEST\r\nLog output (last 5 lines):\r\nBeam 2 VC  (total 0):\r\nBeam 1 RF  (total 0):\r\nBeam 2 RF  (total 0):\r\nBunches filled for Beam 1 (total 0):\r\nBunches filled for Beam 2 (total 0):\r\nFailure LHCInfoPerFillAnalyzer_cfg.py log has wrong number of lines (expected 32, got 31): status\r\n```\r\n\r\n## Failure Test Case For PerLS\r\n\r\n```\r\n[asalgado@lxplus976 test]$ /bin/sh ./test_lhcInfo_analyzer.sh\r\nBegin processing the 1st record. Run 1, Event 1, LumiSection 1 on stream 0 at 26-Aug-2025 17:22:32.196 CEST\r\nBegin processing the 1st record. Run 1, Event 1, LumiSection 1 on stream 0 at 26-Aug-2025 17:22:36.364 CEST\r\nLog output (last 5 lines):\r\nIOV,class,timestamp,runNumber,LS,xangleX,xangleY,beta*X,beta*Y,\r\n1,LHCInfoPerLS,0,301765,1,170,170,11,11,\r\nFailure LHCInfoPerLSAnalyzer_cfg.py log has wrong number of lines (expected 32, got 2): status\r\n```\r\n\r\nThe printLHCInfoPerPayloads tests also validate proper error handling by verifying expected line counts for each test case and ensuring the utility works with different input formats and filtering options.\r\n\r\n### Note: The *Begin Processing...* in test_lhcInfo_analyzer.sh is a print from the writer, therefore not modified\r\n\r\n@JanChyczynski please review", "branch": "master", "changed_files": 7, "comments": 9, "commits": 13, "created_at": "1756212609", "deletions": 22, "labels": ["db-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-pending"], "milestone": "CMSSW_15_1_X", "number": 48804, "release-notes": [], "review_comments": 7, "state": "open", "title": "LHCInfoAnalyzer Tests", "updated_at": "1756973221", "user": "Alejandro1400"}
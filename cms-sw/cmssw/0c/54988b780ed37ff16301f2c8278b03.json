{"additions": 161, "auther_ref": "jgs_PR_alpaka_fixOneToManyAssoc", "auther_sha": "c7eb907d3e159865326383b6600b51e16374fbc2", "author": "JanGerritSchulz", "body": "#### PR description:\r\n\r\nThis PR fixes the argument type in two functions of the `OneToManyAssocBase` of the alpaka interface in CMSSW. The purpose of this association is to map from `uint32_t`-type keys (\"ones\") to a set of associated object of templated type `index_type = I` (\"many\"). \r\nHowever, in two of the functions, the input `b` (which corresponds to a \"one\") is has the wrong type `I` instead of `uint32_t`.\r\n\r\nThis bug limits the type `I` of the \"many\" that can be stored by the association to integer-types as the code of the function does not compile otherwise. As far as I can tell this issue was never discovered since all the applications that are currently in release associate integers to integers.\r\n\r\nWe are taking this fix as an occasion to harmonize a bit the Key/index type used in the alpaka `FlexiStorage`, `OneToManyAssoc` and `HistoContainer` to use `uint32_t` consistently. \r\n\r\n**Changes in the user interface of these containers:** Before `SIZE == -1` defined a flexible container size that is initialized at runtime using external storage. Now, since `SIZE` is a `uint32_t`, the user is supposed to use `cms::alpakatools::kDynamicSize` instead (see example below). Similarly, the `bulkFill()` function of the `OneToManyAssoc` from now on returns `kOverflow` instead of negative values to indicate overflow. Finally, the former `index_type` was renamed to the more fitting and less misleading `value_type`.\r\n\r\n```c++\r\n# example for setting the SIZE to be initialized at runtime time\r\nusing GenericContainer = cms::alpakatools::\r\n      OneToManyAssocRandomAccess<hindex_type, cms::alpakatools::kDynamicSize, cms::alpakatools::kDynamicSize>;\r\n```\r\n\r\nNo changes in the output are expected.\r\n\r\n#### PR validation:\r\n\r\nFor validation, I ran `scram b runtests` in `HeterogeneousCore/AlpakaInterface` to verify the CUDA and serial backends. I also ran the alpaka pixel tracking in HLT Phase-2 (which uses these associations) and checked that the output is identical.\r\n\r\nFor a validation at larger scale, I think the usual PR tests should be sufficient.\r\n", "branch": "master", "changed_files": 15, "comments": 45, "commits": 1, "created_at": "1769699040", "deletions": 132, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-pending", "bug-fix", "code-checks-approved", "heterogeneous-approved", "tracking", "ngt"], "milestone": "CMSSW_16_1_X", "number": 49975, "release-notes": [], "review_comments": 10, "state": "open", "title": "Fix function input type in the OneToManyAssoc of the alpaka interface", "updated_at": "1771592270", "user": "JanGerritSchulz"}
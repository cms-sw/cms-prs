{"additions": 113, "auther_ref": "phase2CommonRefitter", "auther_sha": "0a117c645e16f5bb5c9313789e0128931712b5d0", "author": "mmusich", "body": "#### PR description:\r\n\r\nThe [common alignment track selection and refitting sequence](https://github.com/cms-sw/cmssw/blob/master/Alignment/CommonAlignment/python/tools/trackselectionRefitting.py) currently cannot run in Phase-2 setups because of missing Phase-0 SiStrip conditions. The module `TrackerTrackHitFilter` indeed requires at construction time the following conditions:\r\n\r\n```\r\n----- Begin Fatal Exception 21-Feb-2023 12:46:22 CET-----------------------\r\nAn exception of category 'NoRecord' occurred while\r\n   [0] Processing  Event run: 1 lumi: 67 event: 6602 stream: 0\r\n   [1] Running path 'p2'\r\n   [2] Prefetching for module TrackerTrackHitFilter/'TrackerTrackHitFilter'\r\n   [3] Prefetching for EventSetup module SiStripQualityESProducer/'siStripQualityESProducer'\r\n   [4] Calling method for EventSetup module SiStripConnectivity/'sistripconn'\r\n   [5] While getting dependent Record from Record SiStripDetCablingRcd\r\nException Message:\r\nNo \"SiStripFedCablingRcd\" record found in the EventSetup.\r\n\r\n Please add an ESSource or ESProducer that delivers such a record.\r\n----- End Fatal Exception -------------------------------------------------\r\n```\r\nAs it seems that adding Phase-0 SiStrip conditions (either in GT or by dedicated `ESSource`) would be a wrong design choice, the goal of this PR is allow `TrackerTrackHitFilter` to run without Phase-0 SiStrip conditions, by means of adding a new parameter `isPhase2` that governs if the `SiStripClusterInfo` object used in `TrackerTrackHitFilter` should be constructed or not with an `esConsumes` call.  ~~Please notice that I am not really happy about addition an additional  ad-hoc constructor to `SiStripClusterInfo` just for this purpose, that would anyway lead to runtime failure, if its method are then subsequently called. This PR is RFC for that reason.~~ \r\nThis is achieved by using `std::optional` to declare the `SiStripClusterInfo` data member and construct it only if the workflow is not meant for Phase-2.\r\n\r\n#### PR validation:\r\n\r\nRun the dedicated test: `cmsRun $CMSSW_BASE/src/Alignment/OfflineValidation/test/test_all_Phase2_cfg.py `\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nNot a backport, but it would probably make sense to backport down to 12.5.x to be used in the phase-2 alignment studies happening in that cycle (see [PdmV JIRA ticket](https://its.cern.ch/jira/browse/PDMVMCPROD-70?focusedCommentId=4748857&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-4748857))\r\n", "branch": "master", "changed_files": 4, "closed_at": "1677576942", "comments": 14, "commits": 3, "created_at": "1676976837", "deletions": 56, "labels": ["alca-approved", "reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved", "tracking", "trk"], "merge_commit_sha": "dbff744f30392f8afd096fd16e1c5e05ef0db833", "merged_at": "1677576942", "merged_by": "cmsbuild", "milestone": "CMSSW_13_1_X", "number": 40835, "release-notes": [], "review_comments": 4, "state": "closed", "title": "Disentangle `TrackerTrackHitFilter` from phase-0 Strip conditions and activate common alignment track refitter sequence for phase-2", "updated_at": "1677596587", "user": "mmusich"}
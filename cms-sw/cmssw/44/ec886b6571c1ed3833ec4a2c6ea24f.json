{"additions": 759, "auther_ref": "HLT_customisation_for_GPU_120x", "auther_sha": "3d1669c4d5335cb8865424493b05a0527c473b41", "author": "fwyzard", "body": "#### PR description:\r\n\r\nAdd a customisation script for the HLT:\r\n  - enable the Patatrack pixel track reconstruction, with quadruplets or triplets, running on CPU or GPU\r\n  - optionally, add the possibility to offload the ECAL unpacking and local reconstruction to run on GPU\r\n  - optionally, add the possibility to offload the HCAL local reconstruction to run on GPU\r\n\r\nThe new customisation is not used by any workflows.\r\n\r\n\r\n#### PR validation:\r\n\r\nValidated in CMSSW_12_0_0_pre6 with\r\n```bash\r\ncmsDriver.py reHLT \\\r\n    --processName reHLT \\\r\n    -s HLT:@relval2021 \\\r\n    --conditions 120X_mcRun3_2021_realistic_v4 \\\r\n    --datatier GEN-SIM-DIGI-RAW \\\r\n    -n 10 \\\r\n    --eventcontent FEVTDEBUGHLT \\\r\n    --geometry DB:Extended \\\r\n    --era Run3 \\\r\n    --customise=HLTrigger/Configuration/customizeHLTforPatatrack.customizeHLTforPatatrackTriplets \\\r\n    --filein /store/relval/CMSSW_12_0_0_pre6/RelValTTbar_14TeV/GEN-SIM-DIGI-RAW/PU_120X_mcRun3_2021_realistic_v4_JIRA_129-v1/00000/79c06ed5-929b-4a57-a4f2-1ae90e6b38c5.root\r\n```\r\nresulting in\r\n```\r\n19-Aug-2021 17:42:08 CEST  Initiating request to open file file:///gpu_data/store/relval/CMSSW_12_0_0_pre6/RelValTTbar_14TeV/GEN-SIM-DIGI-RAW/PU_120X_mcRun3_2021_realistic_v4_JIRA_129-v1/00000/79c06ed5-929b-4a57-a4f2-1ae90e6b38c5.root\r\n19-Aug-2021 17:42:10 CEST  Successfully opened file file:///gpu_data/store/relval/CMSSW_12_0_0_pre6/RelValTTbar_14TeV/GEN-SIM-DIGI-RAW/PU_120X_mcRun3_2021_realistic_v4_JIRA_129-v1/00000/79c06ed5-929b-4a57-a4f2-1ae90e6b38c5.root\r\n%MSG-e TkDetLayers:   TSGFromL2Muon:hltL3NoFiltersNoVtxTrajSeedOIHit@streamBeginRun  19-Aug-2021 17:42:51 CEST Run: 1 Stream: 0\r\n ForwardDiskSectorBuilderFromDet: Trying to build Petal Wedge from Dets at different z positions !! Delta_z = -0.951241\r\n%MSG\r\nBegin processing the 1st record. Run 1, Event 2, LumiSection 1 on stream 0 at 19-Aug-2021 17:42:51.956 CEST\r\n#--------------------------------------------------------------------------\r\n#                         FastJet release 3.4.0\r\n#                 M. Cacciari, G.P. Salam and G. Soyez                  \r\n#     A software package for jet finding and analysis at colliders      \r\n#                           http://fastjet.fr                           \r\n#\t                                                                      \r\n# Please cite EPJC72(2012)1896 [arXiv:1111.6097] if you use this package\r\n# for scientific work and optionally PLB641(2006)57 [hep-ph/0512210].   \r\n#                                                                       \r\n# FastJet is provided without warranty under the GNU GPL v2 or higher.  \r\n# It uses T. Chan's closest pair algorithm, S. Fortune's Voronoi code\r\n# and 3rd party plugin jet algorithms. See COPYING file for details.\r\n#--------------------------------------------------------------------------\r\nBegin processing the 2nd record. Run 1, Event 1, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:01.240 CEST\r\nBegin processing the 3rd record. Run 1, Event 3, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:08.832 CEST\r\nBegin processing the 4th record. Run 1, Event 4, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:11.405 CEST\r\nBegin processing the 5th record. Run 1, Event 5, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:15.623 CEST\r\nBegin processing the 6th record. Run 1, Event 7, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:19.599 CEST\r\nBegin processing the 7th record. Run 1, Event 8, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:26.721 CEST\r\nBegin processing the 8th record. Run 1, Event 6, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:28.204 CEST\r\nBegin processing the 9th record. Run 1, Event 9, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:37.284 CEST\r\nBegin processing the 10th record. Run 1, Event 10, LumiSection 1 on stream 0 at 19-Aug-2021 17:43:42.508 CEST\r\n19-Aug-2021 17:43:51 CEST  Closed file file:///gpu_data/store/relval/CMSSW_12_0_0_pre6/RelValTTbar_14TeV/GEN-SIM-DIGI-RAW/PU_120X_mcRun3_2021_realistic_v4_JIRA_129-v1/00000/79c06ed5-929b-4a57-a4f2-1ae90e6b38c5.root\r\n\r\n=============================================\r\n\r\nMessageLogger Summary\r\n\r\n type     category        sev    module        subroutine        count    total\r\n ---- -------------------- -- ---------------- ----------------  -----    -----\r\n    1 TkDetLayers          -e TSGFromL2Muon:hl                       1        1\r\n    2 fileAction           -s file_close                             1        1\r\n    3 fileAction           -s file_open                              2        2\r\n\r\n type    category    Examples: run/evt        run/evt          run/evt\r\n ---- -------------------- ---------------- ---------------- ----------------\r\n    1 TkDetLayers          Run: 1 Stream: 0                  \r\n    2 fileAction           PostGlobalEndRun                  \r\n    3 fileAction           pre-events       pre-events       \r\n\r\nSeverity    # Occurrences   Total Occurrences\r\n--------    -------------   -----------------\r\nError                   1                   1\r\nSystem                  3                   3\r\n\r\ndropped waiting message count 0\r\n```\r\n\r\nTested successfully both with and without a GPU.\r\nThe physics validation and the GPU vs CPU comparison will follow after the customisation has been merged.\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nBackport of #34956 .\r\n<!-- Please replace this text with any link to  -->\r\n\r\nBefore submitting your pull requests, make sure you followed this checklist:\r\n- verify that the PR is really intended for the chosen branch\r\n- verify that changes follow [CMS Naming, Coding, And Style Rules](http://cms-sw.github.io/cms_coding_rules.html)\r\n- verify that the PR passes the basic test procedure suggested in the [CMSSW PR instructions](https://cms-sw.github.io/PRWorkflow.html)\r\n", "branch": "CMSSW_12_0_X", "changed_files": 1, "closed_at": "1629522478", "comments": 7, "commits": 1, "created_at": "1629380679", "deletions": 0, "labels": ["hlt-approved", "fully-signed", "tests-approved", "orp-approved", "backport-ok"], "merge_commit_sha": "b27b636fcff7a6558527d4fbd706a9da885e5f70", "merged_at": "1629522478", "merged_by": "cmsbuild", "milestone": "CMSSW_12_0_X", "number": 34957, "release-notes": [], "review_comments": 0, "state": "closed", "title": "HLT customisation for Patatrack pixel tracks and GPU offload [12.0.x]", "updated_at": "1629522479", "user": "fwyzard"}
{"additions": 6, "auther_ref": "from-CMSSW_14_2_0_pre4", "auther_sha": "7ab6ab4d6537699c31f381d32cffe0654564183b", "author": "mmarchegiani", "body": "#### PR description:\r\n\r\nThis PR updates the DQM sequences corresponding to the offline BTV DQM. Following the recent PR https://github.com/cms-sw/cmssw/pull/46674 to include the DQM histograms of the newest Run-3 b-taggers, the `DQMOfflineBTag` sequence is redefined such that the `bTagMiniDQMSource` producing the DQM histograms for the Run-3 taggers is executed. The harvesting step of the DQM is modified accordingly such that the `DQMHarvestBTag` sequence is executed to fill the histograms.\r\nThese changes are needed such that the alias `btag` defined in [DQMOffline/Configuration/python/autoDQM.py](https://github.com/cms-sw/cmssw/blob/93af1c75d8d6cf955f23f5f9deeca49b76357262/DQMOffline/Configuration/python/autoDQM.py#L137-L139), including the sequences `DQMOfflineBTag` and `DQMHarvestBTag`, is running the production of the offline BTV DQM histograms.\r\nAfter this PR is merged, the tag `@btag` can be used in https://github.com/dmwm/T0/blob/master/etc/ProdOfflineConfiguration.py to run the BTV offline DQM on datasets at Tier-0.\r\n\r\n#### PR validation:\r\n\r\nIn order to test that the `@btag` tag is running the updated DQM sequences, the following command on the `Run2024D/BTagMu` dataset is run to run the prompt reconstruction and DQM steps:\r\n```\r\npython3 $CMSSW_RELEASE_BASE/src/Configuration/DataProcessing/test/RunPromptReco.py --scenario=ppEra_Run3 --reco --aod --miniaod --global-tag 140X_dataRun3_Prompt_v2 --lfn=file:/eos/user/m/mmarcheg/BTVOfflineDQM/store/data/Run2024D/BTagMu/RAW/v1/000/380/649/00000/ff51f62b-a054-4b81-a6f3-58996b9044f6.root --alcarecos=TkAlMinBias+TkAlV0s --PhysicsSkims=LogError+LogErrorMonitor --dqmio --dqmSeq=@common+@btag\r\n```\r\nFinally, the harvesting step is run with the following command:\r\n```\r\ncmsDriver.py step4  -s HARVESTING:@btag --conditions auto:run3_data --data  --filetype DQM --scenario pp --era Run3_2024 -n 100 --filein file:output_inDQMIO.root --fileout file:step4.root\r\n```\r\n\r\nThe output file `DQM_V0001_R000380649__Global__CMSSW_X_Y_Z__RECO.root` is then opened with ROOT and explored with TBrowser to ensure that the BTV DQM histograms are correctly saved in the output.\r\n\r\nThe generic tests described in https://cms-sw.github.io/PRWorkflow.html have been executed. All the tests run with `scram b runtests use-ibeos` are successful. Most of the tests run with `runTheMatrix.py -l limited -i all --ibeos` are successful, with some tests failed due to `Step0-DAS_ERROR`:\r\n\r\n```\r\n2022.000001_RunJetHT2022C_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:13 2024-date Thu Nov 28 19:38:10 2024; exit: 256 0 0 0\r\n2022.002001_RunZeroBias2022C_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:16 2024-date Thu Nov 28 19:38:14 2024; exit: 256 0 0 0\r\n2023.002001_RunZeroBias2023D_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:18 2024-date Thu Nov 28 19:38:17 2024; exit: 256 0 0 0\r\n2024.000001_RunZeroBias2024B_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:21 2024-date Thu Nov 28 19:38:19 2024; exit: 256 0 0 0\r\n2024.101001_RunBTagMu2024C_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:23 2024-date Thu Nov 28 19:38:22 2024; exit: 256 0 0 0\r\n2024.202001_RunJetMET02024D_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:26 2024-date Thu Nov 28 19:38:24 2024; exit: 256 0 0 0\r\n2024.303001_RunDisplacedJet2024E_10k Step0-DAS_ERROR Step1-NOTRUN Step2-NOTRUN Step3-NOTRUN  - time date Thu Nov 28 19:38:27 2024-date Thu Nov 28 19:38:26 2024; exit: 256 0 0 0\r\n```\r\nHowever, the `Step0-DAS_ERROR` is related to fetching the datasets and is not an error specific to our changes, therefore we open the PR.\r\n", "branch": "master", "changed_files": 2, "comments": 9, "commits": 3, "created_at": "1733128121", "deletions": 7, "labels": ["dqm-pending", "pending-signatures", "tests-rejected", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_16_0_X", "number": 46838, "release-notes": [], "review_comments": 0, "state": "open", "title": "Update BTV offline DQM sequences", "updated_at": "1757484245", "user": "mmarchegiani"}
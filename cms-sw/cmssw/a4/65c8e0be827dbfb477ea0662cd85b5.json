{"additions": 28, "auther_ref": "FWLite-MultiChainEvent-fix-0ev-crash", "auther_sha": "6847132ef8249471bc1ea87ccefd8a142538d1e9", "author": "gpetruc", "body": "When creating a MultiChainEvent when the primary list of files have zero events, the `Event` object of the `ChainEvent` is not initialized, since zero-event files are skipped and \nhttps://github.com/cms-sw/cmssw/blob/CMSSW_7_4_X/DataFormats/FWLite/src/ChainEvent.cc#L57-L68\nand this leads to a crash when setting the product getter\n   https://github.com/cms-sw/cmssw/blob/CMSSW_7_4_X/DataFormats/FWLite/src/MultiChainEvent.cc#L80-L81\nThis PR avoids the crash by not setting the product getter, which should probably be ok since if there's no events, valid code should never end up querying the product getter for anything.\nI also implemented `toBegin()` and `atEnd()` so that they don't crash if there's no non-empty files. This way, an event loop will just do nothing, as it should, if there's no events to loop on.\n\nYou can use the script below to test this fix:\n- Run with a non-empty input file\n  `python poc.py root://eoscms//eos/cms/store/data/Run2015B/SingleMuon/MINIAOD/PromptReco-v1/000/251/251/00000/EEBF2AF4-8D27-E511-91F7-02163E014527.root root://eoscms//eos/cms/store/data/Run2015B/SingleMuon/RAW/v1/000/251/251/00000/02E8B556-CA25-E511-A441-02163E011BB9.root  root://eoscms//eos/cms/store/data/Run2015B/SingleMuon/RAW/v1/000/251/251/00000/0691B06D-CA25-E511-8FBD-02163E0133B6.root  root://eoscms//eos/cms/store/data/Run2015B/SingleMuon/RAW/v1/000/251/251/00000/4CD4166A-CA25-E511-A474-02163E011D4A.root  root://eoscms//eos/cms/store/data/Run2015B/SingleMuon/RAW/v1/000/251/251/00000/9E73A652-CA25-E511-B232-02163E0133ED.root`\n- Run with an empty input file\n  `python poc.py root://eoscms//eos/cms/store/data/Run2015B/SingleElectron/MINIAOD/PromptReco-v1/000/251/781/00000/662647FF-9B2C-E511-85C5-02163E012965.root root://eoscms//eos/cms/store/data/Run2015B/SingleElectron/RAW/v1/000/251/781/00000/32256686-A02A-E511-BEBE-02163E014437.root`\n\n```\nfrom sys import argv\nargv.append( '-b-' )\nimport ROOT\nROOT.gROOT.SetBatch(True)\nargv.remove( '-b-' )\n\nROOT.gSystem.Load(\"libFWCoreFWLite.so\");\nROOT.gSystem.Load(\"libDataFormatsFWLite.so\");\nROOT.AutoLibraryLoader.enable()\n\nfrom DataFormats.FWLite import Handle, Events\nfrom optparse import Values\noptions = Values()\noptions.inputFiles = [ argv[1] ]\noptions.secondaryInputFiles = argv[2:] \noptions.maxEvents = -1\nevents = Events([],options=options)\n\nprint \"In total there are %d events\" % events.size()\nprint \"Trying an event loop\"\nfor i,event in enumerate(events):\n    print \"I am processing an event\"\n    if i > 10: break\nprint \"Done with the event loops\"\n\n```\n", "branch": "CMSSW_7_4_X", "changed_files": 4, "closed_at": "1439986901", "comments": 24, "commits": 3, "created_at": "1439462715", "deletions": 3, "labels": ["comparison-available", "core-approved", "fully-signed", "tests-approved"], "merge_commit_sha": "a820f784314c050b47132725b57b7657364971f6", "merged_at": "1439986901", "merged_by": "cmsbuild", "milestone": "Next CMSSW_7_4_X", "number": 10739, "release-notes": [], "review_comments": 0, "state": "closed", "title": "FWLite MultiChainEvent: avoid crash on empty files", "updated_at": "1443642601", "user": "gpetruc"}
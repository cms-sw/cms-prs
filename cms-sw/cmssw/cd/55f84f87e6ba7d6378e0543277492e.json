{"additions": 220, "auther_ref": "devel-cmsenv-mpirun", "auther_sha": "0edf2f954ed6cf93c54dae9bdd9a4028163e12ea", "author": "ghyls", "body": "Backport of #49566\r\n\r\n#### PR Description\r\n\r\nThe current version of `cmsenv_mpirun` relies on `cmsenv_orted`, a wrapper around `orted` (OpenMPI 4.x's \"Open Runtime Environment Daemon\") that sets the `cmsenv` before calling `orted`.\r\n\r\n- In OpenMPI 5, `orted` has been replaced by `prted`, and more importantly `mpirun` requires knowing where its libraries are at an earlier stage than OpenMPI 4, so commands like\r\n```\r\nmpirun --launch-agent cmsenv_prted ...\r\n```\r\nfail before `cmsenv_prted` is executed.\r\n- MPICH uses `hydra`, yet a different launcher.\r\n\r\nThis PR proposes a modified `cmsenv_mpirun` that can be used with OpenMPI 4, OpenMPI 5 and MPICH. This is accomplished by wrapping `ssh`, used by the three MPI implementations to establish the connection with the remote node at the very first step, before the MPI libraries are attempted to be loaded in the remote node. The wrapper sets the CMS environment in the remote node so the MPI libraries can later be found.\r\n\r\n`cmsenv_mpirun` and `cmsenv_ssh` rely on the assumption that `$CMS_PATH` and `$CMSSW_BASE` are the same in the local and remote nodes.\r\n\r\n\r\n\r\nThe script `cmsenv_ssh` can also be used independently from `cmsenv_mpirun`, e.g.\r\n``` \r\ncmsenv_ssh remote_host which mpirun\r\n```\r\nwhich could be handy in some cases.\r\n\r\n#### PR validation:\r\nNo unit tests are currently set up to test `cmsenv_mpirun`", "branch": "CMSSW_16_0_X", "changed_files": 3, "comments": 8, "commits": 1, "created_at": "1766069294", "deletions": 177, "labels": ["fully-signed", "tests-approved", "orp-pending", "backport", "heterogeneous-approved", "ngt"], "milestone": "CMSSW_16_0_X", "number": 49672, "release-notes": [], "review_comments": 0, "state": "open", "title": "A `cmsenv_mpirun` that works transparently with OpenMPI 5, OpenMPI 4 and MPICH, [`16_0_X`]", "updated_at": "1766086258", "user": "ghyls"}
{"additions": 1, "auther_ref": "fix_loop_in_vertexFinder_splitVertices", "auther_sha": "5ab8cd95ece47e951cec1273a8cbc2e7aa08df41", "author": "fwyzard", "body": "#### PR description:\r\n\r\nFix loop in `vertexFinder::splitVertices(acc, ...)`.\r\n\r\nThe correct loop should be over all tracks of a given vertex, not all tracks of all vertices.\r\n\r\n#### PR validation:\r\n\r\nEnabling device-side asserts in `RecoTracker/PixelVertexFinding/plugins/alpaka/splitVertices.h` shows the problem:\r\n```\r\n$ $CMSSW_BASE/test/el8_amd64_gcc12/deviceVertexFinderByDensity_tSerialSync\r\nM eps, pset 2 0.1 0\r\nnt,nv 297 0,0\r\nnt,nv 297 17,17\r\nafter fit nv, min max chi2 17 0.399816 16.1201\r\nbefore splitting nv, min max chi2 17 0.399816 11.9221\r\ndeviceVertexFinderByDensity_tSerialSync: /data/user/fwyzard/CMSSW_14_0_X_2024-01-23-2300/src/RecoTracker/PixelVertexFinding/plugins/alpaka/splitVertices.h:85: void alpaka_serial_sync::vertexFinder::splitVertices(const TAcc&, VtxSoAView&, WsSoAView&, float) [with TAcc = alpaka::AccCpuSerial<std::integral_constant<long unsigned int, 1>, unsigned int>; VtxSoAView = reco::ZVertexLayout<>::ViewTemplateFreeParams<128, false, true, false>; WsSoAView = vertexFinder::PixelVertexWSSoALayout<>::ViewTemplateFreeParams<128, false, true, false>]: Assertion `int(nq) == nn[kv] + 1' failed.\r\nAborted (core dumped)\r\n```\r\n\r\nWith the fix, the tests run to completion:\r\n```\r\n$ $CMSSW_BASE/test/el8_amd64_gcc12/deviceVertexFinderByDensity_tSerialSync\r\nM eps, pset 2 0.1 0\r\nnt,nv 297 0,0\r\nnt,nv 297 17,17\r\nafter fit nv, min max chi2 17 0.399816 16.1201\r\nbefore splitting nv, min max chi2 17 0.399816 11.9221\r\nafter split 17\r\nnv, min max chi2 17 0.399816 11.3424\r\nmin max error 0.0115278 0.00197312\r\nmin max ptv2 17.8624 130.467\r\nmin max ptv2 17.8624 130.467 at 4 0\r\nmin max rms 0.000147343 0.00674829 0.000665088\r\n...\r\n```", "branch": "master", "changed_files": 1, "closed_at": "1706707673", "comments": 11, "commits": 1, "created_at": "1706683017", "deletions": 1, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "bug-fix", "orp-approved", "urgent", "code-checks-approved", "tracking"], "merge_commit_sha": "b097b2ad6ac1c97755cd09c6bae5f23d147e26f2", "merged_at": "1706707673", "merged_by": "cmsbuild", "milestone": "CMSSW_14_0_X", "number": 43820, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix loop in vertexFinder::splitVertices(acc, ...)", "updated_at": "1706707674", "user": "fwyzard"}
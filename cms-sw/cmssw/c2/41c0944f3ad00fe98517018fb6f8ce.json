{"additions": 120, "auther_ref": "update_convertToRaw_125x", "auther_sha": "9a4b207bd3aa70c67b2b63dfb62fbb1542ce4468", "author": "fwyzard", "body": "#### PR description:\r\n\r\nUpdate the `convertToRaw` script:\r\n  - change the default to 100 events per file, to match the value currently used online;\r\n  - Improve the handling of the output and exit status of the subprocesses;\r\n  - write a `run####_cff.py` file with the Source and Services to process the converted files;\r\n  - add the `-r`/`--range` option to restrict the processing to a range of runs and lumisections;\r\n  - add the `-v/--verbose` option to print additional message while preprocessing and converting the input files.\r\n\r\n#### PR validation:\r\n\r\nThe new version runs and selects lumisections correctly.\r\n\r\nHere is a sample output from running `convertToRaw` over one .root file:\r\n```\r\n$ convertToRaw -o /gpu_data/store/data/Run2022C/HLTPhysics/FED/v1 -r 34-65 root://eoscms.cern.ch//eos/cms/tier0/store/data/Run2022C/EphemeralHLTPhysics11/RAW/v1/000/357/329/00000/9e43f951-59ef-4dbf-85d1-28b5fa5f664f.root \r\npreprocessing input file root://eoscms.cern.ch//eos/cms/tier0/store/data/Run2022C/EphemeralHLTPhysics11/RAW/v1/000/357/329/00000/9e43f951-59ef-4dbf-85d1-28b5fa5f664f.root\r\n  run 357329, lumisetion 29 is outside of the given range and will be skipped\r\n  run 357329, lumisetion 30 is outside of the given range and will be skipped\r\n  run 357329, lumisetion 31 is outside of the given range and will be skipped\r\n  run 357329, lumisetion 32 is outside of the given range and will be skipped\r\n  run 357329, lumisetion 33 is outside of the given range and will be skipped\r\n  run 357329, lumisetion 34 with 463 events will be processed\r\n  run 357329, lumisetion 35 with 431 events will be processed\r\n\r\nfound run 357329, lumi 34, with 463 events\r\ncmsRun \\\r\n  /data/user/fwyzard/CMSSW_12_4_6/src/HLTrigger/Tools/python/convertToRaw.py \\\r\n  inputFiles=root://eoscms.cern.ch//eos/cms/tier0/store/data/Run2022C/EphemeralHLTPhysics11/RAW/v1/000/357/329/00000/9e43f951-59ef-4dbf-85d1-28b5fa5f664f.root \\\r\n  runNumber=357329 \\\r\n  lumiNumber=34 \\\r\n  eventsPerLumi=11655 \\\r\n  eventsPerFile=100 \\\r\n  outputPath=/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329_ls0034\r\n\r\nfound run 357329, lumi 35, with 431 events\r\ncmsRun \\\r\n  /data/user/fwyzard/CMSSW_12_4_6/src/HLTrigger/Tools/python/convertToRaw.py \\\r\n  inputFiles=root://eoscms.cern.ch//eos/cms/tier0/store/data/Run2022C/EphemeralHLTPhysics11/RAW/v1/000/357/329/00000/9e43f951-59ef-4dbf-85d1-28b5fa5f664f.root \\\r\n  runNumber=357329 \\\r\n  lumiNumber=35 \\\r\n  eventsPerLumi=11655 \\\r\n  eventsPerFile=100 \\\r\n  outputPath=/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329_ls0035\r\n\r\n```\r\n\r\nAnd the corresponding `/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329_cff.py` file:\r\n```python\r\nimport FWCore.ParameterSet.Config as cms\r\n\r\nfrom EventFilter.Utilities.FedRawDataInputSource_cfi import source as _source\r\nsource = _source.clone(\r\n    eventChunkSize = 200,   # MB\r\n    eventChunkBlock = 200,  # MB\r\n    numBuffers = 4,\r\n    maxBufferedFiles = 4,\r\n    fileListMode = True,\r\n    fileNames = (\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0034_index000000.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0034_index000001.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0034_index000002.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0034_index000003.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0034_index000004.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0035_index000000.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0035_index000001.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0035_index000002.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0035_index000003.raw',\r\n        '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1/run357329/run357329_ls0035_index000004.raw'\r\n    )\r\n)\r\n\r\nfrom EventFilter.Utilities.EvFDaqDirector_cfi import EvFDaqDirector as _EvFDaqDirector\r\nEvFDaqDirector = _EvFDaqDirector.clone(\r\n    buBaseDir = '/gpu_data/store/data/Run2022C/HLTPhysics/FED/v1',\r\n    runNumber = 357329\r\n)\r\n\r\nfrom EventFilter.Utilities.FastMonitoringService_cfi import FastMonitoringService as _FastMonitoringService\r\nFastMonitoringService = _FastMonitoringService.clone()\r\n```\r\n\r\n#### If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nTo be backported to 12.4.x to convert data for use by the HLT.\r\nSee #39048.", "branch": "master", "changed_files": 1, "closed_at": "1660431817", "comments": 18, "commits": 3, "created_at": "1660332973", "deletions": 16, "labels": ["hlt-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "f44cb5d5076592c1a394b3d95691d1ae362914fb", "merged_at": "1660431817", "merged_by": "cmsbuild", "milestone": "CMSSW_12_5_X", "number": 39047, "release-notes": [], "review_comments": 5, "state": "closed", "title": "Update the `convertToRaw` script", "updated_at": "1660431817", "user": "fwyzard"}
{"additions": 35, "auther_ref": "cleaning_patatrackPixelOnly", "auther_sha": "6e737c5efc3554c21c1b2aed840890ee12427e78", "author": "AdrianoDee", "body": "As it is now the Patatrack on CPU worflows (anything with `pixelNtupletFit` modifier, `.501` and `.505` or also `.502` and `.506` when no GPU is available ) runs both the `SiPixelRecHitSoAFromLegacy` module and the legacy/deprecated `SiPixelRecHitConverter `. This shouldn't happen and this fix this. See the dependency graph for the `.501` or `.502` on CPU wfs (dropping the validation to simplify the graph).\r\n\r\n<img width=\"523\" alt=\"image\" src=\"https://user-images.githubusercontent.com/16901146/146466190-84c747fa-f82d-47df-b643-328af62068d5.png\">\r\n\r\nThe full graphs here for [reference](https://adiflori.web.cern.ch/adiflori/cleaning_pata/cpu_ref_timing.png) and [this PR](https://adiflori.web.cern.ch/adiflori/cleaning_pata/cpu_dev_timing.png). \r\n\r\nThe way it is creates also some mismatch in the pixel local reco given that `siPixelRecHitsPreSplitting` identifies the legacy products and then the pixel RecHit validation modules cosumes them [here](https://github.com/cms-sw/cmssw/blob/master/Validation/SiPixelPhase1ConfigV/python/SiPixelPhase1OfflineDQM_sourceV_cff.py#L29). Also the pixel tracks are built (when converting from SoA) using the legacy hits.\r\n\r\n### PR validation:\r\n\r\n#### Local pixel reconstruction\r\n\r\nDifferences expected in the CPU workflows given now the validation modules will consume the correct products. See comparison plots:\r\n\r\n1. Comparison across the GPU and CPU workflows for both the `master` (reference) and this PR. See in blue the reference on CPU that's the only one mismatching. [Here](https://adiflori.web.cern.ch/adiflori/cleaning_pata/all_comparisons/index.html).\r\n2. Comparison GPU vs CPU workflows for both the `master`. There's an \"artificial\" mismatch. [Here](https://adiflori.web.cern.ch/adiflori/cleaning_pata/ref_comparisons/index.html)\r\n3. Comparison GPU vs CPU workflows for both this PR. CPU and CPU perfectly the same. [Here](https://adiflori.web.cern.ch/adiflori/cleaning_pata/pr_comparisons/index.html)\r\n\r\nAn example for the laziest:\r\n\r\n<img width=\"1020\" alt=\"image\" src=\"https://user-images.githubusercontent.com/16901146/146421808-c060ab30-1607-49d6-9553-44434255f540.png\">\r\n\r\n#### Pixel track reconstruction\r\n\r\nNo regression expected nor observed.\r\n\r\nSee comparisons for\r\n\r\n- `.501` ttbar CPU worflows [here](https://adiflori.web.cern.ch/adiflori/cleaning_pata/cpu_plots/)\r\n- `.502` ttbar GPU workflows [here](https://adiflori.web.cern.ch/adiflori/cleaning_pata/gpu_plots/) [just to be sure]\r\n\r\nno differences for pixel track reco.\r\n\r\n", "branch": "master", "changed_files": 2, "comments": 11, "commits": 2, "created_at": "1639672992", "deletions": 17, "labels": ["reconstruction-pending", "pending-signatures", "tests-pending", "orp-pending", "bug-fix", "code-checks-pending"], "milestone": "CMSSW_12_3_X", "number": 36529, "release-notes": [], "review_comments": 0, "state": "open", "title": "Fixing Patatrak pixelTracking only wfs", "updated_at": "1639696292", "user": "AdrianoDee"}
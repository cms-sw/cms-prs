{"additions": 35, "auther_ref": "copy75XMemImprovements", "auther_sha": "d4daca34099ee4d8f415b31f83960c71b13d5af7", "author": "mark-grimes", "body": "Found the problem in `SeedGeneratorFromRegionHitsEDProducer` and realised Vincenzo had fixed in 75X, just using `vector.clear(); vector.shrink_to_fit();` - I'd been greping for things of the form `vector.swap(temp)`.  So I went through and copied the majority of the occurrences of `shrink_to_fit` in 75X to SLHC.  There's also a few uses of `edm::RunningAverage` to estimate a reserve size.\n\nRetained memory, excluding products before:\n![mem75x_before](https://cloud.githubusercontent.com/assets/6480160/7782802/fa3f64a8-0121-11e5-97f4-31f4586ba94e.png)\nAfter applying this pull request:\n![mem75x_after](https://cloud.githubusercontent.com/assets/6480160/7782803/fbe75af4-0121-11e5-95ae-3383322e9384.png)\n\nSo there's a saving of ~85 Mb just in `SeedGeneratorFromRegionHitsEDProducer`.  Probably quite a few savings in smaller modules too, which could add up to quite a bit.\n\nThink I'm going to call it a day now - all the big memory allocations are before the first event, so probably services, database reads etcetera.  The only exception is PoolOutputModule which I'm reluctant to get into.  I'll start running some full RSS and VmSize tests and post here later.\n\n@lgray\n", "branch": "CMSSW_6_2_X_SLHC", "changed_files": 9, "closed_at": "1432496729", "comments": 10, "commits": 1, "created_at": "1432358282", "deletions": 25, "labels": ["comparison-pending", "orp-pending", "pending-signatures", "reconstruction-pending", "tests-approved"], "merge_commit_sha": "8807fcde726dccaa935629dbc28981252306a562", "merged_at": "1432496729", "merged_by": "cmsbuild", "milestone": "Next CMSSW_6_2_X_SLHC", "number": 9243, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Copy some memory improvements from 75X to SLHC", "updated_at": "1432498876", "user": "mark-grimes"}
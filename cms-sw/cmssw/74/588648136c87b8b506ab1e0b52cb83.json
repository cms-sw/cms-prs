{"additions": 4, "auther_ref": "chargeflip_quickfix", "auther_sha": "0b9519d8925cb48eefe68180634c9f15b474c3a6", "author": "leonardogiannini", "body": "#### PR description:\r\n\r\nThis PR fixes the mkFit propagation to plane to allow for charge flips during the propagation.\r\n\r\n- inside kalmanOperationPlaneLocal the sign of 1/pT (outPar(n,3,0) is set negative in case of charge flips, so that the safeguard can catch the charge flip [here](https://github.com/leonardogiannini/cmssw/blob/e97630413c53d5ee6e47a6e80092f6737f8850c2/RecoTracker/MkFitCore/src/KalmanUtilsMPlex.cc#L1355-L1358)\r\n\r\n- the sign of the jacobian element jacCurv2CCS(n, 3, 0) is also changed as the charge enters it directly.\r\n\r\n\r\n#### PR validation:\r\n\r\nThe change has a small effect on mkFit built tracks, visible for instance at HLT with legacy tracking ([MTV_TTPU](http://uaf-10.t2.ucsd.edu/~legianni/checkFitPt/newBaseline_crosschecks/plots_TTPU_fix_vs_nofix_BuildLegacy)), where the number of hits increases slightly (blue=before, red=after fix)\r\n\r\n<img width=\"651\" height=\"421\" alt=\"image\" src=\"https://github.com/user-attachments/assets/87a48523-e4f9-4802-9317-052f69126b97\" />\r\n\r\nThe effect is negligible in the HLT tracking proposed new baseline, or patatrack extension + LST seeding single iteration (see [plots](http://uaf-10.t2.ucsd.edu/~legianni/checkFitPt/newBaseline_crosschecks/plots_TTPU_fix_vs_nofix_Build)) \r\n\r\nThe most noticeable improvement is observed when mkFit is used in the final fit, where the problem was found.\r\nE.g. for 10 GeV muons (blue = CKF fit, red = mkFit, with legacy HLT tracking, hltInitialStepTracks), we can see that right tail at high pT due to the missing charge flips disappears in right plot, after the fix.\r\n\r\n<img width=\"1094\" height=\"650\" alt=\"image\" src=\"https://github.com/user-attachments/assets/b0793c9e-03e0-423a-b3cb-0879c661070a\" />\r\n\r\nNB: the mkFit fit is not currently part of any baseline tracking configuration.\r\n\r\n", "branch": "master", "changed_files": 1, "closed_at": "1765828713", "comments": 11, "commits": 2, "created_at": "1765556167", "deletions": 0, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved", "tracking"], "merge_commit_sha": "e41240ab9278c5d1ea555fdd31bd3fdd9cc367e5", "merged_at": "1765828713", "merged_by": "cmsbuild", "milestone": "CMSSW_16_0_X", "number": 49622, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[mkFit] fix charge flip bug in propagationToPlane", "updated_at": "1765828714", "user": "leonardogiannini"}
{"additions": 435, "auther_ref": "1510p1_JoinedStripRecHitsPR", "auther_sha": "5e4f143727b5547c72a074949ce7e0c85f251b1f", "author": "elusian", "body": "#### PR description:\r\n\r\n<!-- Please replace this text with a description of the feature proposed or problem addressed, specifying:\r\n  - what changes are expected in the output if any, \r\n  - what other PRs or externals it depends upon if any,\r\n  - link to any additional material useful to provide a documentation for this PR (slides, JIRA tickets, related pull requestes, hypernews, TWiki or Indico pages)  -->\r\n\r\nTracking with mkFit depends on a series of converters that translate the standard CMSSW objects (e.g. tracking rechits) to the mkFit specific formats.\r\nGiven the introduction of mkFit for the tracking iteration at HLT in 2025, it's important that all these converters are as fast as possible.\r\n\r\nThis PR includes two commits:\r\n- the first adds an output to the hit converters that details the number of hits for each layer, which can be used as an hint for allocations in further steps\r\n- the second adds a parameter in the standard `SiStripRecHitConverterAlgorithm` that allows filling further collections and a new plugin (`MkFitSiStripHitConverterFromClusters`), which acts as drop-in replacement for both `SiStripRecHitConverter` and `MkFitSiStripHitConverter` while being faster than the sum of the two.\r\n\r\nOnly the first commit touches code that is currently being executed in release (but it amounts to a call to reserve on some vectors), while the second is fully opt in and needs to be added to sequences to be active.\r\nTo avoid touching existing code (for a faster review) there is a small amount of code repetition in `convertHits.h` that can be corrected with a future PR.\r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\nThis change was validated on 731 TTbar MC events from the Winter25 campaign. \r\nThe results can be found [here](https://elusiani.web.cern.ch/SiStrip/SiStripRecHitJoinedConverterHLTPR/plots_hlt.html).\r\nNo differences were observed in either of the commits.\r\nNo other code physics object depend on the modules that are being modified.\r\n\r\nThe timing improvement was measured in the HLT timing server:\r\n- [Baseline](https://cmshlttiming.app.cern.ch/display/elusiani/CMSSW_15_0_4_CA_MkFit.20250422_105914): 477.8 ms, 540.3 +/- 3 ev/s\r\n- [This PR](https://cmshlttiming.app.cern.ch/display/elusiani/CMSSW_15_0_4_CA_MkFit_Opt.20250422_151358): 467.3 ms, 552.9 +/- 1.7 ev/s (+2.3 +/- 0.6% throughput)\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nNot a backport but will be backported to 15_0_X\r\n\r\n<!-- Please delete the text above after you verified all points of the checklist  -->\r\n\r\ncc @mmasciov @kskovpen \r\n", "branch": "master", "changed_files": 13, "closed_at": "1750771041", "comments": 15, "commits": 3, "created_at": "1745325111", "deletions": 84, "labels": ["reconstruction-pending", "hlt-rejected", "pending-signatures", "tests-pending", "orp-pending", "code-checks-rejected", "tracking", "trk", "allow-elusian"], "milestone": "CMSSW_15_1_X", "number": 47926, "release-notes": [], "review_comments": 3, "state": "closed", "title": "Optimizations for the MkFit converters", "updated_at": "1750771041", "user": "elusian"}
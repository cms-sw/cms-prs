{"additions": 418, "auther_ref": "HGCal_tiling_CLUE_10_6_0_pre4", "auther_sha": "9253598fa540e51a2377e84f90c2662b6283dde6", "author": "felicepantaleo", "body": "#### PR description:\r\nHGCal Layer Clustering `HGCalLayerClusterProducer` is in the top 3 main offenders in computing resources in Phase 2 reconstruction.\r\n![image](https://user-images.githubusercontent.com/6595715/58321915-cd99b780-7e1f-11e9-9017-8551f46efb6c.png)\r\n\r\nToday, Layer Clustering is performed using CLUE algorithm, which is using a KD-Tree for speeding up nearest neighbor search.\r\nHowever, the KD-Tree is :\r\n- hard to build on a GPU\r\n- expensive if the search-box is small with respect to the point cloud volume\r\n- not optimal for a small number of dimensions and we are just using it for x and y position.\r\n\r\nThis PR replaces the KD-Tree with a Tiling data structure.\r\nThis allows to achieve a speed-up of **1 order of magnitude** in PU200 conditions, making the Layer Clustering negligible with respect to the rest of the Phase-2 reconstruction.\r\n\r\n#### PR validation:\r\nThe validation was executed with 10_6_0 on ttbar PU200:\r\nhttps://fpantale.web.cern.ch/fpantale/PRs/26777\r\n\r\nNo differences are found for Silicon-only layers, improvements in the Scintillator are found due to the change in the logic of the association.\r\n\r\nMemory footprint per stream is **down by more than 200MB**.\r\n![image](https://user-images.githubusercontent.com/6595715/58214529-57e5fc80-7cf6-11e9-844c-a2b461cb43ee.png)\r\n\r\nThe overall phase 2 reconstruction time (including some overhead) is also **~4% faster**:\r\nbaseline: event loop CPU/event = 224.874532 s\r\nPR: event loop CPU/event = 217.093278 s\r\n\r\nThis is due to the **speedup by an order of magnitude** of the hgcalLayerClusters module:\r\nbaseline (s): 6.160537\r\nPR (s): 0.797660\r\n\r\n\r\n\r\n@rovere @ZihengChen @tonydp03 @malgeri @cseez ", "branch": "master", "changed_files": 4, "closed_at": "1558895834", "comments": 104, "commits": 21, "created_at": "1557830747", "deletions": 372, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "5fe12e0a5edec3b5cf6ff23b9e81e89fd37becf9", "merged_at": "1558895834", "merged_by": "cmsbuild", "milestone": "CMSSW_11_0_X", "number": 26777, "release-notes": [], "review_comments": 11, "state": "closed", "title": "[HGCal] Use tiling for speeding up CLUE algo nearest neighbor search", "updated_at": "1558895834", "user": "felicepantaleo"}
{"additions": 1, "auther_ref": "121X-fix-ls-assert", "auther_sha": "8fe41661345d77c6fcba46320b159ab1607fab97", "author": "smorovic", "body": "#### PR description:\r\n\r\nFix a crash caused by the missing luminosityBlockAuxiliary object, seen in rare instances at the start of run in production DAQ/HLT.\r\n\r\nA race can happen because the local file lock is unlocked before lsToStart is determined.\r\nSince this check involves stat calls for marker files locally, another competing process can in parallel create\r\nthe EoL marker file being checked (and cause lsToStart to be increased\r\nabove LS of the newly opened file).\r\n\r\nIn case lsToStart is larger than ls, source would skip opening a lumisection\r\nbefore ending up processing events and this results in the lumi block\r\nrelated assertion.\r\n\r\nBugfix ensures that lumisection is opened before file can be processed.\r\n\r\n\r\n#### PR validation:\r\n\r\nTested in DAQ filterfarm test system (Openstack VMs). A special test mode was constructed to emulate conditions of crash and find a fix.\r\n\r\n", "branch": "master", "changed_files": 1, "comments": 5, "commits": 1, "created_at": "1634248537", "deletions": 1, "labels": ["reconstruction-pending", "daq-approved", "pending-signatures", "tests-approved", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_12_1_X", "number": 35682, "release-notes": [], "review_comments": 0, "state": "open", "title": "DAQ fix spurious luminosityBlockAuxiliary assertion in HLT (12_1_X)", "updated_at": "1634281354", "user": "smorovic"}
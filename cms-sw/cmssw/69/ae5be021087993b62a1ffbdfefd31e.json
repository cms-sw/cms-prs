{"additions": 25, "auther_ref": "dev-mt-112X", "auther_sha": "6dab9fb4a8d4c401259087895ddf33ef75965457", "author": "colizz", "body": "#### PR description:\r\n\r\n<!-- Please replace this text with a description of the feature proposed or problem addressed, specifying:\r\n  - what changes are expected in the output if any, \r\n  - what other PRs or externals it depends upon if any,\r\n  - link to any additional material useful to provide a documentation for this PR (slides, JIRA tickets, related pull requestes, hypernews, TWiki or Indico pages)  -->\r\n\r\nFix two scripts related to MadGraph multithread implementation.\r\n\r\n- A MadGraph bug was recently observed in the multithread mode that influences the calculated cross-section for the multi-jet process: https://bugs.launchpad.net/mg5amcnlo/+bug/1884085\r\nTo fix this, We apply the corresponding patch to the MadGraph code when producing events from earlier gridpacks.\r\n- Simplify the runcmsgrid patch to make it compatible with the current and future [runcmsgrid script](https://github.com/cms-sw/genproductions/blob/c5b912a886c0aadc9d17cd5893f8bd1a00b453a6/bin/MadGraph5_aMCatNLO/runcmsgrid_LO.sh).\r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\nThe fix is on shell scripts, hence does not influence the CMSSW framework.\r\nWe tested the scripts on W+01234j and DY+01234j multi-jet processes to validate that the MG bug is solved.\r\n\r\n(A quick test for this PR on [`SMP-MultiValidationUL17wmLHEGEN-00001`](https://cms-pdmv.cern.ch/mcm/requests?prepid=SMP-MultiValidationUL17wmLHEGEN-00001&page=0&shown=127))\r\n```shell\r\ncmsrel CMSSW_11_2_X_2020-06-28-0000\r\ncd CMSSW_11_2_X_2020-06-28-0000/src/\r\ncmsenv\r\ngit cms-merge-topic colizz:dev-mt-112X\r\ncurl -s --insecure https://cms-pdmv.cern.ch/mcm/public/restapi/requests/get_fragment/SMP-MultiValidationUL17wmLHEGEN-00001 --retry 2 --create-dirs -o Configuration/GenProduction/python/SMP-MultiValidationUL17wmLHEGEN-00001-fragment.py \r\nscram b -j 8\r\ncd ../..\r\ncmsDriver.py Configuration/GenProduction/python/SMP-MultiValidationUL17wmLHEGEN-00001-fragment.py --fileout file:SMP-MultiValidationUL17wmLHEGEN-00001.root --mc --eventcontent RAWSIM,LHE --datatier GEN,LHE --conditions 106X_mc2017_realistic_v6 --beamspot Realistic25ns13TeVEarly2017Collision --step LHE,GEN --geometry DB:Extended --era Run2_2017 --python_filename SMP-MultiValidationUL17wmLHEGEN-00001_1_cfg.py --no_exec --customise Configuration/DataProcessing/Utils.addMonitoring -n 400 --nThreads 4\r\n\r\ncmsRun -e -j SMP-MultiValidationUL17wmLHEGEN-00001_rt.xml SMP-MultiValidationUL17wmLHEGEN-00001_1_cfg.py\r\n```", "branch": "master", "changed_files": 2, "closed_at": "1593440457", "comments": 18, "commits": 2, "created_at": "1593392509", "deletions": 23, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "generators-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "d63e62ec90ff09e284ec7099df7c6bff4b5772ed", "merged_at": "1593440457", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 30444, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix the MadGraph bug for multithreading", "updated_at": "1593448055", "user": "colizz"}
{"additions": 354, "auther_ref": "scouting_nano_dev_15_0_0_pre2", "auther_sha": "d2ddda9f7b3cc6db34f83975947ab5eee8c44e8f", "author": "patinkaew", "body": "#### PR description:\r\n\r\nThis enables ScoutingNano workflows in CMSSW_15_0_X+ to run on scouting samples (```ScoutingPFRun3```, ```ScoutingPFMonitor```) collected in 2022-2024. Addressed changes are as follows:\r\n\r\n2022:\r\n- Add EDFilter to skip events without scouting object products in ScoutingPFMonitor\r\n\r\n2023:\r\n- Add additional track variables to the Run 3 scouting electron collection for low pT electrons ([cms-sw/cmssw#41025](https://github.com/cms-sw/cmssw/pull/41025))\r\n- Add EDFilter to skip events without scouting object products in ScoutingPFMonitor\r\n\r\n2024:\r\n- Add off-diagonal entries of the vertex fit covariance matrix ([cms-sw/cmssw#43758](https://github.com/cms-sw/cmssw/pull/43758))\r\n- Electron and Photon Scouting Data Format Update for 2024 pp Collisions ([cms-sw/cmssw#43744](https://github.com/cms-sw/cmssw/pull/43744))\r\n- Add EDFilter to skip events without scouting object products in ScoutingPFMonitor\r\n\r\n2025:\r\n- Remove EDFilter to skip events without scouting object products in ScoutingPFMonitor since all ScoutingPFMonitor events should now have scouting object products ([CMSHLT-3089](https://its.cern.ch/jira/browse/CMSHLT-3089))\r\n\r\nIn summary, this PR\r\n- adds era modifiers for 2023,2024,2025: ```run3_scouting_nanoAOD_2023```, ```run3_scouting_nanoAOD_2024```, and ```run3_scouting_nanoAOD_2025``` which are added to ```Run3_2023```, ```Run3_2024```, and ```Run3_2025```.\r\n- removes era modifer ```run3_scouting_nanoAOD_post2023``` as ```run3_scouting_nanoAOD_2024``` and ```run3_scouting_nanoAOD_2025``` are introduced instead.\r\n- adds EDFilter to skip events without scouting object products in ScoutingPFMonitor. This can also be configured in ```cmsDriver.py``` by adding ```--customise PhysicsTools/NanoAOD/custom_run3scouting_cff.skipEventsWithoutScouting```\r\n- adds ```@ScoutMonitor``` flavour to automatically turn on/off the EDFilter based on era modifiers (turn on for 2022-24 and turn off for 2025). This should be used when running with ```ScoutingPFMonitor/RAW``` in scouting-only configuration.\r\n- adds the above feature to automatically turn on/off the EDFilter based on era modifiers to ```@ScoutFromMini```. When running on data, this assumes running on ```ScoutingPFMonitor/MINIAOD``` and will turn on the EDFilter for 2022-24 and turn off on 2025. When running on MC, EDFilter will be turn off.\r\n\r\n\r\nNote on different flavours:\r\n- Data. The default ```Scout``` is designed to be used with ```ScoutingPFRun3``` (containing scouting only). ```ScoutMonitor``` should be used with ```ScoutingPFMonitor/RAW``` and ```ScoutFromMini``` should be used with ```ScoutingPFMonitor/MiniAOD```. The default ```Scout``` will not check for events without scouting products while ```ScoutMonitor``` and ```ScoutFromMini``` will check and skip events without scouting products with 2022-24 samples but turn off this check for 2025. For L1 bits and objects, ```Scout``` assume ```hltFEDSelectorL1``` of type ```FEDRawDataCollection``` exists, ```ScoutMonitor```  assume ```rawDataCollector``` of type ```FEDRawDataCollection``` exists, and ```ScoutFromMini``` assume ```gtStage2Digis, gmtStage2Digis, caloStage2Digis``` exists in the input files. In all flavours, reduced variables for L1 objects are used.\r\n- MC. The default ```Scout``` and ```ScoutFromMini``` can be used and they differ in how L1 bits and objects are handled. For ```Scout```, L1 bits and objects are produced from ```gtStage2DigisScouting``` (similar to ```gtStage2Digis```) with ```hltFEDSelectorL1``` of type ```FEDRawDataCollection``` as input. For```ScoutFromMini```,  L1bits are obtained from standard ```L1TriggerResultsConverter``` (similar to standard NanoAOD) and L1 objects are obtained from ```gmtStage2Digis``` (L1 Muon) and ```caloStage2Digis``` (L1 EG, Jet, EtSum, Tau). In all flavours, reduced variables for L1 objects are used. Both ```Scout``` and ```ScoutFromMini``` will not check for events without scouting products. ```ScoutMonitor``` should not be used.\r\n\r\n#### PR validation:\r\n\r\nPass all tests from ```scram b runtests use-ibeos```.\r\nPass all ScoutingNano-related relval_nano workflows from ```runTheMatrix.py --ibeos -l 2500.131,2500.227,2500.228,2500.237,2500.238```\r\n\r\nIn addition, several ```cmsDriver.py``` commands have been tested on data and MC samples documented in [1].\r\nIn brief, concerning data:\r\n- ```@Scout``` works for ScoutingPFRun3 2022-24\r\n- ```@ScoutMonitor``` works for ScoutingPFMonitor 2022-24\r\n- ```@ScoutFromMini``` works for ScoutingPFMonitor 2024 (Scouting objects are in MiniAOD starting in Prompt 2024)\r\n- ```@Prompt+@ScoutMonitor``` works for ScoutingPFMonitor 2023. Input 2022 fails because of Tau.\r\n- ```@Prompt+@ScoutFromMini``` works for ScoutingPFMonitor 2024 (Scouting objects are in MiniAOD starting in Prompt 2024)\r\nPlease see commands in [1]. Relevant test results (python config, root, event content, size report, log) are included in [2]. Summary of size report is in [3].\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nThis is not a backport, but backport to 15_0_0 will likely follow.\r\n\r\n[1] https://codimd.web.cern.ch/s/Fgye0cLYG\r\n[2] https://cernbox.cern.ch/s/5P2nt1ChLhcwhFU\r\n[3] [2025-02-08_ScoutingNano_Size-Report-Summary](https://docs.google.com/spreadsheets/d/1oKOjjTCHuYAyIsJhQar60sRwfTATLwOAbPXtxX-atIE/edit?usp=sharing)\r\n", "branch": "master", "changed_files": 14, "comments": 1, "commits": 7, "created_at": "1739004811", "deletions": 33, "labels": ["operations-pending", "pending-signatures", "tests-pending", "orp-pending", "pdmv-pending", "upgrade-pending", "code-checks-pending", "xpog-pending"], "milestone": "CMSSW_15_1_X", "number": 47302, "release-notes": [], "review_comments": 0, "state": "open", "title": "Add era modifiers for ScoutingNano to account for changes in 2022-24 and beginning of 2025", "updated_at": "1739004841", "user": "patinkaew"}
{"additions": 264, "auther_ref": "devel_hltJsonMonitoringWithDatasetPaths", "auther_sha": "7e1c50fde81da06a05bf5dd5d7e66a911e7abedc", "author": "missirol", "body": "#### PR description:\r\n\r\nThis PR is an attempt to update the plugin `HLTriggerJSONMonitoring` to take into account the existence of the so-called `DatasetPath`s in Run-3 HLT menus.\r\n\r\n_Context_ :\r\n`DatasetPath` is HLT jargon for what is a normal `cms.Path` that selects events based on the results of other `cms.Path`s (which, most commonly, correspond to physics triggers).\r\n\r\nIn the Run-3 HLT menus, `DatasetPath`s effectively provide the definition of Primary Datasets. A `DatasetPath` can have its own prescales (PD-level prescales), as well as \"smart\"-prescales for its triggers (where a \"smart-prescale\" is a prescale that applies to a given trigger-path only for a specific PD, and not for others; smart-prescales in `DatasetPath`s are applied via a `TriggerResultsFilter` module).\r\n\r\n`HLTriggerJSONMonitoring` currently does not know about `DatasetPath`s, and reports as PD counts the counts of the OR of the relevant triggers. This means that PD-level prescales and smart-prescales are ignored in the counts reported for each PD by this plugin. As a consequence, this can lead to OMS reporting inaccurate PD rates.\r\n\r\n_Implementation_ :\r\nIf a `DatasetPath` (e.g. `Dataset_X`) exists in the configuration, `HLTriggerJSONMonitoring` now assigns only the Path `Dataset_X` to PD `X`, and does not include the `DatasetPath` in the standard list of trigger paths (see https://github.com/cms-sw/cmssw/pull/38418#issuecomment-1159760327). Otherwise, the current behaviour applies (which I think relies on the PSet `datasets`).\r\n\r\n_Comments_ :\r\nThis update is meant to be backward-compatible (no changes if used with older menus, improved outputs for current menus).\r\nThis (or a similar update) will need to be backported to `12_4_X`, and possibly `12_3_X`.\r\n\r\nIn addition\r\n - the default value of 1 InputTag in `fillDescriptions` is changed to use `@currentProcess` instead of `HLT` as process name;\r\n - a simple unit-test for `HLTriggerJSONMonitoring` is added in `test/` (the unit test is a mock-up HLT menu, and maybe it could be simplified further; right now, it tests more than just `HLTriggerJSONMonitoring`).\r\n\r\nTagging @fwyzard and @Sam-Harper , so they can review.\r\n\r\n#### PR validation:\r\n\r\nThe outputs of the new unit test are as expected.\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR:\r\n\r\nN/A", "branch": "master", "changed_files": 4, "comments": 12, "commits": 1, "created_at": "1655645575", "deletions": 43, "labels": ["hlt-pending", "pending-signatures", "orp-pending", "tests-started", "code-checks-approved"], "milestone": "CMSSW_12_5_X", "number": 38418, "release-notes": [], "review_comments": 0, "state": "open", "title": "update of `HLTriggerJSONMonitoring` for `DatasetPath`s", "updated_at": "1655703283", "user": "missirol"}
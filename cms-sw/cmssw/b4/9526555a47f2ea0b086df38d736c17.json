{"additions": 458, "auther_ref": "fc-mtdtopo20241202", "auther_sha": "4193a383af0209d053b2c96b822b7b9ae5a192df", "author": "fabiocos", "body": "#### PR description:\r\n\r\nThis PR updates the ```MTDTopology``` class by adding a BTL part, associating an ```iphi`` and ```ieta``` index to sensor modules ```DetId``` of ```MTDGeometry```, using the same ordering. In order to avoid circular dependencies, ```MTDTopology``` is moved from ```MTDNumberingBuilder```, where it was for historical reasons (cloning the tracker geometry structure in old days) to the more appropriate ```MTDGeometryBuilder```. The ```_cfi.py``` fragment is kept anyway in the original location (through a python import) to prevent disruption of scores of existing configuration files. \r\n\r\nThis is the opportunity to:\r\n\r\n- add a test of BTL navigation in ```RecoMTD/DetLayers``` that couples both ```MTDTopology``` and ```MTDTrayBarrelLayer``` navigation at the same time (in parallel to the existing test for ETL navigation in tracking).\r\n- clean some records definition and dependencies;\r\n- remove part of codes referring to the obsolete v1 BTL geometry, no more supported and present in CMSSW since this summer;\r\n- reorder the ```MTDGeometry``` entries running their phi from -pi to pi, as the CMS default used in the ```RecoMTD/DetLayers``` construction of BTL, instead of the present order from 0 to 2pi;\r\n\r\nIn order to keep the unit tests stable at this step, the last point is temporarily undone, and it will be separately proposed together a complete rewriting of the BTL numbering scheme, to be based on top of this PR, where all data references will have anyway to be changed. In this way we reduce the number of space expensive test reference updates.\r\n\r\n#### PR validation:\r\n\r\nCode, compiles, runs, unit tests are at present providing the expected output, and the yet not used ```TestBTLNavigation``` has the expected behaviour:\r\n\r\n```\r\n\r\nTest of BTL navigation \r\n\r\n\r\n\r\nBTL layer   18 at z =           0.00 rods =            108 dets =          10368\r\n\r\nTray    1\r\n MTDDetTray at  (-115.030,-13.011,0.000)  L/W/T   :         496.07 /           5.47 /           0.38 normal phi =           0.17\r\n    1 BTLDetId 1653824400 iphi/ieta =    1 /    1 side =    0 RU =    2 mod =   22 pos =              (-115.03,-13.01,-245.48) \r\n...............phishift=  iphi/ieta =  108 /    1  -1 side =    0 RU =    2 mod =   24 pos =              (-115.03,13.01,-245.48) \r\n...............phishift=  iphi/ieta =    2 /    1   1 side =    0 RU =    2 mod =   23 pos =              (-114.03,-19.03,-245.48) \r\n...............etashift= -1 out of range\r\n...............etashift=  iphi/ieta =    1 /    2   1 side =    0 RU =    2 mod =   19 pos =              (-115.03,-13.01,-240.32) \r\n    2 BTLDetId 1653821328 iphi/ieta =    1 /    2 side =    0 RU =    2 mod =   19 pos =              (-115.03,-13.01,-240.32) \r\n...............phishift=  iphi/ieta =  108 /    2  -1 side =    0 RU =    2 mod =   21 pos =              (-115.03,13.01,-240.32) \r\n...............phishift=  iphi/ieta =    2 /    2   1 side =    0 RU =    2 mod =   20 pos =              (-114.03,-19.03,-240.32) \r\n...............etashift=  iphi/ieta =    1 /    1  -1 side =    0 RU =    2 mod =   22 pos =              (-115.03,-13.01,-245.48) \r\n...............etashift=  iphi/ieta =    1 /    3   1 side =    0 RU =    2 mod =   16 pos =              (-115.03,-13.01,-235.16) \r\n    3 BTLDetId 1653818256 iphi/ieta =    1 /    3 side =    0 RU =    2 mod =   16 pos =              (-115.03,-13.01,-235.16) \r\n...............phishift=  iphi/ieta =  108 /    3  -1 side =    0 RU =    2 mod =   18 pos =              (-115.03,13.01,-235.16) \r\n...............phishift=  iphi/ieta =    2 /    3   1 side =    0 RU =    2 mod =   17 pos =              (-114.03,-19.03,-235.16) \r\n...............etashift=  iphi/ieta =    1 /    2  -1 side =    0 RU =    2 mod =   19 pos =              (-115.03,-13.01,-240.32) \r\n...............etashift=  iphi/ieta =    1 /    4   1 side =    0 RU =    2 mod =   13 pos =              (-115.03,-13.01,-230.00) \r\n    4 BTLDetId 1653815184 iphi/ieta =    1 /    4 side =    0 RU =    2 mod =   13 pos =              (-115.03,-13.01,-230.00) \r\n...............phishift=  iphi/ieta =  108 /    4  -1 side =    0 RU =    2 mod =   15 pos =              (-115.03,13.01,-230.00) \r\n...............phishift=  iphi/ieta =    2 /    4   1 side =    0 RU =    2 mod =   14 pos =              (-114.03,-19.03,-230.00) \r\n...............etashift=  iphi/ieta =    1 /    3  -1 side =    0 RU =    2 mod =   16 pos =              (-115.03,-13.01,-235.16) \r\n...............etashift=  iphi/ieta =    1 /    5   1 side =    0 RU =    2 mod =   10 pos =              (-115.03,-13.01,-224.84) \r\n(...)\r\n10366 BTLDetId 1657949072 iphi/ieta =  108 /   94 side =    1 RU =    2 mod =   18 pos =              (-115.03,13.01,235.16) \r\n...............phishift=  iphi/ieta =  107 /   94  -1 side =    1 RU =    2 mod =   17 pos =              (-114.03,19.03,235.16) \r\n...............phishift=  iphi/ieta =    1 /   94   1 side =    1 RU =    2 mod =   16 pos =              (-115.03,-13.01,235.16) \r\n...............etashift=  iphi/ieta =  108 /   93  -1 side =    1 RU =    2 mod =   15 pos =              (-115.03,13.01,230.00) \r\n...............etashift=  iphi/ieta =  108 /   95   1 side =    1 RU =    2 mod =   21 pos =              (-115.03,13.01,240.32) \r\n10367 BTLDetId 1657952144 iphi/ieta =  108 /   95 side =    1 RU =    2 mod =   21 pos =              (-115.03,13.01,240.32) \r\n...............phishift=  iphi/ieta =  107 /   95  -1 side =    1 RU =    2 mod =   20 pos =              (-114.03,19.03,240.32) \r\n...............phishift=  iphi/ieta =    1 /   95   1 side =    1 RU =    2 mod =   19 pos =              (-115.03,-13.01,240.32) \r\n...............etashift=  iphi/ieta =  108 /   94  -1 side =    1 RU =    2 mod =   18 pos =              (-115.03,13.01,235.16) \r\n...............etashift=  iphi/ieta =  108 /   96   1 side =    1 RU =    2 mod =   24 pos =              (-115.03,13.01,245.48) \r\n10368 BTLDetId 1657955216 iphi/ieta =  108 /   96 side =    1 RU =    2 mod =   24 pos =              (-115.03,13.01,245.48) \r\n...............phishift=  iphi/ieta =  107 /   96  -1 side =    1 RU =    2 mod =   23 pos =              (-114.03,19.03,245.48) \r\n...............phishift=  iphi/ieta =    1 /   96   1 side =    1 RU =    2 mod =   22 pos =              (-115.03,-13.01,245.48) \r\n...............etashift=  iphi/ieta =  108 /   95  -1 side =    1 RU =    2 mod =   21 pos =              (-115.03,13.01,240.32) \r\n...............etashift=  1 out of range\r\n```", "branch": "master", "changed_files": 43, "comments": 5, "commits": 8, "created_at": "1733910955", "deletions": 261, "labels": ["reconstruction-pending", "simulation-pending", "dqm-pending", "geometry-pending", "pending-signatures", "orp-pending", "tests-started", "upgrade-pending", "code-checks-approved", "tracking", "mtd"], "milestone": "CMSSW_15_0_X", "number": 46911, "release-notes": [], "review_comments": 0, "state": "open", "title": "MTD geometry: add BTL topology to MTDTopology, reorganize dependencies", "updated_at": "1733911357", "user": "fabiocos"}
{"additions": 44, "auther_ref": "feature/unit_tests", "auther_sha": "2641cd87503d2cc6a2595f97b0cd85e50ac18f86", "author": "bfonta", "body": "#### PR description:\r\n\r\nThis PR adds unit tests for the Jet and MET validation scripts. It stems from the issue found in https://github.com/cms-sw/cmssw/pull/49775.\r\nThe scripts run on a DQM QCD RelVal file which was added to the `/store/group/phys_jetmet/cmssw_unittests` folder, and was produced with:\r\n\r\n```bash\r\n#!/usr/bin/env bash\r\n\r\nGEOMETRY=\"ExtendedRun4D110\"\r\nCONDITIONS=\"auto:phase2_realistic_T33\"\r\nVALIDSEQ=\"@hltValidation\"\r\nERA=\"Phase2C17I13M9\"\r\nRELVAL=\"/eos/cms/store/relval/CMSSW_16_0_0_pre4/RelValQCD_FlatPt_15_3000HS_14/GEN-SIM-DIGI-RAW/PU_150X_mcRun4_realistic_v1_STD_Run4D110_PU-v2/2580000/ffd716a4-ebc9-4f88-8534-b62a75aeaa9f.root\"\r\nNEVENTS=100\r\n\r\nfunction mystep2() {\r\n    cmsDriver.py step2 --step L1P2GT,HLT:@relvalRun4,VALIDATION:\"${VALIDSEQ}\" \\\r\n\t\t --conditions ${CONDITIONS} \\\r\n\t\t --datatier GEN-SIM-DIGI-RAW,DQMIO \\\r\n\t\t -n ${NEVENTS} \\\r\n\t\t --procModifier ticl_v5 \\\r\n\t\t --eventcontent FEVTDEBUGHLT,DQMIO \\\r\n\t\t --geometry ${GEOMETRY} \\\r\n\t\t --customise SLHCUpgradeSimulations/Configuration/aging.customise_aging_1000 \\\r\n\t\t --era ${ERA} \\\r\n\t\t --filein file:${RELVAL} \\\r\n\t\t --fileout file:step2.root \\\r\n\t\t --nThreads 0 \\\r\n\t\t --process HLTX \\\r\n\t\t --inputCommands='keep *, drop *_hlt*_*_HLT, drop triggerTriggerFilterObjectWithRefs_l1t*_*_HLT'\r\n}\r\n\r\nfunction mystep3() {\r\n    cmsDriver.py step3 -s HARVESTING:\"${VALIDSEQ}\" \\\r\n\t\t --conditions \"${CONDITIONS}\" \\\r\n\t\t --mc \\\r\n\t\t --geometry \"${GEOMETRY}\" \\\r\n\t\t --scenario pp \\\r\n\t\t --filetype DQM \\\r\n\t\t --era \"${ERA}\" \\\r\n\t\t --procModifier ticl_v5 \\\r\n\t\t -n ${NEVENTS} \\\r\n\t\t --filein file:step2_inDQM.root \\\r\n\t\t --fileout file:step3.root\r\n}\r\n\r\nmystep2 && mystep3\r\n```\r\n\r\nThe unit test scripts were inspired by [this unit test](https://github.com/cms-sw/cmssw/blob/283f511ce2e67fcdf6ef538db7db55be204d409a/Validation/RecoTrack/test/test_makeTrackValidationPlots.sh).\r\n\r\n#### PR validation:\r\n\r\nThe validation scripts were manually tested on the produced DQM file, and then `scram b runtests` was successfully tested as follows:\r\n\r\n```shell\r\nbfontana@nv:/cms-hlt-nfs/user/bfontana/UnitTests/src  (feature/unit_tests) $ ll\r\ntotal 0MB\r\ndrwxr-xr-x. 4 bfontana zh 1MB Jan 14 11:40 Validation/\r\nbfontana@nv:/cms-hlt-nfs/user/bfontana/UnitTests/src  (feature/unit_tests) $ ll Validation/\r\ntotal 0MB\r\ndrwxr-xr-x. 6 bfontana zh 1MB Jan 13 15:27 RecoJets/\r\ndrwxr-xr-x. 6 bfontana zh 1MB Jan 14 11:40 RecoMET/\r\nbfontana@nv:/cms-hlt-nfs/user/bfontana/UnitTests/src  (feature/unit_tests) $ scram b runtests\r\n>> Local Products Rules ..... started\r\n>> Local Products Rules ..... done\r\n>> Creating project symlinks\r\nCreating test log file logs/el9_amd64_gcc13/testing.log\r\nPass   25s ... Validation/RecoJets/testMakeJetValidationPlots\r\nPass   14s ... Validation/RecoMET/testMakeHLTMETValidationPlots\r\n>> Test sequence completed for CMSSW CMSSW_16_0_0_pre4\r\nbfontana@nv:/cms-hlt-nfs/user/bfontana/UnitTests/src  (feature/unit_tests) $ ll ../unit_tests/\r\ntotal 1MB\r\ndrwxr-xr-x. 2 bfontana zh 1MB Jan 14 12:06 testMakeJetValidationPlots/\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:06 testMakeJetValidationPlots.log\r\ndrwxr-xr-x. 4 bfontana zh 1MB Jan 14 12:06 testMakeHLTMETValidationPlots/\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:06 testMakeHLTMETValidationPlots.log\r\nbfontana@nv:/cms-hlt-nfs/user/bfontana/UnitTests/src  (feature/unit_tests) $ ll ../unit_tests/testMakeJetValidationPlots\r\ntotal 8MB\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:05 JetPt.png\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:05 JetPt.pdf\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:05 CorrJetPt.png\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:05 CorrJetPt.pdf\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:05 GenPt.png\r\n-rw-r--r--. 1 bfontana zh 1MB Jan 14 12:05 GenPt.pdf\r\n...\r\nbfontana@nv:/cms-hlt-nfs/user/bfontana/UnitTests/src  (feature/unit_tests) $ head -n5 ../unit_tests/testMakeJetValidationPlots.log \r\n \r\n===== Test \"testMakeJetValidationPlots\" ====\r\nxrdfs command status = 0\r\nUsing file DQM_RelValQCD_FlatPt_15_3000HS_14_CMSSW_16_0_0_pre4.root.\r\nRunning in /cms-hlt-nfs/user/bfontana/UnitTests/unit_tests/testMakeJetValidationPlots.\r\n```\r\n", "branch": "master", "changed_files": 4, "comments": 4, "commits": 3, "created_at": "1768385707", "deletions": 0, "labels": ["dqm-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved", "ngt"], "milestone": "CMSSW_16_1_X", "number": 49817, "release-notes": [], "review_comments": 0, "state": "open", "title": "Units tests for Jet and MET validation.", "updated_at": "1768385829", "user": "bfonta"}
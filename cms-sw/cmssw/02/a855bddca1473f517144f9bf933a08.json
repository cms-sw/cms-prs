{"additions": 165, "auther_ref": "optimize-finecalo", "auther_sha": "78cd74e59cae00c0d085e6d0a517660b3f7f9372", "author": "tklijnsma", "body": "#### PR description:\r\n\r\nThis patch streamlines the finecalo patch ([PR 32673)](https://github.com/cms-sw/cmssw/pull/32673).\r\n\r\n  - Main fix: The lookups of the boundary-crossing parent of a track are cached in a map in CaloSD, which leads to a lot less lookups. (A 'lookup' consists of traversing the track history via the SimTrackManager, which is expensive.)\r\n  - Some needless attributes from the CaloHitID classes are removed again.\r\n  - Fixed a bug where in very rare cases hits would still be assigned to the primary rather than the boundary crossing parent.\r\n  - Line 309 in CaloTrkProcessing.cc (introduced in [PR 33056](https://github.com/cms-sw/cmssw/pull/33056)) is for now commented out, as it changes the behavior of finecalo.\r\n\r\nThe CPU time needed per event is similar to default CMSSW (hard to quantify the exact time difference due to slightly varying usage of the compute nodes I am using). This is a significant improvement w.r.t. to the finecalo patch 1, which was anywhere between 100% and 500% slower depending on the simulated event topology.\r\n\r\nPlot of the RSS as a function of time (orange = this patch, green = the previous patch, blue = default CMSSW):\r\n![finecalo_patch2_rss](https://user-images.githubusercontent.com/11268158/125113403-3e5ac700-e0ae-11eb-8370-e7787c6b4464.png)\r\n\r\n#### PR validation:\r\n\r\nI checked event displays of ttbar and of a tau gun, and it looks in order.\r\n", "branch": "master", "changed_files": 7, "closed_at": "1625844187", "comments": 2, "commits": 3, "created_at": "1625843601", "deletions": 174, "labels": ["code-checks-approved", "orp-pending", "pending-signatures", "simulation-pending", "tests-pending"], "milestone": "CMSSW_12_0_X", "number": 34431, "release-notes": [], "review_comments": 0, "state": "closed", "title": "finecalo patches v2: Performance improvements", "updated_at": "1625844187", "user": "tklijnsma"}
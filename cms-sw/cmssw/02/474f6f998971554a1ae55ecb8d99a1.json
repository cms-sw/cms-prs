{"additions": 2946, "auther_ref": "areaSeededRegion_step1", "auther_sha": "39f3ff2c6d1693e249ff4c70ca1198aec6ed836a", "author": "makortel", "body": "This PR adds automated pixel pair mitigation for regions in pixel where there are inactive areas in two layers.\r\n\r\nThe algorithm has been presented in tracking POG meeting on November 6th\r\nhttps://indico.cern.ch/event/675097/contributions/2775830/attachments/1553214/2442464/updated_slides_trk_mk_20171106.pdf\r\nA notable addition to the version presented is an option to ignore single inactive panels in FPix from the inactive areas. This option reduces fake rate without notable change in efficiency. Here are MTV plots comparing 1k ttbar+PU50 events in 940pre3 for the pre-release, the \"POG meeting version\", and the version ignoring single inactive panels\r\nhttps://cms-tracking-validation.web.cern.ch/cms-tracking-validation/PR/CMSSW_9_4_0_pre3_PR21630/\r\n\r\nThe algorithm is implemented in `PixelInactiveAreaTrackingRegionsSeedingLayersProducer`, which produces\r\n* `SeedingLayerSetsHits` (normally produced by `SeedingLayersEDProducer`)\r\n   * Technically could be produced with `SeedingLayersEDProducer` here as well, but then I'd need new accessors for some details in `SeedingLayerSetsHits`, and I felt that the current solution would be a bit cleaner\r\n* `TrackingRegionsSeedingLayerSets`, which is essentially `vector<TrackingRegion, vector<SeedingLayerSet>>` i.e. for each region holds also the seeding layer pair to be used for that region.\r\nThe producer is further split in two parts\r\n* `PixelInactiveAreaFinder`\r\n   * Finds the inactive modules on each layer and group adjacent inactive modules together\r\n   * Looks for layer pairs that have overlapping inactive areas and returns them and the list of layer pairs that should be used in seeding\r\n* `AreaSeededTrackingRegionsBuilder`\r\n   * Creates `RectangularEtaPhiTrackingRegion` for a given vector of `(phi, r, z)` boxes such that the eta-phi window covers all the boxes\r\n\r\nAs a \"byproduct\"\r\n* created `AreaSeededTrackingRegionsProducer`\r\n  * uses also `AreaSeededTrackingRegionsBuilder` to create `RectangularEtaPhiTrackingRegion`s, but the input `(phi, r, z)` boxes come from configuration\r\n  * (actually I created this producer as one of the first steps even if it is not strictly needed for this PR, but it could be useful in the future)\r\n* abstracted the vertex/beamspot origins to their own class\r\n   * common part with `CandidatePointSeededTrackingRegionsProducer`\r\n* in tracking DQM\r\n   * monitor eta-phi areas covered by `RectangularEtaPhiTrackingRegion`s\r\n     * currently we monitor only the direction\r\n     * with variable-size regions monitoring also the covered area becomes interesting, and also allows to correlate regions wrt. pixel maps\r\n   * in the configuration of \"track building and seeding monitoring\" replace the dictionaries with `cms.PSet`s to be able to customize them with eras\r\n     * there is further room to reduce copy-paste and harmonize naming of PSet members with the `TrackingMonitor` parameters\r\n\r\n~~Enabling the code in reconstruction is left to a subsequent PR. In the mean time the following commits can be used on top of this PR to enable the mitigation.\r\nhttps://github.com/makortel/cmssw/compare/areaSeededRegion_step1...areaSeededRegion_step2~~\r\n\r\nTested in CMSSW_10_0_X_2017-11-27-2300 (rebased to CMSSW_10_0_0_pre2), ~~no changes expected~~ expecting changes in phase1 workflows as shown in the MTV plots above.\r\n\r\n@VinInn @nikoleskinen @JanFSchulte @mtosi ", "branch": "master", "changed_files": 28, "closed_at": "1513238356", "comments": 55, "commits": 34, "created_at": "1512140461", "deletions": 404, "labels": ["code-checks-approved", "comparison-available", "dqm-approved", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "c864dffbedb9292f36d6de03e3aa3a3ece4d736d", "merged_at": "1513238356", "merged_by": "cmsbuild", "milestone": "CMSSW_10_0_X", "number": 21630, "release-notes": [], "review_comments": 18, "state": "closed", "title": "Add automated pixel pair mitigation for inactive pixel regions", "updated_at": "1513238356", "user": "makortel"}
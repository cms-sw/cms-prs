{"additions": 268, "auther_ref": "MigrationToDD4hepForGEMdbLoader", "auther_sha": "b062d1a0aa6c9eadb339f333969cd27b748276be", "author": "slomeo", "body": "**PR description:**\r\n\r\nThis PR (only for GEM) followed what I did for DT in the PR #32781 (to be signed and merged)  . \r\n\r\n**PR validation:**\r\n\r\n1) Validation by using \"cmsRun CondTools/Geometry/test/gemgeometrywriter.py\" (with DDD and DD4hep):\r\nby checking printouts for both DD & DD4Hep build methods within the GEMGeometryParsFromDD Class in order to compare some DetId parameters (see below):\r\n\r\n//DDD\r\n\r\n(0) GEMGeometryParsFromDD - DDD \r\n(1) DDD, tran vector 1877.54  331.06  5695.5\r\n(4) DDD, Chamber DetID 687898914 Name GEMBox11L dx1 141.087 dx2 254.993 dy 641.5 dz 17.35\r\n(1) DDD, tran vector 2377.3  419.183  5692.09\r\n(5) DDD, Eta Partion DetID 688423202 Name GHA101 dx1 205.701 dx2 222.929 dy 97.025 dz 1.4875 nStrips 384 nPads 192 dPhi 0.177151\r\n\r\nand so on...\r\n\r\n//DD4Hep \r\n\r\n(0) GEMGeometryParsFromDD - DD4HEP \r\n(1) DD4HEP, tran vector 1877.54  331.06  5695.5\r\n(4) DD4HEP, Chamber DetID 687898914 Name GEMBox11L dx1 141.087 dx2 254.993 dy 641.5 dz 17.35\r\n(1) DD4HEP, tran vector 2377.3  419.183  5692.09\r\n(5) DD4HEP, Eta Partion DetID 688423202 Name GHA101 dx1 205.701 dx2 222.929 dy 97.025 dz 1.4875 nStrips 384 nPads 192 dPhi 0.177151\r\n\r\nand so on..\r\n\r\nThe DD part of the code has not been touched by this PR (except for the printouts). Added \"/ dd4hep::mm;\", where it was necessary, in the DD4Hep part of the code.\r\n\r\n2) Validation by using a dump script, not included in this PR (because it uses a local .mb file). \r\nDetails are present in [*] at the end of this PR description.\r\n\r\n// DDD\r\n\r\nGEMGeometryESModule::produce :: GEMGeometryBuilder builder db\r\nGEMGeometry found with 2 regions\r\n\r\nRegion 0:-1 with 1 staions\r\n\r\nStation 0:1:GE-1/1 with 1 rings\r\n\r\nRing 0:1 with 36 superChambers\r\n\r\nSuperChamber 0: Re -1 Ri 1 St 1 La 0 Ch 35 Ro 0  with 2 chambers\r\n\r\nChamber 0: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 0  with 8 etaPartitions\r\n\r\nEtaPartition 0: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 1 GHA111 with 384 strips of pitch 0.10517 and 192 pads of pitch 0.21034\r\n\r\nEtaPartition 1: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 2 GHA112 with 384 strips of pitch 0.0974638 and 192 pads of pitch 0.194927\r\n\r\nEtaPartition 2: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 3 GHA113 with 384 strips of pitch 0.0903565 and 192 pads of pitch 0.180713\r\n\r\nEtaPartition 3: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 4 GHA114 with 384 strips of pitch 0.0838485 and 192 pads of pitch 0.167697\r\n\r\nEtaPartition 4: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 5 GHA115 with 384 strips of pitch 0.077825 and 192 pads of pitch 0.15565\r\n\r\nEtaPartition 5: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 6 GHA116 with 384 strips of pitch 0.0722858 and 192 pads of pitch 0.144572\r\n\r\nEtaPartition 6: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 7 GHA117 with 384 strips of pitch 0.0671505 and 192 pads of pitch 0.134301\r\n\r\nEtaPartition 7: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 8 GHA118 with 384 strips of pitch 0.0624191 and 192 pads of pitch 0.124838\r\n\r\nand so on\r\n\r\n// DD4Hep\r\n\r\nGEMGeometryESModule::produce :: GEMGeometryBuilder builder db\r\nGEMGeometry found with 2 regions\r\n\r\nRegion 0:-1 with 1 staions\r\n\r\nStation 0:1:GE-1/1 with 1 rings\r\n\r\nRing 0:1 with 36 superChambers\r\n\r\nSuperChamber 0: Re -1 Ri 1 St 1 La 0 Ch 35 Ro 0  with 2 chambers\r\n\r\nChamber 0: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 0  with 8 etaPartitions\r\n\r\nEtaPartition 0: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 1 GHA111 with 384 strips of pitch 0.10517 and 192 pads of pitch 0.21034\r\n\r\nEtaPartition 1: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 2 GHA112 with 384 strips of pitch 0.0974638 and 192 pads of pitch 0.194927\r\n\r\nEtaPartition 2: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 3 GHA113 with 384 strips of pitch 0.0903565 and 192 pads of pitch 0.180713\r\n\r\nEtaPartition 3: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 4 GHA114 with 384 strips of pitch 0.0838485 and 192 pads of pitch 0.167697\r\n\r\nEtaPartition 4: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 5 GHA115 with 384 strips of pitch 0.077825 and 192 pads of pitch 0.15565\r\n\r\nEtaPartition 5: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 6 GHA116 with 384 strips of pitch 0.0722858 and 192 pads of pitch 0.144572\r\n\r\nEtaPartition 6: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 7 GHA117 with 384 strips of pitch 0.0671505 and 192 pads of pitch 0.134301\r\n\r\nEtaPartition 7: Re -1 Ri 1 St 1 La 1 Ch 35 Ro 8 GHA118 with 384 strips of pitch 0.0624191 and 192 pads of pitch 0.124838\r\n\r\nand so on\r\n\r\nThe conclusion is that the validation of the GEM DB Loader Migration to DD4Hep is fine.\r\n\r\n**if this PR is a backport please specify the original PR and why you need to backport that PR:**\r\n\r\nnothing special\r\n\r\n[*]\r\n\r\nIn CMSSW_11_3_X_2021-02-21-0000 (for DDD) and CMSSW_11_3_X_2021-02-21-2300 (for DD4Hep)\r\n\r\na) In /condTools/Geom/test \r\ncp writehelp/* .\r\n\r\nb) ./createExtended2021Payload.sh 113YV10 (for DDD and 113YV11 for DD4Hep)\r\n\r\nThen I created a\r\nscript called \"dumpGEMGeometry_DB_cfg.py\" and the lines are:\r\n+++++++\r\nimport FWCore.ParameterSet.Config as cms\r\n\r\nprocess = cms.Process('DUMP')\r\n\r\nprocess.load(\"CondCore.CondDB.CondDB_cfi\")\r\nprocess.load(\"Configuration.StandardSequences.FrontierConditions_GlobalTag_cff\")\r\nprocess.load('Geometry.MuonCommonData.testGE0XML_cfi')\r\nprocess.load(\"FWCore.MessageLogger.MessageLogger_cfi\")\r\nprocess.load(\"Geometry.MuonNumbering.muonGeometryConstants_cff\")\r\nprocess.load(\"Geometry.GEMGeometryBuilder.gemGeometryDB_cfi\")\r\nprocess.load(\"Geometry.GEMGeometryBuilder.gemGeometryDump_cfi\")\r\n\r\nprocess.MessageLogger = cms.Service(\"MessageLogger\",\r\n    destinations = cms.untracked.vstring('myLogGEM'),\r\n    myLogGEM = cms.untracked.PSet(\r\n        threshold = cms.untracked.string('INFO'),\r\n    )\r\n)\r\n\r\nprocess.muonGeometryConstants.fromDD4Hep = True\r\n\r\nfrom Configuration.AlCa.autoCond import autoCond\r\nprocess.GlobalTag.globaltag = autoCond['mc']\r\nprocess.GlobalTag.toGet = cms.VPSet(cms.PSet(record = cms.string('GEMRecoGeometryRcd'),\r\ntag = cms.string('GEMRECO_Geometry_113YV10'),\r\nconnect = cms.string(\"sqlite_file:/afs/cern.ch/user/s/slomeo/CMSSW_11_3_X_2021-02-21-0000/src/CondTools/Geometry/test/myfile.db\")))\r\n\r\nprocess.source = cms.Source('EmptySource')\r\n\r\nprocess.maxEvents = cms.untracked.PSet(\r\n    input = cms.untracked.int32(1)\r\n)\r\n\r\nprocess.p = cms.Path(process.gemGeometryDump)\r\n++++++++++++\r\n\r\nThis script (not included in this PR) is located in https://cmssdt.cern.ch/lxr/source/Geometry/GEMGeometryBuilder/test/python/\r\nand calls GEMGeometryDump Class (already present) by using \"cmsRun dumpGEMGeometry_DB_cfg.py\"", "branch": "master", "changed_files": 4, "closed_at": "1614597768", "comments": 9, "commits": 7, "created_at": "1614162019", "deletions": 20, "labels": ["code-checks-approved", "db-approved", "fully-signed", "geometry-approved", "orp-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "482bdb2a0d1615c705a64343b88cf2c345f58b44", "merged_at": "1614597768", "merged_by": "cmsbuild", "milestone": "CMSSW_11_3_X", "number": 32982, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Migration to DD4hep for GEM DB loader", "updated_at": "1614597768", "user": "slomeo"}
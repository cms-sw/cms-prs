{"additions": 261, "auther_ref": "master", "auther_sha": "7265dbf9bc635b1b616f4d70bd9e779d6c255111", "author": "ctdax", "body": "\r\n\r\n#### PR description:\r\n\r\n#### This PR is a result of continued work from the [previous FullModelHadronic.cc PR.](https://github.com/cms-sw/cmssw/pull/46728) In an attempt to check if other bugs existed, we first had to understand how the file simulated hadronic interactions. This led to many quality changes such as the removal of unneeded blocks of code and the changing of variable names. The final result was the discovery of three minor bugs, whose impact is thankfully no where near the magnitude of the bug from the aforementioned previous PR. A talk on this matter will be given during the [June 27th long-lived exotica meeting.](https://indico.cern.ch/event/1558290/#17-update-on-r-hadron-g4-inter)\r\n\r\n#### We would like for a new release to be cut.\r\n\r\n- **Bug fix:** Corrected the usage of G4LorentzVector from (p, m) to (p, E)\r\n    - Lines 79, 81 in update\r\n- **Bug fix:** Corrected the energy deposit magnitude to be the total change in energy of the cloud particle\r\n    - Line 211 in update\r\n- **Bug fix:** Corrected the momentum to update in magnitude, not just direction, when the custom particle does not change in type\r\n    - Line 242 in update\r\n- **Quality change:** Removed unneeded lines of code, notably:\r\n    - Lines 434 through 476 in previous version. It mentions histogram filling, however no histograms are actually filled and all of the variables are unused. Removing this section also removes unnecessary variables defined earlier in the code.\r\n    - Lines 654 through 672 in previous version. The `FindRhadron` function is only used in the aforementioned histogram filling section. It is not used anywhere else in CMSSW and so this function was removed too.\r\n    - Lines 517 through 540 in previous version.  The `if` statement at line 522 does not check for annihilation properly, as expected from the comment in line 524. Additionally, in 10,000 gluino R-Hadron events this if statement never passed.\r\n    - Lines 541 through 566 in previous version. Again, this `if` statement never passed in 10,000 gluino R-Hadron events. The complicated and infrequent nature of this block of code led us to remove it.\r\n- **Quality change:** Cleaned up the code format and variable names for ease of understanding in the future\r\n\r\n#### PR validation:\r\n\r\nVerified that the PR passes the basic test procedure suggested below with the following output:\r\n\r\n```bash\r\n4.22_RunCosmics2011A Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 02:56:36 2025-date Tue Jun 24 02:49:59 2025; exit: 0 0 0 0 0\r\n4.53_RunPhoton2012B Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:02:42 2025-date Tue Jun 24 02:49:59 2025; exit: 0 0 0 0\r\n5.1_TTbarFS Step0-PASSED Step1-PASSED  - time date Tue Jun 24 03:00:54 2025-date Tue Jun 24 02:50:00 2025; exit: 0 0\r\n7.3_CosmicsSPLoose2018 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 02:56:36 2025-date Tue Jun 24 02:50:00 2025; exit: 0 0 0 0 0\r\n8.0_BeamHalo Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 03:00:27 2025-date Tue Jun 24 02:56:36 2025; exit: 0 0 0 0 0\r\n9.0_Higgs200ChargedTaus Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:04:53 2025-date Tue Jun 24 02:56:37 2025; exit: 0 0 0 0\r\n25.0_TTbar Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 03:10:20 2025-date Tue Jun 24 03:00:27 2025; exit: 0 0 0 0 0\r\n135.4_ZEEFS_13 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:06:17 2025-date Tue Jun 24 03:00:55 2025; exit: 0 0 0 0\r\n136.731_RunSinglePh2016B Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:12:56 2025-date Tue Jun 24 03:02:42 2025; exit: 0 0 0 0\r\n136.7611_RunJetHT2016EreMINIAOD Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 03:08:19 2025-date Tue Jun 24 03:04:54 2025; exit: 0 0 0\r\n136.793_RunDoubleEG2017C Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:19:23 2025-date Tue Jun 24 03:06:17 2025; exit: 0 0 0 0\r\n136.8311_RunJetHT2017FreMINIAOD Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 03:11:47 2025-date Tue Jun 24 03:08:20 2025; exit: 0 0 0\r\n136.874_RunEGamma2018C Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:25:41 2025-date Tue Jun 24 03:10:20 2025; exit: 0 0 0 0\r\n136.88811_RunJetHT2018DreMINIAODUL Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 03:15:09 2025-date Tue Jun 24 03:11:48 2025; exit: 0 0 0\r\n139.001_RunMinimumBias2021 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:18:20 2025-date Tue Jun 24 03:12:56 2025; exit: 0 0 0 0\r\n140.023_RunZeroBias2022B Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:24:20 2025-date Tue Jun 24 03:15:10 2025; exit: 0 0 0 0\r\n140.043_RunZeroBias2022C Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:28:34 2025-date Tue Jun 24 03:18:21 2025; exit: 0 0 0 0\r\n140.063_RunZeroBias2022D Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:31:19 2025-date Tue Jun 24 03:19:24 2025; exit: 0 0 0 0\r\n140.56_RunHI2018 Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 03:37:46 2025-date Tue Jun 24 03:24:20 2025; exit: 0 0 0\r\n141.042_RunZeroBias2023D Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:42:55 2025-date Tue Jun 24 03:25:42 2025; exit: 0 0 0 0\r\n141.044_RunJetMET2023D Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:54:05 2025-date Tue Jun 24 03:28:34 2025; exit: 0 0 0 0\r\n141.046_RunEGamma2023D Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:55:51 2025-date Tue Jun 24 03:31:20 2025; exit: 0 0 0 0\r\n158.01_HydjetQB12ppRECOin2018reMINIAOD Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 03:40:32 2025-date Tue Jun 24 03:37:47 2025; exit: 0 0 0\r\n1306.0_SingleMuPt1_UP15 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:44:34 2025-date Tue Jun 24 03:40:33 2025; exit: 0 0 0 0\r\n1330.0_ZMM_13 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 03:47:55 2025-date Tue Jun 24 03:42:56 2025; exit: 0 0 0 0 0\r\n101.0_SingleElectronE120EHCAL Step0-PASSED  - time date Tue Jun 24 03:45:32 2025-date Tue Jun 24 03:44:34 2025; exit: 0\r\n312.0_Pyquen_ZeemumuJets_pt10_2760GeV_2022 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 03:51:01 2025-date Tue Jun 24 03:45:32 2025; exit: 0 0 0 0\r\n25202.0_TTbar_13 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 03:55:46 2025-date Tue Jun 24 03:47:56 2025; exit: 0 0 0 0 0\r\n1000.0_RunMinBias2011A Step0-PASSED Step1-PASSED Step2-FAILED Step3-NOTRUN Step4-NOTRUN  - time date Tue Jun 24 03:54:41 2025-date Tue Jun 24 03:51:02 2025; exit: 0 0 22016 0 0\r\n1001.0_RunMinBias2011A Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED Step5-PASSED Step6-PASSED Step7-PASSED Step8-PASSED Step9-PASSED Step10-PASSED  - time date Tue Jun 24 04:02:30 2025-date Tue Jun 24 03:54:06 2025; exit: 0 0 0 0 0 0 0 0 0 0 0\r\n11634.0_TTbar_14TeV+2021 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:00:19 2025-date Tue Jun 24 03:54:41 2025; exit: 0 0 0 0 0\r\n12434.0_TTbar_14TeV+2023 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:01:15 2025-date Tue Jun 24 03:55:47 2025; exit: 0 0 0 0 0\r\n12834.0_TTbar_14TeV+2024 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:03:02 2025-date Tue Jun 24 03:55:51 2025; exit: 0 0 0 0 0\r\n12834.7_TTbar_14TeV+2024_trackingMkFit Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 04:07:19 2025-date Tue Jun 24 04:00:19 2025; exit: 0 0 0 0\r\n12846.0_ZEE_14+2024 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:08:50 2025-date Tue Jun 24 04:01:16 2025; exit: 0 0 0 0 0\r\n13034.0_TTbar_14TeV+2024PU Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED  - time date Tue Jun 24 04:17:19 2025-date Tue Jun 24 04:02:30 2025; exit: 0 0 0 0\r\n13234.0_TTbar_14TeV+2021FS Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 04:09:08 2025-date Tue Jun 24 04:03:03 2025; exit: 0 0 0\r\n14034.0_TTbar_14TeV+2023FS Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 04:13:29 2025-date Tue Jun 24 04:07:20 2025; exit: 0 0 0\r\n14234.0_TTbar_14TeV+2023FSPU Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 04:18:07 2025-date Tue Jun 24 04:08:50 2025; exit: 0 0 0\r\n23234.0_TTbar_14TeV+2026D94 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:25:07 2025-date Tue Jun 24 04:09:09 2025; exit: 0 0 0 0 0\r\n24834.0_TTbar_14TeV+2026D98 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:25:08 2025-date Tue Jun 24 04:13:30 2025; exit: 0 0 0 0 0\r\n24834.911_TTbar_14TeV+2026D98_DD4hep Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:43:20 2025-date Tue Jun 24 04:17:19 2025; exit: 0 0 0 0 0\r\n24896.0_CloseByPGun_CE_E_Front_120um+2026D98 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:26:35 2025-date Tue Jun 24 04:18:08 2025; exit: 0 0 0 0 0\r\n24900.0_CloseByPGun_CE_H_Coarse_Scint+2026D98 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:33:25 2025-date Tue Jun 24 04:25:07 2025; exit: 0 0 0 0 0\r\n25034.999_TTbar_14TeV+2026D98PU_PMXS1S2PR Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:40:23 2025-date Tue Jun 24 04:25:08 2025; exit: 0 0 0 0 0\r\n250202.181_TTbar13TeVPUppmx2018 Step0-PASSED Step1-PASSED Step2-PASSED Step3-PASSED Step4-PASSED  - time date Tue Jun 24 04:44:11 2025-date Tue Jun 24 04:26:35 2025; exit: 0 0 0 0 0\r\n2500.4_NANOmc132X Step0-PASSED Step1-PASSED Step2-PASSED  - time date Tue Jun 24 04:44:35 2025-date Tue Jun 24 04:33:26 2025; exit: 0 0 0\r\n47 46 44 35 18 1 1 1 1 1 1 tests passed, 0 0 1 0 0 0 0 0 0 0 0 failed\r\n```\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\n<!-- Please replace this text with any link to the master PR, or the intended backport release cycle numbers -->\r\n\r\nBefore submitting your pull requests, make sure you followed this checklist:\r\n- verify that the PR is really intended for the chosen branch\r\n- verify that changes follow [CMS Naming, Coding, And Style Rules](http://cms-sw.github.io/cms_coding_rules.html)\r\n- verify that the PR passes the basic test procedure suggested in the [CMSSW PR instructions](https://cms-sw.github.io/PRWorkflow.html)\r\n\r\n<!-- Please delete the text above after you verified all points of the checklist  -->\r\n", "branch": "master", "changed_files": 2, "comments": 44, "commits": 3, "created_at": "1750765024", "deletions": 538, "labels": ["simulation-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_15_1_X", "number": 48396, "release-notes": [], "review_comments": 11, "state": "open", "title": "Fixed G4LorentzVector usage, momentum updating, and energy deposit model in FullModelHadronicProcess.cc", "updated_at": "1751561750", "user": "ctdax"}
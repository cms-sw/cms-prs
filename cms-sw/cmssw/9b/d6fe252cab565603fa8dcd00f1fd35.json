{"additions": 20, "auther_ref": "mm_dev_protect_HLTPPSJetComparisonFilter", "auther_sha": "c87206fbd1411eabbbfa1f232d2d448514c85816", "author": "mmusich", "body": "#### PR description:\r\n\r\nThis PR is a follow-up to [CMSHLT-3564](https://its.cern.ch/jira/browse/CMSHLT-3564).\r\nIn some 2025 fills the rate of `HLT_DiPFJetAve180_PPSMatch_Xi0p3_QuadJet_Max2ProtPerRP` was 10 larger than the foreseen rate.\r\n\r\nAfter having investigated several components it was found out that the problem comes from the content of the conditions stored in the tag [`LHCInfoPerFill_duringFill_hlt_v1`](https://cms-conddb.cern.ch/cmsDbBrowser/list/Prod/tags/LHCInfoPerFill_duringFill_hlt_v1) , in particular from the energy value that occasionally results =0 . This has an impact on the proton reconstruction thus modifying the behavior of the HLT filter. \r\nThe filter `HLTPPSJetComparisonFilter` is unprotected against the cases in which the energy is 0,\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/05ea4d3d8d93a818c1ed3a72434230f5e52b15b5/HLTrigger/special/plugins/HLTPPSJetComparisonFilter.cc#L121-L122\r\n\r\nresulting in `NaN`-s here:\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/05ea4d3d8d93a818c1ed3a72434230f5e52b15b5/HLTrigger/special/plugins/HLTPPSJetComparisonFilter.cc#L142-L143\r\n\r\nWhich then lead to the filter always accepting events (hence the greater rate).\r\nThe goal of this PR is to put a protection against these cases, while a more thorough review of how the conditions are prepared is carried out by AlCa and PPS.\r\n\r\n#### PR validation:\r\n\r\nRun the following script:\r\n\r\n```bash\r\n#!/bin/bash -ex\r\n\r\nhltGetConfiguration /dev/CMSSW_15_0_0/GRun/V79 \\\r\n   --globaltag 150X_dataRun3_HLT_v1 \\\r\n   --data \\\r\n   --unprescale \\\r\n   --output minimal \\\r\n   --max-events -1 \\\r\n   --eras Run3_2025 --l1-emulator uGT --l1 L1Menu_Collisions2025_v1_1_1_xml \\\r\n   --paths 'HLT_DiPFJetAve180_PPSMatch_Xi0p3_QuadJet_Max2ProtPerRP_v*' \\\r\n   --input /store/data/Run2025C/JetMET0/RAW/v1/000/392/733/00000/a57ed55b-7920-42ee-82fb-4ccc780a54db.root \\\r\n   > hltData.py\r\n\r\ncat <<@EOF >> hltData.py\r\ndel process.MessageLogger\r\nprocess.load('FWCore.MessageService.MessageLogger_cfi')  \r\nprocess.options.wantSummary = True\r\nprocess.options.numberOfThreads = 4\r\nprocess.options.numberOfStreams = 0\r\n@EOF\r\n\r\ncmsRun hltData.py >& hltData.log\r\n```\r\n\r\nforcing by hand the energy in LHCInfo to be 0, and observed that all events are rejected by this filter, while the error message is printed out only once.\r\n\r\n\r\n```\r\nTrigReport ---------- Modules in Path: HLT_DiPFJetAve180_PPSMatch_Xi0p3_QuadJet_Max2ProtPerRP_v8 ------------\r\nTrigReport  Trig Bit#    Visited     Passed     Failed      Error Name\r\nTrigReport     1    0       7266       7266          0          0 hltTriggerType\r\n\r\n[...]\r\n\r\nTrigReport     1  211       3921       3921          0          0 hltCTPPSLocalTrackLiteProducer\r\nTrigReport     1  212       3921       3921          0          0 hltCTPPSProtons\r\nTrigReport     1  213       3921          0       3921          0 hltPPSJetComparisonFilter0p3\r\nTrigReport     1  214          0          0          0          0 hltBoolEnd\r\n```\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nNot a backport, but if accepted it will be backported to CMSSW_15_0_X for 2025 data-taking operations.", "branch": "master", "changed_files": 1, "comments": 7, "commits": 1, "created_at": "1748788007", "deletions": 7, "labels": ["hlt-pending", "pending-signatures", "tests-approved", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_15_1_X", "number": 48226, "release-notes": [], "review_comments": 8, "state": "open", "title": "add protection to `HLTPPSJetComparisonFilter` against faulty `LHCInfo` payloads (Energy=0)", "updated_at": "1748868649", "user": "mmusich"}
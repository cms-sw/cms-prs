{"additions": 3692, "auther_ref": "emtf_may_2020", "auther_sha": "7745bb89b118109fcc1bec2d99df3e3c4e4a9874", "author": "jiafulow", "body": "#### PR description:\r\n\r\nThis PR **improves the EMTF emulator configuration**. In the past few months, several issues had been identified and fixes have been made. These changes have been consolidated in this PR. Right now, the emulator is configured by the FW version. The FW version is supplied by the GlobalTag, specifically the  `L1TMuonEndCapParamsRcd` record. The BDT trees used for pT assignment are also supplied by the GlobalTag, specifically the `L1TMuonEndCapForestRcd` record. These two records must be in sync. Furthermore, the global \"era\"  (e.g. `Run2_2016`, `Run2_2017`, `Run2_2018`) must be in sync with the GTs. When making changes in the future (e.g. `Run3_2021`), we need to keep all the above in sync to avoid the issues that occurred in the past few months. By default (if \"era\" is not specified), `Run2_2018` is used.\r\n\r\nTwo new classes (VersionControl, EMTFSetup) have been added to handle these configuration issues more transparently. In addition, other improvements have been made to facilitate the development of Run 3 pT assignment method.\r\n\r\nNotes:\r\n\r\n- VersionControl has been added to collect all the configurables and apply the function `configure_by_fw_version()` which was previously found in SectorProcessor.\r\n- EMTFSetup has been added to collect the objects: geometry, conditions, versions, sp LUTs, and pt assignment engine. These objects may be updated run-by-run or event-by-event. These objects were previously found in TrackFinder.\r\n- The configurable `primConvLUT` has been removed from the python cfi. The correct PC LUT version should be inferred from the FW version. If necessary to choose a different PC LUT version, do: (i) turn off `FWConfig`; (ii) set `PrimConvVersion` in the \"fake\" condition file (`python/fakeEmtfParams_empty_cff.py`); (iii) load the fake condition.\r\n- All the `assert` have been turned off. If necessary to enable the assertion checks, see the comment about `emtf_assert` in `interface/DebugTools.h`.\r\n- The functions in `PtLUTVarCalc` have been merged into `PtAssignmentEngineAux2017`. This is done to reduce the number of files used for each pt assignment engine.\r\n- Fake condition files for 2018 have been added (`python/fakeEmtfParams_2018_MC_cff.py`, `python/fakeEmtfParams_2018_data_cff.py`). Other fake condition files have been updated.\r\n- This PR is a continuation of #29262 .\r\n\r\n#### PR validation:\r\n\r\nValidated with:\r\n\r\n- `runTheMatrix.py -l limited -i all -j10`\r\n- `runTheMatrix.py -w upgrade -l 20434.0,20504.0 -j10`\r\n\r\n---\r\nNotifications: @abrinke1 @eyigitba @rekovic ", "branch": "master", "changed_files": 79, "closed_at": "1589779629", "comments": 28, "commits": 34, "created_at": "1588868398", "deletions": 3772, "labels": ["code-checks-approved", "comparison-available", "dqm-approved", "fully-signed", "l1-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "d34ff70cad6388b9b9a63f9f63b4dc3958bab516", "merged_at": "1589779629", "merged_by": "cmsbuild", "milestone": "CMSSW_11_1_X", "number": 29767, "release-notes": [], "review_comments": 7, "state": "closed", "title": "EMTF May 2020 emulator update", "updated_at": "1589779629", "user": "jiafulow"}
{"additions": 98, "auther_ref": "axoEmu_utm12Update_140_backport", "auther_sha": "a88865567315f289628642857b7c260298808f42", "author": "artlbv", "body": "#### PR description:\r\n\r\n_This is a backport of https://github.com/cms-sw/cmssw/pull/44510 needed for the AXOL1TL L1 emulator to be compatible with the new and old UTM grammar for the seed and model selection. The description below is copied from the above PR._\r\n\r\nThis PR is an amendment of the AXOL1TL emulator PRs: https://github.com/cms-sw/cmssw/pull/44054 (original backport: https://github.com/cms-sw/cmssw/pull/44397). \r\nEssentially reverting and extending the AXO-only part of this revert: https://github.com/cms-sw/cmssw/pull/44466 \r\n\r\nThe main changes are:\r\n* As the original PR, this introduces compatibility with the new UTM \"grammar\" (v12) for the AXO seed, i.e. what is used in the `L1Menu_Collisions2024_v1_1_0` ([see the AXO seeds in that menu here](https://htmlpreview.github.io/?https://github.com/cms-l1-dpg/L1MenuRun3/master/development/L1Menu_Collisions2024_v1_1_0/L1Menu_Collisions2024_v1_1_0.html#L1_AXO_VLoose). \r\n* **New: Added backward compatibility with the previous UTM \"grammar\"** (pre v12) for the AXO seed, i.e. what is used in the `L1Menu_Collisions2024_v1_0_0` ([see the AXO seeds in that menu here](https://htmlpreview.github.io/?https://github.com/cms-l1-dpg/L1MenuRun3/master/development/L1Menu_Collisions2024_v1_0_0/L1Menu_Collisions2024_v1_0_0.html#L1_AXO_VLoose)).  Note that UTM v12 supports the old and new AXO condition type.\r\n_For this kind of seeds the AXO model is hard-coded to the `v3` version as this is currently the baseline_. \r\n* **New**: cleaned up the AXO model setting in the L1GlobalProducer/Board code as the model version is not defined globally anymore, but on the seed level. \r\n\r\nNo additional PRs are needed to test this PR.\r\n\r\n#### PR validation:\r\n\r\nI tested this PR in 14_1 (and 14_0) with the following command with the default 1_0_0 L1 menu (old UTM), but also with 1_1_0 (new UTM for AXO) and a menu where I mix both old and new AXO conditions. Note this is inspired by the workflow `141.044_RunJetMET2023D` but faster for testing.\r\n\r\nRerunning L1 and HLT with the default L1 Menu `1_0_0`:\r\n```python\r\ncmsDriver.py repackuGT_reHLT -s L1REPACK:Full,HLT:@relval2024 --process reHLT --datatier NANOAOD --eventcontent NANOAOD \\\r\n-n 100 --era=Run3 \\            \r\n--data --conditions=auto:run3_hlt_relval  \\\r\n--filein=/store/data/Run2023D/JetMET0/RAW/v1/000/369/978/00000/00b9eba7-c847-465b-a6de-98bceae93613.root\r\n```\r\n\r\nRerunning L1 and HLT with the `1_0_1` L1 Menu by specifying it via: \r\n```python\r\n--customise=L1Trigger/Configuration/customiseUtils.L1TGlobalMenuXML\r\n```\r\n\r\nIn all cases L1 and HLT properly ran. Note though that given the current HLS4ML issues (see https://github.com/cms-sw/cmssw/issues/44435), the AXO seeds fire in all events in the current master. \r\nThis can be circumvented by adding this to the config (removing the CICADA emulator from the L1 chain):\r\n```\r\nprocess.SimL1Emulator.remove(process.simCaloStage2Layer1Summary)\r\n```\r\n\r\nThe results are in line with what is expected:\r\n```\r\n../repackuGT_reHLT_L1_101_L1REPACK_HLT.root\r\nTrigs for 100 events:\r\nDST_PFScouting_AXONominal    100\r\nDST_PFScouting_AXOTight      100\r\nHLT_L1AXOVTight              100\r\ndtype: int64\r\n../repackuGT_reHLT_L1_101_L1REPACK_HLT_noCICADA.root\r\nTrigs for 100 events:\r\nDST_PFScouting_AXONominal    0\r\nDST_PFScouting_AXOTight      0\r\nHLT_L1AXOVTight              0\r\ndtype: int64\r\n../repackuGT_reHLT_def_L1REPACK_HLT.root\r\nTrigs for 100 events:\r\nDST_PFScouting_AXONominal    100\r\nDST_PFScouting_AXOTight      100\r\nHLT_L1AXOVTight              100\r\ndtype: int64\r\n../repackuGT_reHLT_def_L1REPACK_HLT_noCICADA.root\r\nTrigs for 100 events:\r\nDST_PFScouting_AXONominal    2\r\nDST_PFScouting_AXOTight      1\r\nHLT_L1AXOVTight              0\r\n```\r\n\r\nThe results for L1 were checked with the L1 menu ntuples and show agreement for using different UTM grammar within the same XML:\r\n```\r\n141 L1ReEmu\r\nseed                \tunp\temu\tmism\r\nL1_AXO_Nominal      \t0\t2\t2\r\nL1_AXO_Tight        \t0\t1\t1\r\nL1_AXO_VLoose       \t0\t11\t11\r\nL1_AXO_VLooseNewUTMv3\t0\t11\t11\r\nL1_AXO_VTight       \t0\t0\t0\r\n```\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nOriginal PR: https://github.com/cms-sw/cmssw/pull/44510 \r\n\r\nReason for backport: add compatibility for the AXOL1TL emulator with the new UTM grammar which is required for proper O2O of the L1 conditions. Needed in CMSSW_14_0_X for the initial data-taking in 2024.", "branch": "CMSSW_14_0_X", "changed_files": 11, "comments": 4, "commits": 10, "created_at": "1711103200", "deletions": 40, "labels": ["l1-pending", "hlt-pending", "pending-signatures", "orp-pending", "tests-started"], "milestone": "CMSSW_14_0_X", "number": 44511, "release-notes": [], "review_comments": 0, "state": "open", "title": "[14_0_0] Backport of #44510 AXOL1TL emulator update for L1 Menu parsing with UTMv12 ", "updated_at": "1711105442", "user": "artlbv"}
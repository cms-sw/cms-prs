{"additions": 5, "auther_ref": "fc-nanProtection", "auther_sha": "1f72727cd64480a81dd8ca82f76da90211e316e0", "author": "fabiocos", "body": "#### PR description:\r\n\r\nMy recent fix of #26593 excited error messages from comparison of 2-d histograms filled by Nans (probably adjusting the range for the comparison). The problem in itself is present since a while, linked to the module DTDCSByLumiSummary and apparently known, as in the RelMon blacklist some 1-d histograms from that module are already inserted https://cmssdt.cern.ch/lxr/source/Utilities/RelMon/data/blacklist.txt#0058\r\nI update the blacklist to add also these 2-d histograms and avoid spurious failures in the PR tests. The issue should be revisited separately.\r\n\r\n#### PR validation:\r\n\r\nUnfortunately cms-bot always uses RelMon from the base release, so my previous test #26756 was inconclusive. Running manually a comparison for wf 136.85 with the same set of options used by the bot shows that the problem is reproducible and fixed by this update:\r\n\r\n```\r\n15:07 cmsdev25 6778> compare_using_files.py -d DT -B DQM/TimerService@3 -o out -C -R -p --no_successes -s b2b -t 0.9999999999 --standalone /build/fabiocos/106X/crash/due/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root /build/fabiocos/106X/crash/due/std/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root \r\nAnalysing Histograms located in directory DT at: \r\n o /build/fabiocos/106X/crash/due/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root\r\n o /build/fabiocos/106X/crash/due/std/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root\r\nWe have a Blacklist:\r\n o Directory TimerService at level 3\r\n++++++++++++++++++++++++++++++\r\nOutput Directory will be  out\r\nStudying directory Run summary, 1/1\r\nBin 1bin: bindiff nan\r\nHistogram hDCSFracTrendWh-1 differs: nok: 2.0 ntot: 3\r\nThis comparison failed 0.666667\r\nBin 1bin: bindiff nan\r\nHistogram hDCSFracTrendWh-2 differs: nok: 2.0 ntot: 3\r\nThis comparison failed 0.666667\r\nBin 1bin: bindiff nan\r\nHistogram hDCSFracTrendWh2 differs: nok: 2.0 ntot: 3\r\nThis comparison failed 0.666667\r\nBin 1bin: bindiff nan\r\nHistogram hDCSFracTrendWh0 differs: nok: 2.0 ntot: 3\r\nThis comparison failed 0.666667\r\nBin 1bin: bindiff nan\r\nHistogram hDCSFracTrendWh1 differs: nok: 2.0 ntot: 3\r\nThis comparison failed 0.666667\r\n ->Appending Run summary... Appended.\r\nFinished\r\nWaiting for 1 threads to finish...\r\n      * DT/Run summary/EventInfo/DCSContents:\r\n       - hDCSFracTrendWh-1: BinToBin Test Failed (pval = 0.666666666667) \r\n       - hDCSFracTrendWh-2: BinToBin Test Failed (pval = 0.666666666667) \r\n       - hDCSFracTrendWh0: BinToBin Test Failed (pval = 0.666666666667) \r\n       - hDCSFracTrendWh1: BinToBin Test Failed (pval = 0.666666666667) \r\n       - hDCSFracTrendWh2: BinToBin Test Failed (pval = 0.666666666667) \r\n\r\nDT - summary of 2170 tests:\r\n o Failiures: 0.23% (5/2170)\r\n o Nulls: 0.00% (0/2170) \r\n o Successes: 99.77% (2165/2170) \r\n o Skipped: 0.00% (0/2170) \r\n o Missing objects: 0\r\nPickleing the directory as out.pkl in dir /build/fabiocos/106X/relmon/CMSSW_10_6_X_2019-05-13-1100/work/out\r\nReading directory from out.pkl\r\nCalculating stats for the directory...\r\nProducing html...\r\n15:09 cmsdev25 6779> compare_using_files.py -d DT -B DQM/TimerService@3 -o out -C -R -p --no_successes --use_black_file -s b2b -t 0.9999999999 --standalone /build/fabiocos/106X/crash/due/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root /build/fabiocos/106X/crash/due/std/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root  \r\nAnalysing Histograms located in directory DT at: \r\n o /build/fabiocos/106X/crash/due/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root\r\n o /build/fabiocos/106X/crash/due/std/CMSSW_10_6_X_2019-05-10-1100/work/136.85_RunEGamma2018A+RunEGamma2018A+HLTDR2_2018+RECODR2_2018reHLT_skimEGamma_Offline_L1TEgDQM+HARVEST2018_L1TEgDQM/DQM_V0001_R000315489__Global__CMSSW_X_Y_Z__RECO.root\r\nWe have a Blacklist:\r\n o Directory TimerService at level 3\r\n++++++++++++++++++++++++++++++\r\nOutput Directory will be  out\r\nStudying directory Run summary, 1/1\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hActiveUnits-2\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hActiveUnits-1\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hActiveUnits2\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hActiveUnits1\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hActiveUnits0\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hDCSFracTrendWh-1\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hDCSFracTrendWh-2\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hDCSFracTrendWh2\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hDCSFracTrendWh0\r\n  Skipping DT/Run summary/EventInfo/DCSContents/hDCSFracTrendWh1\r\n ->Appending Run summary... Appended.\r\nFinished\r\n\r\nDT - summary of 2170 tests:\r\n o Failiures: 0.00% (0/2170)\r\n o Nulls: 0.00% (0/2170) \r\n o Successes: 99.54% (2160/2170) \r\n o Skipped: 0.46% (10/2170) \r\n o Missing objects: 0\r\nPickleing the directory as out.pkl in dir /build/fabiocos/106X/relmon/CMSSW_10_6_X_2019-05-13-1100/work/out\r\nReading directory from out.pkl\r\nCalculating stats for the directory...\r\nProducing html...\r\n\r\n```", "branch": "master", "changed_files": 1, "closed_at": "1557809352", "comments": 14, "commits": 1, "created_at": "1557746464", "deletions": 0, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "ed29751b3e894218027c7e2030fd621bc7ab1abb", "merged_at": "1557809352", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 26764, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Update the RelMon blacklist file for histos in DT/Run summary/EventInfo/DCSContents with Nans ", "updated_at": "1557809352", "user": "fabiocos"}
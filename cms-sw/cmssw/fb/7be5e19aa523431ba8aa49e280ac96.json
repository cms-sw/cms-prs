{"additions": 62, "auther_ref": "lheproducer-npartonmap", "auther_sha": "56421f2b52c9f8b4a5e2c34980a40ae20a1c6b8c", "author": "yiiyama", "body": "Following a presentation made at the Generator meeting in November: [Event](https://indico.cern.ch/event/746822/overview) and [Presentation](https://indico.cern.ch/event/746822/contributions/3168659/attachments/1745485/2825857/unlops.pdf)\r\n\r\nWe would like to merge multijet NLO samples using the UNLOPS scheme. Most of the infrastructure already exists in CMSSW. In the presentation I reported that we still need a new LHE parsing module that can read from multiple gridpacks (NLO and LO), but Josh pointed out that there is a feature in MG5_aMC@NLO that allows a creation of a single NLO/LO mixed gridpack (using directive [ LOonly=QCD ]), which means the existing ExternalLHEProducer suffices. The only feature we need is then to have `npLO` and `npNLO` correctly set in the LHEEvent. MG5_aMC@NLO does this only when `ickkw = 4`, but for processes such as gamma+jets, this option is not available.\r\n\r\nThe proposal with this PR is to enable the users of ExternalLHEProducer to specify the npLO and npNLO values by hand. These values simply correspond to the number of \"j\"s in the MG5 proc card, so they are uniquely determined by the process id (e.g. \"0\" in `p p > a j @0`). The process id is stored in IDPRUP of the HEPEUP block, so a simple map (IDPRUP -> (order, nparton)) created in the constructor  does the job.\r\n\r\nThe feature is optional and can be turned on by giving a VPSet in the job configuration\r\n```\r\nprocess.externalLHEProducer = cms.EDProducer(\"ExternalLHEProducer\",\r\n    args = cms.vstring('gridpack.tar.xz'),\r\n    numberOfParameters = cms.uint32(1),\r\n    nEvents = cms.untracked.uint32(100),\r\n    outputFile = cms.string('cmsgrid_final.lhe'),\r\n    scriptName = cms.FileInPath('GeneratorInterface/LHEInterface/data/run_generic_tarball_cvmfs.sh'),\r\n    ## new option ##\r\n    nPartonMapping = cms.VPSet(\r\n        cms.PSet(\r\n            idprup = cms.uint32(0),\r\n            order = cms.string('NLO'),\r\n            np = cms.uint32(0)\r\n        ),\r\n        cms.PSet(\r\n            idprup = cms.uint32(1),\r\n            order = cms.string('LO'),\r\n            np = cms.uint32(1)\r\n        )\r\n    )\r\n)\r\n```", "branch": "master", "changed_files": 1, "comments": 11, "commits": 2, "created_at": "1550066187", "deletions": 11, "labels": ["code-checks-approved", "comparison-pending", "generators-pending", "orp-pending", "pending-signatures", "tests-started"], "milestone": "CMSSW_10_5_X", "number": 25928, "release-notes": [], "review_comments": 0, "state": "open", "title": "New option to the ExternalLHEProducer to enable UNLOPS merging", "updated_at": "1550124596", "user": "yiiyama"}
{"additions": 2, "auther_ref": "fixCASegfault", "auther_sha": "93f8ae2e9100a52437eecca2ab588bb8733d3ca1", "author": "makortel", "body": "In 810pre12 I get a segfault in step2 (HLT) with\n\n```\nrunTheMatrix.py -i all -l 1325.0 --command \"--customise RecoTracker/Configuration/customiseForTripletsByCellularAutomaton.customiseForTripletsByCellularAutomaton\" \n```\n\nIt turns out that the `LayerHitMapCache` in `CAHitTripletGenerator` is currently cleared too early. `CACell::getInnerHit()` and `getOuterHit()` forward the calls to a `HitDoublets` object, which forwards the calls to a `RecHitsSortedInPhi` object owned by `LayerHitMapCache`. If the `LayerHitMapCache` is cleared, the `RecHitsSortedInPhi` objects are deleted, so the `clear()` must be done after all operations to `HitDoublets`. The `CAHitQuadrupletGenerator` is also affected.\n\nWith the fix here, the test above runs to completion (also a more thorough test\n\n```\nrunTheMatrix.py -i all -l 1325.0,1325.1 --command \"--customise RecoTracker/Configuration/customiseForTripletsByCellularAutomaton.customiseForTripletsByCellularAutomaton --customise RecoTracker/Configuration/customiseForTripletsHLTPixelTracksByCellularAutomaton.customiseForTripletsHLTPixelTracksByCellularAutomaton\"\nrunTheMatrix.py -i all -l 10024.0,10024.1 --command \"--customise RecoTracker/Configuration/customiseForQuadrupletsByCellularAutomaton.customiseForQuadrupletsByCellularAutomaton --customise RecoTracker/Configuration/customiseForQuadrupletsHLTPixelTracksByCellularAutomaton.customiseForQuadrupletsHLTPixelTracksByCellularAutomaton\"\n```\n\nworks)\n\nTested in 8_1_0_pre12, no changes expected in any matrix workflows.\n\n@felicepantaleo @VinInn @rovere \n", "branch": "CMSSW_8_1_X", "changed_files": 2, "closed_at": "1475409150", "comments": 11, "commits": 1, "created_at": "1475045619", "deletions": 5, "labels": ["bug-fix", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "c8b352fa2495b81c7df0eec9431bac84b1febdec", "merged_at": "1475409150", "merged_by": "cmsbuild", "milestone": "Next CMSSW_8_1_X", "number": 16008, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Move LayerHitMapCache::clear() to very end in CA triplet and quadruplet generators", "updated_at": "1475409151", "user": "makortel"}
{"additions": 10, "auther_ref": "reco-virt-dtors", "auther_sha": "95dafe52db06741082c581c43b48afdebb3ffc49", "author": "davidlt", "body": "CMSSW GCC 7.0.1 builds now follows jemalloc (dev branch) and also has a\r\nnew TCMalloc. Both of these have C++14 sized deallocation feature\r\nenabled. This means that if possible operator delete will be called with\r\nsize argument, which will help allocator to reduce the time to free the\r\nobject. E.g. this is not possible for incomplete types which size is\r\nunknown at a time.\r\n\r\nGCC 7.0.1 builds contain an additional build of jemalloc\r\n(jemalloc-debug) which contains extra asserts and checks for developers.\r\nIt helped to find two places were operate delete is called using base\r\nclass type instead of actual type. E.g., this means that wrong size (8\r\nbytes) were passed to operator delete instead of actual type (16 bytes).\r\n\r\nThis seems to be undefined behavior in C++14. From [expr.delete] (5.3.5\r\nDelete):\r\n\r\n    In the first alternative (delete object), if the static type of the\r\n    object to be deleted is different from its dynamic type, the static type\r\n    shall be a base class of the dynamic type of the object to be deleted\r\n    and the static type shall have a virtual destructor or the behavior is\r\n    undefined.\r\n\r\nSigned-off-by: David Abdurachmanov <David.Abdurachmanov@cern.ch>", "branch": "master", "changed_files": 10, "closed_at": "1491573360", "comments": 8, "commits": 1, "created_at": "1491505907", "deletions": 2, "labels": ["comparison-available", "l1-pending", "orp-pending", "pending-signatures", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "dbeb15b3f8eabc7c9bf7265487d3e904c730b3c7", "merged_at": "1491573360", "merged_by": "davidlange6", "milestone": "CMSSW_9_1_X", "number": 18250, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Add missing virtual dtors", "updated_at": "1491573360", "user": "davidlt"}
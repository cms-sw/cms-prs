{"additions": 89, "auther_ref": "fix-HTXS-classification", "auther_sha": "1c946ebf9cee7871050244e24fba1d35d296fad0", "author": "runtingt", "body": "#### PR description:\r\n\r\n<!-- Please replace this text with a description of the feature proposed or problem addressed, specifying:\r\n  - what changes are expected in the output if any, \r\n  - what other PRs or externals it depends upon if any,\r\n  - link to any additional material useful to provide a documentation for this PR (slides, JIRA tickets, related pull requestes, hypernews, TWiki or Indico pages)  -->\r\n\r\nIn certain 2024 MC samples, the HTXS labels for all events are set to `0: UNKNOWN`, see e.g. [`ZH-Hto2G`](https://cms-pdmv-prod.web.cern.ch/mcm/requests?prepid=HIG-RunIII2024Summer24NanoAODv15-00022):\r\n\r\n```python\r\nwith uproot.open(\"root://xrootd-cms.infn.it//store/mc/RunIII2024Summer24NanoAODv15/ZH-Hto2G_Par-M-125_TuneCP5_13p6TeV_amcatnloFXFX-pythia8/NANOAODSIM/150X_mcRun3_2024_realistic_v2-v2/2530000/2e868471-3ed9-461f-b633-7034cc80b492.root\") as f:\r\n    tree = f[\"Events\"]\r\n    print(tree[\"HTXS_stage1_2_cat_pTjet30GeV\"].array()) # 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ..., 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n```\r\n\r\nThis stems from changes made to transition from HepMC2 -> HepMC3 for these samples, where `signal_process_vertex()` was removed. Instead, it was assumed that the first vertex in `GenEvent` is the hard-scatter vertex. This is not always the case and causes the Rivet routine to fail. This PR moves the existing (correct) logic from the Rivet routine itself into a utility function that can then be used by the producer. \r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\n- Sanity check: Following these changes, a re-nano of the affected Hgg samples contain no `0: UNKNOWN` labels\r\n- Eventwise check: Re-nano of some known good samples (from 2023) with these changes produce the same HTXS labels for each event\r\n- Distribution check: The HTXS distributions for a known good sample (from 2023) and a re-nano 2024 sample with these changes (for the same process) agree within statistical uncertainties.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\n- Intended backport: CMSSW_15_X_X\r\n", "branch": "master", "changed_files": 3, "comments": 1, "commits": 1, "created_at": "1767991472", "deletions": 37, "labels": ["generators-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-pending"], "milestone": "CMSSW_16_1_X", "number": 49759, "release-notes": [], "review_comments": 0, "state": "open", "title": "Fix hard-scatter vertex ID in HTXSRivetProducer", "updated_at": "1767991494", "user": "runtingt"}
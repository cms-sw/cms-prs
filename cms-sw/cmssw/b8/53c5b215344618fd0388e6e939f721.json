{"additions": 17, "auther_ref": "SetBinLabelFixes_1220pre2", "auther_sha": "b1758203301eac15231e3b4df934507ddda7d843", "author": "Sam-Harper", "body": "#### PR description:\r\n\r\nFastTimerServiceClient seemed to be taking a lot of time so I had a quick look. \r\n\r\nIt was quickly established that all the time was spent in TAxis::SetBinLabel https://root.cern.ch/doc/v616/TAxis_8cxx_source.html#l00809, specifically THashList::Rehash\r\n\r\nI then had a quick look at FastTimerServiceClient and noticed its remaking the histograms every lumisection\r\nhttps://github.com/cms-sw/cmssw/blob/master/HLTrigger/Timer/plugins/FastTimerServiceClient.cc#L95\r\n\r\nI'm not entirely clear why it does it and I didnt spend any time to understand it. Perhaps experts could comment, I have no idea how DQM lumi plots work.  It would be ideal if we could move that call to just end job if possible and experts agree.\r\n\r\nHowever what it is doing is resetting the bin labels on each histogram each time. This is a very expensive operation so I put a simple check to see if the bin label is already set to that value before changing it. Honestly this should be inside TAxis::SetBinLabel ...\r\n\r\nOn my cern PC it goes from taking 14mins to 4mins for a file which only has a single lumisection. It'll be bigger gains for multi lumisection files. \r\n\r\n@fwyzard \r\n\r\n\r\n#### PR validation:\r\n\r\nlabels are still being set on my test workflow\r\n\r\n", "branch": "master", "changed_files": 2, "comments": 2, "commits": 1, "created_at": "1638348543", "deletions": 7, "labels": ["dqm-pending", "hlt-pending", "pending-signatures", "orp-pending", "tests-started", "code-checks-rejected"], "milestone": "CMSSW_12_2_X", "number": 36313, "release-notes": [], "review_comments": 0, "state": "open", "title": "Speeding up FastTimerServiceClient ", "updated_at": "1638349507", "user": "Sam-Harper"}
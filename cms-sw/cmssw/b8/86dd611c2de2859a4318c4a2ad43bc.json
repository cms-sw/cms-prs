{"additions": 13, "auther_ref": "CMSSW_14_1_X_feature_hltGtStage2Digis_in_ALCARECO", "auther_sha": "e15c1e3da6f9b6867326681b9dd35c3d3339a48c", "author": "CTPPS", "body": "#### PR description:\r\n\r\nThe PR adds the hltGtStage2Digis production step in the PPS ALCARECO sequence and preserves this product in the output. This change follows the discussion in [CMSHLT-2989](https://its.cern.ch/jira/browse/CMSHLT-2989), in which the the hltFEDSelectorL1 products are added to the HLT output in order to have access to the prescale values in the final dataset.\r\n\r\nA backport to CMSSW_14_0_X will be created as soon as this PR is fully checked out.\r\n\r\n#### PR validation:\r\n\r\nThe PR was tested using privately-produced input files (check recipe below) and unit tests run locally. These input files (one for the express stream and one for the prompt) are available as:\r\n\r\n  * /afs/cern.ch/user/a/abellora/public/ALCAPPSTest/outputALCAPPSExpress.root\r\n  * /afs/cern.ch/user/a/abellora/public/ALCAPPSTest/outputALCAPPSPrompt.root\r\nThe tests were executed with:\r\n\r\n```cmsDriver.py testExpressPPSAlCaRecoProducer -s ALCAPRODUCER:PPSCalMaxTracks,ENDJOB     --process ALCARECO     --scenario pp     --era run3_common     --conditions auto:run3_data_express     --data      --datatier ALCARECO     --eventcontent ALCARECO     --nThreads 8     --number 100 --filein ${INPUTFILE}     --fileout file:outputALCAPPS_RECO_express.root     --customise_commands=\"$customise_commands\"```\r\nand\r\n\r\n```cmsDriver.py testPromptPPSAlCaRecoProducer -s ALCAPRODUCER:PPSCalMaxTracks,ENDJOB     --process ALCARECO     --scenario pp     --era run3_common     --conditions auto:run3_data_express     --data      --datatier ALCARECO     --eventcontent ALCARECO     --nThreads 8     --number 100 --filein ${INPUTFILE}     --fileout file:outputALCAPPS_RECO_prompt.root     --customise_commands=\"$customise_commands\"```\r\nwhere ${INPUTFILE} is the respective file above and $customise_commands is taken from the [express test-script](https://github.com/cms-sw/cmssw/compare/master...CTPPS:cmssw:CMSSW_14_1_X_feature_hltGtStage2Digis_in_ALCARECO#diff-ba061000a48eb7b39f75c8ef63861ea696d461f59ce734402b7b86dbca98ee66R4) or [prompt test-script](https://github.com/cms-sw/cmssw/compare/master...CTPPS:cmssw:CMSSW_14_1_X_feature_hltGtStage2Digis_in_ALCARECO#diff-2964a184e339eaf960971bde9742f2ca58f5baaf02187aa5d86380d425120928R4), respectively.\r\n\r\nThese input files should be moved to the /store/group/alca_global/pps_alcareco_producer_tests area and become the new test files.\r\n\r\n#### Backward compatibility\r\n\r\nThe `hltGtStage2Digis` expects a product (under `hltFEDSelectorL1` label) which is not present in 2023 (but will be available in 2024 data) and older datasets. \r\nWe have a couple of PPS relvals (1043,1044,1045) using PPS ALCARECO producer on 2022 raw data, see [PPS ALCARECO relvals](https://github.com/search?q=repo%3Acms-sw%2Fcmssw%20RunRawPPS2022B&type=code).\r\nThese relvals should be used in testing of this PR, as we believe they are not part of usual set of `runTheMatrix` tests.\r\n\r\nWhen we tested this PR we discovered that these relvals (1043,1044,1045) were succeeding, but the step2 log files contained an expected error message (as the product was not found in 2022 raw data):\r\n```\r\n%MSG-e L1T:  L1TRawToDigi:hltGtStage2Digis 20-Feb-2024 16:24:34 CET  Run: 355207 Event: 748612\r\nCannot unpack: no FEDRawDataCollection found\r\n```\r\n\r\nWe are open for discussion on proper back-ward compatibility mode.\r\n\r\n### HLT test file production recipe\r\nHLT test files were produced for a ZeroBias RAW file from run 367104.\r\n\r\n  * CMSSW_13_0_5_patch1 was used (same version used at P5 for that run)\r\n  * An HLT config was created with the same GT and menu used for data-taking using: hltGetConfiguration adg:/cdaq/physics/Run2023/2e34/v1.0.2/HLT/V6 --data --output all --max-events 1000 --globaltag 130X_dataRun3_HLT_v2 --eras Run3 --input /store/data/Run2023C/ZeroBias/RAW/v1/000/367/104/00000/ca4253b3-9a09-4158-8036-501272d6fe16.root\r\n  * The config was modified in order to implement the same changes of [CMSHLT-2989](https://its.cern.ch/jira/browse/CMSHLT-2989) by modifying the outputCommands of the hltOutputALCAPPSExpress and hltOutputALCAPPSPrompt modules.", "branch": "master", "changed_files": 5, "comments": 1, "commits": 1, "created_at": "1708527626", "deletions": 8, "labels": ["alca-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-pending"], "milestone": "CMSSW_14_1_X", "number": 44044, "release-notes": [], "review_comments": 0, "state": "open", "title": "[PPS] Added hltGtStage2Digis to ALCARECOPRODUCER", "updated_at": "1708527655", "user": "grzanka"}
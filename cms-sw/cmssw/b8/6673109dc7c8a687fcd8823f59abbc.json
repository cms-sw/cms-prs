{"additions": 415, "auther_ref": "mkFitHLT2025", "auther_sha": "d578a59f6d5434087db2c336b9e1e29439e96270", "author": "trackreco", "body": "### PR description:\r\n\r\nThis PR aims at speeding up the mkFit (input) converters and the mkFit producer, targeting HLT in 2025:\r\n    - `RecoTracker/MkFit/plugins/MkFit*HitConverter.cc` and `convertHits.h`: save mkFit layer index per hit to be used for a faster `MkFitEventOfHitsProducer`; use more variables available for a given `Det` to avoid their recomputation per hit (including hit local->global conversion); access clusters from the reference collection by index directly instead of dereferencing an `OmniClusterRef`\r\n    - `RecoTracker/MkFit/plugins/MkFitEventOfHitsProducer.cc` uses pre-computed per-hit layer index \r\n    - `RecoTracker/MkFit/plugins/MkFitProducer.cc` (and customization functions) : disable (by config) additional/redundant re-check of the input cluster charge (already applied during the hit creation); this should work OK for an mkFit setup where CCC is the same in all iterations\r\n    - `RecoTracker/MkFitCore/interface/Hit.h` : vdt, replace (slow) `std::hypot` with explicit `sqrt(x*x+y*y)`; use `SMatrixSym33` for direct covariance storage to avoid conversion from `SVector6`\r\n    - `RecoTracker/MkFitCore/src/MkFinder.cc`, `RecoTracker/MkFitCore/src/MkFitter.cc`, `RecoTracker/MkFitCore/src/PropagationMPlex*.cc`, `RecoTracker/MkFitCore/src/Track.cc` vdt, replace (slow) `std::hypot` with explicit `sqrt(x*x+y*y)`\r\n\r\nTiming reduction (based on callgrind) in MC ttbar with PU using mkFit at HLT configuration is overall ~30% in mkFit-related modules:\r\n- `MkFitEventOfHitsProducer` : -40%\r\n- `MkFitSiStripHitConverter`: -35%\r\n- `MkFitSiPixelHitConverter`: -40%\r\n- `MkFitProducer`: -14% (7% is the faster math, 7% from not updating the cluster mask with CCC)\r\n\r\nFor testing of the HLT configuration, PR https://github.com/cms-data/RecoTracker-MkFit/pull/15 is required.\r\n\r\n### PR validation:\r\n\r\nThis PR was validated using both offline and HLT configurations.\r\nFor offline: http://uaf-10.t2.ucsd.edu/~mmasciov/MIC/HLTTracking/offlineMTV_TTbarPU_2024_PR155/\r\n--> Only differences are at the level of fluctuations, consistently with the proposed changes.\r\n\r\nFYI: @cms-sw/tracking-pog-l2, @slava77, @mtosi, @missirol\r\n\r\n", "branch": "master", "changed_files": 21, "comments": 31, "commits": 3, "created_at": "1736938225", "deletions": 184, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-pending", "requires-external", "code-checks-approved", "tracking"], "milestone": "CMSSW_15_0_X", "number": 47106, "release-notes": [], "review_comments": 3, "state": "open", "title": "Speedup of mkFit hit converters, and introduction of mkFit HLT customization for 2025", "updated_at": "1737099337", "user": "mmasciov"}
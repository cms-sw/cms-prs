{"additions": 429, "auther_ref": "premixMTD", "auther_sha": "f68bffa2f31cd6e606674be20ad7c3db001fb0c9", "author": "makortel", "body": "#### PR description:\r\n\r\nThis PR makes the first attempt to implement premixing for MTD. As the SimHit accumulation approach is similar to HGCal, the premixing approach is as well similar. A few details are different-enough though so that no code can be easily re-used (e.g. \"MTD cell\" indexing uses row and column indices in addition to DetId, and the exact way to fill `MTDCellInfo` differs from `HGCCellInfo`).\r\n\r\nBasically in stage1 `MTDSimHitDataAccumulator` is converted to `PMTDSimAccumulator` by packing each \"non-zero\" element `MTDCellInfo` to 11 bits.\r\n\r\nElements of `MTDCellInfo[0]`(energy) are packed with `logintpack::pack16log()` to the range 1e-4..1e6 yielding ~1.3 % precision. I found this range by printing out values on 200 PU, so likely there is room for further tuning (from printouts I noticed that especially on the higher side the values seem to be quantized with much larger steps than 1.3 %).\r\n\r\nElements of `MTDCellInfo[1]` (time of flight) appeared to be limited roughly to the range of 0-26, so those values are packed linearly on that range.\r\n\r\n#### PR validation:\r\n\r\nTested in 10_4_0_mtd5 (and then rebased on 10_6_0_pre3, compiled, and limited matrix runs). I have here comparison of 4D-vertices validation on 10 ttbar+PU35 events \r\nhttp://mkdev7.cern.ch:8081/dqm/relval/start?runnr=1;dataset=/RelValTTbar_14/CMSSW_10_4_0_mtd5-PU35_2023d35_10ev_classical_v1-v1/DQMIO;sampletype=offline_relval;filter=all;referencepos=ratiooverlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A/RelValTTbar_14/CMSSW_10_4_0_mtd5-PU35_2023d35_10ev_premixing_v2-v1/DQMIO%3A%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=Vertexing/PrimaryVertexV/offlinePrimaryVertices4D;focus=Vertexing/PrimaryVertexV/offlinePrimaryVertices4D/RecoAllAssoc2GenMatched_PullY;zoom=no;\r\nand (e.g. reco-only) distributions look reasonable\r\n![image](https://user-images.githubusercontent.com/33993/55462818-f065d780-55f7-11e9-82d3-98542716455e.png)\r\n![image](https://user-images.githubusercontent.com/33993/55462846-ff4c8a00-55f7-11e9-815e-770340c19e98.png)\r\n\r\nFurther testing (larger statistics, lower-level variables) would be useful, \r\n\r\n@kpedro88 @mdhildreth @fabiocos \r\n", "branch": "master", "changed_files": 13, "closed_at": "1554746830", "comments": 23, "commits": 2, "created_at": "1554273761", "deletions": 14, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "simulation-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "65d5af1bbe3b2475ba125c7ad3453e51280757c5", "merged_at": "1554746830", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 26332, "release-notes": [], "review_comments": 3, "state": "closed", "title": "First attempt of premixing for MTD", "updated_at": "1554746830", "user": "makortel"}
{"additions": 6, "auther_ref": "updatePedeOptions_forSiPixelAliPCL", "auther_sha": "880ad295be00b4c8bb09267ce5403e693324a4ce", "author": "mmusich", "body": "#### PR description:\r\nDuring Run-2 pp operations it was noticed that occasionally the PCL alignment workflow was stalled for very long runs (typically exceeding 1000 LS long), examples are [run 317182](https://tinyurl.com/yxoeyh2r) and [run 317320](https://tinyurl.com/y3j4yjdq). \r\nIn those relatively rare cases no measurement was available despite the large amount of tracks available.\r\nInspection of log files revealed that the issue lied in the inability of the pede routine to open the input binary files and access the data within them:\r\n```\r\nSTOP FILETC: open error\r\n%MSG-e MillePedeFileReader: AlignmentProducerAsAnalyzer:SiPixelAliPedeAlignmentProducer@endJob 10-Jun-2018 13:58:10 CEST PostGlobalEndRun\r\nCould not read millepede result-file.\r\n%MSG\r\n%MSG-e MillePedeFileReader:  MillePedeDQMModule:SiPixelAliDQMModule@endJob 10-Jun-2018 13:58:10 CEST PostGlobalEndRun\r\nCould not read millepede result-file.\r\n%MSG \r\n```\r\nThe issues has been traced back in the meanwhile in having a too large amount of pede binary files open at the same time.\r\nThis issue has been solved in recent pede releases (cf. http://www.desy.de/~kleinwrt/MP2/doc/html/index.html), by providing the option [closeandreopen](http://www.desy.de/~kleinwrt/MP2/doc/html/option_page.html#cmd-closeandreopen) (from the pede manual: sets flag `keepOpen` to zero to enable closing and reopening of binary files to limit the number of concurrently open files). \r\nSuch an option is available starting from the 19.04.12 revision and is available either in the privately distributed pede executable at `/afs/cern.ch/user/c/ckleinw/bin/rev183/pede`or in the official MillePede release `V04-06-00`  (which has been requested here: https://github.com/cms-sw/cmsdist/pull/5309)\r\nThis PR updates the configuration of `SiPixelAliPedeAlignmentProducer`in order to use the `closeandreopen` option and is a companion of  https://github.com/cms-sw/cmsdist/pull/5309 (**N.B. the two should be tested together**). \r\n\r\n#### PR validation:\r\n\r\nThe previously failing PCL workflow for run 317320 re-generated via:\r\n\r\n```\r\ncmsDriver.py pedeStep --data --conditions 106X_dataRun3_Express_v2 --scenario pp --era Run2_2018 -s ALCAHARVEST:SiPixelAli --dasquery='file dataset=/StreamExpress/Run2018B-PromptCalibProdSiPixelAli-Express-v1/ALCAPROMPT run=317320' -n -1 \r\n```\r\nwith the modifications proposed in this PR + adding the line:\r\n```\r\nprocess.SiPixelAliPedeAlignmentProducer.algoConfig.pedeSteerer.pedeCommand = \"/afs/cern.ch/user/c/ckleinw/bin/rev183/pede\"\r\n```\r\nin the configuration (equivalent to have `V04-06-00`as default executable) runs to completion (takes about 3h to complete).\r\n\r\n![image](https://user-images.githubusercontent.com/5082376/67793064-7fe24480-fa7a-11e9-9fca-fee8bc5c188b.png)\r\n\r\n#### if this PR is a backport please specify the original PR:\r\n\r\nThis PR is not a backport.\r\ncc:\r\n@adewit @connorpa @dmeuser\r\n", "branch": "master", "changed_files": 2, "closed_at": "1572462774", "comments": 13, "commits": 1, "created_at": "1572372460", "deletions": 4, "labels": ["alca-approved", "code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "requires-external", "tests-approved"], "merge_commit_sha": "1fc8c61061aae53b47f37e5256bf5f4debb0d4c4", "merged_at": "1572462774", "merged_by": "cmsbuild", "milestone": "CMSSW_11_0_X", "number": 28306, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[SiPixelAli PCL] Update the pede options to avoid issues with too many binaries open", "updated_at": "1572462774", "user": "mmusich"}
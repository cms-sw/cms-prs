{"additions": 210, "auther_ref": "KDTreeLinkerAlgo_for_PR", "auther_sha": "5e9be157e7d2be5bf7c2f28c96bfdfa5ed105f63", "author": "guitargeek", "body": "#### PR description:\r\n\r\nAs noted in https://github.com/cms-sw/cmssw/pull/26534, there are several implementations of KDTrees in CMSSW.\r\n\r\nThe original one is not in the current release anymore:\r\nhttps://github.com/cms-sw/cmssw/blob/CMSSW_9_4_X/RecoParticleFlow/PFProducer/interface/KDTreeLinkerAlgo.h\r\n\r\nThis  code got \"forked\" two times:\r\n\r\n1. https://github.com/cms-sw/cmssw/blob/master/CommonTools/RecoAlgos/interface/KDTreeLinkerAlgo.h\r\n2. https://github.com/cms-sw/cmssw/blob/master/RecoLocalCalo/HGCalRecAlgos/interface/KDTreeLinkerAlgoT.h\r\n\r\nUnfortunately the forks diverged. The first one has the same functionality but  is more optimized (i.e. by arranging the node info in structure of array style, see https://github.com/cms-sw/cmssw/pull/772), and the second one is just the generalization of the original code to n dimensions.\r\n\r\nI suggest to implement the generalization to n dimension also in the CommonTools version, so the diverging fork can be removed and the faster CommonTools version used instead.\r\n\r\nMaybe at a later point one could replace the merged KDTreeLinkerAlgo with another implementation of the KDTree:\r\nhttps://github.com/cms-sw/cmssw/blob/master/CommonTools/RecoAlgos/interface/FKDTree.h\r\n\r\nThe FKDTree has also the improvement with the SOA data structures which the KDTreeLinkerAlgo now has as well. I guess the FKDTree will still be a bit faster because it does not use recursion. However, the replacement should probably not be done without profiling. In any case that would be a more involved migration than what I suggest in this PR.\r\n\r\n#### PR validation:\r\n\r\nCMSSW compiles, local matrix tests pass and the new KDTreeLinkerAlgo seems to work according to my little validation script:\r\nhttps://gist.github.com/guitargeek/0adc2dac708c7bf7c31c553249622197\r\n", "branch": "master", "changed_files": 14, "closed_at": "1560794038", "comments": 30, "commits": 1, "created_at": "1559385387", "deletions": 660, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "c8dadfa76bf7d07adca2291cb4e4d0c869ed5b4a", "merged_at": "1560794038", "merged_by": "cmsbuild", "milestone": "CMSSW_11_0_X", "number": 27049, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Merged KDTreeLinkerAlgo and KDTreeLinkerAlgoT", "updated_at": "1560801203", "user": "guitargeek"}
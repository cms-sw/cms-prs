{"additions": 3595, "auther_ref": "Mahi-alpaka_14_0_X", "auther_sha": "525a14a6457868fba16da28c08fbda4bb7fb01a4", "author": "fwyzard", "body": "#### PR description:\r\n\r\nFirst implementation of MAHI in alpaka, running on CPU and GPU\r\n  - reuse the minimisation code introduced by ECAL multifit\r\n  - implement and use atomicMaxPair function\r\n  - implement HCAL portable conditions\r\n  - implement HCAL digis portable SoA\r\n  - update the HCAL offline reconstruction using the alpaka modifier\r\n  - HLT customisation for alpaka-based HCAL reconstruction, skipping the legacy conversion for HCAL PF clusters\r\n  - various fixes from the code review\r\n\r\nQuoting @kakwok \r\n\r\n> This PR port the CUDA implementation of Hcal Local Reconstruction (Mahi) to using Alpaka. Custom SoA data structure used in CUDA for HCAL condition data and rechits are replaced with PortableCollection. The current Alpaka implementation aims at reproducing the results from the CUDA implementation, no algorithmic changes are made.\r\n> \r\n> There are 4 main pieces involved in the migration:\r\n>     * digiConverter(`hcalDigisProducerPortable`): Convert CPU digis into SoA format\r\n>     * Produce HCAL condition data in SoA format (Multiple producers)\r\n>     * Mahi kernels (`Mahi.dev.cc`)\r\n>     * Convert rechits from SoA to legacy format (`HcalRecHitSoAToLegacy`)\r\n> \r\n> \r\n> More details on code design are presented in the recent HLT GPU development meetings: \r\n> https://indico.cern.ch/event/1350955/\r\n> https://indico.cern.ch/event/1350953/\r\n> https://indico.cern.ch/event/1350952/\r\n> https://indico.cern.ch/event/1230377/\r\n> https://indico.cern.ch/event/1230374/\r\n\r\nNote: this PR requires #45277 and #45278.\r\n\r\n#### PR validation:\r\n\r\nRunning the HLT menu v1.3 over 100k L1-accepted events gives consistent results:\r\n  - on CPU with the legacy HCAL code;\r\n  - on GPU with the CUDA HCAL code;\r\n  - on GPU with the alpaka HCAL code;\r\n  - on CPU with the alpaka HCAL code.\r\n\r\nVery minor discrepancies in the alpaka CPU vs alpaka GPU results (< 10) are being investigated, and may be addressed in a follow up PR.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nBackport of #44910 to CMSSW 14.0.x for data taking.", "branch": "CMSSW_14_0_X", "changed_files": 55, "comments": 16, "commits": 1, "created_at": "1719469193", "deletions": 6, "labels": ["core-pending", "alca-pending", "db-pending", "dqm-approved", "hlt-approved", "reconstruction-approved", "simulation-approved", "pending-signatures", "tests-approved", "orp-pending", "pdmv-pending", "urgent", "backport", "upgrade-approved", "heterogeneous-approved", "hcal"], "milestone": "CMSSW_14_0_X", "number": 45324, "release-notes": [], "review_comments": 0, "state": "open", "title": "HCAL local reconstruction in Alpaka [14.0.x]", "updated_at": "1719813105", "user": "fwyzard"}
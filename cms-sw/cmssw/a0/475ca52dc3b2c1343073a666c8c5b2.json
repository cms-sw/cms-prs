{"additions": 38, "auther_ref": "L1TXRawToDigi_bugFix_8_0_0pre6", "auther_sha": "5a07ce10736ff6840b2d54b4452af91be332510a", "author": "jpazzini", "body": "- check beginning/end of AMC stream using HEX of header/trailer -> moved to 4 bit [was 6 for header, 8 for trailer]\n\n```\n-  int BOEevTy  = ( dataWord >> 56 ) & 0xFf;  // positions 60 -> 63\n+  int BOEevTy  = ( dataWord >> 60 ) & 0xF;  // positions 60 -> 63\n```\n\n```\n-  if ( (BOEevTy != 0x51) || ( TM7fedId != twinMuxFed ) ) {\n+  if ( (BOEevTy != 0x5) || ( TM7fedId != twinMuxFed ) ) {\n```\n\n```\n+  int chkEOE = (dataWord >> 60 ) & 0xF;  // positions 60 -> 63\n+  if ( chkEOE != 0xA ) {\n+      edm::LogWarning(\"TwinMux_unpacker\") << \"AMC block closing line \" << std::hex << dataWord \n+                                          << std::dec << \" does not start with 0xA\";\n+      return;\n+  }\n```\n- range of AMC blocks to be read -> changed to 1-12 [was 0-11]\n\n```\n-    if ( AMCno < 12 ) {\n-      AMCsizes[AMCno] = ( dataWord >> 32 ) & 0xFFFFFF;  // positions 32 -> 55\n+    if ( (AMCno < 1) || (AMCno > 12) ) {\n+        edm::LogWarning(\"TwinMux_unpacker\") << \"AMCnumber \" << std::dec << AMCno \n+                                            << \" out of range (1-12)\";\n+        return;\n+    }    \n```\n- TM payload -> payload stored according to the expected size from the headers [was until the stream start with the trailer HEX (0xA) ]\n\n```\n-  while ( chkEOE != 0xA0 ) { \n[...] (store TM payloads)\n-}\n```\n\n```\n+  ///--> Store payloads\n+  std::map<int,int>::iterator AMCiterator = AMCsizes.begin();\n+  std::map<int,int>::iterator AMCitend = AMCsizes.end();  \n+  for ( ; AMCiterator != AMCitend; ++AMCiterator ) {\n+      \n+    for ( int k=0; k<AMCiterator->second; ++k) {\n+        \n+       readline( nline, dataWord );\n+       calcCRC( dataWord, newCRC);\n+       DTTM7WordContainer.push_back( dataWord );\n+     }\n+  }  \n```\n", "branch": "CMSSW_8_0_X", "changed_files": 1, "closed_at": "1455531163", "comments": 9, "commits": 1, "created_at": "1455520751", "deletions": 45, "labels": ["comparison-available", "new-package-pending", "orp-pending", "pending-signatures", "tests-approved"], "merge_commit_sha": "02a4b648099d3a34c36819a6457d554e1e2eae30", "merged_at": "1455531163", "merged_by": "davidlange6", "milestone": "CMSSW_8_0_X", "number": 13278, "release-notes": [], "review_comments": 0, "state": "closed", "title": "BugFix for TwinMux unpacker - change of logic involved", "updated_at": "1455531164", "user": "jpazzini"}
{"additions": 55, "auther_ref": "LowPtElectronsFull_102X_VeryLoose", "auther_sha": "416663b02795c38d4d6bf60f62a300726e6fb579", "author": "bainbrid", "body": "__This PR provides incremental changes on top of #25887.__\r\n\r\n__This PR requires the following external: cms-data/RecoEgamma-ElectronIdentification#13__\r\n\r\nThis PR supersedes #25936. \r\n\r\n---\r\n\r\nThis PR provides four changes:\r\n\r\n__1) Fixes to the SuperCluster class.__\r\n\r\nThe fixes are back ported from #25960 and #25974: \r\n- fix a memory use after free error caught by ASAN;\r\n- avoid creating and using unnecessary edm::Refs; \r\n- removes a single line of code that was responsible for duplicating edm::Refs to ECAL clusters. \r\n\r\nThe timing and footprint numbers below have been updated to reflect these fixes.\r\n\r\n__2) Modifies ValueMaps to store BDT output per GsfTrack track.__\r\n\r\nThis is the back port of #25915. The change is very small and concerns the only the `LowPtGsfElectronSeedValueMapsProducer` class, which produces ValueMaps that store the discriminator values from the BDT models used in the `LowPtGsfElectronSeedProducer`.\r\n\r\nThe ValueMaps originally stored the BDT outputs per GsfElectrons, but we need them per GsfTrack. There is a near (but not exact) 1-to-1 correspondence between GsfElectrons and GsfTracks, so the ValueMaps will increase moderately in size (at the few tens of % level, not orders of magnitude!) and they will use a different key. Quantitive numbers on timing and footprint can be found in the conversation of #25915.\r\n\r\n__3) Use new \"Autumn18\" BDT models and provide updated L, M, and T working points.__\r\n\r\nThis is the back port of #26012. \r\n\r\n**4) This PR switches to a Very Loose working point in the ElectronSeed module of the low pT electron chain. This change is only enabled for the ```bParking``` era.**\r\n\r\nThis is the back port of #26012. \r\n\r\n---\r\n\r\n__Timing and footprint studies for the Very Loose WP used by the bParking era:__\r\n\r\nThe increases in timing and footprint w.r.t. nominal are provided below. In short:\r\n- the timing increases by 25%,\r\n- the MINIAOD footprint increases by 137%.\r\n\r\n**RECO timing increase, bParking era only, Very Loose WP:**\r\n```\r\nThe same excluding the first 1 events\r\n  delta/mean delta/orJob     original                   new       module name\r\n  ---------- ------------     --------                  ----       ------------\r\n       added      +0.00%         0.00 ms/ev ->         0.50 ms/ev selectedPatLowPtElectrons\r\n       added      +8.23%         0.00 ms/ev ->      1225.09 ms/ev lowPtGsfElectronSeeds\r\n       added      +0.01%         0.00 ms/ev ->         1.45 ms/ev slimmedLowPtElectrons\r\n       added      +0.02%         0.00 ms/ev ->         2.56 ms/ev lowPtElectronMatch\r\n       added      +8.92%         0.00 ms/ev ->      1328.09 ms/ev lowPtGsfEleGsfTracks\r\n       added      +0.04%         0.00 ms/ev ->         6.17 ms/ev patLowPtElectrons\r\n       added      +2.00%         0.00 ms/ev ->       297.88 ms/ev lowPtGsfEleCkfTrackCandidates\r\n       added      +0.07%         0.00 ms/ev ->         9.84 ms/ev lowPtGsfElePfTracks\r\n       added      +1.55%         0.00 ms/ev ->       230.25 ms/ev lowPtGsfElePfGsfTracks\r\n       added      +0.00%         0.00 ms/ev ->         0.15 ms/ev lowPtGsfElectronSeedValueMaps\r\n       added      +0.04%         0.00 ms/ev ->         5.93 ms/ev lowPtGsfElectronID\r\n       added      +0.53%         0.00 ms/ev ->        78.90 ms/ev lowPtGsfElectronCores\r\n       added      +2.86%         0.00 ms/ev ->       425.63 ms/ev lowPtGsfElectrons\r\n       added      +0.81%         0.00 ms/ev ->       120.77 ms/ev lowPtGsfElectronSuperClusters\r\n                 +25.08%                            3732.71 ms/ev\r\n  ---------- ------------     --------                  ----       ------------\r\nJob total:  14.8827 s/ev ==> 18.9492 s/ev\r\n```\r\n\r\n**RECO footprint increase, bParking era only, Very Loose WP:**\r\n```\r\n-----------------------------------------------------------------\r\n   or, B         new, B      delta, B   delta, %   deltaJ, %    branch\r\n-----------------------------------------------------------------\r\n      0.0 ->      1126.5       1127     NEWO   0.03     recoGsfElectronCores_lowPtGsfElectronCores__RECO\r\n      0.0 ->      2121.7       2122     NEWO   0.06     recoConversions_gsfTracksOpenConversions_gsfTracksOpenConversions_RECO\r\n   8870.8 ->      8425.3       -446     -5.2  -0.01     edmErrorSummaryEntrys_logErrorHarvester__RECO\r\n      0.0 ->       601.4        601     NEWO   0.02     floatedmValueMap_lowPtGsfElectronID__RECO\r\n      0.0 ->     18855.2      18855     NEWO   0.53     recoCaloClusters_lowPtGsfElectronSuperClusters__RECO\r\n      0.0 ->      6125.4       6125     NEWO   0.17     recoSuperClusters_lowPtGsfElectronSuperClusters__RECO\r\n      0.0 ->     27324.7      27325     NEWO   0.77     recoGsfTracks_lowPtGsfEleGsfTracks__RECO\r\n      0.0 ->       773.9        774     NEWO   0.02     floatedmValueMap_lowPtGsfElectronSeedValueMaps_ptbiased_RECO\r\n      0.0 ->       790.8        791     NEWO   0.02     floatedmValueMap_lowPtGsfElectronSeedValueMaps_unbiased_RECO\r\n      0.0 ->     43295.5      43296     NEWO   1.22     recoGsfElectrons_lowPtGsfElectrons__RECO\r\n-------------------------------------------------------------\r\n  3541675 ->     3642021     100346             2.8     ALL BRANCHES\r\n```\r\n\r\n**MINIAOD footprint increase, bParking era only, Very Loose WP:**\r\n```\r\n-----------------------------------------------------------------\r\n   or, B         new, B      delta, B   delta, %   deltaJ, %    branch\r\n-----------------------------------------------------------------\r\n      0.0 ->     16480.1      16480     NEWO   20.87     recoCaloClusters_lowPtGsfElectronSuperClusters__RECO\r\n      0.0 ->     57850.4      57850     NEWO   73.27     patElectrons_slimmedLowPtElectrons__RECO\r\n      0.0 ->       985.8        986     NEWO   1.25     recoGsfElectronCores_lowPtGsfElectronCores__RECO\r\n      0.0 ->       723.1        723     NEWO   0.92     floatedmValueMap_lowPtGsfElectronSeedValueMaps_ptbiased_RECO\r\n      0.0 ->       555.0        555     NEWO   0.70     floatedmValueMap_lowPtGsfElectronID__RECO\r\n      0.0 ->       742.8        743     NEWO   0.94     floatedmValueMap_lowPtGsfElectronSeedValueMaps_unbiased_RECO\r\n      0.0 ->     25644.5      25644     NEWO   32.48     recoGsfTracks_lowPtGsfEleGsfTracks__RECO\r\n      0.0 ->      5431.8       5432     NEWO   6.88     recoSuperClusters_lowPtGsfElectronSuperClusters__RECO\r\n-------------------------------------------------------------\r\n    78956 ->      187349     108393            137.3     ALL BRANCHES\r\n```\r\n\r\n---\r\n\r\n__Timing and footprint studies for the Loose WP used by the bParking era:__\r\n\r\nFor the record: the numbers below are for the original Loose working point, which has been tuned to rate balance w.r.t. the old Fall17 models. \r\n\r\nRECO timing increase, bParking era only, Loose WP:\r\n```\r\nThe same excluding the first 1 events\r\n  delta/mean delta/orJob     original                   new       module name\r\n  ---------- ------------     --------                  ----       ------------\r\n       added      +0.00%         0.00 ms/ev ->         0.15 ms/ev selectedPatLowPtElectrons\r\n       added      +8.21%         0.00 ms/ev ->      1222.58 ms/ev lowPtGsfElectronSeeds\r\n       added      +0.00%         0.00 ms/ev ->         0.57 ms/ev slimmedLowPtElectrons\r\n       added      +0.01%         0.00 ms/ev ->         0.85 ms/ev lowPtElectronMatch\r\n       added      +2.22%         0.00 ms/ev ->       330.50 ms/ev lowPtGsfEleGsfTracks\r\n       added      +0.01%         0.00 ms/ev ->         2.06 ms/ev patLowPtElectrons\r\n       added      +0.43%         0.00 ms/ev ->        63.31 ms/ev lowPtGsfEleCkfTrackCandidates\r\n       added      +0.07%         0.00 ms/ev ->        10.39 ms/ev lowPtGsfElePfTracks\r\n       added      +0.38%         0.00 ms/ev ->        56.14 ms/ev lowPtGsfElePfGsfTracks\r\n       added      +0.00%         0.00 ms/ev ->         0.05 ms/ev lowPtGsfElectronSeedValueMaps\r\n       added      +0.02%         0.00 ms/ev ->         2.77 ms/ev lowPtGsfElectronID\r\n       added      +0.13%         0.00 ms/ev ->        18.65 ms/ev lowPtGsfElectronCores\r\n       added      +0.89%         0.00 ms/ev ->       132.60 ms/ev lowPtGsfElectrons\r\n       added      +0.20%         0.00 ms/ev ->        29.43 ms/ev lowPtGsfElectronSuperClusters\r\n                 +12.57%                            1870.05 ms/ev\r\n  ---------- ------------     --------                  ----       ------------\r\nJob total:  14.8827 s/ev ==> 16.9203 s/ev\r\n```\r\n\r\nRECO footprint increase, bParking era only, Loose WP:\r\n```\r\n-----------------------------------------------------------------\r\n   or, B         new, B      delta, B   delta, %   deltaJ, %    branch\r\n-----------------------------------------------------------------\r\n      0.0 ->       312.3        312     NEWO   0.01     recoGsfElectronCores_lowPtGsfElectronCores__RECO\r\n      0.0 ->       252.9        253     NEWO   0.01     floatedmValueMap_lowPtGsfElectronID__RECO\r\n      0.0 ->     13477.6      13478     NEWO   0.38     recoCaloClusters_lowPtGsfElectronSuperClusters__RECO\r\n      0.0 ->      2198.6       2199     NEWO   0.06     recoSuperClusters_lowPtGsfElectronSuperClusters__RECO\r\n      0.0 ->      6474.3       6474     NEWO   0.18     recoGsfTracks_lowPtGsfEleGsfTracks__RECO\r\n      0.0 ->       264.5        264     NEWO   0.01     floatedmValueMap_lowPtGsfElectronSeedValueMaps_ptbiased_RECO\r\n      0.0 ->       262.8        263     NEWO   0.01     floatedmValueMap_lowPtGsfElectronSeedValueMaps_unbiased_RECO\r\n      0.0 ->     14082.6      14083     NEWO   0.40     recoGsfElectrons_lowPtGsfElectrons__RECO\r\n-------------------------------------------------------------\r\n  3541675 ->     3578709      37035             1.0     ALL BRANCHES\r\n```\r\n\r\nMINIAOD footprint increase, bParking era only, Loose WP:\r\n```\r\n-----------------------------------------------------------------\r\n   or, B         new, B      delta, B   delta, %   deltaJ, %    branch\r\n-----------------------------------------------------------------\r\n      0.0 ->     12017.7      12018     NEWO   15.22    recoCaloClusters_lowPtGsfElectronSuperClusters__RECO\r\n      0.0 ->     19327.0      19327     NEWO   24.48    patElectrons_slimmedLowPtElectrons__RECO\r\n      0.0 ->       345.5        346     NEWO   0.44     recoGsfElectronCores_lowPtGsfElectronCores__RECO\r\n      0.0 ->       200.8        201     NEWO   0.25     floatedmValueMap_lowPtGsfElectronSeedValueMaps_ptbiased_RECO\r\n      0.0 ->       195.3        195     NEWO   0.25     floatedmValueMap_lowPtGsfElectronID__RECO\r\n      0.0 ->       199.4        199     NEWO   0.25     floatedmValueMap_lowPtGsfElectronSeedValueMaps_unbiased_RECO\r\n      0.0 ->      6594.4       6594     NEWO   8.35     recoGsfTracks_lowPtGsfEleGsfTracks__RECO\r\n      0.0 ->      2125.1       2125     NEWO   2.69     recoSuperClusters_lowPtGsfElectronSuperClusters__RECO\r\n-------------------------------------------------------------\r\n    78956 ->      120018      41062            52.0     ALL BRANCHES\r\n```\r\n\r\n", "branch": "CMSSW_10_2_X", "changed_files": 6, "comments": 9, "commits": 8, "created_at": "1551102276", "deletions": 49, "labels": ["comparison-pending", "orp-pending", "pending-signatures", "reconstruction-pending", "requires-external", "tests-started"], "milestone": "CMSSW_10_2_X", "number": 26013, "release-notes": [], "review_comments": 0, "state": "open", "title": "LowPtElectrons: Very Loose working point", "updated_at": "1551125434", "user": "bainbrid"}
{"additions": 2380, "auther_ref": "deep-boosted-jets", "auther_sha": "1acac95a45b0841e2b02215d30a445f9c3ef17b9", "author": "hqucms", "body": "## Introduction ##\r\n\r\nThis PR is to integrate the [DeepAK8](https://twiki.cern.ch/twiki/bin/view/CMS/DeepAKXTagging) tagger into CMSSW. The DeepAK8 tagger is a multi-class tagger for identifying boosted hadronic top, W, Z, Higgs using AK8 jets. It uses low-level inputs (jet constituent particles and secondary vertices) and customized deep neural networks, and have shown significant improvement in performance compared to traditional approaches. Two versions of DeepAK8 have been developed: the *nominal* version aims at achieving the best possible performance but sculpts the mass distribution in background jets, while the *mass-decorrelated* version aims at minimizing the mass sculpting while keeping the performance as much as possible. Both versions are included in this PR. More details about the DeepAK8 tagger are summarized in  [twiki](https://twiki.cern.ch/twiki/bin/view/CMS/DeepAKXTagging), [slides](https://indico.cern.ch/event/695320/contributions/2850962/attachments/1632794/2603820/status_deepAK8_CMSHFT_2018-04-13_hqu.pdf), [CMS-DP-2017-049](https://cds.cern.ch/record/2295725?ln=en), and [NIPS paper](https://dl4physicalsciences.github.io/files/nips_dlps_2017_10.pdf).\r\n\r\n## Prerequisites ##\r\n\r\nMXNet (as an CMSSW external): https://github.com/cms-sw/cmsdist/pull/4167\r\nDNN model files: https://github.com/cms-data/RecoBTag-Combined/pull/15\r\n\r\n## Implementation ##\r\n\r\nThe implementation in this PR is based on the b-tagging framework. Similar to DeepFlavour and DeepDoubleB, the DeepAK8 tagger (named `pfDeepBoostedJetTags` and `pfMassDecorrelatedDeepBoostedJetTags` in this PR) is also trained with MiniAOD inputs (e.g., `pat::PackedCandidate`), so we follow the same strategy and add this tagger to MiniAOD by updating b-tagging on `slimmedJetsAK8`. We tried to set up the code to run on RECO inputs (e.g., `reco::PFCandidate`) as well but that part does not work now and is not used anywhere in this PR. This may be revisited in the future.\r\n\r\nAn overview of the changes:\r\n\r\n`DataFormats/BTauReco`:\r\n* new classes for the features and taginfo\r\n* moved `FeaturesTagInfo` to a separate file, since it is the base class for DeepFlavour, DeepDoubleB and DeepBoostedJet now\r\n\r\n`RecoBTag/DeepBoostedJet`:\r\n* producers for the TagInfo and the Tag results\r\n* corresponding cfi/cff\r\n\r\n`RecoBTag/TensorFlow`:\r\n* small refactor to allow some functions to be reused in DeepBoostedJet\r\n\r\n`PhysicsTools/MXNet`:\r\n* convenience wrapper of MXNet based on the C prediction API and unit tests\r\n\r\n`RecoBTag/Configuration`, `PhysicsTools/PatAlgos`:\r\n* enable DeepBoostedJet in b-tagging framework\r\n* add DeepBoostedJet to MiniAOD\r\n\r\n`DataFormats/Candidate/interface/CompositePtrCandidate.h`,\r\n`DataFormats/PatCandidates/interface/Jet.h`:\r\n* override clearDaughters in pat::Jet to reset the daughter cache too\r\n* This is needed due to changes introduced by https://github.com/cms-sw/cmssw/pull/22914. See https://github.com/hqucms/cmssw/commit/c04145d1bd9b1671db4d39925fe9a6421d770434#commitcomment-29634182 for the detailed explanation.\r\n\r\n## Validation ##\r\n\r\nWe have compared the discriminator values from this CMSSW implementation to the results obtained from the training framework using a TTBar RelVal sample. As shown below, the CMSSW implementation (running on RECO->MiniAOD) reproduces the results of the training framework (MiniAOD->standalone MXNet) very well.\r\n\r\n![comp_pfdeepboosteddiscriminatorsjettags_tvsqcd](https://user-images.githubusercontent.com/7973717/42448201-b79f38f4-837c-11e8-8324-8f12a3d37cd3.png)\r\n![comp_pfdeepboosteddiscriminatorsjettags_wvsqcd](https://user-images.githubusercontent.com/7973717/42448202-b7ba5fee-837c-11e8-8ae3-2b0aec5392cc.png)\r\n![comp_pfdeepboostedjettags_probhbb](https://user-images.githubusercontent.com/7973717/42448203-b7d4c8b6-837c-11e8-845b-2ff43dd38040.png)\r\n\r\n![comp_pfmassdecorrelateddeepboosteddiscriminatorsjettags_tvsqcd](https://user-images.githubusercontent.com/7973717/42448204-b7ee95f2-837c-11e8-8657-9864ed727bf6.png)\r\n![comp_pfmassdecorrelateddeepboosteddiscriminatorsjettags_wvsqcd](https://user-images.githubusercontent.com/7973717/42448205-b8085924-837c-11e8-9951-6c8ffedeaf56.png)\r\n![comp_pfmassdecorrelateddeepboostedjettags_probhbb](https://user-images.githubusercontent.com/7973717/42448206-b8238528-837c-11e8-9091-05df8ccd84fc.png)\r\n", "branch": "master", "changed_files": 57, "closed_at": "1536660268", "comments": 113, "commits": 29, "created_at": "1531129303", "deletions": 340, "labels": ["analysis-pending", "code-checks-approved", "comparison-available", "orp-approved", "pending-signatures", "reconstruction-approved", "requires-external", "tests-approved"], "merge_commit_sha": "e6ee4a8d6a569ff325d6cc0e15b83e95a562e167", "merged_at": "1536660268", "merged_by": "cmsbuild", "milestone": "CMSSW_10_3_X", "number": 23768, "release-notes": [], "review_comments": 77, "state": "closed", "title": "DeepAK8 tagger integration", "updated_at": "1536660275", "user": "hqucms"}
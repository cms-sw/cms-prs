{"additions": 911, "auther_ref": "offlineDQM_102X-integration-v2_from-CMSSW_10_2_X_2018-07-15-0000", "auther_sha": "aaa7328ef1fb66fce2576bd95ca23d4748e473cd", "author": "cms-bph-trigger", "body": "Same changes that were merged in #23738 and reverted in #23788 after a crash observed in 136.86 (see #23787 ), plus a sanity check to avoid that crash to happen and few additional minor fixes.\r\nThe present code has been successfully tested, also on 136.86\r\n\r\nHere, for reference, the description of the original PR, listing the major changes to the code:\r\n\r\nIn this pull-request many features of the offline DQM code used for BPH triggers have been fixed and optimised, and few more functionalities have been added.\r\nHere a list of the major changes:\r\n\r\n- **New general structure** of the code: for each efficiency type (defined as the \"cases\" in the big \"switch\") the numerator histos are filled in a nested environment just after the denominator filling, instead of defining two separate environments with specific selection criteria for each of them.\r\n- **Fixed trigger matching** feature: the bool BPHMonitor::matchToTrigger function is now using the HLTConfigProvider method to access the trigger-object collections.\r\n- **New correction for prescaled triggers**: while using the reference method to produce efficiencies, if the numerator path is prescaled it would flatly decrease the resulting efficiency by that prescale value. By filling the numerator histograms with weighted events, according to that prescale, the reduction effect is corrected.\r\n- **Better tuning of the offline selections** (especially the dimuon invariant masses), to select the correct regions where to compute the efficiency. This helps in some modules to select a pure region for the signal, in other modules (based on background events) to select the appropriate kinematic region.\r\n- **Customised and optimised binning**: to reduce the global number of bins, especially where they are not needed, the binning of the histograms has been refined\r\n- **Removal of few meaningless efficiencies**: some modules defined in the list of the cff file (devoted to the L1 efficiency of dR(MuMu) cut in 2mu+trk triggers) have been removed, since their efficiency definition is not correct (using at denominator a 2mu trigger, they will always be biased by the inefficiency of the track reconstruction at HLT)\r\n", "branch": "master", "changed_files": 4, "closed_at": "1532002006", "comments": 17, "commits": 2, "created_at": "1531809105", "deletions": 754, "labels": ["code-checks-approved", "comparison-available", "dqm-approved", "fully-signed", "orp-approved", "tests-approved"], "merge_commit_sha": "4237fed813d1b8a6fdb7d3f08db058e4eaf0bc26", "merged_at": "1532002006", "merged_by": "cmsbuild", "milestone": "CMSSW_10_3_X", "number": 23807, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Improvements and fixes for the BPH-trigger offline DQM code (v2)", "updated_at": "1532002007", "user": "aboletti"}
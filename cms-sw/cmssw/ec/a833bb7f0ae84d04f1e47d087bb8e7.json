{"additions": 25, "auther_ref": "runtime_nhits_141X", "auther_sha": "d1d19b5f41b7dd813bd5d1e181dbf10b1eb384ec", "author": "AdrianoDee", "body": "This PR proposes a solution for https://github.com/cms-sw/cmssw/issues/44769. \r\nso the culprit is https://github.com/cms-sw/cmssw/blob/6e82cc8aa6fff019b94eb34a5b5297c2eaa62573/RecoLocalTracker/SiPixelClusterizer/plugins/alpaka/SiPixelRawToClusterKernel.dev.cc#L509-L513\r\n\r\nwhere we cut the number of hits to \"only\":\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/6e82cc8aa6fff019b94eb34a5b5297c2eaa62573/Geometry/CommonTopologies/interface/SimplePixelTopology.h#L420\r\n\r\nAnd the event of the crash has:\r\n\r\n```\r\nSiPixelClusterizerAlpaka results:\r\n > no. of digis: 301020\r\n > no. of active modules: 1794\r\n > no. of clusters: 50684\r\n > bpix2 offset: 19595\r\n```\r\n\r\nThe poor man solution would be to rise the max to something safer  such as`static constexpr uint32_t maxNumberOfHits = 96 * 1024;`. But seems to me a waste also because this procedure is anyway a remnant of that intermediate phase of the Alpaka port when we had no runtime sized histograms (before https://github.com/cms-sw/cmssw/pull/43064). \r\n\r\nSo this PR involves a slightly bigger code refactoring in order to drop the fixed number of hits and use the runtime sized histograms where needed (namely for the hit to tuple map).\r\n\r\n#### PR validation:\r\n\r\nThe setup in https://github.com/cms-sw/cmssw/issues/44769 with this PR (on top of `master` or `14_0_X`) doesn't crash anymore.\r\n\r\nBackported to 14_0_X in #44774.\r\n\r\nsolves https://github.com/cms-sw/cmssw/issues/44769.\r\n", "branch": "master", "changed_files": 6, "comments": 5, "commits": 1, "created_at": "1713444978", "deletions": 25, "labels": ["reconstruction-pending", "geometry-pending", "pending-signatures", "tests-pending", "orp-pending", "urgent", "code-checks-pending", "tracking", "trk"], "milestone": "CMSSW_14_1_X", "number": 44773, "release-notes": [], "review_comments": 0, "state": "open", "title": "Allow Runtime Number of Hits for Alpaka Pixel Reconstruction", "updated_at": "1713445106", "user": "AdrianoDee"}
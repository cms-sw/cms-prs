{"additions": 12, "auther_ref": "devel_hltDontOverwriteOptions", "auther_sha": "72e637baf32699954f52b62b57f4253539343375", "author": "missirol", "body": "#### PR description:\r\n\r\nThis PR ensures that HLT utilities like `hltGetConfiguration` do not overwrite the `options` PSet downloaded as part of an HLT menu from `ConfDB`.\r\n\r\nThis update is intended to be fully backward-compatible. It is needed now since HLT menus have started to introduce the `options` PSet in ConfDB mainly as a way to control GPU offloading via `options.accelerators`.\r\n\r\nIn recent CMSSW releases (`CMSSW_11` and higher), the options `PSet` exists by default in the `cms.Process` and the types of its variables do not need to be specified (even if `process.options` is not explictly defined in the python config), so those type specifications are dropped.\r\n\r\nThis PR will be backported to `12_4_X`. I'd also suggest to also backport it to `12_3_X` for convenience, since there are recent online menus for `12_3_X` which define the `options` PSet in `ConfDB`.\r\n\r\n_Note_ : [the `options` PSet continues to be removed when the HLT configuration is downloaded as a \"fragment\"](https://github.com/cms-sw/cmssw/blob/b54d06d5447f6bb55d1da6c42d3a413f526150a0/HLTrigger/Configuration/python/Tools/confdb.py#L859). When using HLT fragments via `cmsDriver.py`, `options.accelerators` can be configured via `cmsDriver.py --accelerators [..]`.\r\n\r\nMerely technical. No changes expected.\r\n\r\nAttn (in case I missed something): @Martin-Grunewald @fwyzard @Sam-Harper\r\n\r\n#### PR validation:\r\n\r\nManual tests, e.g.\r\n\r\n1) Menu without `options` PSet in ConfDB\r\n```shell\r\nhltGetConfiguration /dev/CMSSW_12_4_0/GRun/V33 > hlt1.py\r\nedmConfigDump hlt1.py > dump1.py\r\npython3 hlt1.py\r\npython3 dump1.py\r\n```\r\n\r\n2) Menu with `options` PSet in ConfDB, and non-default accelerators choice (`accelerators = ['cpu']`):\r\n```shell\r\nhltGetConfiguration adg:/cdaq/physics/firstCollisions22/v2.0/HLT/V1 > hlt2.py\r\nedmConfigDump hlt2.py > dump2.py\r\npython3 hlt2.py\r\npython3 dump2.py\r\n```\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR:\r\n\r\nN/A", "branch": "master", "changed_files": 2, "closed_at": "1654319901", "comments": 7, "commits": 1, "created_at": "1654243386", "deletions": 14, "labels": ["hlt-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "02e7d700b126bf12c2652054125e0b3ce49601ed", "merged_at": "1654319901", "merged_by": "cmsbuild", "milestone": "CMSSW_12_5_X", "number": 38225, "release-notes": [], "review_comments": 3, "state": "closed", "title": "avoid overwrite of `options` PSet from `ConfDB` in HLT utilities", "updated_at": "1654319901", "user": "missirol"}
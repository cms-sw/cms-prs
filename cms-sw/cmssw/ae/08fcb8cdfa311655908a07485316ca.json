{"additions": 5, "auther_ref": "PUPPIV15_106X", "auther_sha": "dd50beb21fba76079cefac8177836e6795fe8002", "author": "lathomas", "body": "#### PR description:\r\n\r\nThis is a fix to https://github.com/cms-sw/cmssw/pull/32076 that introduced a crash in NANOAOD workflows. \r\nFor the record, the crash only happens when running the NANO step alone, but is not visible when both NANO and DQM:@nanoAODDQM steps are run (hence why it wasn't spotted earlier).\r\n\r\nThe fix consists to rearrange the order of some modules.  \r\nIn addition, it was noticed that some booleans were not properly set for MC when recreating the jet PUPPI collection. This is now corrected.\r\n\r\nFinally, the V15 PUPPI was in fact NOT enabled in the previous PR for reNANOAOD since only the run2_miniAOD_UL modifier was considered. This is also corrected. (That last item is not a backport because V15 is run by default in master) \r\n\r\n#### PR validation:\r\n\r\nThe two following commands (used in NANOAOD v8 validation and that previously failed) are now running fine. \r\n\r\n`cmsDriver.py  --python_filename PPD-RunIISummer20UL17NanoAODv2-00001_1_cfg.py --eventcontent NANOEDMAODSIM --customise Configuration/DataProcessing/Utils.addMonitoring --datatier NANOAODSIM --fileout file:PPD-RunIISummer20UL17NanoAODv2-00001.root --conditions 106X_mc2017_realistic_v8 --step NANO --filein \"dbs:/DYJetsToLL_M-50_TuneCP5_13TeV-amcatnloFXFX-pythia8/RunIISummer20UL17MiniAOD-Pilot_106X_mc2017_realistic_v6-v2/MINIAODSIM\" --era Run2_2017,run2_nanoAOD_106Xv1  --mc -n 1000`\r\n\r\n`cmsDriver.py RECO --conditions 106X_dataRun2_v32 --customise Configuration/DataProcessing/Utils.addMonitoring --datatier NANOAOD --era Run2_2017,run2_nanoAOD_106Xv1 --eventcontent NANOEDMAOD --filein /store/data/Run2017F/JetHT/MINIAOD/09Aug2019_UL2017-v1/270000/1B3CEF31-C191-CA4B-A5F1-447647399163.root --fileout \"file:ReReco-Run2017C-JetHT-02Dec2020_UL2017_pilot-00001.root\" --nThreads 2  --number 1000 --python_filename \"ReReco-Run2017C-JetHT-02Dec2020_UL2017_pilot-00001_0_cfg.py\" --scenario pp --step NANO --data `\r\n \r\n\r\n\r\nThe PUPPIMET is indeed different when running this command on 10_6_19 and on 10_6_19_patch1 with this PR added. \r\nIt is identical when the commands above are run without the run2_nanoAOD_106Xv1 modifier. \r\n\r\n\r\n![puppimet_modifier](https://user-images.githubusercontent.com/4995867/100560743-1654eb00-32b7-11eb-9d64-ff9806de0caf.png)\r\n\r\n![puppimet_nomodifier](https://user-images.githubusercontent.com/4995867/100560741-148b2780-32b7-11eb-99bb-e575efe0f7fc.png)\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nBackport of https://github.com/cms-sw/cmssw/pull/32328 \r\n", "branch": "CMSSW_10_6_X", "changed_files": 2, "closed_at": "1606778593", "comments": 20, "commits": 2, "created_at": "1606697645", "deletions": 4, "labels": ["analysis-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved", "urgent", "xpog-approved"], "merge_commit_sha": "39c926a36889fca2318efac1c9727a8691a4788d", "merged_at": "1606778592", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 32329, "release-notes": [], "review_comments": 0, "state": "closed", "title": "PUPPI v15 bug/crash fix for NANOAOD (106X backport) ", "updated_at": "1606778593", "user": "lathomas"}
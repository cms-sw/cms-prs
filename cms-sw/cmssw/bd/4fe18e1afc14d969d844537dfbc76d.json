{"additions": 66, "auther_ref": "l1-ubsan-fix1", "auther_sha": "5fa788a6ee5359c5bf30549909dc83cfb2bbb333", "author": "smuzaffar", "body": "This should fix the UBSAN error like [a]. There are few issues with this code\r\n- It allocates a temp ` ap_uint<12> temp[p2eg::CRYSTAL_IN_ETA + 2][p2eg::CRYSTAL_IN_PHI + 4];` but then assign value to  `temp[CRYSTAL_IN_ETA + 1][CRYSTAL_IN_PHI + 7]`. \r\n- Loop https://github.com/cms-sw/cmssw/blob/master/L1Trigger/L1CaloTrigger/interface/Phase2L1RCT.h#L1267-L1295 only reads values for `seed eta and phi` so I think there is no need to loop over every item\r\n- Same as loop https://github.com/cms-sw/cmssw/blob/master/L1Trigger/L1CaloTrigger/interface/Phase2L1RCT.h#L1342-L1385. \r\n- Todo: Finally we only read temp memory for `seed eta and phi` + some offset. So we do not need to allocate `temp[p2eg::CRYSTAL_IN_ETA + 2][p2eg::CRYSTAL_IN_PHI + 4];` a smaller memory just to hold the values for  `seed eta and phi` + some offset should be enough.\r\n\r\nI am opening this PR but would like @cms-sw/l1-l2  to review this code and may be propose a batter change\r\n\r\n\r\n\r\n[a]  https://cmssdt.cern.ch/SDT/cgi-bin/buildlogs/raw/el8_amd64_gcc12/CMSSW_14_2_UBSAN_X_2024-10-11-2300/pyRelValMatrixLogs/run/23634.0_TTbar_14TeV+2026D95/step2_TTbar_14TeV+2026D95.log\r\n```\r\nsrc/L1Trigger/L1CaloTrigger/interface/Phase2L1RCT.h:1257:24: runtime error: index 25 out of bounds for type 'ap_uint [24]'\r\n    #0 0x14e16aba5450 in p2eg::getBremsValuesNeg(p2eg::crystal (*) [20], ap_uint<5>, ap_uint<5>) src/L1Trigger/L1CaloTrigger/interface/Phase2L1RCT.h:1257\r\n    #1 0x14e16abedbad in p2eg::getClusterFromRegion3x4(p2eg::crystal (*) [20]) src/L1Trigger/L1CaloTrigger/interface/Phase2L1RCT.h:1441\r\n    #2 0x14e16aa9cd7c in Phase2L1CaloEGammaEmulator::produce(edm::Event&, edm::EventSetup const&) src/L1Trigger/L1CaloTrigger/plugins/Phase2L1CaloEGammaEmulator.cc:337\r\n```", "branch": "master", "changed_files": 1, "closed_at": "1729662067", "comments": 15, "commits": 1, "created_at": "1728902395", "deletions": 71, "labels": ["l1-pending", "pending-signatures", "tests-approved", "orp-pending", "upgrade-pending", "code-checks-approved"], "milestone": "CMSSW_14_2_X", "number": 46372, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[UBSAN][L1] Fix read out of bounds issue", "updated_at": "1729662068", "user": "smuzaffar"}
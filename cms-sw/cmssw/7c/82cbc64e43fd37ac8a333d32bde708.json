{"additions": 5, "auther_ref": "proton_reco_fix2", "auther_sha": "18d740cdbb85aa8a606531b7e3b09ad8171dea59", "author": "CTPPS", "body": "#### PR description:\r\n\r\nThis PR fixes two problems observed in rare conditions:\r\n  * Fixed logic condition in ``CTPPSInterpolatedOpticalFunctionsESSource`` - the aim is to check the freshly-obtained xangle value, not the buffered one.\r\n  * In ``CTPPSProtonProducer``, the re-initialisation is triggered with the help of an ESWatcher. With the recently introduced ``!hTracks->empty()`` condition, not all xangle transitions are seen anymore. Using ESWatcher is better anyway - the decision on updating optics-related data is made just on one place.\r\n\r\nThe fix is important for the UL re-reco. We apologise for the late submission.\r\n\r\n#### PR validation:\r\n\r\nComparison on selected datasets, below, shows no difference wrt. the current master: blue = with this PR, red dashed = before this PR.\r\n![make_cmp](https://user-images.githubusercontent.com/17830858/57527944-3c134b80-7331-11e9-98eb-cac0e85fc71b.png)\r\n\r\nThe problems addressed in this PR were discovered in a systematic test applied to (almost) all fills in which PPS Roman Pots participated (2016 to 2018). The problems occurred in about 5 out of 400 tests. After the fix all tests pass successfully. For the record, some of the originally failing input files were copied here:\r\n  * /afs/cern.ch/user/j/jkaspar/public/ctpps/proton_reco_debug/fill5405_xangle140_beta0.30_ZeroBias.root\r\n  * /afs/cern.ch/user/j/jkaspar/public/ctpps/proton_reco_debug/fill6960_xangle130_beta0.30_SingleMuon.root\r\n\r\nThese files are skims from the \"official\" AOD ntuples.\r\n\r\nFinally, AddOnTests were run on LXPLUS, yielding:  46 tests passed, 1 failed. The failing test was running PhysicsTools/PatAlgos/test/IntegrationTest_cfg.py and the failure was due to an XROOT problem.\r\n", "branch": "master", "changed_files": 2, "closed_at": "1557600679", "comments": 14, "commits": 1, "created_at": "1557486259", "deletions": 7, "labels": ["alca-approved", "code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "fb306694fae59f563cea6498f77d0a28837db20f", "merged_at": "1557600679", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 26739, "release-notes": [], "review_comments": 0, "state": "closed", "title": "PPS: bugfix in proton reconstruction.", "updated_at": "1557600679", "user": "jan-kaspar"}
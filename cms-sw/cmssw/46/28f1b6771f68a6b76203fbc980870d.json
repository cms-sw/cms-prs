{"additions": 161, "auther_ref": "mm_improve_HLT_beamspot_45555", "auther_sha": "a390d6b643460a04903e7acc49a4e997495c0c8b", "author": "mmusich", "body": "#### PR description:\r\n\r\nThis is a follow-up to https://github.com/cms-sw/cmssw/issues/45555#issuecomment-2515124788.\r\n\r\n   * a4a0d1685ad4716ef65a472445fd755ea42e7a3d annotates `SequentialPrimaryVertexFitterAdapter::fit` exceptions of the `VertexExcpetion` type according to the suggestions at https://github.com/cms-sw/cmssw/issues/45555#issuecomment-2515124788\r\n   * a390d6b643460a04903e7acc49a4e997495c0c8b contains a generalized clean-up / refactoring of `BeamSpotOnlineProducer` in order to be more modular (and hopefully more easily debuggable).\r\n\r\n#### PR validation:\r\n\r\n`cmssw` compiles. Run an HLT job in normal conditions and didn't observe anomalies.\r\nInducing the type of `VertexException` that is being caught now, I get the following type of log messages:\r\n\r\n```\r\n%MSG-e UnusableBeamSpot:  PrimaryVertexProducer:hltVerticesPF  07-Dec-2024 11:13:50 CET Run: 386614 Event: 48610345\r\nBeamspot with invalid errors [            0           0           0\r\n             0           0           0\r\n             0           0           0 ]\r\n%MSG\r\n----- Begin Fatal Exception 07-Dec-2024 11:13:50 CET-----------------------\r\nAn exception of category 'VertexException' occurred while\r\n   [0] Processing  Event run: 386614 lumi: 55 event: 48610345 stream: 0\r\n   [1] Running path 'MC_AK8PFJetPNet_v4'\r\n   [2] Calling method for module PrimaryVertexProducer/'hltVerticesPF'\r\n   [3] While processing SequentialPrimaryVertexFitterAdapter::fit() with BeamSpot parameters: \r\n-----------------------------------------------------\r\n              Beam Spot Data\r\n\r\n Beam type    = -1\r\n       X0     = 0 +/- 0 [cm]\r\n       Y0     = 0 +/- 0 [cm]\r\n       Z0     = 0 +/- 0 [cm]\r\n Sigma Z0     = 0 +/- 0 [cm]\r\n dxdz         = 0 +/- 0 [radians]\r\n dydz         = 0 +/- 0 [radians]\r\n Beam width X = 0 +/- 0 [cm]\r\n Beam width Y = 0 +/- 0 [cm]\r\n EmittanceX   = 0 [cm]\r\n EmittanceY   = 0 [cm]\r\n beta-star    = 0 [cm]\r\n-----------------------------------------------------\r\n\r\n\r\nException Message:\r\nBasicSingleVertexState::could not invert error matrix \r\n```\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nN/A", "branch": "master", "changed_files": 2, "comments": 4, "commits": 2, "created_at": "1733564770", "deletions": 131, "labels": ["reconstruction-pending", "alca-pending", "pending-signatures", "orp-pending", "tests-started", "code-checks-approved", "tracking"], "milestone": "CMSSW_15_0_X", "number": 46893, "release-notes": [], "review_comments": 1, "state": "open", "title": "Improve messages due `VertexException` in `SequentialPrimaryVertexFitterAdapter` and clean-up of `BeamSpotOnlineProducer`", "updated_at": "1733648625", "user": "mmusich"}
{"additions": 372, "auther_ref": "premixModifier", "auther_sha": "225f34c959e20403e65410879dd7364d18f6bb1e", "author": "makortel", "body": "Currently premixing customizations are implemented as separate files that import or copy from the standard ones, and get used in the configurations according to the cmsDriver parameters. This PR replaces the customizations in stage1 fully, and in stage2 partially, with \"process modifier\". This is a preparatory step for phase2 premixing developments (making phase2 customizations a bit easier to do). This PR also addresses #21704.\r\n\r\nIn a bit more detail this PR\r\n* adds modifiers `premix_stage1` and `premix_stage2`\r\n   * `--procModifiers` parameter is added to all premixing workflows\r\n* removes `DIGIPREMIX` and `DIGIPREMIX_S2` steps from cmsDriver (both can be now just `DIGI`)\r\n* migrates (i.e. removes) configuration files\r\n   * stage1: `Digi_Premix_cff`, `DigiToRawPremixing_cff`, `SimL1EmulatorPremix_cff`, `digi_noNoise_cfi` and \"`DIGIPREMIX` terrible hacks\"\r\n   * stage2: `digi_MixPreMix_cfi`, `DigiDMPremix_cff`\r\n\r\nWhat remains for stage2 is at least `DataMixerPreMix_cff`. It wasn't clear to me whether moving the customizations to the default `DataMixerDataOnSim_cff` would actually be an improvement, so I decided to leave that for a later exercise (and then one would have to think the relationship of `--procModifiers premix_stage2` and `--datamix` cmsDriver parameters).\r\n\r\nThe idea has been discussed in #21704 and in simulation meeting on Feb 6th.\r\nhttps://indico.cern.ch/event/702324/contributions/2885358/attachments/1596021/2527902/slides_mk_simulation_20180206.pdf\r\n\r\nAs a sidestep, in order to avoid adding `isChosen()` calls, the `Modifier` boolean expressions are extended with \"not\" (`~`)  and \"or\" (`|`). For completeness added support for `toReplaceWith()` to the resulting `Modifier` of the boolean expressions.\r\n\r\nTested in CMSSW_10_1_X_2018-02-11-2300, no changes expected in results. I've tested with workflows 250199.{0,17,18} and 250202.{0,17,18} (such that the 250202.X use premixing library from 250202.X as an input) that the DQM histograms agree, and that the configuration dumps (from both stage1 and stage2) do not contain essential differences (there are many changes visible not affecting any functionality because the \"customization point\" is moved earlier in the chain of cloning of PSets).\r\n\r\n@mdhildreth @kpedro88 ", "branch": "master", "changed_files": 38, "closed_at": "1519653826", "comments": 47, "commits": 17, "created_at": "1518599144", "deletions": 313, "labels": ["code-checks-approved", "comparison-available", "core-approved", "daq-approved", "fastsim-approved", "fully-signed", "l1-approved", "operations-approved", "orp-approved", "pdmv-approved", "reconstruction-approved", "simulation-approved", "tests-rejected", "upgrade-approved"], "merge_commit_sha": "4fb710b7ca54b508f95f9202cd4f89cf9feeb14d", "merged_at": "1519653826", "merged_by": "cmsbuild", "milestone": "CMSSW_10_1_X", "number": 22210, "release-notes": [], "review_comments": 7, "state": "closed", "title": "Customize premixing stage1 and parts of stage2 with modifiers, and extend Modifier boolean expressions to include \"not\" and \"or\"", "updated_at": "1519653826", "user": "makortel"}
{"additions": 364, "auther_ref": "esconsumesMultipleScattering", "auther_sha": "fa1e4e0f0de57c9d4afda51e577d47a2c19d4c7f", "author": "makortel", "body": "#### PR description:\r\n\r\nThis PR is part of https://github.com/cms-sw/cmssw/issues/31061 and focuses on the `MultipleScatteringParametrisation` helper. That class relied an old hack to cache EventSetup data\r\nhttps://github.com/cms-sw/cmssw/blob/919a7477d148ff35ff5d5174e117d27227c87284/RecoTracker/TkMSParametrization/src/MultipleScatteringParametrisation.cc#L45-L49\r\nthat this PR suggests to finally fix properly by moving the `MSLayersKeeperX0DetLayer`, `MSLayersKeeperX0AtEta`, and `MSLayersKeeperX0Averaged` from thread-locals into EventSetup itself. In the EventSetup they are abstracted into `MultipleScatteringParametrisationMaker` class that is then used to make `MultipleScatteringParametrisation` objects. The corresponding ESProducer is added into the `customizeHLTforCMSSW.py` and in various cff fragments within reconstruction configuration (I can't exclude missing some places).\r\n\r\nThis PR also completes the esConsumes migration for touched helper classes where that was feasible.\r\n\r\nAs in https://github.com/cms-sw/cmssw/pull/35081, despite of being part of #31061 this PR adds some new calls to the deprecated `EventSetupRecord::get()` function without `esConsumes()`. All these cases have some relation to `TrackingRegion` classes, and will be addressed in a subsequent PR (I have the work done already, but I though they would be easier to review separately).\r\n\r\nResolves https://github.com/makortel/framework/issues/251\r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nTested on earlier IB (on top of https://github.com/cms-sw/cmssw/pull/35081) that limited matrix runs. After rebase checked that the code compiles.", "branch": "master", "changed_files": 54, "comments": 2, "commits": 2, "created_at": "1631627631", "deletions": 231, "labels": ["reconstruction-pending", "hlt-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_12_1_X", "number": 35269, "release-notes": [], "review_comments": 0, "state": "open", "title": "Move MSLayerKeeper* objects from thread-local into EventSetup", "updated_at": "1631628085", "user": "makortel"}
{"additions": 814, "auther_ref": "dev-106X-ConcurrentHadronizerFilter", "auther_sha": "26392cb19c579ab79b142ced227e58d2bfa32326", "author": "colizz", "body": "#### PR description:\r\n\r\n**This PR is a backport of #28913 by @Dr15Jones and #28879 by @wddgit.**\r\nThe former introduces a thread-safe method `ConcurrentHadronizerFilter` which runs the hadronizer concurrently. The latter implements the base method `cloneEngine` as the support of `ConcurrentHadronizerFilter`.\r\nWith the use of `ConcurrentHadronizerFilter` in GEN step and MadGraph multithreading support (#30030) in LHE step, the overall CPU efficiency and runtime is significantly improved, which may benefit future UL production. More detailed explanation and validation can be found in [**these slides**](https://indico.cern.ch/event/894534/contributions/3827059/attachments/2031408/3400041/20.05.04_GEN_Multi-thread_support_for_MadGraph.pdf).\r\n\r\n#### PR validation:\r\n\r\nThis PR is validated on multiple datasets, by replacing `Pythia8HadronizerFilter` with `Pythia8ConcurrentHadronizerFilter` in the GEN step configuration.\r\nBelow is a quick test on [`SMP-RunIISummer19UL17wmLHEGEN-00001`](https://cms-pdmv.cern.ch/mcm/requests?prepid=SMP-RunIISummer19UL17wmLHEGEN-00001&page=0&shown=127).\r\n```shell\r\ncmsrel CMSSW_10_6_X_2020-05-25-2300\r\ncd CMSSW_10_6_X_2020-05-25-2300/src/\r\ncmsenv\r\ngit cms-merge-topic colizz:dev-106X-ConcurrentHadronizerFilter\r\ncurl -s --insecure https://cms-pdmv.cern.ch/mcm/public/restapi/requests/get_fragment/SMP-RunIISummer19UL17wmLHEGEN-00001 --retry 2 --create-dirs -o Configuration/GenProduction/python/SMP-RunIISummer19UL17wmLHEGEN-00001-fragment.py\r\nscram b -j 8\r\ncd ../..\r\ncmsDriver.py Configuration/GenProduction/python/SMP-RunIISummer19UL17wmLHEGEN-00001-fragment.py --fileout file:SMP-RunIISummer19UL17wmLHEGEN-00001.root --mc --eventcontent RAWSIM,LHE --datatier GEN,LHE --conditions 106X_mc2017_realistic_v6 --beamspot Realistic25ns13TeVEarly2017Collision --step LHE,GEN --geometry DB:Extended --era Run2_2017 --python_filename SMP-RunIISummer19UL17wmLHEGEN-00001_1_cfg.py --no_exec --customise Configuration/DataProcessing/Utils.addMonitoring --customise_commands process.source.numberEventsInLuminosityBlock=\"cms.untracked.uint32(2222)\" -n 400 --nThreads 4\r\n\r\nsed -i \"s/Pythia8HadronizerFilter/Pythia8ConcurrentHadronizerFilter/g\" SMP-RunIISummer19UL17wmLHEGEN-00001_1_cfg.py\r\ncmsRun -e -j SMP-RunIISummer19UL17wmLHEGEN-00001_rt.xml SMP-RunIISummer19UL17wmLHEGEN-00001_1_cfg.py\r\n```", "branch": "CMSSW_10_6_X", "changed_files": 9, "closed_at": "1590988180", "comments": 12, "commits": 2, "created_at": "1590789410", "deletions": 4, "labels": ["comparison-available", "core-approved", "fully-signed", "generators-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "4264f0ce766c309a1c3b4473a2b68cde6329e183", "merged_at": "1590988179", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 30053, "release-notes": [], "review_comments": 0, "state": "closed", "title": "ConcurrentHadronizerFilter (106X)", "updated_at": "1590988180", "user": "colizz"}
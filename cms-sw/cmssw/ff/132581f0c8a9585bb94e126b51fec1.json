{"additions": 4, "auther_ref": "from-CMSSW_7_6_0_pre5", "auther_sha": "5a75f346fc85925fa1e4865f0d7054261cc2c69e", "author": "blinkseb", "body": "Hello,\n\nThis PR fixes a crash I experienced when running on CMSSW 7.4.12 patch4. I manually create a new slimmedMETs using the following code snippet:\n\n``` python\nfrom JMEAnalysis.JetToolbox.jetToolbox_cff import jetToolbox\njetToolbox(process, 'ak4', 'ak4CHSJetSequence', 'out', PUMethod='CHS', runOnMC=not isData, miniAOD=True, addPUJetID=False)\n\nfrom PhysicsTools.PatAlgos.tools.metTools import addMETCollection\nprocess.load('RecoMET.METProducers.PFMET_cfi')\n\nprocess.pfMet.src = cms.InputTag('packedPFCandidates')\naddMETCollection(process, labelName='patPFMet', metSource='pfMet')\n\n\nprocess.load('JetMETCorrections.Configuration.JetCorrectors_cff')\nfrom JetMETCorrections.Type1MET.correctionTermsPfMetType1Type2_cff import corrPfMetType1\nfrom JetMETCorrections.Type1MET.correctedMet_cff import pfMetT1\n\nprocess.corrPfMetType1 = corrPfMetType1.clone(\n        src = 'ak4PFJetsCHS',\n        jetCorrLabel = 'ak4PFCHSL1FastL2L3Corrector' if not isData else 'ak4PFCHSL1FastL2L3ResidualCorrector',\n        offsetCorrLabel = 'ak4PFCHSL1FastjetCorrector'\n    )\n    process.pfMetT1 = pfMetT1.clone(\n        src = 'pfMet',\n        srcCorrections = [cms.InputTag(\"corrPfMetType1\", \"type1\")]\n    )\n\naddMETCollection(process, labelName='patMET', metSource='pfMetT1') # T1 MET\n\nfrom PhysicsTools.PatAlgos.slimming.slimmedMETs_cfi import slimmedMETs\ndel slimmedMETs.caloMET\n\nprocess.slimmedMETs = slimmedMETs.clone()\n\nprocess.slimmedMETs.src = cms.InputTag(\"patMET\")\nprocess.slimmedMETs.rawVariation = cms.InputTag(\"patPFMet\")\n```\n\nI explicitly do not want T1 uncertainties, I'm only interested in T1 met + Raw met.\n\nWhen trying to access `pat::MET::uncorPt()` the code crash inside the `pat::MET::findMETTotalShift`.\n\nThis is because in this particular case, the `uncertainties_` array is empty, because, since there's no Type1 uncertainties, the function `setUncShift` is never called by `PATMETSlimmer`.\n\n~~This PR fixes both issues: first, it ensure that if `uncertainties_` is empty, the code no longer crashed. Second, it fixes `PATMETSlimmer` by making sure `setUncShift` is called not matter the type of uncertainties.~~\n\nThis PR changes `pat::MET::findMETTotalShift` to prevent the crash by checking if `uncertainties_` is empty.\n\nIf merged, it'll need to be backport to 7.5 and 7.4.\n\nThanks\n", "branch": "CMSSW_7_6_X", "changed_files": 1, "closed_at": "1443954227", "comments": 13, "commits": 1, "created_at": "1442827855", "deletions": 0, "labels": ["analysis-pending", "comparison-available", "orp-pending", "pending-signatures", "tests-approved"], "merge_commit_sha": "0e3b3173c92b7e2beef4a71a6eb8d27d1156b939", "merged_at": "1443954227", "merged_by": "davidlange6", "milestone": "CMSSW_7_6_X", "number": 11394, "release-notes": [], "review_comments": 4, "state": "closed", "title": "Fix crash in pat::MET when no Type-I uncertainties are added", "updated_at": "1443954228", "user": "blinkseb"}
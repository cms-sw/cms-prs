{"additions": 19, "auther_ref": "devel_hltL1REPACK", "auther_sha": "c1ef30cc0249fe69e865bd4f2e311459840657e8", "author": "missirol", "body": "#### PR description:\r\n\r\nThis PR is an attempt to make one of the customisations used by HLT a bit more robust against changes in L1T configurations.\r\nI haven't tested this extensively, and I welcome feedback (@Martin-Grunewald , @silviodonato , @Sam-Harper , @fwyzard).\r\n\r\nThe function in question is `L1REPACK`, and it is used to re-rerun the L1-Trigger emulation together with the HLT reconstruction.\r\n\r\nDue to how the L1-Trigger sequences are configured, `L1REPACK` presently loads in the `process` several objects (modules, sequences, tasks) which are not needed in Run-3 configs (e.g. Phase-2 modules), and then removes them a posteriori based on a list of hard-coded names. Under certain conditions, this can lead to invalid configs, as recently reported by a user.\r\n\r\nThe update here tries to make the removal a bit more robust, adding to the `process` only the objects that are used by the sequence `SimL1Emulator` (which, I think, is all HLT ultimately uses).\r\n\r\nStill, I ended up keeping the list of \"manual removals\" due to one L1T `ESProducer`. Hopefully, this can be improved in the future.\r\n\r\n#### PR validation:\r\n\r\nValidated with the following test:\r\n```bash\r\nhltGetConfiguration /dev/CMSSW_12_2_0/GRun --globaltag auto:run3_hlt  --data --unprescale \\\r\n --input /store/data/Run2018D/EphemeralHLTPhysics1/RAW/v1/000/323/775/00000/2E066536-5CF2-B340-A73B-209640F29FF6.root \\\r\n --customise HLTrigger/Configuration/customizeHLTforCMSSW.customiseFor2018Input --l1-emulator uGT > hlt.py\r\n(edmConfigDump hlt.py | grep -v 'L1T WARN: ') > hlt_dump.py\r\n(edmConfigDump --prune hlt.py | grep -v 'L1T WARN: ') > hlt_dump_pruned.py\r\n```\r\n * `hlt.py` works both before and after the PR\r\n * `python3 hlt_dump.py` does not work without the PR; after the PR, `cmsRun hlt_dump.py` works, and `hlt_dump.py` does not contain unnecessary L1T modules/sequences/tasks (e.g. L1T Phase-2 objects)\r\n * `hlt_dump_pruned.py` (the final pruned version of the full configuration) is unchanged by this PR (modulo one module which is kept on a `Task` instead being put directly on a Path, b/c `L1REPACK` deletes that particular Task manually without the PR)\r\n\r\n*Note* : the `grep` bit is an hack to avoid 2 printouts from L1T that make their way into the stdout of `edmConfigDump`.\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR:\r\n\r\nN/A", "branch": "master", "changed_files": 1, "closed_at": "1637747332", "comments": 13, "commits": 1, "created_at": "1637258385", "deletions": 48, "labels": ["hlt-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "5dc818a8f487697b1ab18a92aabf0f6ec6fa005c", "merged_at": "1637747332", "merged_by": "cmsbuild", "milestone": "CMSSW_12_2_X", "number": 36173, "release-notes": [], "review_comments": 0, "state": "closed", "title": "improve robustness of a HLT customisation used for L1T re-emulation", "updated_at": "1637747332", "user": "missirol"}
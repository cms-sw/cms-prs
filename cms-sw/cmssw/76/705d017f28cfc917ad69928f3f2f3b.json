{"additions": 25, "auther_ref": "reuse_produce_queue_in_transform", "auther_sha": "8e9b3929924d071d85a17453e4996dcb9198445d", "author": "fwyzard", "body": "#### PR description:\r\n\r\nModify the \"transform\" that the framework uses to automatically copy device products to the host to reuse the same device queue associated with the product, instead of an independent one.\r\n\r\nThis make the host copy use the same queue as any potential module that consumes the device product, slightly reducing the potential parallelism. On the other hand it cuts the number of device queues by about 30%, potentially improving the performance of the GPU runtime:\r\n\r\n  * on an AMD MI300X GPU with a \"reduced\" HLT menu running with 16 threads and 16 streams, this gives a speed-up of over 10%.\r\n\r\n  * on an NVIDIA L40S GPU with the same \"reduced\" HLT menu running with 32 threads and 32 streams, the changes do not have any measurable impact (maybe a speed-up of 0.1~0.2%, well within the error).\r\n\r\n  * on an NVIDIA L40S GPU with the same \"reduced\" HLT menu running with 2 jobs, each with 16 threads and 16 streams, there is a small but measurable speed-up: from `909.4  1.5 ev/s` to `913.9  0.6 ev/s`.\r\n\r\n  * on an NVIDIA L40S GPU with the _full_ HLT menu running with 2 jobs, each with 16 threads and 16 streams, there is no impact on the performance.\r\n\r\n  * with a realistic HLT menu, that tests on the timing server with NVIDIA T4 GPUs without and with this PR did not show any differences in performance.\r\n\r\n\r\n#### PR validation:\r\n\r\nCode builds, a reduced HLT menu runs correctly, with a speed-up of about 10% observed on an AMD MI300X GPU.", "branch": "master", "changed_files": 4, "comments": 18, "commits": 2, "created_at": "1764834765", "deletions": 9, "labels": ["pending-signatures", "tests-approved", "orp-pending", "code-checks-approved", "heterogeneous-pending"], "milestone": "CMSSW_16_0_X", "number": 49545, "release-notes": [], "review_comments": 9, "state": "open", "title": "Reuse the device queue from produce in transform", "updated_at": "1765554339", "user": "fwyzard"}
{"additions": 190, "auther_ref": "12_5_X-streamer-prebuffering", "auther_sha": "d6ea8aab85309c63f5c030442fb4cc281600eab9", "author": "smorovic", "body": "#### PR description:\r\n\r\nAdds a preallocated buffer intended to avoid many small reads when reading streamer files. This is aimed at improving EOS reading performance (see https://github.com/cms-sw/cmssw/issues/38997).\r\nA pointer to the big buffer is passed if possible for reading header and even payloads (contiguous), otherwise data is copied to  the intermediate header or event buffer.\r\n\r\nNew parameter enables and configures size of the large buffer in MBytes (0 to disable), for example:\r\n```\r\nprocess.source = cms.Source(\"NewEventStreamFileReader\",\r\n    prefetchMBytes = cms.untracked.uint32(100),\r\n```\r\n\r\n#### PR validation:\r\n\r\nA new unit test in `IOPool/Streamer` specifically checks behavior with this parameter (1 MB with small generated events). A file larger than the buffer was created to test behavior at the buffer boundary.\r\nInternally, source checks adler32 checksum of both the header and event payload (compared to a header field), so corruption of payloads would be caught by unit tests.\r\n\r\n\r\nStreamer source in `CalibCalorimetry/EcalLaserSorting` uses this code and has a respective unit test in that location.\r\nSimilarly, DQM streamer input source is tested as part of DAQ I/O chain in `EventFilter/Utilities` unit test.", "branch": "master", "changed_files": 8, "closed_at": "1661189902", "comments": 31, "commits": 12, "created_at": "1660717783", "deletions": 41, "labels": ["core-approved", "fully-signed", "tests-approved", "orp-approved", "urgent", "code-checks-approved"], "merge_commit_sha": "0c04ca4982d250097f685bffe480187b2dd2444f", "merged_at": "1661189902", "merged_by": "cmsbuild", "milestone": "CMSSW_12_5_X", "number": 39088, "release-notes": [], "review_comments": 17, "state": "closed", "title": "Streamer input source prefetching (12_5_X)", "updated_at": "1661189902", "user": "smorovic"}
{"additions": 74, "auther_ref": "devel_dqmIntegOptDataFNPos", "auther_sha": "5db75984e66663f931fe970c3c2b8776abc7c405", "author": "missirol", "body": "#### PR description:\r\n\r\nThis PR allows to set the parameter `datafnPosition` from the command line when running the online-DQM clients, e.g.\r\n```bash\r\ncmsRun \"${CMSSW_BASE}\"/src/DQM/Integration/python/clients/hlt_dqm_clientPB-live_cfg.py \\\r\n  runInputDir=. runNumber=361468 runkey=pp_run scanOnce=True \\\r\n  datafnPosition=4\r\n```\r\nThis can be useful when testing the clients locally on inputs whose format differs (slightly) from the one used online.\r\n\r\n(For outputs produced in `dat` format for a given stream and LS (for example, by the `GlobalEvFOutputModule` plugin), there is a JSON file which contains a dictionary with a list-of-strings named \"data\". `datafnPosition` (data file name position) corresponds to the index of this list where the name of the `dat` file is; its default value is `3`.)\r\n\r\nIn practise, this PR takes the command-line argument already defined in\r\nhttps://github.com/cms-sw/cmssw/blob/321bee86659704bf8b36f6c772f6d5ff78064740/DQMServices/StreamerIO/python/DQMProtobufReader_cff.py#L12\r\nhttps://github.com/cms-sw/cmssw/blob/321bee86659704bf8b36f6c772f6d5ff78064740/DQMServices/StreamerIO/python/DQMStreamerReader_cff.py#L12\r\nand adds it to the following `cfi` files\r\n```\r\nDQM/Integration/python/config/inputsource_cfi.py\r\nDQM/Integration/python/config/pbsource_cfi.py\r\nDQM/Integration/python/config/unitteststreamerinputsource_cfi.py\r\n```\r\n\r\nFor completeness, the parameter `loadFiles` is also made configurable in `DQMProtobufReader_cff`. Minor code-formatting changes are included as well.\r\n\r\nMerely technical. No changes expected. (This PR just adds a new functionality not used anywhere in CMSSW.)\r\n\r\n#### PR validation:\r\n\r\nThe following test produces a ROOT file with the expected histograms only if `datafnPosition=4` is specified (using this PR, obviously).\r\n```sh\r\n#!/bin/bash -ex\r\n\r\nINPUTFILE=root://eoscms.cern.ch//eos/cms/store/group/dpg_trigger/comm_trigger/TriggerStudiesGroup/STORM/RAW/Run2022F_EphemeralHLTPhysics0_run361468/26ce1488-8c46-436b-becd-6b41535dda79.root\r\n\r\nHLTMENU=/users/missirol/test/dev/CMSSW_13_0_0/tmp/test01/cmssw40334/HLT/V3\r\n\r\nrm -rf run361468* upload\r\nconvertToRaw -f 100 -l 100 -r 361468:172 -o . -- \"${INPUTFILE}\"\r\n\r\ntmpfile=$(mktemp)\r\nhltConfigFromDB --dbproxy --configName \"${HLTMENU}\" > \"${tmpfile}\"\r\ncat <<@EOF >> \"${tmpfile}\"\r\nprocess.load('run361468_cff')\r\nprocess.hltOnlineBeamSpotESProducer.timeThreshold = int(1e6)\r\n@EOF\r\nedmConfigDump \"${tmpfile}\" > hlt.py\r\n\r\ncmsRun hlt.py &> hlt.log\r\n\r\ncmsRun \"${CMSSW_BASE}\"/src/DQM/Integration/python/clients/hlt_dqm_clientPB-live_cfg.py \\\r\n  runInputDir=. runNumber=361468 runkey=pp_run scanOnce=True \\\r\n  datafnPosition=4\r\n```\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR. If this PR will be backported, please specify to which release cycle the backport is meant for:\r\n\r\nN/A", "branch": "master", "changed_files": 6, "comments": 5, "commits": 1, "created_at": "1672736321", "deletions": 56, "labels": ["dqm-pending", "pending-signatures", "orp-pending", "tests-started", "code-checks-approved"], "milestone": "CMSSW_13_0_X", "number": 40418, "release-notes": [], "review_comments": 0, "state": "open", "title": "make `datafnPosition` parameter configurable in online-DQM clients", "updated_at": "1672757851", "user": "missirol"}
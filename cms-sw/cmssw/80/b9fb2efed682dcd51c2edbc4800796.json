{"additions": 171, "auther_ref": "FillProcessHistoryIDMapAtRegistration", "auther_sha": "cc5726f06f205a3b460fbd8210eebf53ac2e98d6", "author": "ktf", "body": "This is a merge of #598 by Bill. The only change was to rebase on top of CMSSW_7_0_X and then change `Selections` to `SelectedProducts` as Chris did. Find below the result of:\n\n`diff -Naur =(git show cms-sw/refs/pull/598/head) =(git show HEAD)`\n\n```\n--- /tmp/zshL4mFUZ      2013-08-27 23:35:30.000000000 +0200\n+++ /tmp/zshUwMkgU      2013-08-27 23:35:30.000000000 +0200\n@@ -1,4 +1,4 @@\n-commit 34485e93d5e3524bb155d9697d1f300c0a7b968b\n+commit cc5726f06f205a3b460fbd8210eebf53ac2e98d6\n Author: wmtan <wmtan@fnal.gov>\n Date:   Fri Aug 23 17:38:11 2013 +0200\n\n@@ -604,10 +604,10 @@\n            << \"The process name \" << processName << \" was already in the ProcessHistory.\\n\"\n            << \"Please modify the configuration file to use a distinct process name.\\n\";\n diff --git a/FWCore/Framework/src/InputSource.cc b/FWCore/Framework/src/InputSource.cc\n-index d32c40d..ce3157d 100644\n+index e2efbb3..0f61fe1 100644\n --- a/FWCore/Framework/src/InputSource.cc\n +++ b/FWCore/Framework/src/InputSource.cc\n-@@ -604,7 +604,7 @@ namespace edm {\n+@@ -601,7 +601,7 @@ namespace edm {\n    InputSource::reducedProcessHistoryID() const {\n      assert(runAuxiliary());\n      //THREADUNSAFE this is modifying global state\n@@ -657,10 +657,10 @@\n            << \"PrincipalCache::insert\\n\"\n            << \"Illegal attempt to insert lumi into cache\\n\"\n diff --git a/FWCore/Framework/src/SubProcess.cc b/FWCore/Framework/src/SubProcess.cc\n-index 5de5572..5adab1d 100644\n+index 0773add..c309401 100644\n --- a/FWCore/Framework/src/SubProcess.cc\n +++ b/FWCore/Framework/src/SubProcess.cc\n-@@ -309,9 +309,9 @@ namespace edm {\n+@@ -310,9 +310,9 @@ namespace edm {\n      rpp->fillRunPrincipal(principal.reader());\n      principalCache_.insert(rpp);\n\n@@ -673,11 +673,11 @@\n\n      parentToChildPhID_.insert(std::make_pair(parentInputReducedPHID,inputReducedPHID));\n\n-@@ -471,12 +471,12 @@ namespace edm {\n+@@ -470,12 +470,12 @@ namespace edm {\n    void\n    SubProcess::propagateProducts(BranchType type, Principal const& parentPrincipal, Principal& principal) const {\n-     Selections const& keptVector = keptProducts()[type];\n--    for(Selections::const_iterator it = keptVector.begin(), itEnd = keptVector.end(); it != itEnd; ++it) {\n+     SelectedProducts const& keptVector = keptProducts()[type];\n+-    for(SelectedProducts::const_iterator it = keptVector.begin(), itEnd = keptVector.end(); it != itEnd; ++it) {\n -      ProductHolderBase const* parentProductHolder = parentPrincipal.getProductHolder((*it)->branchID(), false, false, nullptr);\n -      if(parentProductHolder != 0) {\n +    for(auto const& item : keptVector) {\n@@ -855,7 +855,7 @@\n\n      ++indexIntoFileIter_;\n diff --git a/IOPool/Output/src/RootOutputFile.cc b/IOPool/Output/src/RootOutputFile.cc\n-index a25500c..b183cad 100644\n+index 57e754b..ae309ad 100644\n --- a/IOPool/Output/src/RootOutputFile.cc\n +++ b/IOPool/Output/src/RootOutputFile.cc\n @@ -409,7 +409,7 @@ namespace edm {\n```\n", "branch": "CMSSW_7_0_X", "changed_files": 24, "closed_at": "1377662079", "comments": 5, "commits": 1, "created_at": "1377632360", "deletions": 215, "labels": ["core-pending", "dqm-pending", "generators-pending", "pending-signatures"], "merge_commit_sha": "89375e68bdb2d7449173cfda605f9db998e33b19", "merged_at": "1377662079", "merged_by": "ktf", "milestone": "CMSSW_7_0_0_pre4", "number": 640, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Add process history map entry immediately on registration", "updated_at": "1403897155", "user": "ktf"}
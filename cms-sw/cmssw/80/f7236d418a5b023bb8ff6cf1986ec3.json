{"additions": 394, "auther_ref": "devel_fix40615", "auther_sha": "b1cfdff507700f43205b34059498dd81aab6198f", "author": "missirol", "body": "#### PR description:\r\n\r\nThis PR addresses the issue reported in #40615.\r\n\r\nA check is added to ensure that there is no de-referencing of `Ref`s that are null or pointing to unavailable products.\r\n\r\nIn addition, the PR includes an attempt to (1) modernise the plugin (e.g. minimise boilerplate code, improve `const` correctness where possible), (2) remove unused parameters from the PSet of some of the template instantiations (specifically, the ones used for Phase 2), and (3) add some optimisations (e.g. use Delta-R^2 instead of Delta-R).\r\n\r\nThese changes are meant to be purely technical (no changes to the logic of the filter). The review will clarify if changes in logic should be considered as well.\r\n\r\nThese changes add more checks on certain objects, so it might be good to check the effect on HLT timing.\r\n\r\n#### PR validation:\r\n\r\nThe problematic use case detailed in https://github.com/cms-sw/cmssw/issues/40615#issuecomment-1406750107 does not lead to a crash with this PR (checked with 300 events).\r\n\r\nThe test in [1] was used to compare the results of HLT filters (and the corresponding `TriggerObject`s) pre- and post-PR. No differences were seen.\r\n\r\n[1]\r\n```bash\r\n#!/bin/bash\r\n\r\nhltGetConfiguration /dev/CMSSW_12_6_0/GRun \\\r\n  --mc --globaltag auto:phase1_2022_realistic_postEE \\\r\n  --unprescale --output minimal --max-events 100 \\\r\n  --eras Run3 --l1-emulator FullMC --l1 L1Menu_Collisions2022_v1_4_0-d1_xml \\\r\n  --input /store/mc/Run3Summer22EEDR/TT_TuneCP5_13p6TeV_powheg-pythia8/GEN-SIM-RAW/Poisson70KeepRAW_124X_mcRun3_2022_realistic_postEE_v1-v3/2820000/39f9c60e-b12b-44c8-b266-6eb7aa9bc28d.root \\\r\n  > hlt.py\r\n\r\ncat <<@EOF >> hlt.py\r\nprocess.options.numberOfThreads = 1\r\nprocess.options.numberOfStreams = 0\r\n@EOF\r\n\r\ncmsRun hlt.py &> hlt.log\r\n```\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR. If this PR will be backported, please specify to which release cycle the backport is meant for:\r\n\r\nN/A", "branch": "master", "changed_files": 4, "comments": 2, "commits": 1, "created_at": "1675178474", "deletions": 439, "labels": ["hlt-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_13_0_X", "number": 40648, "release-notes": [], "review_comments": 1, "state": "open", "title": "fix to `HLTDoubletDZ` filter against invalid track refs", "updated_at": "1675178851", "user": "missirol"}
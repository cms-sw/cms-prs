{"additions": 1227, "auther_ref": "TrackerSubDetToTrackerTopology_SiStripSubstructure", "auther_sha": "2c837e099524b94a112bf1bdb6763178c0ea7856", "author": "pieterdavid", "body": "This pull request migrates SiStripSubstructure and the classes that use it (most notably: TkDetMap, and through that TkHistoMap) away from the specific strip tracker DetId classes (TIBDetId etc.), see https://twiki.cern.ch/twiki/bin/viewauth/CMS/SiStripLocalReco_notesSiStripSubDetIdToTrackerTopologyMigration for more context.\r\n\r\nSummary of the changes:\r\n- changed `SiStripSubStructure` from a class without data members to a namespace with methods (that also take a `const TrackerTopology*` argument)\r\n- changed `TkDetMap` into an EventSetup product (it only needs a `TrackerTopology` from the EventSetup, so I put it into the `TrackerTopologyRcd`, following the advice in https://twiki.cern.ch/twiki/bin/view/CMSPublic/SWGuideEDMESWhichRecord#Data_built_from_data_in_one_Reco, but it also uses the `SiStripDetInfoFileReader` service to get the list of active detectors, so this may not be the ultimate solution, e.g. if this is migrated to the EventSetup as well at some point). I also updated the interface a bit (passing arguments by value for small types, const reference for big types, and non-const reference only if necessary for caching).\r\n- take a `const TkDetMap*` argument in the `TkHistoMap` constructor, instead of loading it as a service (since I was going through all constructors, I also updated `TkHistoMap*` members to `std::unique_ptr<TkHistoMap>` for some plugins)\r\n- adapted the configs that used to load the `TkDetMap` service. For those where the geometry is loaded from the global tag, this is straightforward, but there are some test/calibration/standalone cases where this is not done, so I added a few more lines there - I tried to run them to verify that they do not fail before getting the `TkDetMap` (changing global tags, config errors and input files for the outdated ones if necessary), but that is not a complete test, so please verify that everything is fine in case I edited a config file that is used in some workflow (I did not spot problems with `runTheMatrix.py -l limited -i all`, but that may leave some things uncovered).\r\n\r\nCC @OlivierBondu @alesaggio @vidalm \r\nTracked at https://github.com/cms-sw/cmssw/issues/19398", "branch": "master", "changed_files": 122, "closed_at": "1511956351", "comments": 35, "commits": 12, "created_at": "1511277522", "deletions": 1563, "labels": ["alca-approved", "analysis-pending", "code-checks-approved", "comparison-available", "dqm-pending", "hlt-approved", "orp-approved", "pending-signatures", "reconstruction-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "e775c2b6b822417a83d14d30a545fc5628003c15", "merged_at": "1511956351", "merged_by": "cmsbuild", "milestone": "CMSSW_10_0_X", "number": 21421, "release-notes": [], "review_comments": 3, "state": "closed", "title": "Migrate SiStripSubStructure (and TkDetMap, TkHistoMap) from tracker-sub-DetId to TrackerTopology", "updated_at": "1511956351", "user": "pieterdavid"}
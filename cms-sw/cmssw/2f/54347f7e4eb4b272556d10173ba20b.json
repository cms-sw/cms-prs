{"additions": 51, "auther_ref": "150X_noLumiECALdqmBugFix", "auther_sha": "2764a0ee783648a87ee96e4f1cbb3c4cf46ab8a0", "author": "kyungminparkdrums", "body": "#### PR description:\r\n\r\nThis PR fixes a bug from ECAL DQM ME formatter when a run has no luminosity block. For more details, see this thread: https://github.com/cms-sw/cmssw/issues/38976#issuecomment-2327757921\r\n\r\n#### PR validation:\r\n\r\nPR is validated by running test via `scram b runtests_testEcalCommon`, after adding the following files under `DQM/EcalCommon/test/` directory, following the recipe in the thread from: https://github.com/cms-sw/cmssw/issues/38976#issuecomment-2327757921\r\n\r\n```\r\ndiff --git a/DQM/EcalCommon/test/BuildFile.xml b/DQM/EcalCommon/test/BuildFile.xml\r\nnew file mode 100644\r\nindex 00000000000..67518e7f759\r\n--- /dev/null\r\n+++ b/DQM/EcalCommon/test/BuildFile.xml\r\n@@ -0,0 +1,4 @@\r\n+<bin file=\"testEcalCommon.cc\" name=\"testEcalCommon\">\r\n+    <use name=\"FWCore/TestProcessor\"/>\r\n+    <use name=\"catch2\"/>\r\n+  </bin>\r\ndiff --git a/DQM/EcalCommon/test/testEcalCommon.cc b/DQM/EcalCommon/test/testEcalCommon.cc\r\nnew file mode 100644\r\nindex 00000000000..d4eb9db6a08\r\n--- /dev/null\r\n+++ b/DQM/EcalCommon/test/testEcalCommon.cc\r\n@@ -0,0 +1,43 @@\r\n+#include \"FWCore/TestProcessor/interface/TestProcessor.h\"\r\n+#include \"FWCore/Utilities/interface/Exception.h\"\r\n+#include \"FWCore/ServiceRegistry/interface/Service.h\"\r\n+\r\n+#define CATCH_CONFIG_MAIN\r\n+#include \"catch.hpp\"\r\n+\r\n+// Function to run the catch2 tests\r\n+//___________________________________________________________________________________________\r\n+void runTestForAnalyzer(const std::string& baseConfig, const std::string& analyzerName) {\r\n+  edm::test::TestProcessor::Config config{baseConfig};\r\n+\r\n+  SECTION(analyzerName + \" base configuration is OK\") { REQUIRE_NOTHROW(edm::test::TestProcessor(config)); }\r\n+\r\n+  SECTION(\"Run with no LuminosityBlocks\") {\r\n+    edm::test::TestProcessor tester(config);\r\n+    REQUIRE_NOTHROW(tester.testRunWithNoLuminosityBlocks());\r\n+  }\r\n+}\r\n+\r\n+// Function to generate base configuration string\r\n+//___________________________________________________________________________________________\r\n+std::string generateBaseConfig(const std::string& cfiName, const std::string& analyzerName) {\r\n+  // Define a raw string literal\r\n+  constexpr const char* rawString = R\"_(from FWCore.TestProcessor.TestProcess import *\r\n+from DQM.EcalCommon.{}_cfi import {}\r\n+process = TestProcess()\r\n+process.harvester = {}\r\n+process.moduleToTest(process.harvester)\r\n+process.add_(cms.Service('MessageLogger'))\r\n+process.add_(cms.Service('JobReportService'))\r\n+process.add_(cms.Service('DQMStore'))\r\n+    )_\";\r\n+\r\n+  // Format the raw string literal using fmt::format\r\n+  return fmt::format(rawString, cfiName, analyzerName, analyzerName);\r\n+}\r\n+\r\n+//___________________________________________________________________________________________\r\n+TEST_CASE(\"EcalMEFormatter tests\", \"[EcalMEFormatter]\") {\r\n+  const std::string baseConfig = generateBaseConfig(\"EcalMEFormatter\", \"ecalMEFormatter\");\r\n+  runTestForAnalyzer(baseConfig, \"EcalMEFormatter\");\r\n+}\r\n```\r\n\r\nTest results are:\r\n```\r\n===== Test \"testEcalCommon\" ====\r\n===============================================================================\r\nAll tests passed (2 assertions in 1 test case)\r\n\r\n\r\n---> test testEcalCommon succeeded\r\nTestTime:2\r\n^^^^ End Test testEcalCommon ^^^^\r\n```\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nThis is the backport to `15_0_X`, which is currently in production for DQM. Master PR is made #48027. ", "branch": "CMSSW_15_0_X", "changed_files": 3, "comments": 11, "commits": 2, "created_at": "1746606994", "deletions": 0, "labels": ["dqm-approved", "fully-signed", "tests-approved", "orp-pending", "bug-fix", "backport-ok"], "milestone": "CMSSW_15_0_X", "number": 48028, "release-notes": [], "review_comments": 0, "state": "open", "title": "[15_0_X] Fix ECAL DQM crash from ME formatter when there is no luminosity block", "updated_at": "1746707824", "user": "kyungminparkdrums"}
{"additions": 89, "auther_ref": "mm_tkal_addGS_branches", "auther_sha": "fe38e9fd29110d45cc41746579fcdc8d323200f9", "author": "cms-trackeralign", "body": "backport of https://github.com/cms-sw/cmssw/pull/45357\r\nbackport of https://github.com/cms-sw/cmssw/pull/45385\r\n\r\n#### PR description:\r\n\r\nFrom the original description at https://github.com/cms-sw/cmssw/pull/45357#issue-2386223979:\r\n\r\n> The goal of this PR is to add `GEN-SIM` related branches to the outputs of several Tracker Alignment ALCARECO producers (using resonant di-muon inputs).\r\n> The main goal is to be able to produce MC-truth based validations like the ones shown [here](https://indico.cern.ch/event/1431066/contributions/6022416/attachments/2888005/5061991/AlCaDB_meeting_010724.pdf#page=34) readily from ALCARECO samples instead of relying on scarce and not very easily available `GEN-SIM-RECO` samples.\r\n> A similar request was done for analysis purposes e.g. in [this ticket](https://its.cern.ch/jira/browse/PDMVMCPROD-59).\r\n> To limit the output size, we don't add the whole `genParticles` collection, but just the particles with `abs(pdgId) == 13`.\r\n> In order to do that some gymnastics with the `outputCommands` is required. A simpler solution might entail adding directly a new event content `GeneratorInterfaceALCARECO` [here](https://github.com/cms-sw/cmssw/blob/master/GeneratorInterface/Configuration/python/GeneratorInterface_EventContent_cff.py).\r\n> The increase of data volume (limited by construction only to the MC samples, since the added branches are not available in data) is marginal (estimated in less than 1% on 100 input events).\r\n\r\nin addition from https://github.com/cms-sw/cmssw/pull/45385#issue-2392303729\r\n\r\n> fixes https://github.com/cms-sw/cmssw/issues/45384, \r\n\r\n#### PR validation:\r\n\r\nRun the following command: `runTheMatrix.py --what upgrade -l 12842.0 -t 4 -j 8 --nEvents=100` to produce an input file, then analyzed with `SagittaBiasNtuplizer` (introduced back then at PR https://github.com/cms-sw/cmssw/pull/44297) by using this patch:\r\n\r\n```diff\r\ndiff --git a/Alignment/OfflineValidation/test/SagittaBiasNtuplizer_cfg.py b/Alignment/OfflineValidation/test/SagittaBiasNtuplizer_cfg.py\r\nindex e5f08e57ebf..bfeb8c65021 100644\r\n--- a/Alignment/OfflineValidation/test/SagittaBiasNtuplizer_cfg.py\r\n+++ b/Alignment/OfflineValidation/test/SagittaBiasNtuplizer_cfg.py\r\n@@ -179,18 +179,19 @@ process.refittedTracks = RecoTracker.TrackProducer.TrackRefitter_cfi.TrackRefitt\r\n ####################################################################\r\n from RecoVertex.PrimaryVertexProducer.OfflinePrimaryVertices_cfi import offlinePrimaryVertices\r\n process.offlinePrimaryVerticesFromRefittedTrks = offlinePrimaryVertices.clone()\r\n-#process.offlinePrimaryVerticesFromRefittedTrks.TrackLabel = cms.InputTag(\"refittedVtxTracks\")\r\n-process.offlinePrimaryVerticesFromRefittedTrks.TrackLabel = cms.InputTag(\"refittedTracks\")\r\n+process.offlinePrimaryVerticesFromRefittedTrks.TrackLabel = cms.InputTag(\"refittedVtxTracks\")\r\n+#process.offlinePrimaryVerticesFromRefittedTrks.TrackLabel = cms.InputTag(\"refittedTracks\")\r\n \r\n ###################################################################\r\n # The analysis modules\r\n ###################################################################\r\n process.ZtoMMNtuple = cms.EDAnalyzer(\"SagittaBiasNtuplizer\",\r\n-                                     #tracks = cms.InputTag('refittedMuons'),\r\n-                                     useReco = cms.bool(True),\r\n-                                     muons = cms.InputTag('muons'),\r\n+                                     muonTracks = cms.InputTag('refittedMuons'),\r\n+                                     useReco = cms.bool(False),\r\n+                                     #muons = cms.InputTag('muons'),\r\n                                      doGen = cms.bool(True),\r\n-                                     tracks = cms.InputTag('refittedTracks'),\r\n+                                     #tracks = cms.InputTag('refittedTracks'),\r\n+                                     genParticles = cms.InputTag('TkAlDiMuonAndVertexGenMuonSelector'),\r\n                                      vertices = cms.InputTag('offlinePrimaryVerticesFromRefittedTrks'))\r\n \r\n process.DiMuonVertexValidation = cms.EDAnalyzer(\"DiMuonVertexValidation\",\r\n@@ -257,9 +258,9 @@ process.TFileService = cms.Service(\"TFileService\",\r\n # Path\r\n ###################################################################\r\n process.p1 = cms.Path(process.offlineBeamSpot\r\n-                      #* process.refittedMuons\r\n-                      #* process.refittedVtxTracks\r\n-                      * process.refittedTracks\r\n+                      * process.refittedMuons\r\n+                      * process.refittedVtxTracks\r\n+                      #* process.refittedTracks\r\n                       * process.offlinePrimaryVerticesFromRefittedTrks\r\n                       * process.ZtoMMNtuple) \r\n                       #* process.DiMuonVertexValidation\r\n```\r\n\r\nand analyzed with: `cmsRun SagittaBiasNtuplizer_cfg.py myfile=file:../../../12842.0_ZMM_13+2024/TkAlDiMuonAndVertex.root`. Finally the resulting output ntuple has been checked for having appropriate branches filled.\r\n\r\n`runTheMatrix.py -l 1001.3` runs with this addition.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nVerbatim backport of https://github.com/cms-sw/cmssw/pull/45357 and  https://github.com/cms-sw/cmssw/pull/45385 for 2024 MC production purposes.", "branch": "CMSSW_14_0_X", "changed_files": 9, "closed_at": "1736837191", "comments": 10, "commits": 5, "created_at": "1734683920", "deletions": 4, "labels": ["alca-approved", "reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "backport-ok"], "merge_commit_sha": "997bb02940b54779ce3a73c6b4908b42ad83a04d", "merged_at": "1736837191", "merged_by": "cmsbuild", "milestone": "CMSSW_14_0_X", "number": 47016, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[14.0.X] Add GEN-SIM information to resonant di-muon TkAl ALCARECO producers", "updated_at": "1736837303", "user": "mmusich"}
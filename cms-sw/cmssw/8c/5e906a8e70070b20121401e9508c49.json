{"additions": 12, "auther_ref": "quickTrackAssocRemoveNumberOfHits", "auther_sha": "ab364fbd11cb99a69bd137a701655f3f47025560", "author": "makortel", "body": "Currently `QuickTrackAssociatorByHits` ignores TrackingParticles with `numberOHits()==0` from track-TrackingParticle association. While this seems like a nice performance optimization, it does cause some track-TrackingParticle pairs to not be associated because of how the `numberOfHits()` is calculated in `TrackingTruthAccumulator`:\r\n\r\n1. only SimHits with the same `particleType` as the `SimTrack`'s `pdgId` and the same `particleType` and `processType` as the \"first hit\" are counted\r\n2. the definition of \"first hit\" is not robust (or very counter-intuitive if that is the intention; I'll give more details  in another PR ~~fixing that issue~~ improving the situation, the PR is #17382).\r\n\r\nBecause of 1, I propose to include also TrackingParticles with `numberOfHits()==0` in the track-TrackingParticle association, because the association is (effectively) done with **all** SimHits of a TrackingParticle (via the Pixel/StripDigiSimLinks).\r\n\r\n\"Accidentally\", this PR also fixes the problem caused of 2.\r\n\r\nHere are MTV plots in CMSSW_9_0_X_2017-01-23-1100 for ttbar+35PU for phase0, phase1, and phase1 with CA seeding, and CMSSW_9_0_0_pre2 for phase2 (D4) ttbar+PU200\r\nhttps://mkortela.web.cern.ch/mkortela/tracking/validation/CMSSW_9_0_X_phase2debug/\r\nand here for phase2 (D4) ttbar noPU in CMSSW_9_0_X_2017-01-23-1100 (thanks to @ebrondol)\r\nhttp://ebrondol.web.cern.ch/ebrondol/Phase2Tracking/fixFakes/20170125_TTbar/\r\n\r\nThe effect on efficiency in phase0, phase1, phase2 PU200 is tiny; phase2 noPU shows few percent increase in |eta| 2-3. The effect on fake rate in phase0, phase1, phase2 PU200 is a 1-2 % overall decrease (can be more in specific phase space regions); phase2 noPU shows ~40 % overall decrease.\r\n\r\nTested in CMSSW_9_0_X_2017-01-23-1100 and CMSSW_9_0_0_pre2, expecting changes like above in the track-TrackingParticle association (no change expected e.g. on RECO itself).\r\n\r\n@VinInn @rovere @ebrondol @slava77 ", "branch": "CMSSW_9_0_X", "changed_files": 2, "closed_at": "1485958744", "comments": 12, "commits": 2, "created_at": "1485875283", "deletions": 5, "labels": ["comparison-available", "dqm-approved", "fully-signed", "orp-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "d81044f0f8fc144426343ce559f86906fb70e7e4", "merged_at": "1485958744", "merged_by": "cmsbuild", "milestone": "CMSSW_9_0_X", "number": 17338, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Remove check on TrackingParticle::numberOfHits()==0 from QuickTrackAssociatorByHits", "updated_at": "1486021794", "user": "makortel"}
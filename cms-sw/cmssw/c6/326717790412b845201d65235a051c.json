{"additions": 2115, "auther_ref": "embedding_dev_CMSSW_15_0_4_p3_improveCode", "auther_sha": "c52227a733db9cb4c52cb6a5775819dd7859b960", "author": "KIT-CMS", "body": "#### PR description:\r\n\r\nThis is a backport of https://github.com/cms-sw/cmssw/pull/48408.\r\nThis backport is needed to produce 2024 tau embedding samples.\r\n\r\nThe following is the description of https://github.com/cms-sw/cmssw/pull/48408:\r\n\r\nThis PR restructures and cleans the [tau embedding method](https://twiki.cern.ch/twiki/bin/viewauth/CMS/TauEmbeddingSamplesUL) ([`TauAnalysis/MCEmbeddingTools`](https://github.com/cms-sw/cmssw/tree/master/TauAnalysis/MCEmbeddingTools)) so that it is possible to produce RUN 3 tau embedding samples with CMS submission workflows.\r\nOne goal was to remove the need of `--customise` or `--customise_commands` in the tau embedding `cmsDriver.py` commands.\r\nThis was possible due to modifiers and the possibility to add python config fragments to some `cmsDriver.py` steps.\r\nOnly the `HLT` step required additional modification of the `cmsDriver.py` [config builder](https://github.com/cms-sw/cmssw/pull/48408/files#diff-cdb26c43130acb8faa9c94529dd55a55671d2621695d7c5a2a47aa20a62e62df).\r\n\r\nThe other goal of this PR is to have more understandable, better commented code and therefore sustainable code.\r\n\r\n#### Tau embedding `cmsDriver.py` commands\r\nWith the changes introduced in this PR, tau embedding samples can be produced using the following `cmsDriver.py` commands.\r\n\r\n<details>\r\n<summary>Selection</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step RAW2DIGI,L1Reco,RECO,PAT,FILTER:TauAnalysis/MCEmbeddingTools/Selection_FILTER_cff.makePatMuonsZmumuSelection \\\r\n--processName SELECT \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingSelection \\\r\n--datatier RAWRECO \\\r\n--filein \"root://cmsdcache-kit-disk.gridka.de:1094//store/data/Run2024C/Muon0/RAW/v1/000/380/115/00000/00979445-916c-42e2-8038-428d7bd4f176.root\" \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>LHE and Cleaning</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step USER:TauAnalysis/MCEmbeddingTools/LHE_USER_cff.embeddingLHEProducerTask,RAW2DIGI,RECO:TauAnalysis/MCEmbeddingTools/Cleaning_RECO_cff.reconstruction \\\r\n--processName LHEembeddingCLEAN \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingCleaning \\\r\n--datatier RAWRECO \\\r\n--procModifiers tau_embedding_mu_to_mu \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Simulation Gen</summary>\r\n\r\n```shell\r\ncmsDriver.py TauAnalysis/MCEmbeddingTools/python/Simulation_GEN_cfi.py \\\r\n--step GEN,SIM,DIGI,L1,DIGI2RAW \\\r\n--processName SIMembeddingpreHLT \\\r\n--mc \\\r\n--beamspot DBrealistic \\\r\n--geometry DB:Extended \\\r\n--era Run3_2024 \\\r\n--conditions auto:phase1_2024_realistic \\\r\n--eventcontent TauEmbeddingSimGen \\\r\n--datatier RAWSIM \\\r\n--procModifiers tau_embedding_mu_to_mu \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Simulation HLT</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step HLT:TauAnalysis/MCEmbeddingTools/Simulation_HLT_customiser_cff.embeddingHLTCustomiser.Fake2 \\\r\n--processName SIMembeddingHLT \\\r\n--mc \\\r\n--beamspot DBrealistic \\\r\n--geometry DB:Extended \\\r\n--era Run3_2024 \\\r\n--conditions auto:phase1_2024_realistic \\\r\n--eventcontent TauEmbeddingSimHLT \\\r\n--datatier RAWSIM \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Simulation Reco</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step RAW2DIGI,L1Reco,RECO:TauAnalysis/MCEmbeddingTools/Simulation_RECO_cff.reconstruction,RECOSIM \\\r\n--processName SIMembedding \\\r\n--mc \\\r\n--beamspot DBrealistic \\\r\n--geometry DB:Extended \\\r\n--era Run3_2024 \\\r\n--conditions auto:phase1_2024_realistic \\\r\n--eventcontent TauEmbeddingSimReco \\\r\n--datatier RAW-RECO-SIM \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Merging</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step USER:TauAnalysis/MCEmbeddingTools/Merging_USER_cff.merge_step,PAT \\\r\n--processName MERGE \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingMerge \\\r\n--datatier USER \\\r\n--inputCommands 'keep *_*_*_*' \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>NanoAOD</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step NANO:TauAnalysis/MCEmbeddingTools/Nano_cff.embedding_nanoAOD_seq \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingNANOAOD \\\r\n--datatier NANOAODSIM \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n\r\n\r\n#### PR validation:\r\n\r\nI have included simple release validation and unit tests for tau embedding 2024.", "branch": "CMSSW_15_0_X", "changed_files": 80, "comments": 18, "commits": 25, "created_at": "1752656771", "deletions": 1652, "labels": ["reconstruction-pending", "simulation-pending", "operations-approved", "pending-signatures", "tests-approved", "orp-pending", "pdmv-approved", "upgrade-pending", "xpog-pending", "tracking", "trk"], "milestone": "CMSSW_15_0_X", "number": 48557, "release-notes": [], "review_comments": 0, "state": "open", "title": "[15_0_X] Backport: Restructure and comment the tau embedding method", "updated_at": "1759320437", "user": "winterchristian"}
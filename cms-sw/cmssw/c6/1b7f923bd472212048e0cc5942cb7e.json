{"additions": 389, "auther_ref": "EgammaJetCoreRegional", "auther_sha": "8f3353d2d8453a70043a4c54e5dbef872aec5910", "author": "Sam-Harper", "body": "Dear All,\r\n\r\nThe PR allows the jet core regional tracking to be seeded by E/gamma objects, specifically superclusters with Et> 20 GeV and H/E <0.2.\r\n\r\nCurrently jet core regional tracking is seeded by 100 GeV CaloJets. This causes problems for E/gamma as electrons/photons will also be reconstructed as 100 GeV CaloJets and so causes the track isolation defination to change at 100 GeV which has caused problems in the past. It also means that the variable which is studied and validated at the Z peak is different to the variable used at high pt which is far from ideal.  Therefore we now run this in the region for all e/gamma objects. \r\n\r\nA pleasant bonus is that it is likely that this will improve the performance of tracker based isolation for e/gamma. It was shown slightly over a year ago that this is true for high energy electrons so could be true for < 100 GeV electrons too https://indico.cern.ch/event/491518/contributions/2363233/attachments/1367167/2071567/trkIsolHEEP_EGMIDV2.pdf  (slides 12-14, compare the black line with the dotted black line).  \r\nUnfortunately E/gamma gave me some erroneous information then that jet core regional was being removed in 2017 otherwise this PR would have happened last year...\r\n\r\nThis PR leverages RecoEcalCandidates to convert superclusters into something inheriting from candidates, using existing well established HLT code. Not to re-invent the wheel, I reused EgammaHLTFilteredSuperClusterProducer to filter the RecoEcalCandidates. This mean I had to turn it into a generic templated class EgammaHLTFilteredObjProducer and then have instances of that to produce a std::vector of edm::Ptrs. \r\n\r\nI then combine the selected jets (which are a collection of edm::Ptr<reco::Candidate>  with the selected e/gammas using a new class CandidateCombiner to make a new collection egammaAndJetsForCoreTracking which seeds the tracking regions. The jets and e/gammas are loosely dR cleaned (ie they have tightish dR match) with e/gammas eta/phi being preferred. \r\n\r\nValidation:\r\nIn CMSSW_10_0_0_pre3 I re-recoed a file from /RelValTTbar_13/CMSSW_10_0_0_pre3-PU25ns_100X_upgrade2018_realistic_v4_mahiOFF-v1/GEN-SIM-DIGI-RAW (/store/relval/CMSSW_10_0_0_pre3/RelValTTbar_13/GEN-SIM-DIGI-RAW/PU25ns_100X_upgrade2018_realistic_v4_mahiOFF-v1/20000/048FD543-85E9-E711-8FC9-0CC47A78A414.root, 500 events)\r\n\r\nwith the cmsDriver recoTiming.py step3 --conditions auto:phase1_2018_realistic -n 10 --era Run2_2018 --customise_commands process.hbheprereco.algorithm.useMahi = cms.bool(False) \\n process.hbheprereco.algorithm.useM2 = cms.bool(True) \\n --runUnscheduled -s RAW2DIGI,L1Reco,RECO,RECOSIM,EI,PAT --datatier GEN-SIM-RECO,MINIAODSIM --eventcontent RECOSIM,MINIAODSIM --geometry DB:Extended --no_exec --filein file:step2.root --fileout file:step3.root --nThreads 4 --no_exec\r\n\r\nwith both this PR and clean CMSSW_10_0_0_pre3:\r\n\r\ndefault pre3 seconds per event:  16.99 , 17.20, 16.93, 17.47 \r\nwith this PR: 17.47, 17.13, 17.49, 16.99.\r\n\r\nLooking at detail for the output comparing the fastest \"default\" one and the slowest one with this pr:\r\nCouldn't parse time report using CPU and wall-clock format: trying Wall-clock only\r\n  delta/mean delta/orJob     original                   new       module name\r\n  ---------- ------------     --------                  ----       ------------\r\n       added      +0.00%         0.00 ms/ev ->         0.30 ms/ev egammaHoverEForTrk\r\n       added      +0.00%         0.00 ms/ev ->         0.02 ms/ev egammasForTrk\r\n       added      +0.00%         0.00 ms/ev ->         0.01 ms/ev egammasForCoreTracking\r\n       added      +0.02%         0.00 ms/ev ->         3.04 ms/ev particleFlowSuperClusterECALForTrk\r\n       added      +0.00%         0.00 ms/ev ->         0.02 ms/ev egammaAndJetsForCoreTracking\r\n   +1.971550      +0.47%         0.58 ms/ev ->        80.41 ms/ev dt1DRecHits\r\n   +1.969100      +0.54%         0.72 ms/ev ->        92.23 ms/ev l1extraParticles\r\n   +1.955702      +0.05%         0.09 ms/ev ->         8.39 ms/ev dt1DCosmicRecHits\r\n   +1.944751      +0.05%         0.12 ms/ev ->         8.57 ms/ev castorreco\r\n   -1.909900      -0.02%         3.51 ms/ev ->         0.08 ms/ev jetsForCoreTrackingPreSplitting\r\n   +1.907162      +0.03%         0.11 ms/ev ->         4.42 ms/ev gtDigis\r\n   -1.891304      -0.02%         3.40 ms/ev ->         0.10 ms/ev jetsForCoreTracking\r\n   -1.812378      -0.22%        39.18 ms/ev ->         1.93 ms/ev siStripZeroSuppression\r\n   +1.808692      +0.52%         4.63 ms/ev ->        92.22 ms/ev ecalPreshowerRecHit\r\n   +1.793510      +0.00%         0.03 ms/ev ->         0.64 ms/ev offlineBeamSpot\r\n   -1.773824      -0.03%         4.77 ms/ev ->         0.29 ms/ev totemRPRawToDigi\r\n   -1.738878      -0.01%         1.93 ms/ev ->         0.14 ms/ev corrPfMetType1Puppi\r\n   +1.709287      +0.15%         2.10 ms/ev ->        26.82 ms/ev displacedGlobalMuons\r\n   -1.665399      -0.01%         2.41 ms/ev ->         0.22 ms/ev caloJetMap\r\n   -1.623188      -0.02%         3.38 ms/ev ->         0.35 ms/ev corrPfMetType1NoHF\r\n   -1.571429      -0.00%         0.07 ms/ev ->         0.01 ms/ev ak4PFCHSL3AbsoluteCorrector\r\n   +1.527711      +0.00%         0.05 ms/ev ->         0.37 ms/ev ak4PFCHSL2RelativeCorrector\r\n   +1.514061      +0.00%         0.11 ms/ev ->         0.78 ms/ev ak4PFPuppiResidualCorrector\r\n   +1.481481      +0.00%         0.03 ms/ev ->         0.19 ms/ev hpsPFTauDiscriminationByMVA6VTightElectronRejection\r\n   +1.445545      +0.00%         0.03 ms/ev ->         0.17 ms/ev hpsPFTauDiscriminationByMVA6MediumElectronRejection\r\n   +1.440242      +0.01%         0.18 ms/ev ->         1.14 ms/ev patJetCorrFactorsAK8\r\n   +1.391304      +0.00%         0.03 ms/ev ->         0.16 ms/ev hpsPFTauDiscriminationByMVA6TightElectronRejection\r\n   -1.384111      -0.00%         1.03 ms/ev ->         0.19 ms/ev pfCombinedSecondaryVertexV2BJetTagsAK8Puppi\r\n   +1.328467      +0.00%         0.02 ms/ev ->         0.11 ms/ev hpsPFTauDiscriminationByLooseIsolationMVArun2v1PWdR03oldDMwLT\r\n   +1.318386      +0.00%         0.04 ms/ev ->         0.18 ms/ev hpsPFTauDiscriminationByMVA6VLooseElectronRejection\r\n   -1.283105      -0.00%         0.72 ms/ev ->         0.16 ms/ev patPFMetT1T2CorrNoHF\r\n   -1.268855      -0.02%         4.60 ms/ev ->         1.03 ms/ev ctppsPixelLocalTracks\r\n   +1.225251      +0.00%         0.14 ms/ev ->         0.56 ms/ev castorDigis\r\n   -1.208270      -0.01%         2.64 ms/ev ->         0.65 ms/ev muonSeededSeedsOutInDisplaced\r\n   +1.164694      +0.14%         8.45 ms/ev ->        32.02 ms/ev gedPhotons\r\n   +1.140787      +0.01%         0.68 ms/ev ->         2.49 ms/ev initialStepSeedLayersPreSplitting\r\n   +1.112903      +0.00%         0.11 ms/ev ->         0.39 ms/ev patJetCorrFactorsAK8Puppi\r\n   +1.102111      +0.15%        10.43 ms/ev ->        36.04 ms/ev globalMuons\r\n   +1.080904      +0.02%         1.19 ms/ev ->         3.99 ms/ev pfCombinedSecondaryVertexV2BJetTags\r\n   -1.077056      -0.01%         1.79 ms/ev ->         0.54 ms/ev corrPfMetType1\r\n   +1.045872      +0.00%         0.23 ms/ev ->         0.75 ms/ev softPFMuonBJetTags\r\n   -1.030189      -0.00%         0.80 ms/ev ->         0.26 ms/ev patPFMetT1T2Corr\r\n   +0.991511      +0.00%         0.30 ms/ev ->         0.88 ms/ev pfBoostedDoubleSecondaryVertexAK8BJetTagsAK8Puppi\r\n   -0.966956      -0.02%         4.02 ms/ev ->         1.40 ms/ev muonSeededSeedsInOut\r\n   -0.953405      -0.01%         3.30 ms/ev ->         1.17 ms/ev pfCombinedCvsLJetTagsPuppi\r\n   -0.951872      -0.16%        42.15 ms/ev ->        14.97 ms/ev csc2DRecHits\r\n   +0.937513      +0.01%         1.27 ms/ev ->         3.51 ms/ev MeasurementTrackerEventPreSplitting\r\n   -0.930900      -0.00%         1.12 ms/ev ->         0.41 ms/ev basicJetsForMetPuppi\r\n   -0.785068      -0.00%         1.23 ms/ev ->         0.54 ms/ev basicJetsForMetNoHF\r\n   +0.750000      +0.00%         0.38 ms/ev ->         0.84 ms/ev hpsPFTauDiscriminationByMVA6rawElectronRejection\r\n   -0.745278      -0.01%         2.69 ms/ev ->         1.23 ms/ev QGTagger\r\n   +0.708428      +0.05%         8.10 ms/ev ->        16.99 ms/ev pfCombinedCvsLJetTags\r\n   -0.697828      -0.01%         3.26 ms/ev ->         1.57 ms/ev basicJetsForMet\r\n   -0.653978      -0.01%         1.74 ms/ev ->         0.88 ms/ev pfCombinedCvsBJetTagsPuppi\r\n   +0.625937      +0.00%         0.60 ms/ev ->         1.14 ms/ev jetCoreRegionalStep\r\n   -0.613397      -0.01%         2.17 ms/ev ->         1.15 ms/ev patSmearedJets\r\n   -0.559363      -0.00%         1.61 ms/ev ->         0.90 ms/ev oniaPhotonCandidates\r\n   -0.505392      -0.01%         2.15 ms/ev ->         1.28 ms/ev shiftedPatJetResUp\r\n   +0.492910      +0.00%         0.56 ms/ev ->         0.92 ms/ev jetCoreRegionalStepHitDoublets\r\n   -0.466454      -0.00%         1.54 ms/ev ->         0.96 ms/ev shiftedPatJetResUpNoHF\r\n   -0.464340      -0.00%         0.81 ms/ev ->         0.51 ms/ev muonSeededSeedsOutIn\r\n   +0.446649      +0.02%         6.73 ms/ev ->        10.61 ms/ev hcalDigis\r\n   -0.444502      -0.01%         4.76 ms/ev ->         3.03 ms/ev CHSCands\r\n   +0.436803      +0.00%         0.84 ms/ev ->         1.31 ms/ev hpsPFTauDiscriminationByIsolationMVArun2v1PWnewDMwLTraw\r\n   -0.430425      -0.00%         1.36 ms/ev ->         0.88 ms/ev patSmearedJetsNoHF\r\n   +0.418327      +0.00%         0.79 ms/ev ->         1.21 ms/ev hpsPFTauDiscriminationByIsolationMVArun2v1PWdR03oldDMwLTraw\r\n   +0.390480      +0.01%         3.42 ms/ev ->         5.07 ms/ev jetCoreRegionalStepTracks\r\n   -0.381050      -0.01%         4.05 ms/ev ->         2.75 ms/ev cosmicDCSeeds\r\n   +0.364011      +0.01%         2.58 ms/ev ->         3.73 ms/ev pfGhostTrackBJetTags\r\n   +0.343741      +0.37%       151.63 ms/ev ->       214.57 ms/ev jetCoreRegionalStepTrackCandidates\r\n   -0.338765      -0.00%         1.18 ms/ev ->         0.84 ms/ev shiftedPatSmearedJetResUpNoHF\r\n   +0.333570      +0.01%         5.87 ms/ev ->         8.21 ms/ev pfCombinedCvsBJetTags\r\n   -0.312187      -0.01%         6.69 ms/ev ->         4.88 ms/ev patPFMet\r\n   +0.302409      +0.00%         0.83 ms/ev ->         1.12 ms/ev hpsPFTauDiscriminationByIsolationMVArun2v1DBdR03oldDMwLTraw\r\n   +0.294889      +0.04%        17.39 ms/ev ->        23.40 ms/ev initialStepHitQuadrupletsPreSplitting\r\n   -0.285942      -0.00%         1.43 ms/ev ->         1.07 ms/ev shiftedPatJetResDown\r\n   +0.268191      +0.01%         3.11 ms/ev ->         4.07 ms/ev pfCombinedMVAV2BJetTags\r\n   +0.239212      +0.01%         7.51 ms/ev ->         9.55 ms/ev siPixelDigis\r\n   -0.237168      -0.00%         0.63 ms/ev ->         0.50 ms/ev interestingGedEleIsoDetIdEE\r\n   -0.232258      -0.00%         1.04 ms/ev ->         0.82 ms/ev shiftedPatSmearedJetResDownNoHF\r\n   -0.216127      -0.01%         6.38 ms/ev ->         5.14 ms/ev patMETs\r\n   +0.202348      +0.00%         0.80 ms/ev ->         0.98 ms/ev hpsPFTauDiscriminationByIsolationMVArun2v1PWoldDMwLTraw\r\n   +0.202279      +0.00%         0.63 ms/ev ->         0.77 ms/ev tripletElectronSeedLayers\r\n   -0.158194      -0.02%        18.79 ms/ev ->        16.03 ms/ev initialStepSeedsPreSplitting\r\n   +0.143703      +0.07%        73.33 ms/ev ->        84.69 ms/ev ecalMultiFitUncalibRecHit\r\n   +0.142177      +0.02%        19.90 ms/ev ->        22.95 ms/ev CSCHaloData\r\n   +0.115197      +0.01%        12.67 ms/ev ->        14.22 ms/ev standAloneMuons\r\n   +0.114189      +0.01%        11.42 ms/ev ->        12.80 ms/ev particleFlowClusterOOTECAL\r\n   +0.108277      +0.01%        11.23 ms/ev ->        12.52 ms/ev particleFlowClusterECAL\r\n   +0.101760      +0.01%        13.35 ms/ev ->        14.78 ms/ev siPixelClusters\r\n   +0.089352      +0.02%        31.98 ms/ev ->        34.97 ms/ev trackVertexArbitrator\r\n   +0.089106      +0.00%         7.34 ms/ev ->         8.03 ms/ev muonCSCDigis\r\n   +0.086487      +0.01%        25.14 ms/ev ->        27.42 ms/ev generalV0Candidates\r\n   +0.082014      +0.44%       864.36 ms/ev ->       938.28 ms/ev hbheprereco\r\n   +0.063157      +0.19%       496.49 ms/ev ->       528.87 ms/ev initialStepTrackCandidatesPreSplitting\r\n   +0.060664      +0.03%        93.83 ms/ev ->        99.70 ms/ev siPixelClustersPreSplitting\r\n   +0.059434      +0.01%        36.81 ms/ev ->        39.07 ms/ev candidateVertexArbitrator\r\n   +0.058152      +0.02%        48.39 ms/ev ->        51.28 ms/ev candidateVertexArbitratorCvsL\r\n   +0.050909      +0.00%         5.76 ms/ev ->         6.06 ms/ev detachedQuadStep\r\n  ---------- ------------     --------                  ----       ------------\r\nJob total:  16.9326 s/ev ==> 17.4926 s/ev\r\nthe time increase is due to completely unrelated modules which this PR can not effect, eg hbheprereco, ecalPreshowerRecHit\r\n\r\nLooking at the relavent module, the main driver of actual changes are jetCoreRegionalStepTrackCandidates which does from  153.5,153.2, 152.23,151.6 -> 210.5, 207.4, 206.4, 214.6 so a 0.35% increase. \r\n\r\nIn general we get at most one or two extra tracks every so often so no diskspace concerns. ", "branch": "master", "changed_files": 6, "comments": 57, "commits": 4, "created_at": "1515515156", "deletions": 161, "labels": ["analysis-pending", "code-checks-approved", "comparison-pending", "hlt-pending", "orp-pending", "pending-signatures", "reconstruction-pending", "tests-approved"], "milestone": "CMSSW_10_1_X", "number": 21818, "release-notes": [], "review_comments": 22, "state": "open", "title": "Allowing E/gamma objects to seed jet core regional tracking", "updated_at": "1517261307", "user": "Sam-Harper"}
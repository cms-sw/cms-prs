{"additions": 17, "auther_ref": "fc-fixRelMon", "auther_sha": "15e4114b4d5056bd284ea365abf7ca64ebe86fcd", "author": "fabiocos", "body": "#### PR description:\r\n\r\nThe RelMon DQM histogram comparison is complaining about differences between histograms when comparing a file with itself, which is clearly incorrect, see the discussion in https://github.com/cms-sw/cmssw/issues/26496 . This issue looks linked to the inconsistent use in the utility package https://cmssdt.cern.ch/lxr/source/Utilities/RelMon/python/utils.py of number of bins and ranges. In python the range function has as a second argument not the last value of the list but the next to last. This looks likely the motivation for the function getNbins adding 1 unit to the number of bins as returned by the ROOT function getNbinsX(). There seems to be also some inconsistency between the starting point of the different range loops, in several cases bin 0 is used (underflow), sometime bin 1 (the first histogram bin). \r\n\r\nThis PR tries to solve the issue, having all the range based loops running from the underflow (bin=0) to the overflow (bin=GetNbinsX()+1), which means setting in the range loops as last item GetNbinsX()+2. \r\n\r\n#### PR validation:\r\n\r\nRunning the test BinToBin to compare a file with itself does not show any more the problem. Using the DQM output of the generator workflow 503 with a syntax similar to cms-bot:\r\n```\r\n13:51 cmsdev25 4149> compare_using_files.py -B DQM/TimerService@3 -o out -C -R -p --no_successes -s b2b 503.0_MinBias_13TeV_pythia8+MinBias_13TeV_pythia8+HARVESTGEN/DQM_V0001_R000000001__Global__CMSSW_X_Y_Z__RECO.root 503.0_MinBias_13TeV_pythia8+MinBias_13TeV_pythia8+HARVESTGEN/DQM_V0001_R000000001__Global__CMSSW_X_Y_Z__RECO.root\r\nAnalysing Histograms located in directory  at: \r\n o 503.0_MinBias_13TeV_pythia8+MinBias_13TeV_pythia8+HARVESTGEN/DQM_V0001_R000000001__Global__CMSSW_X_Y_Z__RECO.root\r\n o 503.0_MinBias_13TeV_pythia8+MinBias_13TeV_pythia8+HARVESTGEN/DQM_V0001_R000000001__Global__CMSSW_X_Y_Z__RECO.root\r\nWe have a Blacklist:\r\n o Directory TimerService at level 3\r\n++++++++++++++++++++++++++++++\r\nOutput Directory will be  out\r\nStudying directory Info, 1/2\r\nStudying directory Generator, 2/2\r\n ->Appending Generator... Appended.\r\nFinished\r\n\r\n - summary of 840 tests:\r\n o Failiures: 0.00% (0/840)\r\n o Nulls: 0.00% (0/840) \r\n o Successes: 100.00% (840/840) \r\n o Skipped: 0.00% (0/840) \r\n o Missing objects: 0\r\nPickleing the directory as out.pkl in dir /build/fabiocos/106X/relmon/CMSSW_10_6_X_2019-04-29-2300/work/out\r\nReading directory from out.pkl\r\nCalculating stats for the directory...\r\nProducing html...\r\n```\r\n\r\n", "branch": "master", "changed_files": 1, "closed_at": "1557428160", "comments": 30, "commits": 3, "created_at": "1556791167", "deletions": 10, "labels": ["bug-fix", "code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "e181325217a13c952fba5fce577e886d1c4b3763", "merged_at": "1557428160", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 26593, "release-notes": [], "review_comments": 4, "state": "closed", "title": "RelMon histogram comparison: adapt ranges in a compatible way with the definition of getNbins", "updated_at": "1557428160", "user": "fabiocos"}
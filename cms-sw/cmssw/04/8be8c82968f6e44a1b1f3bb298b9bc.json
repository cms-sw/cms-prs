{"additions": 602, "auther_ref": "bp-feature-ConcurrentGeneratorFilter", "auther_sha": "6ad88d536f027e7f08671795cafd276872d7ab6e", "author": "PhyM73", "body": "#### PR description:\r\n\r\n**This PR is a backport of#33883.** \r\n\r\nIt implements a thread-safe module`ConcurrentGeneratorFilter`for GEN workflows. This module replicates the Generator for each stream in order to run them concurrently and only works for thread-friendly hadronizers, decayers, and filters. It also provides a concurrent module of the Pythia8 generator, `Pythia8ConcurrentGeneratorFilter`. More detailed explanation and validation can be found in[these slides](https://indico.cern.ch/event/1045566/contributions/4392194/attachments/2261959/3839785/21.06.10_PPD_Concurrent%20GEN%20processing.pdf)(thanks to @colizz).\r\n\r\n#### PR validation:\r\n\r\nThis PR is validated on multiple datasets, by replacing `Pythia8GeneratorFilter` with `Pythia8ConcurrentGeneratorFilter` in the GEN step configuration(see page 7 and 9 of above slides). Below is a quick test on [BTV-RunIISummer20UL17GEN-00002](https://cms-pdmv.cern.ch/mcm/requests?prepid=BTV-RunIISummer20UL17GEN-00002&page=0&shown=127) with 4 threads. There is also a unittest, `GeneratorInterface/Pythia8Interface/test/test_Pythia8ConcurrentGeneratorFilter_WZ_TuneCP5_13TeV-pythia8.sh`.\r\n\r\n```bash\r\ncmsrel CMSSW_10_6_X_2021-06-16-2300\r\ncd CMSSW_10_6_X_2021-06-16-2300/src/\r\ncmsenv\r\ngit cms-merge-topic PhyM73:bp-feature-ConcurrentGeneratorFilter\r\ncurl -s -k https://cms-pdmv.cern.ch/mcm/public/restapi/requests/get_fragment/BTV-RunIISummer20UL17GEN-00002 --retry 3 --create-dirs -o Configuration/GenProduction/python/BTV-RunIISummer20UL17GEN-00002-fragment.py\r\nscram b -j 8\r\ncd ../..\r\ncmsDriver.py Configuration/GenProduction/python/BTV-RunIISummer20UL17GEN-00002-fragment.py --python_filename BTV-RunIISummer20UL17GEN-00002_1_cfg.py --eventcontent RAWSIM --customise Configuration/DataProcessing/Utils.addMonitoring --datatier GEN --fileout file:BTV-RunIISummer20UL17GEN-00002.root --conditions 106X_mc2017_realistic_v6 --beamspot Realistic25ns13TeVEarly2017Collision --customise_commands process.source.numberEventsInLuminosityBlock=\"cms.untracked.uint32(10)\" --step GEN --geometry DB:Extended --era Run2_2017 --no_exec --mc -n 100 --nThreads 4 --nConcurrentLumis 0\r\n\r\nsed -i \"s/Pythia8GeneratorFilter/Pythia8ConcurrentGeneratorFilter/g\" BTV-RunIISummer20UL17GEN-00002_1_cfg.py\r\ncmsRun -e -j BTV-RunIISummer20UL17GEN-00002_report.xml BTV-RunIISummer20UL17GEN-00002_1_cfg.py\r\n```", "branch": "CMSSW_10_6_X", "changed_files": 6, "closed_at": "1624627963", "comments": 20, "commits": 3, "created_at": "1624001601", "deletions": 3, "labels": ["fully-signed", "generators-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "fa6684e738df65799c2d1be64d4ecade2c243245", "merged_at": "1624627963", "merged_by": "cmsbuild", "milestone": "CMSSW_10_6_X", "number": 34176, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Backport ConcurrentGeneratorFilter to 106X", "updated_at": "1624627964", "user": "PhyM73"}
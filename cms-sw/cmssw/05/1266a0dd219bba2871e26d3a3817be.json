{"additions": 15, "auther_ref": "Mahi_Fix_PulseTime_NaNs_10_1_X", "auther_sha": "2df4e2ad296d60a16db936946400cf28af20f27b", "author": "jaylawhorn", "body": "The current version of Mahi can return a pulse arrival time that is NaN because there is no check for division by zero. Additionally, we limit the pulse arrival time to +/- 12.5 ns from the nominal time, because if the hit is put in the in-time sample (bx=0), it does belong in that sample. This removes large tails in the timing distribution induced by deviations from the default pulse shape template and/or the existence of pulses in bunch crossing we don't allow pulses to exist in the fit.\r\n\r\nFor example, some recHits from the default release:\r\n```\r\nroot [5] HcalTree->Scan(\"ieta:iphi:depth:mahiE:mahiT\")\r\n************************************************************************\r\n*    Row   *      ieta *      iphi *     depth *     mahiE *     mahiT *\r\n************************************************************************\r\n*        0 *        -1 *         1 *         1 *         0 *       inf *\r\n*        1 *        -1 *         7 *         1 *         0 *     -9999 *\r\n*        2 *        -1 *         8 *         1 * 0.0201498 * -2.192569 *\r\n*        3 *        -1 *         9 *         1 * 0.5976437 * -0.054388 *\r\n*        4 *        -1 *        14 *         1 * 0.2618228 * 0.0405726 *\r\n*        5 *        -1 *        19 *         1 * 0.2631363 * -3.694539 *\r\n*        6 *        -1 *        23 *         1 *         0 *     -9999 *\r\n*        7 *        -1 *        24 *         1 *         0 *       inf *\r\n*        8 *        -1 *        25 *         1 *         0 *       inf *\r\n*        9 *        -1 *        28 *         1 *         0 *       inf *\r\n*       10 *        -1 *        29 *         1 *         0 *     -9999 *\r\n```\r\nbecome\r\n```\r\nroot [3] HcalTree->Scan(\"ieta:iphi:depth:mahiE:mahiT\")\r\n************************************************************************\r\n*    Row   *      ieta *      iphi *     depth *     mahiE *     mahiT *\r\n************************************************************************\r\n*        0 *        -1 *         1 *         1 *         0 *     -9999 *\r\n*        1 *        -1 *         7 *         1 *         0 *     -9999 *\r\n*        2 *        -1 *         8 *         1 * 0.0201498 * -2.192569 *\r\n*        3 *        -1 *         9 *         1 * 0.5976437 * -0.054388 *\r\n*        4 *        -1 *        14 *         1 * 0.2618228 * 0.0405726 *\r\n*        5 *        -1 *        19 *         1 * 0.2631363 * -3.694539 *\r\n*        6 *        -1 *        23 *         1 *         0 *     -9999 *\r\n*        7 *        -1 *        24 *         1 *         0 *     -9999 *\r\n*        8 *        -1 *        25 *         1 *         0 *     -9999 *\r\n*        9 *        -1 *        28 *         1 *         0 *     -9999 *\r\n*       10 *        -1 *        29 *         1 *         0 *     -9999 *\r\n```\r\nwhere -9999 is the default value corresponding to zero in-time energy.\r\n\r\nThe following plot demonstrates the truncation of the ~1% tails in the pulse shape arrival time:\r\n\r\n![mahit_fix](https://user-images.githubusercontent.com/6333978/36806040-1f6eb7ea-1cbf-11e8-918a-4f928568d703.png)\r\n\r\n@mariadalfonso @deguio @jaehyeok ", "branch": "master", "changed_files": 2, "closed_at": "1520409847", "comments": 15, "commits": 2, "created_at": "1519839713", "deletions": 3, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "2e2579f39e3841b771ac4b899187b20538deee3f", "merged_at": "1520409847", "merged_by": "cmsbuild", "milestone": "CMSSW_10_1_X", "number": 22394, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[HCAL] Sanitize Mahi HCAL local reconstruction pulse arrival time values", "updated_at": "1520409847", "user": "jaylawhorn"}
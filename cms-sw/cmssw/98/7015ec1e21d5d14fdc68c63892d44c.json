{"additions": 70, "auther_ref": "better_config_pruning", "auther_sha": "65f69fd93ef83ced0525d50d42b10aa9a155eca9", "author": "alkis-pap", "body": "#### PR description:\r\n\r\n`edmConfigDump` with `--prune` calls the `prune` method of the process object which is extremely slow and can even fail for some configurations because it uses `delattr` to remove unused attributes. Instead it should simply avoid printing the unused attributes to the final output.\r\n\r\nFurthermore, it doesn't remove any PSets even though the data contained in most of them is already copied to the corresponding modules, adding thousands of lines of redundant data to the pruned config. Very few PSets are actually referenced by other PSets via `refToPSet_` and should be kept.\r\n\r\nThe main changes in this PR:\r\n- The `prune` method of  `Process` was renamed to `_unusedAttributes`. Instead of calling `delattr`, it collects the unused attribute names into a list (to preserve order) and returns it. \r\n- `_unusedAttributes` also finds the names of all referenced PSets by recursively finding all `refToPSet_` attributes (elements of `__dict__` not starting with `'_'`) of objects and their children starting from the process object. All PSets that are not referenced are included in the returned list.\r\n- A new `prune` method was added because it's used in some tests (in the same file). It simply calls `delattr` for every attribute returned by `_unusedAttributes`.\r\n- `dumpPython` has a new boolean argument `prune`. If set to true, `_unusedAttributes` will be called and the resulting attributes will not be included in the output\r\n- `edmConfigDump` doesn't call `prune` but sets the `prune` argument accordingly when calling `dumpPython`\r\n\r\n#### PR validation:\r\n\r\nPasses the tests in `FWCore/ParameterSet`", "branch": "master", "changed_files": 2, "comments": 11, "commits": 1, "created_at": "1699981142", "deletions": 48, "labels": ["core-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_16_0_X", "number": 43276, "release-notes": [], "review_comments": 0, "state": "open", "title": "faster edmConfigDump with --prune, also prunes unreferenced PSets", "updated_at": "1757484224", "user": "alkis-pap"}
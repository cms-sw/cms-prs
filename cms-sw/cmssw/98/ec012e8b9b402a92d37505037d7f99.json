{"additions": 51, "auther_ref": "run2_mAOD_AA_fix_egamma_assoPF", "auther_sha": "a9fc49b7a606548c078d38cd911c23934cf9b87d", "author": "ttrk", "body": "**Description**\r\n\r\nPF candidate association is necessary for a GED electron/photon to avoid double counting energy in PF isolation.\r\n\r\nIn AOD, the association is stored in `particleBasedIsolation` object. In miniAOD, association is accessible via `associatedPackedPFCandidates()` of a pat electron/photon (e.g. [here](https://github.com/cms-sw/cmssw/blob/4883b2eac701c829419f974811c1cd2f6550bd56/DataFormats/PatCandidates/interface/Photon.h#L314)), the AOD-2-miniAOD process transfers the association between objects.\r\n\r\nCurrently, the transfer does not work correctly for 2018 PbPb data, i.e. `run2_miniAOD_pp_on_AA_103X` process. This is understood as packedPFcandidates in this workflow is made from an intermediate, \"cleaned\" PF collection (introduced via [PR](https://github.com/cms-sw/cmssw/pull/31668)) and while references in `particleBasedIsolation` are still the ones from original PF collection. The `associatedPackedPFCandidates` collection created in current workflow is not correct.\r\n\r\nThis PR fixes the problem by producing a map between original (old) and the cleaned (new) PF candidate references and updating the references in `particleBasedIsolation` from old to new ones.\r\n\r\n**Validation**\r\nTests pass wf 140.5611 and give correct output.\r\n\r\n@mandrenguyen", "branch": "master", "changed_files": 4, "comments": 34, "commits": 5, "created_at": "1647531006", "deletions": 6, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_12_4_X", "number": 37262, "release-notes": [], "review_comments": 8, "state": "open", "title": "Associated PF for Egamma in 2018 PbPb miniAOD", "updated_at": "1650854371", "user": "ttrk"}
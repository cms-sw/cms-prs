{"additions": 117, "auther_ref": "master_GPUrunTheMatrix", "auther_sha": "1ac63f5e79160751041a05190010a556c7248598", "author": "srimanob", "body": "#### PR description:\r\nThis PR is to introduce how the workflow with GPU attributes will look like. This follows https://docs.google.com/document/d/150k_VBbja1EK9HlxhXs544T0uhenbad8dnMadyNKlpg/edit?usp=sharing\r\nhttps://docs.google.com/document/d/1shJAEaPDIWF0S3odHm3SSMERhvlTozyTKP8cgfFcOto/edit?usp=sharing\r\n\r\nThe original PR is on 11_3:\r\nhttps://github.com/cms-sw/cmssw/pull/33057\r\non WM side:\r\n\r\n- https://github.com/dmwm/WMCore/issues/10388\r\n- https://github.com/dmwm/WMCore/issues/10393\r\n\r\nDefault attributes when GPU is required are:\r\n```\r\n'GPUParams': {'CUDACapabilities': ['7.5'],\r\n                         'CUDADriverVersion': '',\r\n                         'CUDARuntime': '11.2',\r\n                         'CUDARuntimeVersion': '',\r\n                         'GPUMemory': '8000',\r\n                         'GPUName': ''},\r\n```\r\n\r\n#### PR validation:\r\nCall the GPU workflow and overwrite the CUDACapabilities, as for example:\r\nrunTheMatrix.py --what upgrade -l 11650.502 --RequiresGPU required --wm init --CUDACapabilities 6.1,7.5\r\n\r\n```\r\n{'AcquisitionEra': 'CMSSW_12_0_X_2021-04-26-2300',\r\n 'CMSSWVersion': 'CMSSW_12_0_X_2021-04-26-2300',\r\n 'Campaign': 'CMSSW_12_0_X_2021-04-26-2300',\r\n 'ConfigCacheUrl': 'https://cmsweb.cern.ch/couchdb',\r\n 'DQMConfigCacheID': 1041,\r\n 'DQMUploadUrl': 'https://cmsweb.cern.ch/dqm/relval',\r\n 'DbsUrl': 'https://cmsweb-prod.cern.ch/dbs/prod/global/DBSReader',\r\n 'EnableHarvesting': 'True',\r\n 'GlobalTag': u'113X_mcRun3_2021_realistic_v10',\r\n 'Group': 'ppd',\r\n 'Memory': 3000,\r\n 'Multicore': 1,\r\n 'PrepID': 'CMSSW_12_0_X_2021-04-26-2300__1619514394-ZMM_14',\r\n 'ProcessingString': u'113X_mcRun3_2021_realistic_v10',\r\n 'ProcessingVersion': 1,\r\n 'RequestPriority': 500000,\r\n 'RequestString': 'RVCMSSW_12_0_X_2021-04-26-2300ZMM_14',\r\n 'RequestType': 'TaskChain',\r\n 'Requestor': 'srimanob',\r\n 'ScramArch': 'slc7_amd64_gcc900',\r\n 'SizePerEvent': 1234,\r\n 'SubRequestType': 'RelVal',\r\n 'Task1': {'AcquisitionEra': 'CMSSW_12_0_X_2021-04-26-2300',\r\n           'ConfigCacheID': 1043,\r\n           'EventStreams': 0,\r\n           'EventsPerJob': 100,\r\n           'EventsPerLumi': 100,\r\n           'GPUParams': None,\r\n           'GlobalTag': u'113X_mcRun3_2021_realistic_v10',\r\n           'KeepOutput': True,\r\n           'Memory': 3000,\r\n           'Multicore': 1,\r\n           'PrimaryDataset': 'RelValZMM_14',\r\n           'ProcessingString': u'113X_mcRun3_2021_realistic_v10',\r\n           'RequestNumEvents': 18000,\r\n           'RequiresGPU': None,\r\n           'Seeding': 'AutomaticSeeding',\r\n           'SplittingAlgo': 'EventBased',\r\n           'TaskName': 'ZMM_14TeV_TuneCP5_2021_GenSim'},\r\n 'Task2': {'AcquisitionEra': 'CMSSW_12_0_X_2021-04-26-2300',\r\n           'ConfigCacheID': 1044,\r\n           'EventStreams': 0,\r\n           'GPUParams': None,\r\n           'GlobalTag': u'113X_mcRun3_2021_realistic_v10',\r\n           'InputFromOutputModule': u'FEVTDEBUGoutput',\r\n           'InputTask': 'ZMM_14TeV_TuneCP5_2021_GenSim',\r\n           'KeepOutput': True,\r\n           'LumisPerJob': 10,\r\n           'Memory': 3000,\r\n           'Multicore': 1,\r\n           'ProcessingString': u'113X_mcRun3_2021_realistic_v10',\r\n           'RequiresGPU': None,\r\n           'SplittingAlgo': 'LumiBased',\r\n           'TaskName': 'Digi_2021'},\r\n 'Task3': {'AcquisitionEra': 'CMSSW_12_0_X_2021-04-26-2300',\r\n           'ConfigCacheID': 1042,\r\n           'EventStreams': 0,\r\n           'GPUParams': {'CUDACapabilities': ['6.1', '7.5'],\r\n                         'CUDADriverVersion': '',\r\n                         'CUDARuntime': '11.2',\r\n                         'CUDARuntimeVersion': '',\r\n                         'GPUMemory': '8000',\r\n                         'GPUName': ''},\r\n           'GlobalTag': u'113X_mcRun3_2021_realistic_v10',\r\n           'InputFromOutputModule': u'FEVTDEBUGHLToutput',\r\n           'InputTask': 'Digi_2021',\r\n           'KeepOutput': True,\r\n           'LumisPerJob': 10,\r\n           'Memory': 3000,\r\n           'Multicore': 1,\r\n           'ProcessingString': u'113X_mcRun3_2021_realistic_v10',\r\n           'RequiresGPU': 'required',\r\n           'SplittingAlgo': 'LumiBased',\r\n           'TaskName': 'Reco_Patatrack_PixelOnlyGPU_2021'},\r\n 'TaskChain': 3,\r\n 'TimePerEvent': 10}\r\n```\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\nBackport is https://github.com/cms-sw/cmssw/pull/33057 (also the original PR).\r\n", "branch": "master", "changed_files": 2, "closed_at": "1626139145", "comments": 7, "commits": 2, "created_at": "1619507562", "deletions": 15, "labels": ["code-checks-approved", "orp-pending", "pdmv-pending", "pending-signatures", "tests-pending", "upgrade-pending"], "milestone": "CMSSW_12_0_X", "number": 33538, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Add GPUParams to runTheMatrix workflows", "updated_at": "1626139145", "user": "srimanob"}
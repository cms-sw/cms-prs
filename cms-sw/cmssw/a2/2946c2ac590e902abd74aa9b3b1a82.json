{"additions": 14588, "auther_ref": "clustershape_product_v6", "auther_sha": "1955e3d397a6bd7c6b2c680c62d5f930f4a047e5", "author": "makortel", "body": "This PR adds caching of pixel cluster shape data. As a prerequisite, in order to allow `ClusterShapeTrajectoryFilter` to read data product from Event, the `BaseCkfTrajectoryBuilder` and `TrajectoryFilter` derived classes are transformed from ESProducts to helper plugins.\n\nThe cache can be filled also on demand (`onDemand` parameter of `SiPixelClusterShapeProducer`). This mode might be interesting for HLT, at least in my tests there was improvement in timing. The downside is the need of some sort of synchronization, now done with `edm::SerialTaskQueue` (not sure if this is the best approach). I think any solution used for on-demand `edmNew::DetSetVector<>` should also work here.\n\nThe configuration migration relies on the newly added `refToPSet_` feature (#3072, #3146). The configuration files for the removed ESProducers are still kept for ConfDB migration.\n\nThis PR removes `BaseCkfTrajectoryBuilder` and `ClusterShapeTrajectoryFilter` from the list of thread-unsafe ESProducts. `BaseCkfTrajectoryBuilder::createStartingTrajectory() const` does still modify mutable members, but as the `BaseCkfTrajectoryBuilder` objects are local to each EDModule, the class should in practice be thread-friendly at Event level.\n\nThis PR includes also various cleanups (mainly removal of edm::ParameterSet members) on\n- CkfTrackCandidateMakerBase and TransientInitialStateEstimator\n- ConversionTrackFinder\n- SeedGeneratorFromRegionHitsEDProducer\n- PhotonConversionTrajectorySeedProducerFromQuadruplets(Algo)\n- PhotonConversionTrajectorySeedProducerFromSingleLeg(Algo)\n\nFuture work to be done after this PR gets merged\n- Clean the obsolete ESProducer configuration files\n- Transform also `MuonRoadTrajectoryBuilder` from ESProduct to helper plugin (?)\n  - To be consistent with other TrajectoryBuilders (it would be the only one constructed with ESProducer)\n  - It doesn't seem to be used anywhere currently?\n- Remove mutable members from `BaseCkfTrajectoryBuilder` (done in 69fddd4 in this PR)\n\nReferences\n- TRK POG meeting January 27 https://indico.cern.ch/event/292571/contribution/3/material/slides/0.pdf\n- RECO meeting March 6 https://indico.cern.ch/event/304170/session/4/contribution/15/material/slides/0.pdf\n- TRK POG meeting March 10 https://indico.cern.ch/event/306931/contribution/4/material/slides/0.pdf\n- TRK POG meeting March 24 https://indico.cern.ch/event/308199/contribution/8/2/material/slides/0.pdf\n- https://hypernews.cern.ch/HyperNews/CMS/get/recoTracking/1399.html\n- https://hypernews.cern.ch/HyperNews/CMS/get/code-perf/728.html\n- https://hypernews.cern.ch/HyperNews/CMS/get/edmFramework/3244.html\n\nRebased and tested on CMSSW_7_1_X_2014-04-02-1400, should not change physics results.\n", "branch": "CMSSW_7_1_X", "changed_files": 242, "closed_at": "1397535812", "comments": 60, "commits": 52, "created_at": "1396602325", "deletions": 14182, "labels": ["comparison-available", "core-approved", "fastsim-approved", "hlt-approved", "operations-pending", "pending-signatures", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "1dada838e522c5a93dafff32a2029ed49b1251ff", "merged_at": "1397535812", "merged_by": "ktf", "milestone": "CMSSW_7_1_0_pre7", "number": 3211, "release-notes": [], "review_comments": 7, "state": "closed", "title": "Cache pixel cluster shape data", "updated_at": "1476951422", "user": "makortel"}
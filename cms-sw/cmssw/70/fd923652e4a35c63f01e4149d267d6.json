{"additions": 256, "auther_ref": "clusterTPAssociation", "auther_sha": "00041e00c38c668e9868c3b73a7dae5ce133a724", "author": "makortel", "body": "The current use of `ClusterTPAssociationList` in `QuickTrackAssociatorByHits` is a bit dangerous. Although `edm::Ref`s to `TrackingParticle`s are used in `ClusterTPAssociationList`, there are no checks done at any point if the `Ref`s point to the same `TrackingParticleCollection` as those being associated in `QuickTrackAssociatorByHits`. Possible bugs would have the following symptoms\n- `SimToReco` association returns nothing for a given `TrackingParticle`\n- `RecoToSim` association returns associations of `Track` to the `TrackingParticle`s used in `ClusterTPAssociationList`, that are not necessarily the same as were give as arguments\n\nIn order to catch such bugs, this PR adds a check for the `edm::ProductID` of the `TrackingParticleCollection` to `ClusterTPAssociation(List)` and `QuickTrackAssociatorByHits` by encapsulating the \"raw\" `typedef vector<pair<...>> ClusterTPAssociationList` as `ClusterTPAssociation` class that contains also the `ProductID` of the `TrackingParticleCollection`. On the same go I did some technical cleanup in `ClusterTPAssociationProducer`, including turning it to `global` module and using `fillDescriptions()`.\n\nIn addition, `QuickTrackAssociatorByHitsImpl::associate...(..., TrackingParticleRefVector)` overloads are fixed for the case where the argument `TrackingParticlRefVector` is a subset of the `TrackingParticle`s used in `ClusterTPAssociation`. Without the fix, the argument is ignored and the associations are done using the `TrackingParticle`s in `ClusterTPAssociation`.\n\nRunning the short matrix revealed one such bug, in `TkConvValidator`. The existing plots from DQM GUI (https://goo.gl/zor134) look indeed to be poisoned by the bug (obviously one can judge only based on the empty efficiency plots). Minimal fix was to change `TkConvValidator` to read `TrackingParticleRefVector`.\n\nTested in 8_0_0_pre6, expecting changes only in `EgammaV/ConversionValidator` DQM folder.\n\n@rovere @VinInn \n", "branch": "CMSSW_8_0_X", "changed_files": 19, "closed_at": "1455639745", "comments": 21, "commits": 8, "created_at": "1455111661", "deletions": 197, "labels": ["comparison-available", "dqm-approved", "fastsim-approved", "fully-signed", "orp-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "88256b1307b4e3d9a9e449940d1fbd61c4115784", "merged_at": "1455639745", "merged_by": "cmsbuild", "milestone": "CMSSW_8_0_X", "number": 13242, "release-notes": [], "review_comments": 2, "state": "closed", "title": "Check TrackingParticle ProductID in cluster->TrackingParticle association", "updated_at": "1476957135", "user": "makortel"}
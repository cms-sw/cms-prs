{"additions": 2115, "auther_ref": "embedding_dev_CMSSW_15_1_0_pre1_improveCode", "auther_sha": "2993c3e252fafeb287e2003a1ab6bbbbcede08e4", "author": "KIT-CMS", "body": "#### PR description:\r\n\r\nThis PR restructures and cleans the [tau embedding method](https://twiki.cern.ch/twiki/bin/viewauth/CMS/TauEmbeddingSamplesUL) ([`TauAnalysis/MCEmbeddingTools`](https://github.com/cms-sw/cmssw/tree/master/TauAnalysis/MCEmbeddingTools)) so that it is possible to produce RUN 3 tau embedding samples with CMS submission workflows.\r\nOne goal was to remove the need of `--customise` or `--customise_commands` in the tau embedding `cmsDriver.py` commands.\r\nThis was possible due to modifiers and the possibility to add python config fragments to some `cmsDriver.py` steps.\r\nOnly the `HLT` step required additional modification of the `cmsDriver.py` [config builder](https://github.com/cms-sw/cmssw/pull/48408/files#diff-cdb26c43130acb8faa9c94529dd55a55671d2621695d7c5a2a47aa20a62e62df).\r\n\r\nThe other goal of this PR is to have more understandable, better commented code and therefore sustainable code.\r\n\r\n#### Tau embedding `cmsDriver.py` commands\r\nWith the changes introduced in this PR, tau embedding samples can be produced using the following `cmsDriver.py` commands.\r\n\r\n<details>\r\n<summary>Selection</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step RAW2DIGI,L1Reco,RECO,PAT,FILTER:TauAnalysis/MCEmbeddingTools/Selection_FILTER_cff.makePatMuonsZmumuSelection \\\r\n--processName SELECT \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingSelection \\\r\n--datatier RAWRECO \\\r\n--filein \"root://cmsdcache-kit-disk.gridka.de:1094//store/data/Run2024C/Muon0/RAW/v1/000/380/115/00000/00979445-916c-42e2-8038-428d7bd4f176.root\" \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>LHE and Cleaning</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step USER:TauAnalysis/MCEmbeddingTools/LHE_USER_cff.embeddingLHEProducerTask,RAW2DIGI,RECO \\\r\n--processName LHEembeddingCLEAN \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingCleaning \\\r\n--datatier RAWRECO \\\r\n--procModifiers tau_embedding_cleaning,tau_embedding_mu_to_mu \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Simulation Gen</summary>\r\n\r\n```shell\r\ncmsDriver.py TauAnalysis/MCEmbeddingTools/python/Simulation_GEN_cfi.py \\\r\n--step GEN,SIM,DIGI,L1,DIGI2RAW \\\r\n--processName SIMembeddingpreHLT \\\r\n--mc \\\r\n--beamspot DBrealistic \\\r\n--geometry DB:Extended \\\r\n--era Run3_2024 \\\r\n--conditions auto:phase1_2024_realistic \\\r\n--eventcontent TauEmbeddingSimGen \\\r\n--datatier RAWSIM \\\r\n--procModifiers tau_embedding_sim,tau_embedding_mu_to_mu \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Simulation HLT</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step HLT:Fake2+TauAnalysis/MCEmbeddingTools/Simulation_HLT_customiser_cff.embeddingHLTCustomiser \\\r\n--processName SIMembeddingHLT \\\r\n--mc \\\r\n--beamspot DBrealistic \\\r\n--geometry DB:Extended \\\r\n--era Run3_2024 \\\r\n--conditions auto:phase1_2024_realistic \\\r\n--eventcontent TauEmbeddingSimHLT \\\r\n--datatier RAWSIM \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Simulation Reco</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step RAW2DIGI,L1Reco,RECO,RECOSIM \\\r\n--processName SIMembedding \\\r\n--mc \\\r\n--beamspot DBrealistic \\\r\n--geometry DB:Extended \\\r\n--era Run3_2024 \\\r\n--conditions auto:phase1_2024_realistic \\\r\n--eventcontent TauEmbeddingSimReco \\\r\n--datatier RAW-RECO-SIM \\\r\n--procModifiers tau_embedding_sim \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>Merging</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step USER:TauAnalysis/MCEmbeddingTools/Merging_USER_cff.merge_step,PAT \\\r\n--processName MERGE \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingMergeMINIAOD \\\r\n--datatier USER \\\r\n--procModifiers tau_embedding_merging \\\r\n--inputCommands 'keep *_*_*_*' \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n<details>\r\n<summary>NanoAOD</summary>\r\n\r\n```shell\r\ncmsDriver.py \\\r\n--step NANO:@TauEmbedding \\\r\n--data \\\r\n--scenario pp \\\r\n--conditions auto:run3_data \\\r\n--era Run3_2024 \\\r\n--eventcontent TauEmbeddingNANOAOD \\\r\n--datatier NANOAODSIM \\\r\n--filein ... \\\r\n--fileout ...\r\n```\r\n\r\n</details>\r\n\r\n\r\n#### PR validation:\r\n\r\nI had to disable the tests, as I first have to get RAW samples from tape to create a small set of samples I can use. The test `.root` files right now are only useable for the old structure. \r\nI will deliver tests in the next pull request.\r\n\r\n**UPDATE**\r\nI reactivated the unit tests as I realized I can use the RAW samples from the release validation tests.\r\nBoth, the unit tests as the release validation tests worked locally.", "branch": "master", "changed_files": 80, "comments": 61, "commits": 24, "created_at": "1750854918", "deletions": 1652, "labels": ["operations-approved", "reconstruction-approved", "simulation-approved", "fully-signed", "tests-approved", "orp-pending", "pdmv-approved", "upgrade-approved", "code-checks-approved", "xpog-approved", "tracking", "trk"], "milestone": "CMSSW_16_0_X", "number": 48408, "release-notes": [], "review_comments": 25, "state": "open", "title": "Restructure and comment the tau embedding method", "updated_at": "1758608890", "user": "winterchristian"}
{"additions": 1, "auther_ref": "fix-21096", "auther_sha": "07e927c9a12074ae7ff91ea70c7acef074919aa6", "author": "davidlt", "body": "This resolves https://github.com/cms-sw/cmssw/issues/21096\r\n\r\nASan reported stack-buffer-overflow read of 8 bytes in\r\n`std::hash_specialization<float>::operator()(std::tuple<float> const&)`\r\n\r\nWe have a float (4 bytes) and we get a reference to it as `uint32_t` (4\r\nbytes), but later we get another reference as `result_type`\r\n(`std::size_t`) which is 8 bytes. That's a different storage size. Thus\r\nwe will be reading extra 4 bytes from the memory, which don't belong to\r\nthe float.\r\n\r\nInstead now we properly cast the resulting `uint32_t` to `result_type`,\r\nwhich will not damange the number.\r\n\r\nIn workflow 4000.0 step3 this function is triggered 893'957 times each\r\ntime returning `c61c3c00` (hex), i.e. the same value.\r\n\r\nBefore the fix numbers looked like:\r\n\r\n     358'361 7ff5c61c3c00\r\n     133'306 7fffc61c3c00\r\n      65'670 c61c3c00\r\n      38'466 c61c3c00c61c3c00\r\n       6'039 3f1a36e2c61c3c00\r\n       3'268 d5446cdcc61c3c00\r\n         696 12c61c3c00\r\n         306 3c21e3c5c61c3c00\r\n         305 bc40413ec61c3c00\r\n         305 4014b189c61c3c00\r\n         303 40157dd9c61c3c00\r\n         299 40140ebbc61c3c00\r\n         293 4014df30c61c3c00\r\n         293 401430f5c61c3c00\r\n         288 40164789c61c3c00\r\n        [..]\r\n\r\nAs you can see we almost always had extra garbage from the memory.\r\nOnly 65'670 out of 893'957 times function returned intended value.\r\n\r\nSigned-off-by: David Abdurachmanov <David.Abdurachmanov@cern.ch>", "branch": "master", "changed_files": 1, "closed_at": "1509953777", "comments": 9, "commits": 1, "created_at": "1509877350", "deletions": 2, "labels": ["analysis-pending", "code-checks-approved", "comparison-available", "db-pending", "orp-approved", "pending-signatures", "tests-approved"], "merge_commit_sha": "9d3aefbf647b6a9550a78f4d7c0781db0ab77672", "merged_at": "1509953777", "merged_by": "cmsbuild", "milestone": "CMSSW_10_0_X", "number": 21170, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix reinterpret_cast to a wrong storage size", "updated_at": "1509953777", "user": "davidlt"}
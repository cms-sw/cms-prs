{"additions": 377, "auther_ref": "mtvOptimize", "auther_sha": "cdbca7d4fafcc370546e137b807e64e0d81f97cc", "author": "makortel", "body": "This PR speeds up trackingOnly validation by ~2x at PU200 (most speedup is in seed validation, so since that is not part of the standard validation sequence, the effect on standard workflows is smaller). The main optimizations are\r\n- replace `std::unordered_set<unsigned>` that are sets of indices with a newly added `edm::IndexSet`\r\n  * `edm::IndexSet` is just a `std::vector<bool>` with set-style interface\r\n- use the already-made track<->TrackingParticle association (`trackingParticleRecoTrackAsssociation`) also for B-hadron MTV instance\r\n- in `VertexAssociatorByPositionAndTracks::associateRecoToSim()`, select sim PVs only once from all `TrackingVertices`\r\n- call `associationMapFilterValues()` to recoToSim association only once as there is no need to repeat it for each track collection (that is used as the key for searches on the association)\r\n- (last commit 7c30497 was originally a shortening of a loop over TrackingParticles, but that went already in with #18073, so it got left as removing repeated calculation of eta and phi)\r\n\r\nIn addition certain parts of the `analyze()` body were moved to separate functions so that they become visible in profiler.\r\n\r\nThere is potential for further improvements, but those need more thought and work (now the hottest spot is calculation of DeltaR between seeds).\r\n\r\nTested in 9_1_0_pre2, no changes expected.\r\n\r\n@rovere @VinInn @ebrondol ", "branch": "master", "changed_files": 10, "closed_at": "1493195602", "comments": 16, "commits": 8, "created_at": "1492587755", "deletions": 199, "labels": ["analysis-pending", "comparison-available", "core-approved", "dqm-approved", "orp-pending", "pending-signatures", "reconstruction-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "f032f1b05986760dd9604cb6592108512cd603da", "merged_at": "1493195602", "merged_by": "davidlange6", "milestone": "CMSSW_9_1_X", "number": 18399, "release-notes": [], "review_comments": 4, "state": "closed", "title": "Speed up MultiTrackValidator", "updated_at": "1493195603", "user": "makortel"}
{"additions": 28, "auther_ref": "random_generator", "auther_sha": "5be5661abc99143462689ab26fe650536ac42275", "author": "civanch", "body": "Recently it was discovered, that some of components of FastSim calls CLHEP default directly instead of access to the generator via CMSSW Service. Potentially, this may provide data race and/or non-reproducibility of results in MT mode, because the default CLHEP engine is static. Due to this problem we stack with migration to the recent CLHEP 4.2.0.0\r\n\r\nCurrently, known places in FastSim where CLHEP or Geant4 calls to engine are used : HF shower library, FTF nuclear interaction, CTTPS forward simulation.\r\n\r\nFastSim has utility which access CMSSW Service correctly. In this clean-up a thread save method to initialise random engine is added using FullSim approach, so in all sampling, even in Geant4 components, the same random generator will be used. Current default for FastSim is TRandom3 but any other may be configured. Additionally, the inline methods of this utility are modified to reduce number of \"if\" and to use common interface to Gauss and Poisson sampling.\r\n\r\nThe payment for this fix - direct dependence of FastSim/Utilities on Geant4. Note, that FastSim already depends on Geant4 directly and indirectly, I do not think that this dependence make a problem. Also random number sequence will be different, so many differences should be seen in FastSim WFs.", "branch": "master", "changed_files": 8, "comments": 69, "commits": 7, "created_at": "1513257808", "deletions": 38, "labels": ["code-checks-approved", "comparison-available", "fastsim-approved", "fully-signed", "orp-pending", "tests-approved"], "milestone": "CMSSW_10_0_X", "number": 21714, "release-notes": [], "review_comments": 0, "state": "open", "title": "Random generator service for FastSim", "updated_at": "1513861691", "user": "civanch"}
{"additions": 457, "auther_ref": "from-CMSSW_10_1_X_concurrentAndGlobalSiStripGains", "auther_sha": "5fa99ece8b8e3b2421925eb555c2b683419cb302", "author": "mmusich", "body": "   Greetings,\r\nI am re-proposing #22320 with a clean git history this time, and some further cleaning. \r\nThe purpose of https://github.com/cms-sw/cmssw/commit/ec655a6e3d1afabbe57d1a786e79246c7a1a898d remains the same, moving the \"worker\" step of the SiStrip gains PCL workflow to concurrent and global DQM.\r\nThe advantage in terms of memory consumption, after the migration to `edm::one` of the `DQMEDAnalyzer`, of running step3 of `runTheMatrix.py -l 1001.0 -t 4` is reduced, but still visible.\r\n![image](https://user-images.githubusercontent.com/5082376/37102823-ff93df6c-2228-11e8-8314-d1b1f42f2a93.png)\r\nThe other advantage I can see is that if running (in standalone mode) the Gain Calibration in a plain `CMSSW_10_1_0_pre2`  (in single-threaded mode) via:\r\n\r\n```bash\r\ncmsDriver.py step3 --datatier ALCARECO --conditions auto:run2_data -s ALCA:PromptCalibProdSiStripGains --eventcontent ALCARECO -n 100 --dasquery='file dataset=/ZeroBias/Run2016C-SiStripCalMinBias-18Apr2017-v1/ALCARECO run=276097'\r\n```\r\nfollowed by:\r\n\r\n```bash\r\ncmsDriver.py stepHarvest --data --conditions auto:run2_data --scenario pp -s ALCAHARVEST:SiStripGains --filein file:PromptCalibProdSiStripGains.root -n 100 --fileout file:calib.root\r\n```\r\none receives a segmentation fault (stack is available [here](https://gist.github.com/mmusich/4441a57cfe2af315ce1e3be7a3abbf34) ), while this PR changes this is not the case.\r\nRunning the step3 in MT mode even in `CMSSW_10_1_0_pre2` with:\r\n\r\n```bash\r\ncmsDriver.py step3 --datatier ALCARECO --conditions auto:run2_data -s ALCA:PromptCalibProdSiStripGains --eventcontent ALCARECO -n 100 --dasquery='file dataset=/ZeroBias/Run2016C-SiStripCalMinBias-18Apr2017-v1/ALCARECO run=276097' --nThreads 4\r\n```\r\ndoesn't produce a segfault.\r\nI profit of this PR to update the unit test with the standalone harvester step  to be run in sequence after the Analyzer step in https://github.com/cms-sw/cmssw/commit/5fa99ece8b8e3b2421925eb555c2b683419cb302. \r\nAs a final note to the reviewers no algorithmic change is intended by this PR, so both calibration output and monitoring plots shall remain the same. This is validated cross-checking the outputs of running the workflow on 1000 events of run 276097 [here](http://musich.web.cern.ch/musich/display/diff_gains_final.pdf).\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  \r\n", "branch": "master", "changed_files": 11, "closed_at": "1521650332", "comments": 11, "commits": 2, "created_at": "1520439058", "deletions": 317, "labels": ["alca-approved", "code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "tests-approved"], "merge_commit_sha": "e92a01345dc20710be9c1c1de255586a2eba6ea7", "merged_at": "1521650332", "merged_by": "cmsbuild", "milestone": "CMSSW_10_1_X", "number": 22515, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Migrate SiStripGainsPCLWorker to concurrent and global DQM", "updated_at": "1521650333", "user": "mmusich"}
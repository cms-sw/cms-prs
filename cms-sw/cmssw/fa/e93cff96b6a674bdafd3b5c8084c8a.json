{"additions": 354, "auther_ref": "Phase1-HE28-100X", "auther_sha": "4ef247381d5b27671625101d7ac9b02c08aac8ae", "author": "kpedro88", "body": "After the GT updates in #21395, this long-planned update can finally be submitted.\r\n\r\nWith SiPMs, there are two independent contributions to the electronics noise:\r\n1. Usual Gaussian pedestal (from QIE, etc.)\r\n2. Dark current + crosstalk (from SiPM)\r\n\r\nPreviously, the dark current contribution had been included in Method 2 reconstruction in a somewhat haphazard/inconsistent way. Instead, we prefer to measure the pedestals twice (with and without bias voltage), so we do not induce any dependence in the data reconstruction on the *modeling* of SiPM noise. The simulation will still use the (unlabeled) bias voltage off measurement (QIE-only), while the reconstruction uses the \"effective\" bias voltage on measurement, so the dark current is included naturally in both the pedestal means and widths.\r\n\r\nThe terms in the Method 2 reconstruction are changed automatically depending on whether the effective pedestal is stored in the channel info or not (so the old way is still supported). A boolean member is added to the channel info class to keep track of which type of pedestals are stored.\r\n\r\n*Also*, this PR fixes a bug for Phase2 where the dark current was subtracted before calculating the nonlinearity correction for SiPMs. The dark current should be kept when calculating the nonlinearity correction, because it results in pixels firing, the same as signal. This results in a few % change in the pion energy scale for Phase2. (The effective pedestals in hardcode conditions are computed using the model-dependent equations, since this is MC-only usage.)\r\n\r\nMore details in a talk co-written by myself and @abdoulline: https://indico.cern.ch/event/680480/contributions/2787885/attachments/1556785/2448593/Dual_peds_S.A._Nov13_2017.pdf\r\n(including single pion scans for [2018](https://cms-cpt-software.web.cern.ch/cms-cpt-software/General/Validation/SVSuite/HCAL/calo_scan_single_pi/Dual_peds/940pre3_2018_Dual_peds_v2_effective_vs_94X_2018_SinglePi/) and [2023](https://cms-cpt-software.web.cern.ch/cms-cpt-software/General/Validation/SVSuite/HCAL/calo_scan_single_pi/Dual_peds/940pre3_2023D17_dual_vs_940pre3_2023D17_default_SinglePi/), showing expected results)\r\n\r\nattn: @abdoulline, @mariadalfonso, @igv4321, @bsunanda, @hatakeyamak, @deguio ", "branch": "master", "changed_files": 28, "closed_at": "1512648059", "comments": 78, "commits": 13, "created_at": "1511372438", "deletions": 178, "labels": ["alca-approved", "code-checks-approved", "comparison-available", "db-pending", "hlt-approved", "orp-approved", "pending-signatures", "reconstruction-approved", "simulation-approved", "tests-approved"], "merge_commit_sha": "3544062d14974c5550d56136643671f475e3b830", "merged_at": "1512648058", "merged_by": "cmsbuild", "milestone": "CMSSW_10_0_X", "number": 21438, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Use of effective pedestals for HCAL Phase1/Phase2 reco", "updated_at": "1512648059", "user": "kpedro88"}
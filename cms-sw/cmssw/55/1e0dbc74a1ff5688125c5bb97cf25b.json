{"additions": 332, "auther_ref": "ak_new_lhcInfo_reco_squashed2", "auther_sha": "f5c24ce0440e40443b68d6b5158aa77dfc3229a2", "author": "CTPPS", "body": "Following LHCInfo update introducing 2 new records `LHCInfoPerFill` and `LHCInfoPerLS` (https://github.com/cms-sw/cmssw/pull/39495) and their O2Os (https://github.com/cms-sw/cmssw/pull/40817) this PR introduces:\r\n* helper `LHCInfoCombined` class that is meant to be used where old `LHCInfo` was used \r\n* every change needed to run `recoCTPPS` with only `LHCInfoPer*`\r\n\r\nLHCInfoCombined can be created using either `LHCInfoPer*` or `LHCInfo` and is not meant to be serialised. It selects the source depending on the constructor parameter `useNewLHCInfo` that can be set based on era (since Run3 GTs won't contain `LHCInfo` records and Run2 GTs contain only those) in the python _cff file, eg.:\r\n\r\nhttps://github.com/CTPPS/cmssw/blob/bb215fd85be7746ec3449516b4c0565aaf1f624f/CalibPPS/ESProducers/python/ctppsOpticalFunctions_cff.py#L32-L33\r\n\r\nIn order to make `recoCTPPS` able to use `LHCInfoPer*` or `LHCInfo` following modules were updated:\r\n* CTPPSProtonProducer\r\n* CTPPSInterpolatedOpticalFunctionsESSource\r\n\r\nFrom PPS side this is the version of code meant to be used in re-reco of 2022 data.\r\n\r\n#### PR validation:\r\n\r\nValidation can be done by running `recoCTPPS` for fill 9019:\r\n```\r\ncd Calibration/PPSAlCaRecoProducer/test\r\ncmsRun 2023_lhcinfo_test_recoCTPPS_cfg.py\r\n```\r\nand checking if h_multiplicity, h_xi and p_th_y_vs_xi for singleRP plots in `alcareco_protons_express.root` are not empty.\r\n\r\nAdditionally it was tested by comparing the aformentioned plots with the same plots generated with the code before changes from this PR. To generate plots for code before changes 2023_lhcinfo_test_recoCTPPS_cfg.py was copied and run with a tag with properly generated LHCInfo payloads for fill 9019 ( 130X_dataRun3_Prompt_forLHCInfo_Candidate_2023_07_28_12_52_37 )", "branch": "master", "changed_files": 19, "comments": 44, "commits": 13, "created_at": "1691526143", "deletions": 61, "labels": ["reconstruction-pending", "dqm-pending", "alca-pending", "db-pending", "pending-signatures", "tests-pending", "orp-pending", "requires-external", "code-checks-pending", "ctpps"], "milestone": "CMSSW_13_3_X", "number": 42515, "release-notes": [], "review_comments": 34, "state": "open", "title": "CTPPS reco update to use LHCInfoPer* records", "updated_at": "1692271263", "user": "Glitchmin"}
{"additions": 206, "auther_ref": "emtf_patch_20200719", "auther_sha": "7a32ba713d73b9d14a36e6b7f04a9b95054eba4c", "author": "jiafulow", "body": "#### PR description:\r\n\r\nDue to the [incident](https://hypernews.cern.ch/HyperNews/CMS/get/tier0-Ops/2170.html) from the recent MWGR, we found out that the EMTF emulator might crash if it receives CSC LCTs with unexpected parameters. This PR aims to **improve protection against such corrupted LCT data**.\r\n\r\nThe specific cause of the crash was the corrupted LCT pattern number. This pattern number is used to address a LUT to retrieve the phi coordinate correction value. The LUT expects a pattern number between 0 and 10. However, due to data corruption, the pattern number might exceed 10, and this line: `ph_patt_corr_.at(pattern);` would throw.\r\n\r\nChanges made:\r\n- To prevent this from happening in the future, all the functions involving a LUT in `L1Trigger/L1TMuonEndCap/src/SectorProcessorLUT.cc` now use \"try-catch\" blocks to catch errors due to `at()`.\r\n- In `L1Trigger/L1TMuonEndCap/src/PrimitiveSelection.cc`, the LCT parameters such as strip, wire, valid, pattern, and quality, are now checked against allowed values. If any of the LCT parameters are found to be corrupted, the LCT is rejected (i.e. it is not used in any subsequent steps in the track finder, including coordinate conversion). The warning messages have been expanded.\r\n- The current logic that tries to patch the pattern number and the quality number has been removed.\r\n\r\n#### PR validation:\r\n\r\nValidated with:\r\n\r\n- `runTheMatrix.py -l limited -i all -j10`. The only errors were coming from `DAS_ERROR`.\r\n- Re-processing the raw data from the Run 336345 during MWGR, the EMTF emulator doesn't crash anymore.\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nN/A\r\n\r\n---\r\nNotifications: @eyigitba ", "branch": "master", "changed_files": 4, "closed_at": "1595913456", "comments": 28, "commits": 3, "created_at": "1595182230", "deletions": 75, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "l1-approved", "orp-approved", "tests-approved", "urgent"], "merge_commit_sha": "da5db30654b63cba022224827f4ae0d1170cbb97", "merged_at": "1595913456", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 30830, "release-notes": [], "review_comments": 4, "state": "closed", "title": "EMTF: Improve protection against corrupted LCT data", "updated_at": "1595913457", "user": "jiafulow"}
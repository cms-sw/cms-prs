{"additions": 162, "auther_ref": "EMTF_unpackerUpdate_run3MEDAQ_Jul22", "auther_sha": "a91df54d21a23c7c2bf60cc899d406c9a6becf18", "author": "eyigitba", "body": "#### PR description:\r\n\r\nThis PR mainly contains the updates to the EMTF unpacker for CSC inputs. In June we discovered that EMTF DAQ output did not contain all the relevant information for Run 3 CSC TPs. Now that they are added in firmware and tested at P5, we want to update the CMSSW unpacker with these changes.\r\n\r\nBulk of the changes are in `EMTFBlockME.cc` and `ME.h` data format. There is a small bug fix in EMTF emulator `PrimitiveConversion.cc` and one in `EMTFBlockSP.cc`. \r\n\r\nDetails of the changes:\r\n\r\n- Added new fields in `ME.h` for Run 3 CSC TP data format. These are the variables related to the CCLUT algorithm and the HMT related variables.\r\n- Modified `EMTFBlockME.cc` to match the new EMTF DAQ output format. In Run 3, EMTF receives different types of CSC TPs depending on the ring. So, the meanings of some fields in EMTF DAQ is different in ring == 1 vs ring == 2 & 3.\r\n- Modified `EMTFBlockME.cc` to produce `CSCShowerDigiCollection` based on HMT related bits in the new DAQ format.\r\n- Added `Hit_.Valid() == 1` check to `EMTFBlockME.cc`. This check will become necessary when EMTF start receiving valid HMTs without valid LCTs (Currently they always come with valid LCTs). \r\n- Fixed the definition of nominal shower bit in `EMTFBlockSP.c`.\r\n- Fixed a bug in `PrimitiveConversion.cc` related to the Run 3 CSC TP pattern calculation. Since the Run 3 TPs were not enabled before, this wasn't caught earlier.\r\n- Modified `EMTFUnpackerTools.cc` and `EMTFHit.cc` to assign the new Run 3 parameters to the `EMTFHit` class and  `CSCCorrelatedLCTDigi` made by EMTFHit class.\r\n- Rest of the modifications in `L1TRawToDigi` are related to producing `CSCShowerDigiCollection` in `EMTFBlockME.cc`\r\n\r\nWe expect some changes in the EMTF emulator behaviour in unpacked data from P5 and also when [PR](https://github.com/cms-sw/cmssw/pull/38373) gets merged to enable Run 3 CSC TPs in EMTF.   \r\n\r\nThis PR is necessary to have good data/emulator agreement for EMTF during data taking. So, it needs to be backported to 12_4_X (not super urgent, but the sooner the better)\r\n\r\n<!-- Please replace this text with a description of the feature proposed or problem addressed, specifying:\r\n  - what changes are expected in the output if any, \r\n  - what other PRs or externals it depends upon if any,\r\n  - link to any additional material useful to provide a documentation for this PR (slides, JIRA tickets, related pull requestes, hypernews, TWiki or Indico pages)  -->\r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\nValidated by doing data/emulator comparisons in private repository which shows 100% agreement.\r\n\r\nAlso validated by `runTheMatrix.py -l limited -i all --ibeos` none of the tests failed.\r\n\r\n#### If this PR is a backport please specify the original PR and why you need to backport that PR. If this PR will be backported please specify to which release cycle the backport is meant for:\r\n\r\nN/A\r\n<!-- Please replace this text with any link to the master PR, or the intended backport release cycle numbers -->\r\n\r\n<!-- Please delete the text above after you verified all points of the checklist  -->\r\n", "branch": "master", "changed_files": 11, "comments": 3, "commits": 3, "created_at": "1657104201", "deletions": 17, "labels": ["l1-pending", "pending-signatures", "orp-pending", "tests-started", "code-checks-approved"], "milestone": "CMSSW_12_5_X", "number": 38615, "release-notes": [], "review_comments": 0, "state": "open", "title": "Emtf Unpacker/Emulator Update for Run 3 CSC TPs", "updated_at": "1657104893", "user": "eyigitba"}
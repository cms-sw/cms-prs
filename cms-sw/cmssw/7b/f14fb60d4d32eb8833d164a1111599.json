{"additions": 208, "auther_ref": "phase2_lorentzAngle_fromDB_alternate", "auther_sha": "4590f5d4ba0a20f4fc13295e2d376820cab49d9e", "author": "mmusich", "body": "#### PR description:\r\nUpcoming developments in the Phase-2 Inner Tracker digitization and local reconstruction require access to several conditions related to the CPE, namely per-module Pixel Lorentz Angle (both for simulation and reconstruction) and in future also Pixel 1D, 2D Templates and Generic Errors.\r\nCurrently only the generic CPE algorithm is used for the Inner Tracker local reconstruction (hence only the Lorentz Angle is accessed) and it is is provided via a fake conditions `ESSource`:  [SiPixelFakeLorentzAngleESSource](https://github.com/cms-sw/cmssw/blob/master/CalibTracker/SiPixelESProducers/plugins/SiPixelFakeLorentzAngleESSource.cc).  This `ESSource` makes use of the `DetId` list from a Skimmed Geometry external file: one DetId list for each geometry ([example](https://github.com/cms-sw/cmssw/blob/master/SLHCUpgradeSimulations/Geometry/python/fakeConditions_phase2TkT14_cff.py#L11)) and only one single LA (H =0.106) for all IT modules is used ([hardcoded](https://github.com/cms-sw/cmssw/blob/master/CalibTracker/SiPixelESProducers/plugins/SiPixelFakeLorentzAngleESSource.cc#L53)).\r\nMoreover the `forWidth ` label is not taken from DB  (see [PixelCPEGeneric_cfi ](https://github.com/cms-sw/cmssw/blob/master/RecoLocalTracker/SiPixelRecHits/python/PixelCPEGeneric_cfi.py#L72) configuration) hence no correction is applied, and the simulation LA value is passed as a configuration parameter in the digitizer (see [phase2TrackerDigitizer_cfi.](https://github.com/cms-sw/cmssw/blob/master/SimTracker/SiPhase2Digitizer/python/phase2TrackerDigitizer_cfi.py#L50-L51)).\r\nFinally the Generic Errors are also not taken from DB (see [PixelCPEGeneric_cfi](https://github.com/cms-sw/cmssw/blob/master/RecoLocalTracker/SiPixelRecHits/python/PixelCPEGeneric_cfi.py#L72)) but are  hard-coded in C++ (see [PixelCPEGeneric.cc](https://github.com/cms-sw/cmssw/blob/master/RecoLocalTracker/SiPixelRecHits/src/PixelCPEGeneric.cc#L114)).\r\nThis PR is meant to change part of this situation, switching on the reading of conditions from Database where payloads are available, and provide such payloads in the production DB.\r\nThe implementation is complicated by the co-existence in release of several geometries, with different `DetId`s lists, and all need to be supported, hence the needed conditions cannot simply be added to the `phase2_realistic` autoCond Global Tag key to satisfy all use-cases. \r\nIn this PR we propose a solution based on an additional `ESSource` configured differently for each Tracker `T*` geometry via the `fakeConditions_phase2TkT*_cff.py` files (already included in the geometry definition).  \r\nFor the D45 geometry a new `SLHCUpgradeSimulations.Geometry.fakeConditions_phase2TkT15_cff` file is created, in order to allow for a different set of LA values (H =0.053) to be applied (T14 geometry is supposed to stay with the current value H =0.106).\r\nA complementary approach, based on the dynamical creation of more autoCond keys one for each of the Tracker geometry, has been implemented in PR #27517, though **we prefer this implementation as it automatically binds the conditions to the geometry**. \r\nMore information has been collected in [this presentation](https://indico.cern.ch/event/832785/contributions/3492905/attachments/1876286/3089720/ts_mm_AlCaDBMeeting_8Jul2019.pdf) at the AlCa/DB meeting of 7th July 2019.\r\nThis PR is RFC and in draft state as it is at odds with the purpose of issue https://github.com/cms-sw/cmssw/issues/27393.\r\n\r\n#### PR validation:\r\nThe PR was tested running 1 event of SingleMuPt10 for all the currently supported phase-2 geometry combinations: D35 (T6), D41 (T14), D43 (T14), D44 (T14), D45 (T5) via:\r\n```\r\nrunTheMatrix.py --what upgrade -l 20007.0,20407.0,20807.0,21207.0,21607.0 --command='-n 1' -j 4\r\n```\r\n#### if this PR is a backport please specify the original PR:\r\n\r\nThis PR is not a backport\r\ncc:\r\n@tsusa @emiglior @pwittich @christopheralanwest @tlampen @ggovi ", "branch": "master", "changed_files": 9, "closed_at": "1565673073", "comments": 9, "commits": 8, "created_at": "1563042763", "deletions": 18, "labels": ["code-checks-approved", "comparison-pending", "geometry-pending", "orp-pending", "pending-signatures", "reconstruction-rejected", "simulation-pending", "tests-pending", "upgrade-pending"], "milestone": "CMSSW_11_0_X", "number": 27516, "release-notes": [], "review_comments": 5, "state": "closed", "title": "[RFC]  Phase-2 InnerTracker conditions from DB (version 1)", "updated_at": "1565673073", "user": "mmusich"}
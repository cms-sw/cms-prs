{"additions": 1, "auther_ref": "master", "auther_sha": "a87d5fbd195bc913e5273c7c0072067241e4d757", "author": "ArturAkh", "body": "#### PR description:\r\n\r\nReplacing access to track reference with a more robust approach, which doesn't rely on indices in a list.\r\n\r\nMore details in https://github.com/cms-sw/cmssw/issues/42110\r\n\r\nPlease note, that this change does not introduce any differences into the usual workflows, while allowing correct behaviour for [tau embedding](https://github.com/KIT-CMS/cmssw/tree/embedding_update_for_run3), where parts of the simulated content (simulation of empty detector except of 2 particles) needs to be re-evaluated under data conditions later on. This lead to inconsistencies between the number of GSF tracks considered in the producer, and the number of preid's, such that access by index number was not possible anymore.\r\n\r\nMore details on the problem on slide 11 of the following presentation:\r\n\r\nhttps://indico.cern.ch/event/1301309/#26-tau-embedding-integration-i\r\n\r\n#### PR validation:\r\n\r\nAs mentioned in https://github.com/cms-sw/cmssw/issues/42110 and if looking at\r\n\r\nhttps://github.com/cms-sw/cmssw/blob/master/RecoEgamma/EgammaElectronProducers/plugins/LowPtGsfElectronSeedProducer.cc\r\n\r\nit can be concluded, that the change leads to an equivalent behaviour by construction. Please refer for this to the following code snippets from the `produce` method of  `LowPtGsfElectronSeedProducer`:\r\n\r\n**CTF track set for the seed**\r\n\r\n```cpp\r\n    // Create ElectronSeed\r\n    reco::ElectronSeed seed(*(trackRef->seedRef()));\r\n    if (seed.nHits() == 0) {  //if DeepCore is used in jetCore iteration the seed are hitless, in case skip\r\n      continue;\r\n    }\r\n    seed.setCtfTrack(trackRef);\r\n```\r\n\r\n**Setting the same track for preId's**\r\n\r\n```cpp\r\n    // Create PreIds\r\n    unsigned int nModels = globalCache()->modelNames().size();\r\n    reco::PreId ecalPreId(nModels);\r\n    reco::PreId hcalPreId(nModels);\r\n\r\n    // Add track ref to PreId\r\n    ecalPreId.setTrack(trackRef);\r\n    hcalPreId.setTrack(trackRef);\r\n```\r\n\r\n**Storing  outputs**\r\n\r\n```cpp\r\n    // Store PreId\r\n    ecalPreIds.push_back(ecalPreId);\r\n    hcalPreIds.push_back(hcalPreId);\r\n    trksToPreIdIndx[trackRef.index()] = ecalPreIds.size() - 1;\r\n\r\n    // Store ElectronSeed and corresponding edm::Ref<PreId>.index()\r\n    seeds.push_back(seed);\r\n```\r\n\r\n\r\n", "branch": "master", "changed_files": 1, "closed_at": "1693857903", "comments": 7, "commits": 1, "created_at": "1693478436", "deletions": 1, "labels": ["reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "0295cb18cb10e5774d20c2d910e4dc17ed352357", "merged_at": "1693857902", "merged_by": "cmsbuild", "milestone": "CMSSW_13_3_X", "number": 42690, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Replace the access to track reference with a more robust approach", "updated_at": "1693857903", "user": "ArturAkh"}
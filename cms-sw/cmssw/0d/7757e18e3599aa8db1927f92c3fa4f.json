{"additions": 19, "auther_ref": "devel_sanityCheckfixHLTRecHitInAllL1RegionsProducer_130X", "auther_sha": "ed4373d97a84efdebda63c43553b142a144918c2", "author": "missirol", "body": "backport of #41466\r\n\r\n#### PR description:\r\n\r\nThis PR adds a check to `HLTRecHitInAllL1RegionsProducer<T>` to handle gracefully events where the input collection of L1T candidates is empty (either completely empty, or even empty just for BX=0).\r\n\r\nFor such events, pre-PR the plugin can crash [here](https://github.com/cms-sw/cmssw/blob/0d6218db24f97d34933bda623816949d340262ba/RecoEgamma/EgammaHLTProducers/plugins/HLTRecHitInAllL1RegionsProducer.cc#L92). This type of crash was observed multiple times online in the last days. The root cause of the problem (i.e. missing L1T candidates) is likely related to issues with the L1T menu deployed a couple of weeks ago ([CMSLITOPS-411](https://its.cern.ch/jira/browse/CMSLITOPS-411)).\r\n\r\nA reproducer is in [1], and it produces the [stack trace attached here](https://github.com/cms-sw/cmssw/files/11360931/run366727.log) (which matches the error log seen online).\r\n\r\nFYI: @Sam-Harper @swagata87 (as this module is used by E/gamma triggers)\r\n\r\n[1]\r\n```bash\r\n#!/bin/bash\r\n\r\n# cmsrel CMSSW_13_0_3\r\n# cd CMSSW_13_0_3/src\r\n# cmsenv\r\n\r\nhltGetConfiguration run:366727 \\\r\n  --globaltag 130X_dataRun3_HLT_v2 --data \\\r\n  --no-prescale --no-output \\\r\n  --max-events -1 \\\r\n  --input dummy.root \\\r\n  > hlt.py\r\n\r\ncat <<@EOF >> hlt.py\r\ndel process.DQMOutput\r\n\r\nprocess.options.numberOfThreads = 1\r\nprocess.options.numberOfStreams = 0\r\n\r\nprocess.hltOnlineBeamSpotESProducer.timeThreshold = int(1e6)\r\n\r\ndel process.MessageLogger\r\nprocess.load('FWCore.MessageService.MessageLogger_cfi')\r\nprocess.MessageLogger.cerr.FwkReport.reportEvery = 1\r\nprocess.MessageLogger.cerr.enableStatistics = False\r\nprocess.MessageLogger.cerr.threshold = 'INFO'\r\n\r\nfrom EventFilter.Utilities.FedRawDataInputSource_cfi import source as _source\r\nprocess.source = _source.clone(\r\n    eventChunkSize = 200,\r\n    eventChunkBlock = 200,\r\n    numBuffers = 4,\r\n    maxBufferedFiles = 4,\r\n    fileListMode = True,\r\n    fileNames = [\r\n      \"/eos/cms/store/group/dpg_trigger/comm_trigger/TriggerStudiesGroup/FOG/error_stream/run366727/run366727_ls0136_index000137_fu-c2b04-34-01_pid3305175.raw\",\r\n    ]\r\n)\r\n\r\nfrom EventFilter.Utilities.EvFDaqDirector_cfi import EvFDaqDirector as _EvFDaqDirector\r\nprocess.EvFDaqDirector = _EvFDaqDirector.clone(buBaseDir = '.', runNumber = 0)\r\n@EOF\r\n\r\ncmsRun hlt.py &> hlt.log\r\n```\r\n\r\n#### PR validation:\r\n\r\nWith the changes in this PR, the reproducer does not crash.\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR. If this PR will be backported, please specify to which release cycle the backport is meant for:\r\n\r\n#41466\r\n\r\nBugfix to plugin used at HLT in release cycle used for data-taking in 2023.", "branch": "CMSSW_13_0_X", "changed_files": 2, "comments": 12, "commits": 1, "created_at": "1682839063", "deletions": 1, "labels": ["hlt-approved", "fully-signed", "tests-rejected", "orp-pending", "bug-fix", "urgent", "backport"], "milestone": "CMSSW_13_0_X", "number": 41467, "release-notes": [], "review_comments": 0, "state": "open", "title": "guard `HLTRecHitInAllL1RegionsProducer<T>` against empty collection of L1T candidates [`13_0_X`]", "updated_at": "1682859936", "user": "missirol"}
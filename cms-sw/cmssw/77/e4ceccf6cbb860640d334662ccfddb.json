{"additions": 792, "auther_ref": "l1tZDCEmulator_uGT_CMSSW13_3_X", "auther_sha": "b23839a968b456876f856200e8e17eccb4b1bdcc", "author": "elfontan", "body": "#### PR description:\r\nThis draft PR includes an update of the uGT emulator for new ZDC triggers included in the Heavy Ion menu for the 2023 data-taking. The implementation relies on new developments included in the [utm libraries v0_11_0](https://globaltrigger.web.cern.ch/globaltrigger/release/utm/latest_doc/html/releaseNotes/v0_11_0.html).\r\n\r\nThe main changes are the following:\r\n* The `TriggerMenuParser` is adapted to parse the new `ZDCPlus` and `ZDCMinus` conditionTypes from the xml menu.  A dedicated parsing function `parseZdcEnergySum` is included to relate these objects to the new `ZdcEnergySumTemplate`.\r\n* The GlobalBoard is updated to receive a new category of objects similar to the EtSum from the CaloLayer2 coming from the new ZDC Producer included in https://github.com/cms-sw/cmssw/pull/42634.\r\n* A dedicated `ZdcEnergySumTemplate` and a `ZdcEnergySumCondition` class are developed for checking the EtSum threshold on the ZDC objects.\r\n* The ste of input tags to the `L1TGlobalProducer` is updated in `simGtStage2Digis_cfi.py`.\r\n\r\nThe following L1Ntuples workflows are also updated to include the new input tags for ZDC objects:\r\n* `L1NtupleEMU_cff.py`\r\n* `L1NtupleRAW_cff.py`\r\n* `l1UpgradeTree_cfi.py`\r\n\r\nStill unclear how we need to update the [customiseReEmul.py](https://github.com/cms-sw/cmssw/blob/master/L1Trigger/Configuration/python/customiseReEmul.py) sequence to include the L1ZDCProducer. Current tests have been done manually adding to the configuration file the following lines:\r\n```\r\nprocess.zdcEtSumProducer = cms.EDProducer('L1TZDCProducer',\r\n  zdcToken = cms.InputTag(\"hcalDigis\", \"ZDC\"),\r\n  doHardCodeLUT = cms.bool(True)\r\n)\r\n\r\nprocess.zdcEtSum = cms.Path(process.zdcEtSumProducer)\r\nprocess.schedule.append(process.zdcEtSum)\r\n```\r\n\r\n#### PR validation:\r\nAll these changes have been added on top of the updates in https://github.com/cms-sw/cmssw/pull/42634 following the recipe in the [README](https://github.com/cfmcginn/cmssw/blob/zdcL1T_latest/L1Trigger/L1TZDC/README.md). A configuration file for a 2018 HI run has been obtained following the [recipe provided by the HI team](https://github.com/mitaylor/L1StudiesFramework/blob/main/RunPbPbL1Ntuples/runCmsDriver_2018Data.sh#L29).\r\nThe produced L1Ntuple stores the new ZDCEnergySums. \r\nCountings for the ZDC algorithms are present in the uGTEmuTree. However, they are currently based on the comparison with a dummy energy value included in the ZdcEnergySumCondition class. A missing piece to get the energy sum computed in the ZDCProducer into the uGT is still under investigation.\r\n\r\nThe PR has been prepared starting from CMSSW_13_3_X_2023-08-22-1100:\r\n```\r\ncmsrel CMSSW_13_3_X_2023-08-22-1100\r\ncd CMSSW_13_3_X_2023-08-22-1100/src\r\ncmsenv\r\ngit cms-init\r\nscram b && scram b code-checks && scram b code-format && scram b\r\n```\r\nNote that the updates to the DataFormats from https://github.com/cms-sw/cmssw/pull/42634 are included here as well to avoid the compilation crashes. These changes are overlapping at the moment. We need to understand how to disentangle the two PRs, if possible, or just create a single one.\r\n\r\n#### Additional notes:\r\nA backport to CMSSW_13_2_X will be needed as that is the release designated for the 2023 HI data-taking.\r\n\r\nTagging relevant people for:\r\n* the HI group: @cfmcginn @ginnocen @icali @hjbossi \r\n* L1T OPS and DPG: @bundocka @eyigitba @lathomas @caruta ", "branch": "master", "changed_files": 24, "comments": 23, "commits": 4, "created_at": "1692737153", "deletions": 23, "labels": ["l1-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved"], "milestone": "CMSSW_13_3_X", "number": 42635, "release-notes": [], "review_comments": 21, "state": "open", "title": "Updates of the uGT emulator and L1Ntuple workflows for ZDC signals", "updated_at": "1693245538", "user": "elfontan"}
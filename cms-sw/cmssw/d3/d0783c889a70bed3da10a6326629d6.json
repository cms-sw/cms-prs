{"additions": 77, "auther_ref": "dl220915t", "auther_sha": "68fc2b3ef8865796c09898f6a380bebcece52e30", "author": "davidlange6", "body": "Extends #36963 by adding a backend parameter to models, used by\r\n\r\ncms::Ort::getSessionOptions(iConfig.getParameter<std::string>(\"onnx_backend\"));\r\n\r\nCurrent options are\r\n   cpu -> Use CPU backend\r\n   cuda -> Use cuda backend\r\n   default -> Use best available\r\n\r\nThe model used in BoostedJetONNXJetTagsProducer crashes on GPU if the full optimization is included. I reduced this optimization in case a GPU is used (following recipes found on the web). The sort of error one gets is\r\n\r\n```\r\nBase::CudnnHandle(), &alpha, Base::s_.z_tensor, Base::s_.z_data, &alpha, Base::s_.y_tensor, Base::s_.y_data); \r\n2022-08-26 13:26:51.964709271 [E:onnxruntime:, sequential_executor.cc:346 Execute] Non-zero status code returned while running FusedConv node. Name:'Conv_98_Add_99_Relu_100'\r\n Status Message: CUDNN error executing cudnnAddTensor(Base::CudnnHandle(), &alpha, Base::s_.z_tensor, Base::s_.z_data, &alpha, Base::s_.y_tensor, Base::s_.y_data)\r\n----- Begin Fatal Exception 26-Aug-2022 14:26:51 CEST-----------------------\r\nAn exception of category 'StdException' occurred while\r\n   [0] Processing  Event run: 1 lumi: 1 event: 1 stream: 0\r\n```\r\n\r\nSo far I do not see any significant performance improvement (at least on lxplus-gpu) nor loss. At least BoostedJetONNXJetTagsProducer.cc can be improved to send more than one jet to onnxruntime at a time.", "branch": "master", "changed_files": 9, "comments": 17, "commits": 6, "created_at": "1663241951", "deletions": 10, "labels": ["reconstruction-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-approved", "heterogeneous-pending"], "milestone": "CMSSW_12_6_X", "number": 39402, "release-notes": [], "review_comments": 7, "state": "open", "title": "Extend onnxruntime gpu interface to producers using onnxruntime", "updated_at": "1663764611", "user": "davidlange6"}
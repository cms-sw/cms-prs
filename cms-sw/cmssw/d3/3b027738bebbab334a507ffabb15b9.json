{"additions": 24, "auther_ref": "conflicting_iovs", "auther_sha": "eb39e319f65bf381a9a588ca0f584ec8df762594", "author": "cms-AlCaDB", "body": "#### PR description:\r\n\r\nThis PR prevents LHCInfoPerLS O2O from trying to overwrite IOVs  (upload a payload with an IOV that's already in a tag) as this resulted in errors when writing to tags with synchronization different than `any` or `validation`.\r\n\r\nIn some (not all) cases, when the start_time of the first LS of a fill was the same as the end time of the previous fill (both fills with stable beams) the LHCInfoPerLS O2O was trying to overwrite an IOV, which results with an error for tags with synchronisation. Why does it happen only in some cases?: The list of lumisections of a fill is taken from OMS and filtered by start_time. OMS returns start_time in precision of seconds, and the filtering works in precision of milliseconds. Also the IOV is being saved in precision of seconds. This makes the filtering of lumisections with start_time greater than the start of the fill seem to behave inconsistently when dealing with values in precision of seconds. \r\n\r\nReport from the error happening in production https://cmsonline.cern.ch/cms-elog/1310230\r\n\r\n#### PR validation:\r\n\r\nThe production O2O was modified to run on this code on 28.10.2025 (running on a local CMSSW environment with these changes). It fixed the error and repopulated the data. No problems were detected.\r\n\r\nAdditionally tested locally: \r\nprepared local .dbs with the last IOVs of the problematic fills:\r\n```\r\nconddb copy LHCInfoPerLS_endFill_Run3_v3 LHCInfoPerLS_endFill_Run3_v3_test     --destdb sqlite:test_case_1_org.db     --from 7564053886386831360     --to 7564053886386831360     --type tag\r\n\r\nconddb copy LHCInfoPerLS_endFill_Run3_v3 LHCInfoPerLS_endFill_Run3_v3_test     --destdb sqlite:logs/test_case_3_org.db     --from 7563816469184643072     --to 7563816469184643072     --type tag\r\n```\r\n\r\nand run the o2o for these dbs:\r\n```\r\ncmsRun ../python/LHCInfoPerLSPopConAnalyzer_cfg.py mode=endFill destinationConnection=sqlite:logs/test_case_${TEST_CASE}_${TEST_NR}.db tag=LHCInfoPerLS_endFill_Run3_v3_test startTime='2025-06-26 15:43:20.000' | tee logs/log_test_${TEST_CASE}_${TEST_NR}.log\r\n```\r\n\r\n\r\n#### Backports\r\n\r\n15_0\r\n15_1", "branch": "master", "changed_files": 1, "comments": 9, "commits": 1, "created_at": "1761835401", "deletions": 13, "labels": ["fully-signed", "tests-approved", "orp-pending", "db-approved", "bug-fix", "code-checks-approved"], "milestone": "CMSSW_16_0_X", "number": 49269, "release-notes": [], "review_comments": 0, "state": "open", "title": "LHCInfoPerLS endFill conflicting IOVs fix", "updated_at": "1761917415", "user": "JanChyczynski"}
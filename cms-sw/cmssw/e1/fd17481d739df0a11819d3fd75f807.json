{"additions": 127, "auther_ref": "dd4hep-regression-test-tracker-parameters-v1", "auther_sha": "ce0cb52c78117e684a933fe29b2c204d48c7fcc5", "author": "ianna", "body": "#### PR description:\r\n\r\n* Automated comparison for `TrackerParameters` produced with `DD4hep` vs `DD`\r\n* Faster retrieval of the parameters from a map\r\n\r\nWhen a namespace is not required:\r\n```c++\r\nauto const& vec = cpv->getVector<int>(\"detIdShifts\");\r\n```\r\nIt gives an identical result as the following, but using a namespace:\r\n```c++\r\nauto const& v = cpv->detector()->vectors().at(\"trackerParameters:detIdShifts\");\r\nstd::vector<int> subdetPars;\r\nstd::transform(v.begin(), v.end(), std::back_inserter(subdetPars), [](int i) -> int { return std::round(i); });\r\n```\r\n\r\nTrackerParameters producer DD4hep vs DD:\r\n```\r\nTimeModule> 1 1 test TrackerParametersAnalyzer 1.94412\r\nTimeModule> 1 1 p1 PathStatusInserter 5.19753e-05\r\nTimeModule> 1 1 TriggerResults TriggerResultInserter 1.97887e-05\r\nTimeEvent> 1 1 1.94451\r\nMemoryReport> Peak virtual size 806.32 Mbytes\r\n Key events increasing vsize: \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[1] run: 1 lumi: 1 event: 1  vsize = 806.32 deltaVsize = 0 rss = 285.715 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[1] run: 1 lumi: 1 event: 1  vsize = 806.32 deltaVsize = 0 rss = 285.715 delta = 0\r\nTimeReport> Time report complete in 6.36567 seconds\r\n Time Summary: \r\n - Min event:   1.94451\r\n - Max event:   1.94451\r\n - Avg event:   1.94451\r\n - Total loop:  1.94565\r\n - Total init:  4.41856\r\n - Total job:   6.36567\r\n - EventSetup Lock:   0\r\n - EventSetup Get:   0\r\n Event Throughput: 0.513968 ev/s\r\n CPU Summary: \r\n - Total loop:  1.81109\r\n - Total init:  2.43381\r\n - Total extra: 0\r\n - Total job:   4.24624\r\n Processing Summary: \r\n - Number of Events:  1\r\n - Number of Global Begin Lumi Calls:  1\r\n - Number of Global Begin Run Calls: 1\r\n\r\n```\r\n```\r\nTimeModule> 1 1 test TrackerParametersAnalyzer 1.27393\r\nTimeModule> 1 1 p1 PathStatusInserter 4.79221e-05\r\nTimeModule> 1 1 TriggerResults TriggerResultInserter 2.09808e-05\r\nTimeEvent> 1 1 1.27431\r\nMemoryReport> Peak virtual size 714.941 Mbytes\r\n Key events increasing vsize: \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[1] run: 1 lumi: 1 event: 1  vsize = 714.941 deltaVsize = 0 rss = 231.512 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[1] run: 1 lumi: 1 event: 1  vsize = 714.941 deltaVsize = 0 rss = 231.512 delta = 0\r\nTimeReport> Time report complete in 4.63043 seconds\r\n Time Summary: \r\n - Min event:   1.27431\r\n - Max event:   1.27431\r\n - Avg event:   1.27431\r\n - Total loop:  1.27532\r\n - Total init:  3.35362\r\n - Total job:   4.63043\r\n - EventSetup Lock:   0\r\n - EventSetup Get:   0\r\n Event Throughput: 0.784119 ev/s\r\n CPU Summary: \r\n - Total loop:  1.19313\r\n - Total init:  2.11341\r\n - Total extra: 0\r\n - Total job:   3.30792\r\n Processing Summary: \r\n - Number of Events:  1\r\n - Number of Global Begin Lumi Calls:  1\r\n - Number of Global Begin Run Calls: 1\r\n```\r\n\r\n@ghugo83 - This PR does not solve the problem with a TOB DetId, just one more automated check for an IB integration.\r\n```\r\n%MSG-w TkAccumulatingSensitiveDetector::createHit:  OscarMTProducer:g4SimHits  26-Oct-2020 16:47:56 CET Run: 1 Event: 1\r\n theDetUnitId is not valid for TrackerHitsTOB\r\n%MSG\r\n----- Begin Fatal Exception 26-Oct-2020 16:47:56 CET-----------------------\r\nAn exception of category 'TkAccumulatingSensitiveDetector::createHit' occurred while\r\n   [0] Processing  Event run: 1 lumi: 1 event: 1 stream: 0\r\n   [1] Running path 'FEVTDEBUGoutput_step'\r\n   [2] Prefetching for module PoolOutputModule/'FEVTDEBUGoutput'\r\n   [3] Calling method for module OscarMTProducer/'g4SimHits'\r\nException Message:\r\ncannot get theDetUnitId for G4Track 5834\r\n----- End Fatal Exception -------------------------------------------------\r\n\r\n```\r\n<!-- Please replace this text with a description of the feature proposed or problem addressed, specifying:\r\n  - what changes are expected in the output if any, \r\n  - what other PRs or externals it depends upon if any,\r\n  - link to any additional material useful to provide a documentation for this PR (slides, JIRA tickets, related pull requestes, hypernews, TWiki or Indico pages)  -->\r\n\r\n#### PR validation:\r\n\r\n<!-- Please replace this text with a description of which tests have been performed to verify the correctness of the PR, including the eventual addition of new code for testing like unit tests, test configurations, additions or updates to the runTheMatrix test workflows -->\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\n<!-- Please replace this text with any link to  -->\r\n\r\nBefore submitting your pull requests, make sure you followed this checklist:\r\n- verify that the PR is really intended for the chosen branch\r\n- verify that changes follow [CMS Naming, Coding, And Style Rules](http://cms-sw.github.io/cms_coding_rules.html)\r\n- verify that the PR passes the basic test procedure suggested in the [CMSSW PR instructions](https://cms-sw.github.io/PRWorkflow.html)\r\n", "branch": "master", "changed_files": 8, "closed_at": "1603788515", "comments": 19, "commits": 2, "created_at": "1603726382", "deletions": 30, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "geometry-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "30cc1e77d618faf03a065ad69ab15bfbfe2d1a3b", "merged_at": "1603788514", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 31942, "release-notes": [], "review_comments": 0, "state": "closed", "title": "[DD4hep] Automated Comparison of TrackerParameters DD vs DD4hep", "updated_at": "1603788515", "user": "ianna"}
{"additions": 290, "auther_ref": "ticl_tracksterEnergyID_11_0_0_pre6", "auther_sha": "7f663ca64648906a526aeca00dfc11e58cae7cc1", "author": "riga", "body": "#### PR description\r\n\r\nThis PR adds energy regression and particle identification for trackster objects to the TrackstersProducer of the RecoHGCal/TICL package. Both the regressed energy and ID probabilities for different types of particles are the outputs of a single neural network, stored as a TensorFlow model. The first version of this model is proposed in\r\n\r\ncms-data/RecoHGCal-TICL#1.\r\n\r\nThis PR is a clean version of #27634. The changes since the last review comments can be found [here](https://github.com/riga/cmssw/compare/c75d2de...e9fb179).\r\n\r\n#### Performance\r\n\r\nTested with workflow 20634.0 (`TTbar_14TeV_TuneCUETP8M1_2026D41PU` with 200 PU).\r\n\r\nThe CPU runtime for inference scales linearly with the batch size, i.e., the number of tracksters, as expected for the `no_threads` TensorFlow session. The average runtime per trackster is ~0.6 ms (see slope below). The time includes trackster selection, preprocessing and filling of input data, the actual inference, and handling of results (== `PatternRecognitionbyCA::energyRegressionAndID`).\r\n\r\n![runtime](https://www.dropbox.com/s/hjivr1l4384lg9q/cpu_perf_27917.png?raw=1)\r\n\r\nThe memory consumption, obtained using the `SimpleMemoryCheck` with and without running the regression and ID, is 178 MB for a maximum batch size of ~750 tracksters.\r\n\r\nTo get an estimate of the memory used per event, I queried `VmRSS` of `/proc/self/status` ([link](https://stackoverflow.com/a/64166/2408501)) at the beginning and at the end of `PatternRecognitionbyCA::energyRegressionAndID`, and also before and after loading the graph and setting up the session.\r\n\r\n- Load graph: + 3.6 MB\r\n- Load session: +7.2 MB\r\n- `energyRegressionAndID`:\r\n![memory](https://www.dropbox.com/s/ukj4f2604islo7h/memory_27917.png?raw=1)\r\n", "branch": "master", "changed_files": 9, "closed_at": "1569437038", "comments": 54, "commits": 5, "created_at": "1567429709", "deletions": 26, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "requires-external", "tests-approved", "upgrade-approved"], "merge_commit_sha": "81891b0df15950646b13607635dade7ec06bbe26", "merged_at": "1569437038", "merged_by": "cmsbuild", "milestone": "CMSSW_11_0_X", "number": 27917, "release-notes": [], "review_comments": 24, "state": "closed", "title": "Add energy regression and particle identification to RecoHGCal/TICL (reopened)", "updated_at": "1569437039", "user": "riga"}
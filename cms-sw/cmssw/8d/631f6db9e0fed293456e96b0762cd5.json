{"additions": 627, "auther_ref": "devel_dqmHLTFiltersDQMonitor", "auther_sha": "ed5f69b089083c58984d2e91d654c6e82737a2c8", "author": "missirol", "body": "#### PR description:\r\n\r\nThis PR updates the plugin `HLTFiltersDQMonitor` in order not to access bare ROOT objects via the methods of DQM's `MonitorElement`. It potentially solves #40419.\r\n\r\nA unit test is also added, along with other small technical updates to `HLTFiltersDQMonitor`.\r\n\r\nThe PR contains the following changes, in order.\r\n\r\n - 0f5ff99d0f5 adds a unit test for the plugin in question. This unit test passes with `threads == streams == 1`, and it often reproduces the error in #40419 when using 4 or more threads/streams (and before adding f51c546feed).\r\n\r\n - f51c546feed implements the actual fix following suggestions by @makortel in https://github.com/cms-sw/cmssw/issues/40419#issuecomment-1370151052 and https://github.com/cms-sw/cmssw/issues/40419#issuecomment-1370156063; calls to `FindBin` are removed at the cost of using a string-to-binIndex map (`std::unordered_map<std::string, unsigned int>`) which is filled once per run. This commit also updates the unit test to run with 4 threads(==streams), instead of 1.\r\n\r\n - 6211e8b421b includes small technical changes to improve readability/clarity (renaming of some of the parameters of `HLTFiltersDQMonitor`, renaming of `cfi` module to start with `dqm` rather than `hlt`, various mostly-stylistic changes in `HLTFiltersDQMonitor.cc`).\r\n\r\nMerely technical. No changes expected in the outputs of PR tests, except for the partial renaming of one `MonitorElement` in `HLTFiltersDQMonitor` [here](https://github.com/cms-sw/cmssw/pull/40426/files#diff-d18b6560ad84d60fede0b40acdb7a9022333a5ec673dd87452d74d78b707fc66L141-R151):\r\n```diff\r\n-  std::replace(hltMenuName.begin(), hltMenuName.end(), '.', '_');\r\n+  std::replace(hltMenuName.begin(), hltMenuName.end(), '.', 'p');\r\n```\r\n\r\n#### PR validation:\r\n\r\nThe new unit test often reproduced the error in #40419 when using 4 or more threads(==streams) without the cpp changes in this PR. Once the latter are included, the same test consistently passed.\r\n\r\n#### If this PR is a backport, please specify the original PR and why you need to backport that PR. If this PR will be backported, please specify to which release cycle the backport is meant for:\r\n\r\nTBD. This is a bugfix, and backports might be needed.\r\n", "branch": "master", "changed_files": 16, "comments": 8, "commits": 4, "created_at": "1672845643", "deletions": 330, "labels": ["dqm-pending", "pending-signatures", "tests-approved", "orp-pending", "bug-fix", "code-checks-approved"], "milestone": "CMSSW_13_0_X", "number": 40426, "release-notes": [], "review_comments": 7, "state": "open", "title": "remove access to bare ROOT objects in `HLTFiltersDQMonitor`", "updated_at": "1672902731", "user": "missirol"}
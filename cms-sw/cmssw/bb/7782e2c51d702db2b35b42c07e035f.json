{"additions": 7, "auther_ref": "fix-val-bug", "auther_sha": "606649709112bfe43c3d0ba85841237daff477ed", "author": "cvuosalo", "body": "Issue #31069 concerned the script `Validation/Geometry/test/runP_Tracker.py` that terminates with an exception if its `AllStepsToTree` is set to True. This PR fixes the problem and allows the script to run to completion and produce its output files.\r\n\r\nThe problem was that a `TTree` was created before its `TFile` was created. When the `TTree` reached 1 MB in memory, this exception was generated:\r\n```\r\n---- Begin Fatal Exception 28-Feb-2022 21:20:13 CET-----------------------\r\nAn exception of category 'FatalRootError' occurred while\r\n   [0] Processing  Event run: 1 lumi: 1 event: 17 stream: 0\r\n   [1] Running path 'p1'\r\n   [2] Calling method for module OscarMTProducer/'g4SimHits'\r\n   Additional Info:\r\n      [a] Fatal Root Error: @SUB=TBranch::WriteBasketImpl\r\nbasket's WriteBuffer failed.\r\n\r\n----- End Fatal Exception -------------------------------------------------\r\n```\r\nThe fix is to create a temporary file for the `TTree` to use. This file can't be used for the actually writing, because the program has another file open that can clash with the temporary file. Thus, when the `TTree` is complete, the final output file is created and the temporary is removed.\r\n\r\n#### PR validation:\r\n\r\nThe script runs successfully to completion and produces complete output files. Here are the commands to test the script:\r\n```\r\ncmsRun test/single_neutrino_cfg.py nEvents=1000\r\npython3 test/runP_Tracker.py geom=\"Extended2017Plan1\" label=Tracker \r\n```\r\n\r\nNo backport is needed.", "branch": "master", "changed_files": 2, "closed_at": "1646177758", "comments": 9, "commits": 2, "created_at": "1646088048", "deletions": 2, "labels": ["dqm-approved", "geometry-approved", "fully-signed", "tests-approved", "bug-fix", "orp-approved", "code-checks-approved"], "merge_commit_sha": "5c624c1e2daea1db6d5c85529b526dc7f73187f7", "merged_at": "1646177758", "merged_by": "cmsbuild", "milestone": "CMSSW_12_3_X", "number": 37095, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix AllStepsToTree option to runP_Tracker.py script", "updated_at": "1646235507", "user": "cvuosalo"}
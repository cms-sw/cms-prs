{"additions": 140, "auther_ref": "implement_AlpakaBackendFilter_14_1_x", "auther_sha": "d51e58e72a76d724418006463349de436ce41be6", "author": "fwyzard", "body": "#### PR description:\r\n\r\nImplement `AlpakaBackendProducer`, an empty alpaka-based `EDProducer` whose only purpose is to save in the event what alpaka backend has been used.\r\n\r\nImplement `AlpakaBackendFilter`, an `EDFilter` that selects events based on the alpaka backend used to run a previous producer.\r\n\r\nImplement a unit test for both modules.\r\n\r\nThe aim is to replace this `SwitchProducer` in the HLT menu\r\n```python\r\n\r\nprocess.statusOnGPU = SwitchProducerCUDA(\r\n   cpu = cms.EDProducer( \"BooleanProducer\",\r\n       value = cms.bool( False )\r\n   ),\r\n  cuda = cms.EDProducer( \"BooleanProducer\",\r\n       value = cms.bool( True )\r\n   ),\r\n )\r\n\r\nprocess.statusOnGPUFilter = cms.EDFilter( \"BooleanFilter\",\r\n    src = cms.InputTag( \"statusOnGPU\" )\r\n)\r\n\r\nprocess.Status_OnCPU = cms.Path( process.statusOnGPU + ~process.statusOnGPUFilter )\r\nprocess.Status_OnGPU = cms.Path( process.statusOnGPU + process.statusOnGPUFilter )\r\n```\r\nwith this alpaka-based solution\r\n```python\r\nprocess.hltBackend = cms.EDProducer('AlpakaBackendProducer@alpaka')\r\n\r\nprocess.hltStatusOnGPUFilter = cms.EDFilter('AlpakaBackendFilter',\r\n  producer = cms.InputTag('hltBackend', 'backend'),\r\n  backends = cms.vstring('CudaAsync', 'ROCmAsync')\r\n)\r\n\r\nprocess.Status_OnCPU = cms.Path( process.hltBackend + ~process.hltStatusOnGPUFilter )\r\nprocess.Status_OnGPU = cms.Path( process.hltBackend + process.hltStatusOnGPUFilter )\r\n```\r\n\r\n#### PR validation:\r\n\r\nThe new unit test passes.\r\n\r\n#### Backport status\r\n\r\nTo be backported to 14.0.x for data taking.", "branch": "master", "changed_files": 5, "comments": 13, "commits": 1, "created_at": "1710323409", "deletions": 0, "labels": ["fully-signed", "orp-pending", "tests-started", "code-checks-pending", "heterogeneous-approved"], "milestone": "CMSSW_14_1_X", "number": 44387, "release-notes": [], "review_comments": 0, "state": "open", "title": "Implement AlpakaBackendProducer and AlpakaBackendFilter", "updated_at": "1710515629", "user": "fwyzard"}
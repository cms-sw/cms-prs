{"additions": 2164, "auther_ref": "gpu-sistripclusterizer", "auther_sha": "dbfc2241de2a28d6fcdfa6bf057de63461521c33", "author": "dan131riley", "body": "#### PR description:\r\n\r\nThis PR is targeted at 12_5_0\r\n\r\nElements are:\r\n\r\nStructure of Arrays (SoA) version of SiStripClusters.  The number of array elements for the cluster ADCs is is configurable at runtime via the PSET:\r\n\r\nDataFormats/SiStripCluster/interface/SiStripClustersSOABase.h\r\nDataFormats/SiStripCluster/interface/SiStripClustersSOA.h\r\nDataFormats/SiStripCluster/src/SiStripClustersSOA.cc\r\nCUDADataFormats/SiStripCluster/interface/SiStripClustersCUDA.h\r\nCUDADataFormats/SiStripCluster/src/SiStripClustersCUDA.cc\r\n\r\nSome associated typedefs:\r\n\r\nDataFormats/SiStripCluster/interface/SiStripTypes.h\r\n\r\nSoA version of SiStripClusterizerConditions plus an auxiliary class to map FedID & channel to DetID & APV pair:\r\n\r\nCalibFormats/SiStripObjects/interface/SiStripClusterizerConditionsGPU.h\r\nCalibFormats/SiStripObjects/src/SiStripClusterizerConditionsGPU.cc\r\n\r\nEvent setup dependency records:\r\n\r\nRecoLocalTracker/Records/interface/SiStripClusterizerConditionsGPURcd.h\r\nRecoLocalTracker/Records/src/SiStripClusterizerConditionsGPURcd.cc\r\n\r\nData structure for mapping raw data into DetID/strip ordering:\r\n\r\nRecoLocalTracker/SiStripClusterizer/plugins/ChannelLocsGPU.h\r\nRecoLocalTracker/SiStripClusterizer/plugins/ChannelLocsGPU.cc\r\n\r\nProducer that consumes raw data and produces SiStripClustersCUDA:\r\n\r\nRecoLocalTracker/SiStripClusterizer/plugins/ClustersFromRawProducerGPU.cc\r\n\r\nTop level algorithm implementation that sequences kernels:\r\n\r\nRecoLocalTracker/SiStripClusterizer/plugins/SiStripRawToClusterGPUKernel.h\r\nRecoLocalTracker/SiStripClusterizer/plugins/SiStripRawToClusterGPUKernel.cc\r\n\r\nCUDA implementation of the ThreeThresholdAlgorithm.  Includes kernels that identify candidate seed strips, finds the left and right boundaries of cluster candidates, and checks the cluster cuts and calculates the charge and barycenter, and CUDA kernel to reorganize raw data on the GPU into DetID/strip order:\r\n\r\nRecoLocalTracker/SiStripClusterizer/plugins/SiStripRawToClusterGPUKernel.cu\r\n\r\nProducer that copies SiStripClustersSOA from device to host, and producer that consumes SiStripClustersCUDAHost and produces edmNew::DetSetVector<SiStripCluster>:\r\n\r\nRecoLocalTracker/SiStripClusterizer/plugins/SiStripClustersSOAtoHost.cc\r\nRecoLocalTracker/SiStripClusterizer/plugins/SiStripClustersFromSOA.cc\r\n\r\nESProducer for SiStripClusterizerConditionsGPU:\r\n\r\nRecoLocalTracker/SiStripClusterizer/plugins/SiStripClusterizerConditionsGPUESProducer.cc\r\n\r\nCustomize function to replace the RECO siStripClusters from DIGIs producer with the siStripClusters from RawData producer.  Intended to only be used for validation:\r\n\r\nRecoLocalTracker/SiStripClusterizer/python/customizeStripClustersFromRaw.py\r\n\r\nModified:\r\n\r\nConfig for siStripClusters from RawData producer modified to use the gpu process modifier and the SwitchProducerCUDA to switch between SiStripClusterizerFromRaw and SiStripClusterizerFromRawGPU.  As far as I know this config is not used in production:\r\n\r\nRecoLocalTracker/SiStripClusterizer/python/SiStripClusterizerOnDemand_cfi.py\r\n\r\nThreeThresholdAlgorithm and associated factory modified to take a cluster size limit cut to match the limit in the SOA/CUDA version:\r\n\r\nRecoLocalTracker/SiStripClusterizer/interface/ThreeThresholdAlgorithm.h\r\nRecoLocalTracker/SiStripClusterizer/src/ThreeThresholdAlgorithm.cc\r\n\r\nVarious BuildFile.xml and event setup registration.\r\n\r\n#### PR validation:\r\n\r\nValidation plots from TTBar with pu flat55-75 comparing the standard clusterizer with the CPU and GPU versions discarding clusters larger than the max (16 strips)  can be found here:\r\n\r\nhttps://www.classe.cornell.edu/~dsr/mic-track/validation/PR34618-CMSSW_12_4_0_pre1/\r\n\r\nCPU and GPU versions are close enough to identical that the differences could be ascribed to platform and implementation differences.  For this data sample, there is no significant loss of efficiency and a 10% reduction in fakes in the barrel.\r\n\r\nComparison of various cluster size cuts for the same data sample:\r\n\r\nhttps://www.classe.cornell.edu/~dsr/mic-track/validation/PR34618-cluster-size/\r\n\r\nand similarly for a QCD Pt1800-2400 with pu flat55-75:\r\n\r\nhttps://www.classe.cornell.edu/~dsr/mic-track/validation/PR34618-cluster-size-Pt1800-2400-PU/\r\n\r\nThis sample does show a loss of efficiency for cluster size cuts < 24, primarily in the jetCore iteration.", "branch": "master", "changed_files": 40, "comments": 121, "commits": 7, "created_at": "1627240643", "deletions": 28, "labels": ["reconstruction-pending", "alca-pending", "pending-signatures", "tests-approved", "orp-pending", "code-checks-approved", "heterogeneous-pending", "trk"], "milestone": "CMSSW_12_6_X", "number": 34618, "release-notes": [], "review_comments": 88, "state": "open", "title": "CUDA implementation of RecoLocalTracker/SiStripCluster  ClustersFromRawProducer", "updated_at": "1662658813", "user": "dan131riley"}
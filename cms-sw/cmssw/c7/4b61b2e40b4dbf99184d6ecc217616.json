{"additions": 58, "auther_ref": "nnPuppiTau_namespace", "auther_sha": "5984287c8228be08e9012517a5bc8cc59022f97d", "author": "thesps", "body": "#### PR description:\r\n\r\nWe have had a recurring issue with hls4ml emulator models that are defined as externals that they sometimes clobber each other's symbols (arrays for weights typically) [[1](https://github.com/cms-sw/cmssw/issues/44435), [2](https://github.com/cms-sw/cmssw/pull/49325)]. This has been fixed by enforcing that new models define a namespace, with the other variables defined within. However we have one model that is defined in CMSSW source, whose development predates the externals setup, whose weights are not in a namespace, so those symbols are in the global namespace. This PR wraps that model in a namespace.\r\n\r\n#### PR validation:\r\n\r\nFirst of all checking symbols.\r\nIn the release:\r\n```bash\r\n$ readelf -Ws /cvmfs/cms.cern.ch/el9_amd64_gcc12/cms/cmssw/CMSSW_15_1_0_pre6/lib/el9_amd\r\n64_gcc12/pluginL1TriggerPhase2L1ParticleFlowAuto.so | grep w17\r\n   728: 00000000001794f0    20 OBJECT  GLOBAL DEFAULT   25 w17\r\n  4466: 00000000001794f0    20 OBJECT  GLOBAL DEFAULT   25 w17\r\n```\r\n\r\nIn this PR:\r\n```bash\r\n$ readelf -Ws ../lib/el9_amd64_gcc12/pluginL1TriggerPhase2L1ParticleFlowAut\r\no.so | grep w17\r\n  1363: 00000000001794f0    20 OBJECT  GLOBAL DEFAULT   25 _ZN20hls4ml_nnpuppitau_v03w17E\r\n  4300: 00000000001794f0    20 OBJECT  GLOBAL DEFAULT   25 _ZN20hls4ml_nnpuppitau_v03w17E\r\n ```\r\n\r\nI also checked the behaviour by defining a proxy external library that just defines and prints out some of these problematic symbols, and compiling it and loading it in CMSSW analagously to an hls4ml external. Working with the release, I see that the values are \"successfuly\" clobbered by the NNPuppiTau weights, while with the fix of this branch they retain their locally defined values. I ran a configuration file defined in [FastPUPPI](https://github.com/p2l1pfp/FastPUPPI/blob/15_1_X/NtupleProducer/python/runPerformanceNTuple.py) that ntuplizes the NNPuppiTau here just to run the producer in the job. There was no change in the ntuple produced since the model here is the one clobbering the others' weights.\r\n", "branch": "master", "changed_files": 23, "comments": 3, "commits": 1, "created_at": "1765814621", "deletions": 4, "labels": ["l1-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-rejected"], "milestone": "CMSSW_16_0_X", "number": 49632, "release-notes": [], "review_comments": 0, "state": "open", "title": "Add a namespace to the NNPuppiTau model", "updated_at": "1765834440", "user": "thesps"}
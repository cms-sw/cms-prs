{"additions": 74, "auther_ref": "fixEsConsumesCurrentProcess", "auther_sha": "c2c4015ba86d05ca8a11cb370e79bc79951556d9", "author": "makortel", "body": "#### PR description:\r\n\r\nES tokens use an \"empty string optimization\", i.e. re-using the `\\0` as the first element of `EDConsumerBase::m_tokenLabels` for empty strings. However, when an EDProduct is consumed with `@currentProcess` process name, `EDConsumerBase::convertCurrentProcessAlias()` overwrites `m_tokenLabels` to have something else as the first element, leading to `NoProxyException` being thrown when an `ESHandle` obtained with `ESGetToken` is dereferenced.\r\n\r\nThis PR fixed `convertCurrentProcessAlias()` to leave `\\0` as the first element of `m_tokenLabels`.\r\n\r\nThis problem was observed in #31962.\r\n\r\n#### PR validation:\r\n\r\nFramework unit tests run. In addition, with #31962 `11634.0` step2 runs (that fails without this PR).", "branch": "master", "changed_files": 5, "closed_at": "1606178329", "comments": 21, "commits": 1, "created_at": "1605881125", "deletions": 34, "labels": ["code-checks-approved", "comparison-available", "core-approved", "fully-signed", "orp-approved", "tests-approved"], "merge_commit_sha": "c608f97d0614674874a20c9e1a81ad6612b2535e", "merged_at": "1606178329", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 32217, "release-notes": [], "review_comments": 6, "state": "closed", "title": "Fix esConsumes() for an EDModule that consumes EDProduct with @currentProcess", "updated_at": "1606178330", "user": "makortel"}
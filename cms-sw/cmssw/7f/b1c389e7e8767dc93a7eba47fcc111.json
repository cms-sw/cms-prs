{"additions": 1918, "auther_ref": "layer-processing-v2-rb1", "auther_sha": "3e2217462a63c34ff1c717f6350c290f8d706dca", "author": "trackreco", "body": "#### PR description:\r\n\r\nThere are no significant physics changes.\r\n\r\nSeveral changes only affect mkFit in standalone mode.\r\n\r\nMain goals:\r\n\r\n- Make it easier to express vectorized code.\r\n\r\n- Be able to do simple propagations, parameters only, no errors.\r\n\r\n- Explore more precise hit preselection in each layer (see MkFinder.selectHitIndicesV2()).\r\n\r\n- Make it easier to export low-level algorithm / tracking state for further analysis directly in ROOT format.\r\n\r\n- Allow further development of Phase2 mkFit tracking, together with the new propagate-to-plane functionality (in another PR).\r\n\r\n#### Detailed changes\r\n\r\nAdd half_length member to ModuleInfo, fill it in MkFitGeometryESProducer.cc\r\n\r\nExtend HitInfo with half-strip-length, add qbar (the other of r/z variables), Store fast-access arrays as std::vector<HitInfo>.\r\n\r\nMove propToR/Z() can/maxReachRadius() from Track to TrackBase.\r\n\r\nImplement LayerOfHits::reset() to make sure containers are empty before re-filling. Call this from both methods (beginHitRegistration() and suckInHits()).\r\n\r\nMiscellaneous changes to better support dump-hit-window case.\r\n\r\n* RecoTracker/MkFitCore/interface/Track.h Add function mcHitIDofFirstHit() to simplify dump-hit-window code.\r\n\r\n* RecoTracker/MkFitCore/src/MkBuilder.cc Add missing MkFinder setup in dump-hit-window case.\r\n\r\n* RecoTracker/MkFitCore/standalone/Makefile.config Clarify usage of Ofast (by Steve).\r\n\r\n* RecoTracker/MkFitCMS/standalone/Makefile Use GNU make &: syntax (grouped targets) for dictionary targets.\r\n\r\n* RecoTracker/MkFitCore/src/MiniPropagators.h/cc: Implementations of propagators of track parameters only (no errors/covariances), with various levels of approximation and also supporting vectorization.\r\n\r\nUse VDT for fast transcendentals in MiniPropagators.\r\n\r\nAdd scalar and element-wise arithemtic operators and transcendentals to Matriplex. This makes writing vectorized loops using Matriplex variables much clearer.\r\n\r\nPrepare infrastructure for deep-dump comparisons in selectHitIndicesV2 (and elsewhere).\r\n\r\n* `MkFitCore/interface/Config.h`\r\n Fix typo.\r\n\r\n* `MkFitCore/interface/MkBuilder.h\r\n MkFitCore/interface/Track.h\r\n MkFitCore/interface/TrackStructures.h\r\n MkFitCore/src/TrackStructures.cc\r\n MkFitCore/src/MkBuilder.cc\r\n MkFitCore/standalone/Event.cc\r\n MkFitCore/standalone/Event.h`\r\nPass seed-index in the current seed-vector along. In Event, provide a means of determining sim-track from hits of each seed track.\r\n\r\n* `MkFitCore/src/MkBuilder.cc`\r\nAdd handling of WSR_Failed.\r\n\r\n* `MkFitCore/src/Matrix.h`\r\nAdd short-int Matriplex typedefs\r\n\r\n* `MkFitCore/src/MiniPropagators.cc\r\n MkFitCore/src/MiniPropagators.h`\r\n Fail-flag consistency, rename State dphi to dalpha.\r\n\r\n* `MkFitCore/src/MkBase.h`\r\nAdd radius() function.\r\n\r\n* `MkFitCore/src/MkFinder.cc\r\n MkFitCore/src/MkFinder.h` \r\nModularization of new/old hit-selection. Reimplemented bin-search for edge positions and determined global scaling of bin-search windows to reproduce current behavior.\r\n\r\n* `MkFitCore/standalone/Makefile\r\nMkFitCore/standalone/Makefile.config`\r\n Add rules for building RntDumper stuff.\r\n\r\n* `MkFitCore/standalone/RntDumper/`\r\nNew sub-directory: Implementation of classes and structures for dumping ROOT TTrees or RNTuples.\r\n\r\n* `MkFitCMS/standalone/Makefile`\r\nAdd linking agains libMicRntDump.so\r\n\r\n* `MkFitCMS/standalone/MkStandaloneSeqs.cc` \r\nMake it easier to find out why standalone tracks are not matched to sim tracks.\r\n\r\n* `MkFitCMS/standalone/Shell.cc\r\nMkFitCMS/standalone/buildtestMPlex.cc` \r\nSetup Event current-seed-vector pointers as needed during event processing.\r\n\r\n* `MkFitCMS/standalone/mkFit.cc`\r\nFinalize all RntDumpers on exit.\r\n\r\nStandalone consolidation plus cleanup of parameters, remove unused ones.\r\n\r\n* `MkFitCMS/standalone/buildtestMPlex.cc` \r\nWhen validation is on make sure seeds are restored after BH, STD, CE runs.\r\n\r\n* `MkFitCMS/standalone/mkFit.cc` \r\nRename run-all to run default -- make it run std, and ce.\r\n\r\n* `MkFitCore/src/MkBuilder.cc` \r\nMissing MkFinder setup in backwardFitBH().\r\n\r\n* `MkFitCore/standalone/Geoms/CylCowWLids.cc` \r\nArray of eta extents too short.\r\n\r\n* `MkFitCore/standalone/Makefile.config` \r\nConsolidate CMSSW and other occurences of Ofast, msse2, std=c++17/1z. Cleanup unused -D defines / settings.\r\n\r\n* `MkFitCore/standalone/ConfigStandalone.h`\r\nRemove unused simulation multiple scattering parameters.\r\n\r\n\r\n#### PR validation:\r\n\r\nNo significant physics changes: [MTV plots](http://uaf-10.t2.ucsd.edu/~legianni/plots_compare_layerProcv2_PRVersion/)\r\n", "branch": "master", "changed_files": 38, "comments": 15, "commits": 2, "created_at": "1698572653", "deletions": 429, "labels": ["reconstruction-pending", "pending-signatures", "tests-approved", "orp-pending", "code-checks-approved", "tracking"], "milestone": "CMSSW_13_3_X", "number": 43145, "release-notes": [], "review_comments": 0, "state": "open", "title": "[mkFit] Tools supporting better layer-related computations -- technical changes to support further development", "updated_at": "1698715491", "user": "osschar"}
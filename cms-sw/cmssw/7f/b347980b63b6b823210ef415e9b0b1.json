{"additions": 45, "auther_ref": "clustering-EventAuxiliary", "auther_sha": "098f2ac38fcc4178b1827500c64f8e149aac5133", "author": "dan131riley", "body": "When removal of duplicate events and fast cloning are enabled (the current defaults), the input module reads the entire EventAuxiliary branch when it opens the file in order to determine if fast cloning is possible.  This currently results in many small reads scattered throughout the entire file, which is not a good IO pattern for storage systems optimized for large-block throughput.  In some cases large files cannot be served from some sites, see\r\n\r\nhttps://hypernews.cern.ch/HyperNews/CMS/get/edmFramework/3853/1/1/1/1.html\r\n\r\nThis PR delays writing the EventAuxiliary branch until the file close sequence, with the branch stored entirely in one basket near the end of the file that can be read in one operation.\r\n\r\nIn a runTheMatrix 'limited' test I am getting a segmentation fault in wf 10824.0 in `Rivet::Analysis::numEvents()`.  On my test system I get the same segmentation fault with an unmodified ASAN build, so I believe this is unrelated to the modifications in this PR.\r\n\r\n@bbockelm please review.", "branch": "master", "changed_files": 4, "comments": 1, "commits": 1, "created_at": "1550753515", "deletions": 7, "labels": ["code-checks-pending", "comparison-pending", "core-pending", "orp-pending", "pending-signatures", "tests-pending"], "milestone": "CMSSW_10_5_X", "number": 25994, "release-notes": [], "review_comments": 0, "state": "open", "title": "Delay writing the EventAuxiliary branch to file closing", "updated_at": "1550753563", "user": "dan131riley"}
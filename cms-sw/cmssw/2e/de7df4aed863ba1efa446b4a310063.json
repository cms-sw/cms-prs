{"additions": 100, "auther_ref": "dev-121X-locking-opt", "auther_sha": "0e52df28d74b6b98e0cfc1c5e282e6d5833ae621", "author": "smorovic", "body": "#### PR description:\r\n\r\nA local file lock on the filter unit machine is used in online HLT when acquiring a file from a builder unit (via file broker service), ensuring that files appear locally in the same order they are acquired (otherwise it is a race between threads in process acquiring it). Order is important to ensure proper local bookeeping of events processed in a lumisection.\r\nAn exclusive file lock has been used for this, but it turns out this can be relaxed in most cases to a shared lock, while only end-of-lumi marker needs to remain exclusive. This is implemented in this PR.\r\n\r\nTest module for generating fake data also gains ability to generate random payload, which will be useful for storage and transfer tests in the future, as it generates data with low compressibility.\r\n\r\n#### PR validation:\r\n\r\nIt has been tested in DAQ3 system which is currently in commissioning. Performance of HLT readout appears improved, especially in conditions of increased network latency due to saturated network bandwith. Functionally no issues are seen with this patch.\r\n\r\nUnit test was modified to use the new feature for creating input data using rand(), so validity is verified by this test.", "branch": "master", "changed_files": 10, "closed_at": "1631274901", "comments": 11, "commits": 3, "created_at": "1631202443", "deletions": 25, "labels": ["daq-approved", "reconstruction-approved", "fully-signed", "tests-approved", "orp-approved", "code-checks-approved"], "merge_commit_sha": "2decae3315331c427176710fcf5274da163af2a0", "merged_at": "1631274901", "merged_by": "cmsbuild", "milestone": "CMSSW_12_1_X", "number": 35218, "release-notes": [], "review_comments": 0, "state": "closed", "title": "DAQ optimized usage of FU file locking", "updated_at": "1631274901", "user": "smorovic"}
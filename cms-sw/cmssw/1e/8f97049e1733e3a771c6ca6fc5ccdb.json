{"additions": 21, "auther_ref": "fixStripEndcapResidualsDQM", "auther_sha": "f0b439185508283dfa782245de0ac260ce44f40e", "author": "mmusich", "body": "#### PR description:\r\n\r\nFollow-up to PR https://github.com/cms-sw/cmssw/pull/35811.\r\nNoticed that even in the CRAFT'22 DQM (post PR #35811 has been merged) data the Strip End Caps (TID / TEC) residuals are still empty (see e.g.: https://tinyurl.com/yd83lqlz and https://tinyurl.com/y8286jpa).\r\nThis has been traced down to the fact that in cosmics, unlike collisions (see:\r\nhttps://github.com/cms-sw/cmssw/blob/8204ef9abce4ead22a957e14751b38f9f1b05e07/DQM/SiStripMonitorClient/python/SiStripSourceConfigTier0_cff.py#L152-L156\r\n) the bare track collection (without the trajectory in the event) is fed to `TrackerValidationVariables` (making it impossible to get precise residuals in the endcap).\r\nThis is fixed in this PR introducing the cosmics track refitter in the DQM configuration.\r\n\r\n#### PR validation:\r\n\r\nRun: ` runTheMatrix.py -l 138.2 -j 8 --command='-n 1000'`\r\n\r\nwith the following patch:\r\n\r\n```diff\r\ndiff --git a/DQM/TrackerMonitorTrack/src/MonitorTrackResiduals.cc b/DQM/TrackerMonitorTrack/src/MonitorTrackResiduals.cc\r\nindex bb58285028f..4b9eb6d0e8d 100644\r\n--- a/DQM/TrackerMonitorTrack/src/MonitorTrackResiduals.cc\r\n+++ b/DQM/TrackerMonitorTrack/src/MonitorTrackResiduals.cc\r\n@@ -274,14 +274,25 @@ void MonitorTrackResidualsBase<pixel_or_strip>::analyze(const edm::Event &iEvent\r\n \r\n       auto subdetandlayer = findSubdetAndLayer(RawId, tTopo);\r\n       auto histos = m_SubdetLayerResiduals[subdetandlayer];\r\n+      std::cout << \" subdet: \" << subdetandlayer.first << \" layer: \" << subdetandlayer.second << std::endl;\r\n+\r\n       // fill if its error is not zero\r\n       if (it.resXprimeErr != 0 && histos.x.base) {\r\n         histos.x.base->Fill(it.resXprime);\r\n         histos.x.normed->Fill(it.resXprime / it.resXprimeErr);\r\n+\r\n+       if(subdetandlayer.first==\"TEC\" || subdetandlayer.first==\"TID\" ){\r\n+         std::cout << \"x-residual: \" << it.resXprime << \" / \" << it.resXprimeErr << std::endl;\r\n+       }\r\n         if (!isPixel)\r\n           tkhisto_ResidualsMean->fill(RawId, it.resXprime);\r\n       }\r\n       if (it.resYprimeErr != 0 && histos.y.base) {\r\n+\r\n+       if(subdetandlayer.first==\"TEC\" || subdetandlayer.first==\"TID\" ){\r\n+         std::cout << \"y-residual:\" << it.resYprime << \" / \" << it.resYprimeErr << std::endl;\r\n+       }\r\n+\r\n         histos.y.base->Fill(it.resYprime);\r\n         histos.y.normed->Fill(it.resYprime / it.resYprimeErr);\r\n       }\r\n```\r\nand now one gets:\r\n```console\r\nBegin processing the 18th record. Run 343498, Event 18792252, LumiSection 1151 on stream 0 at 23-Mar-2022 13:02:01.846 CET\r\n subdet: TEC layer: 1\r\nx-residual: -0.0151313 / 0.0473088\r\n subdet: TEC layer: 2\r\nx-residual: 0.0107512 / 0.0143062\r\n subdet: TEC layer: 3\r\nx-residual: -0.00317227 / 0.00859425\r\n subdet: TEC layer: 3\r\nx-residual: -0.00389814 / 0.00671078\r\n subdet: TEC layer: 3\r\nx-residual: 0.00796366 / 0.00832214\r\n subdet: TEC layer: 4\r\nx-residual: 0.00557164 / 0.0108646\r\n subdet: TEC layer: 5\r\nx-residual: -0.00106809 / 0.00630571\r\n subdet: TEC layer: 5\r\nx-residual: 0.00326104 / 0.00766269\r\n subdet: TEC layer: 6\r\nx-residual: 0.00382722 / 0.010256\r\n subdet: TEC layer: 6\r\nx-residual: -0.00890858 / 0.00832553\r\n subdet: TEC layer: 6\r\nx-residual: -0.00241953 / 0.00897227\r\n subdet: TEC layer: 6\r\nx-residual: -0.00600596 / 0.00603685\r\n subdet: TEC layer: 6\r\nx-residual: 0.00968534 / 0.00783616\r\n subdet: TEC layer: 7\r\nx-residual: 0.00883887 / 0.0321769\r\n```\r\nwhereas before it was:\r\n```console\r\nBegin processing the 18th record. Run 343498, Event 18792252, LumiSection 1151 on stream 0 at 23-Mar-2022 12:25:17.472 CET\r\n subdet: TEC layer: 7\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 6\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 6\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 6\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 6\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 6\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 5\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 5\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 4\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 3\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 3\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 3\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 2\r\nx-residual: -998001 / 999\r\n subdet: TEC layer: 1\r\nx-residual: -998001 / 999\r\n```\r\nExample of obtained plots:\r\n\r\n| CMSSW_12_4_X_2022-03-22-1100 as-is | CMSSW_12_4_X_2022-03-22-1100 + this PR |\r\n| ------------- | ------------- |\r\n| ![image](https://user-images.githubusercontent.com/5082376/159702440-42c561c7-df38-4665-a701-62079eae800f.png) | ![image](https://user-images.githubusercontent.com/5082376/159702311-f5559ea2-fad7-4999-8465-94faeb26ce4d.png) |\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nNot a backport, but should be backported for operations.", "branch": "master", "changed_files": 1, "comments": 3, "commits": 1, "created_at": "1648036046", "deletions": 8, "labels": ["dqm-pending", "pending-signatures", "tests-pending", "orp-pending", "bug-fix", "code-checks-approved"], "milestone": "CMSSW_12_4_X", "number": 37316, "release-notes": [], "review_comments": 0, "state": "open", "title": "run cosmics track refitter in order to fix to Strip Hit residuals", "updated_at": "1648036483", "user": "mmusich"}
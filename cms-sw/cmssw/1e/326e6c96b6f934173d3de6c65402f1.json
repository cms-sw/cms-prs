{"additions": 19, "auther_ref": "TritonServiceFix", "auther_sha": "7d475819928645f5fe90f27cb004416b9c25d8ca", "author": "kpedro88", "body": "#### PR description:\r\n\r\nWhile testing an algorithm with a significantly longer inference time than the one used for the SonicTriton unit test, I re-encountered the issue with the fallback server shutting down too early.\r\n\r\nAdding some debugging info to `auto_stop`, I found that using `$PPID` for the fallback server did not actually get the PID of the `cmsRun` process, but rather the `sh` process spawned by the `popen` call. Apparently, this `sh` process hangs around long enough for the unit test to complete, if `auto_stop` is delayed by a few seconds (in the case of Singularity reading from cvmfs, which is slightly slower than a local read). However, this is not reliable or general.\r\n\r\nInstead, I now pass the `cmsRun` PID directly when starting the fallback server. This works to avoid the previous failure (tested by setting `PMAX=1` in `cmsTriton`). I've retained the value `PMAX=5` in this PR just in case some other instability might arise.\r\n\r\n#### PR validation:\r\n\r\nReran stress tests from #32576.\r\n\r\n@makortel @silviodonato @qliphy it would be nice to get this into pre3 if the deadline has not passed (it's really just a minor bug fix).", "branch": "master", "changed_files": 3, "closed_at": "1612968758", "comments": 10, "commits": 1, "created_at": "1612916464", "deletions": 6, "labels": ["code-checks-approved", "fully-signed", "heterogeneous-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "49c5f62fd7140cde321ab62df5a5338583a6be2c", "merged_at": "1612968758", "merged_by": "cmsbuild", "milestone": "CMSSW_11_3_X", "number": 32861, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Minor improvement to TritonService", "updated_at": "1612968758", "user": "kpedro88"}
{"additions": 17, "auther_ref": "change_flush_settings", "auther_sha": "1f2aeb0bb9461ef89c449aa4ebb57f63b7b705b1", "author": "bbockelm", "body": "Summary:\r\n- Keep LZMA-4 as a default for data tiers that are not transient.\r\n- Change default auto-flush to 20MB (currently 10MB).\r\n- Change auto-flush for *AOD* to 30MB (currently 15MB).\r\n\r\nDetails:\r\nDid a bit of investigating inside ROOT compression settings (which maybe hasn't been done since Run I?)\r\n\r\nI took a file (/store/data/Run2017A/SingleMuon/AOD/PromptReco-v3/000/296/888/00000/002DA5DA-6455-E711-9F13-02163E014259.root) from what should be the most prevalent data tier (AOD) and recompressed it under a variety of settings (ZLIB-7, ZLIB-9, LZMA-4, LZMA-9).  A few findings.\r\n\r\nRelative speed:\r\n- ZLIB-7: 15MB/s, 0.021s/evt\r\n- ZLIB-9: 2.7MB/s, 0.11s/evt\r\n- LZMA-4: 1.9MB/s, 0.15s/evt\r\n- LZMA-9: 1.1MB/s, 0.26s/evt\r\n\r\nNothing new here.  LZMA-9 is about an order-magnitude slower than ZLIB-7; this is consistent with prior measurements.\r\n\r\nThe default compression settings for this file is LZMA-4 with 15MB auto-flush buffer, resulting in a 2,816MB file.\r\n\r\nRelative file sizes (10MB auto-flush buffer):\r\n- ZLIB-7: 3,150MB\r\n- ZLIB-9: 3,129MB\r\n- LZMA-4: 2,925MB, (+3.9% file size increase, 26MB RSS buffer savings)\r\n- LZMA-9: 2,891MB, (+2.7%, 19MB RSS buffer savings)\r\n\r\nRelative file sizes (20MB auto-flush buffer):\r\n- ZLIB-7: 2,996MB\r\n- ZLIB-9: 2,974MB\r\n- LZMA-4: 2,739MB (-2.7% smaller than original, additional 29MB RSS in buffer usage)\r\n- LZMA-9: 2,701MB (-4.1% smaller, additional 23MB RSS)\r\n\r\nUsing a 30MB auto-flush buffer:\r\n- ZLIB-7: 2,941\r\n- ZLIB-9: 2,918\r\n- LZMA-4: 2,666 (-5.3% smaller, +91MB RSS)\r\n- LZMA-9: 2,626 (-6.5% smaller, +94MB RSS)\r\n\r\nSo, for about 90MB per output file, we can get 5% additional file size savings.\r\n\r\nOther thoughts:\r\n- With multithreading, we have additional room in the memory budget.\r\n- Until ROOT 6.12 is available (which multithreads compression using TBB), we ought to be careful about significantly increasing CPU usage per-event for output, is it can cause significant stalls.\r\n\r\n@davidlange6 ", "branch": "master", "changed_files": 2, "closed_at": "1502342553", "comments": 14, "commits": 1, "created_at": "1499345637", "deletions": 36, "labels": ["comparison-available", "core-pending", "operations-pending", "orp-pending", "pending-signatures", "tests-approved"], "merge_commit_sha": "1e1587d79b47ae66268959c50cad86803f632c8a", "merged_at": "1502342553", "merged_by": "davidlange6", "milestone": "CMSSW_9_3_X", "number": 19589, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Make compression settings more aggressive.", "updated_at": "1502342553", "user": "bbockelm"}
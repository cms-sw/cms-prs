{"additions": 100, "auther_ref": "CalibTrackerSiStripCommon_moreTests", "auther_sha": "4671911874364aaf28cba8d487c851dd7e8c1029", "author": "mmusich", "body": "#### PR description:\r\n\r\nAfter integration of PR https://github.com/cms-sw/cmssw/pull/31002 I noticed that the production of Strip calibTrees was substantially slowed down and identified the motivation in the migration of `ShallowGainCalibration` from a `stream` to `global`. \r\nI revert in this PR part of the changes (commit 2c77c10) leading to the slow-down.\r\nAdditionally:\r\n- I address the comment https://github.com/cms-sw/cmssw/pull/31002#discussion_r495831968 about the content of the `plugins/BuildFile.xml` of that package (commit: 7f83ffc)\r\n- improve the unit test, in order to to run multi-threaded (but not yet using concurrent lumis), setting same compression settings as used in production and removing few missing trigger errors currently present in the IBs (see e.g. [log](https://cmssdt.cern.ch/SDT/cgi-bin/logreader/slc7_amd64_gcc820/CMSSW_11_2_X_2020-10-01-1100/unitTestLogs/CalibTracker/SiStripCommon#/71)) in commit 3da8316 \r\n- make `ShallowTree` an `edm::one::EDAnalyzer` (commit 4671911)\r\n\r\n#### PR validation:\r\n\r\nTested in `CMSSW_11_2_X_2020-09-30-1100` using:\r\n```\r\n cmsRun testProduceCalibrationTree_cfg.py inputFiles=\"/store/express/Run2018D/StreamExpress/ALCARECO/SiStripCalMinBias-Express-v1/000/323/492/00000/ED5EFF5C-1B7B-564D-974B-15499A1B7D4E.root\" inputCollection=\"ALCARECOSiStripCalMinBias\" conditionGT=\"101X_dataRun2_Express_v8\"\r\n```\r\nI get:\r\n\r\n```\r\nTimeReport> Time report complete in 360.07 seconds\r\n Time Summary: \r\n - Min event:   0.444757\r\n - Max event:   21.3634\r\n - Avg event:   1.96364\r\n - Total loop:  330.235\r\n - Total init:  29.7974\r\n - Total job:   360.07\r\n - EventSetup Lock:   0\r\n - EventSetup Get:   0\r\n Event Throughput: 2.01372 ev/s\r\n CPU Summary: \r\n - Total loop:  1286.18\r\n - Total init:  11.6651\r\n - Total extra: 0\r\n - Total job:   1297.95\r\n Processing Summary: \r\n - Number of Events:  665\r\n - Number of Global Begin Lumi Calls:  1\r\n - Number of Global Begin Run Calls: 1\r\n```\r\n\r\nwhile with this branch:\r\n\r\n```\r\nTimeReport> Time report complete in 76.3658 seconds\r\n Time Summary: \r\n - Min event:   0.0435982\r\n - Max event:   21.6353\r\n - Avg event:   0.271647\r\n - Total loop:  50.1936\r\n - Total init:  26.1378\r\n - Total job:   76.3658\r\n - EventSetup Lock:   0\r\n - EventSetup Get:   0\r\n Event Throughput: 13.2487 ev/s\r\n CPU Summary: \r\n - Total loop:  144.93\r\n - Total init:  11.4757\r\n - Total extra: 0\r\n - Total job:   156.509\r\n Processing Summary: \r\n - Number of Events:  665\r\n - Number of Global Begin Lumi Calls:  1\r\n - Number of Global Begin Run Calls: 1\r\n```\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\n\r\nNot a backport, no backport is needed.\r\n", "branch": "master", "changed_files": 8, "closed_at": "1602916644", "comments": 17, "commits": 4, "created_at": "1601562603", "deletions": 72, "labels": ["alca-approved", "bug-fix", "code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "tests-approved"], "merge_commit_sha": "731dad3ded566f3bf82a5886746c28b3943dc455", "merged_at": "1602916644", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 31643, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Fix issue with Strip CalibTree production and improve unit tests", "updated_at": "1602916644", "user": "mmusich"}
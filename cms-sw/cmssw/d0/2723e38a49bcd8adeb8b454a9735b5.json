{"additions": 89, "auther_ref": "from-CMSSW_12_3_0_pre5", "auther_sha": "7c3e03d667301c47a952a7ef015205fc4523451b", "author": "valeriadamante", "body": "#### PR description:\r\n\r\nDoing tests on GPU, there have been some issues in L2NNTag produced outputs. The problem has been addressed to the filling of the CNN inputs : ```PatatrackPtSumWithVertex``` and ```PatatrackSizeWithVertex```. The reason is the following:\r\nTo fill the aforementioned variables while looping on tracks, a match between the vertex associated to the track (*) is required by associating the observable ```idv``` (which is the vertex index related to the patatrack) to be the same of the ```sortInd``` (**) which is the vertex index sorted by the vertex observable ```ptv2``` .\r\nIf you want to give a look to the vertex related observables, they are described [here](https://github.com/cms-sw/cmssw/blob/master/CUDADataFormats/Vertex/interface/ZVertexSoA.h)\r\n\r\nThis match is not correct: indeed, the ```idv``` has to be compared with the vertex index. \r\n\r\n(*)  all tracks with vertex index -1 are not considered, since this means that they are not associated to any vertex \r\n(**) the ```sortInd``` is of a subset of all vertices, since they are required to pass some quality cuts described in the function ```SelectGoodVertices```. Also in this function there is a similar matching requirement and also in that case it has been changed. \r\n\r\n\r\n#### PR validation:\r\n\r\nThis bug was spotted because while looping multiple times on GPU, results were not consistent among each other. \r\nWith the aforementioned change, some preliminar tests on GPU and CPU have been carried on, selecting specific bugged events and from those preliminar tests there are no more differences. \r\n \r\n", "branch": "master", "changed_files": 1, "comments": 3, "commits": 2, "created_at": "1647340408", "deletions": 18, "labels": ["hlt-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-pending"], "milestone": "CMSSW_12_4_X", "number": 37249, "release-notes": [], "review_comments": 1, "state": "open", "title": "fixed bug on vertex index", "updated_at": "1647512920", "user": "valeriadamante"}
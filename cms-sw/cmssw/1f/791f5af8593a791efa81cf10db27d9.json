{"additions": 10, "auther_ref": "mc-simMTD-premixTuning", "auther_sha": "2358a53c78459cc2f6111f4214df7402b3b0d18a", "author": "casarsa", "body": "#### PR description:\r\n\r\nThe packing of the PU SimHits information in the premixing library has been tuned to fix a bias in the MTD time resolution when running with premixing. Basically, the width of the word, in which the time and energy information is stored, has been increased from 10 to 16 bits.\r\n\r\nThe figure below shows a comparison of the BTL resolution between the standard PU (WF 22234.0) and the premixed PU (WF 22234.99) for the current code and the proposed changes.\r\n\r\n![image](https://user-images.githubusercontent.com/5435977/75256574-ed617000-57e3-11ea-8ecd-e5392bbf4b1e.png)\r\n\r\n#### PR validation:\r\n\r\n**PU library size:**\r\n\r\n   current:\r\n          PMTDSimAccumulator_mix_FTLBarrel_DIGI. 3.46034e+06 2.89781e+06\r\n          PMTDSimAccumulator_mix_FTLEndcap_DIGI. 1.33435e+06 788234\r\n\r\n   new:\r\n          PMTDSimAccumulator_mix_FTLBarrel_DIGI. 4.66987e+06 2.82419e+06\r\n          PMTDSimAccumulator_mix_FTLEndcap_DIGI. 1.57796e+06 902263\r\n\r\n\r\n**Performance:**\r\n\r\nThe new code affects the steps 2 and 3, it has been tested with WF 22234.99 in CMSSW_11_1_X_2020-02-24-2300.\r\n\r\nstep 2\r\n\r\nMemoryReport> Peak virtual size 4503.98 Mbytes\r\n Key events increasing vsize: \r\n[1] run: 1 lumi: 1 event: 1  vsize = 4119.94 deltaVsize = 0 rss = 2456.23 delta = 0\r\n[2] run: 1 lumi: 1 event: 2  vsize = 4119.95 deltaVsize = 0.015625 rss = 2674.35 delta = 218.117\r\n[4] run: 1 lumi: 1 event: 4  vsize = 4503.96 deltaVsize = 384.008 rss = 2787.09 delta = 112.746\r\n[6] run: 1 lumi: 1 event: 6  vsize = 4503.98 deltaVsize = 0.0195312 rss = 2787.36 delta = 0.265625\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[8] run: 1 lumi: 1 event: 8  vsize = 4503.98 deltaVsize = 0 rss = 2860.68 delta = 73.3164\r\n[7] run: 1 lumi: 1 event: 7  vsize = 4503.98 deltaVsize = 0 rss = 2831.74 delta = 44.3789\r\n[6] run: 1 lumi: 1 event: 6  vsize = 4503.98 deltaVsize = 0.0195312 rss = 2787.36 delta = 0.265625\r\nTimeReport> Time report complete in 844.182 seconds\r\n Time Summary: \r\n - Min event:   61.3985\r\n - Max event:   116.356\r\n - Avg event:   74.3752\r\n - Total loop:  823.047\r\n - Total init:  21.0407\r\n - Total job:   844.182\r\n - EventSetup Lock:   7.72476e-05\r\n - EventSetup Get:   79.1781\r\n Event Throughput: 0.01215 ev/s\r\n CPU Summary: \r\n - Total loop:  685.092\r\n - Total init:  9.92849\r\n - Total extra: 0\r\n - Total job:   695.103\r\n Processing Summary: \r\n - Number of Events:  10\r\n - Number of Global Begin Lumi Calls:  1\r\n - Number of Global Begin Run Calls: 1\r\n\r\nstep 3\r\n\r\nMemoryReport> Peak virtual size 4815.11 Mbytes\r\n Key events increasing vsize: \r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[1] run: 1 lumi: 1 event: 1  vsize = 4035.09 deltaVsize = 0 rss = 2976.07 delta = 0\r\n[2] run: 1 lumi: 1 event: 2  vsize = 4431.09 deltaVsize = 396 rss = 3095.2 delta = 119.129\r\n[3] run: 1 lumi: 1 event: 3  vsize = 4815.11 deltaVsize = 384.02 rss = 3062.52 delta = -32.6836\r\n[0] run: 0 lumi: 0 event: 0  vsize = 0 deltaVsize = 0 rss = 0 delta = 0\r\n[5] run: 1 lumi: 1 event: 5  vsize = 4815.11 deltaVsize = 0 rss = 3238.1 delta = 175.582\r\n[4] run: 1 lumi: 1 event: 4  vsize = 4815.11 deltaVsize = 0 rss = 2982.25 delta = -80.2656\r\n[3] run: 1 lumi: 1 event: 3  vsize = 4815.11 deltaVsize = 384.02 rss = 3062.52 delta = -32.6836\r\nTimeReport> Time report complete in 655.984 seconds\r\n Time Summary: \r\n - Min event:   40.0881\r\n - Max event:   145.567\r\n - Avg event:   58.967\r\n - Total loop:  636.154\r\n - Total init:  19.2085\r\n - Total job:   655.984\r\n - EventSetup Lock:   8.89301e-05\r\n - EventSetup Get:   78.7761\r\n Event Throughput: 0.0157195 ev/s\r\n CPU Summary: \r\n - Total loop:  582.007\r\n - Total init:  12.7771\r\n - Total extra: 0\r\n - Total job:   594.932\r\n Processing Summary: \r\n - Number of Events:  10\r\n - Number of Global Begin Lumi Calls:  1\r\n - Number of Global Begin Run Calls: 1\r\n", "branch": "master", "changed_files": 2, "closed_at": "1582787724", "comments": 26, "commits": 2, "created_at": "1582642046", "deletions": 12, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "simulation-approved", "tests-approved", "upgrade-approved"], "merge_commit_sha": "b09f9d00f104187ec261c825b67026587e050168", "merged_at": "1582787724", "merged_by": "cmsbuild", "milestone": "CMSSW_11_1_X", "number": 29039, "release-notes": [], "review_comments": 0, "state": "closed", "title": "MTD simulation: premixing tuning", "updated_at": "1582787725", "user": "casarsa"}
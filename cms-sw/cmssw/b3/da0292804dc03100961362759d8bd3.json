{"additions": 327, "auther_ref": "nanoAOD_genFilterEff_120X", "auther_sha": "27fcb91fecfc2f4b6c0b56d680f1bda33a61ee76", "author": "mzarucki", "body": "#### PR description:\r\n  - new nanoAOD module `SimpleFlatTableProducerBaseLumi` (`edm::one::EDProducer`) that stores the generator filter information in a flat table\r\n  - the information is taken from the [GenFilterInfo](https://github.com/cms-sw/cmssw/blob/master/SimDataFormats/GeneratorProducts/interface/GenFilterInfo.h) header in the `LuminosityBlocks` tree in miniAOD\r\n  - the module is configured to store the following generator filter information: `numEventsTotal`, `numEventsPassed`, `filterEfficiency`,`filterEfficiencyError`\r\n  - the `genFilterTable` is added to the `globalTablesMC` sequence in [globals_cff.py](https://github.com/cms-sw/cmssw/blob/master/PhysicsTools/NanoAOD/python/globals_cff.py)\r\n  - the `nanoaod::FlatTable` is written into the `LuminosityBlocks` tree as new branches via the added `LumiOutputBranches` type\r\n  - the motivation (xsec/luminosity normalisation) and implementation was presented at the X-POG meeting (16.06.2021): [Storing Generator Filter Information in NanoAOD](https://indico.cern.ch/event/1039035/contributions/4406005/attachments/2265487/3846473/NanoAOD_GenFilterInfo_XPOG_16.06.2021_Zarucki.pdf)\r\n\r\n#### PR validation:\r\nThe code has been tested in _CMSSW_12_0_0_pre1_, running a standard nanoAOD workflow on a miniAOD signal MC sample with a generator filter (_SMS-T2tt_dM-10to80_genHT-160_genMET-80_mWMin-0p1_), over several thousand events (several LS). The output root file correctly has the requested generator filter information stored.\r\n\r\nFollowing rebasing on the latest master branch, the code has passes the nanoAOD unit tests that run over data (`runTheMatrix.py -l 136.8523`) in the latest IB _CMSSW_12_0_X_2021-06-17-1100_. The MC equivalent (`runTheMatrix.py -l 1325.81`) and `scram b runtests` fail due to a DAS error not being able to access the file. I believe it would still important to inspect the output of the nanoAOD MC unit tests.\r\n", "branch": "master", "changed_files": 7, "closed_at": "1639228655", "comments": 42, "commits": 5, "created_at": "1623940340", "deletions": 3, "labels": ["fully-signed", "tests-approved", "orp-approved", "code-checks-approved", "xpog-approved"], "merge_commit_sha": "e151b2ab9086eda00b71aa8fa7f5131271d885e6", "merged_at": "1639228655", "merged_by": "cmsbuild", "milestone": "CMSSW_12_3_X", "number": 34169, "release-notes": [], "review_comments": 15, "state": "closed", "title": "Storing Generator Filter Information in NanoAOD", "updated_at": "1639228655", "user": "mzarucki"}
{"additions": 458, "auther_ref": "setDirectoryFix5", "auther_sha": "9298eaa61cac91f03647a199382cabe187e20ba1", "author": "wddgit", "body": "This change should yield identical behavior\nand remove a thread safety issue.\n\nIn ROOT when a histogram is created, the default\nbehavior is to automatically add a reference to\nthe histogram to the list of in-memory\nobjects for the current file or directory.\nIn some cases in CMSSW, immediately after\ncreating the histogram, SetDirectory is called\nwith a null argument. This removes the reference.\nThis creates a thread safety issue because multiple\nthreads could be creating histograms in the\nsame TFile or TDirectory.\n\nAn alternative is to create a TContext object\nwith a nullptr argument whose lifetime includes\nthe creation of the histogram. Then the reference\nis never created in the first place and the call\nto SetDirectory can be deleted. The TContext object\nis a sentry that sets the thread local gDirectory\npointer in ROOT. The histogram constructor looks\nat gDirectory to decide whether to set the reference.\nWhen the TContext object goes out of scope,\ngDirectory is reset to its original value.\n", "branch": "CMSSW_7_6_X", "changed_files": 17, "closed_at": "1438187680", "comments": 16, "commits": 1, "created_at": "1437055279", "deletions": 299, "labels": ["alca-pending", "analysis-pending", "comparison-available", "dqm-pending", "orp-pending", "pending-signatures", "reconstruction-approved", "simulation-pending", "tests-approved", "visualization-approved"], "milestone": "CMSSW_7_6_X", "number": 10244, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Thread safety SetDirectory(0) fixes", "updated_at": "1474632206", "user": "wddgit"}
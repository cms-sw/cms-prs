{"additions": 10, "auther_ref": "reduceWarninLinesPerEvent", "auther_sha": "0445ac2cffdeb758984f05a3b68eb3285a305f30", "author": "perrotta", "body": "#### PR description:\r\n\r\nLogs in a few test outputs are now flooded by warning messages from L1TGlobalProducer. This makes difficult to find other warnings and debug possible other issues in the code. \r\n\r\nFor example, in wf 136.731 the MessageLogger Summary says:\r\n```\r\nMessageLogger Summary\r\n\r\n type     category        sev    module        subroutine        count    total\r\n ---- -------------------- -- ---------------- ----------------  -----    -----\r\n    1 Configuration        -w HLTHighLevel:ALC                       2        2\r\n    2 L1TGlobal            -w L1TGlobalProduce                   10868    10868\r\n    3 HLTConfigProvider    -e DQMPFCandidateAn                       2        2\r\n    4 HLTConfigProvider    -e METAnalyzer:pfMe                       2        2\r\n    5 HLTConfigProvider    -e METAnalyzer:pfPu                       2        2\r\n    6 TimeReport           -e AfterModEndJob                         1*       1\r\n    7 hltPrescaleTable     -e PATTriggerProduc                       1        1\r\n    8 fileAction           -s file_close                             1        1\r\n    9 fileAction           -s file_open                              2        2\r\n\r\n* Some occurrences of this message were suppressed in all logs, due to limits.\r\n\r\n type    category    Examples: run/evt        run/evt          run/evt\r\n ---- -------------------- ---------------- ---------------- ----------------\r\n    1 Configuration        274199/39389360  274199/38626099  \r\n    2 L1TGlobal            274199/39389360  274199/39389360  274199/39733340\r\n    3 HLTConfigProvider    Run: 274199      Run: 274199      \r\n    4 HLTConfigProvider    Run: 274199      Run: 274199      \r\n    5 HLTConfigProvider    Run: 274199      Run: 274199      \r\n    6 TimeReport           EndJob                            \r\n    7 hltPrescaleTable     274199/39389360                   \r\n    8 fileAction           PostGlobalEndRun                  \r\n    9 fileAction           pre-events       pre-events       \r\n\r\nSeverity    # Occurrences   Total Occurrences\r\n--------    -------------   -----------------\r\nWarning             10870               10870\r\nError                   8                   8\r\nSystem                  3                   3\r\n```\r\n\r\nThose warnings are repeated for every BX in the event and for every bit number above the vector dimension thresholds. Since there is no information on the bit number itself, having that message repeated multiple time is completely useless.\r\n\r\nOne possibility to reduce the number of those logWarnings is to have them only printed once per event (this is needed, because different events my have different trigger menus) and per bx, and **not** for every single bit in a given bx. This is what is implemented in this PR. (Actually, I don't think that repeating the same warning at every bx can have any usefulness, but I did not want to hit thread safety issues in doing it).\r\n\r\nWith this PR, the MessageLogger Summary for the same  wf 136.731 becomes:\r\n\r\n```\r\nMessageLogger Summary\r\n\r\n type     category        sev    module        subroutine        count    total\r\n ---- -------------------- -- ---------------- ----------------  -----    -----\r\n    1 Configuration        -w HLTHighLevel:ALC                       2        2\r\n    2 L1TGlobal            -w L1TGlobalProduce                    1000     1000\r\n    3 HLTConfigProvider    -e DQMPFCandidateAn                       2        2\r\n    4 HLTConfigProvider    -e METAnalyzer:pfMe                       2        2\r\n    5 HLTConfigProvider    -e METAnalyzer:pfPu                       2        2\r\n    6 hltPrescaleTable     -e PATTriggerProduc                       1        1\r\n    7 fileAction           -s file_close                             1        1\r\n    8 fileAction           -s file_open                              2        2\r\n\r\n type    category    Examples: run/evt        run/evt          run/evt\r\n ---- -------------------- ---------------- ---------------- ----------------\r\n    1 Configuration        274199/39389360  274199/38626099  \r\n    2 L1TGlobal            274199/39389360  274199/39389360  274199/39733340\r\n    3 HLTConfigProvider    Run: 274199      Run: 274199      \r\n    4 HLTConfigProvider    Run: 274199      Run: 274199      \r\n    5 HLTConfigProvider    Run: 274199      Run: 274199      \r\n    6 hltPrescaleTable     274199/39389360                   \r\n    7 fileAction           PostGlobalEndRun                  \r\n    8 fileAction           pre-events       pre-events       \r\n\r\nSeverity    # Occurrences   Total Occurrences\r\n--------    -------------   -----------------\r\nWarning              1002                1002\r\nError                   7                   7\r\nSystem                  3                   3\r\n```\r\n\r\nThe outputs are not yet fully cleaned, but with a factor 10 reduction of the repeatedly identical messages the logs already become much better readable and inspectable for other messages.\r\n\r\nTo the attention of @cms-sw/l1-l2\r\n\r\n#### PR validation:\r\n\r\nIt compiles and actually cleans up (a bit) the logs, without removing information from the warning message", "branch": "master", "changed_files": 1, "closed_at": "1599546115", "comments": 14, "commits": 3, "created_at": "1598513400", "deletions": 4, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "l1-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "56e25f2107db38fdb3e77049c5278af483f20140", "merged_at": "1599546115", "merged_by": "cmsbuild", "milestone": "CMSSW_11_2_X", "number": 31256, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Warn about bit number above trigger collections sizes only once per event/bx", "updated_at": "1599546115", "user": "perrotta"}
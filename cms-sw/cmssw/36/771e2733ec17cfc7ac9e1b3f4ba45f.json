{"additions": 4, "auther_ref": "PMVarProdThreadSafeFix", "auther_sha": "b45cb0a270b72d951bff4906476fc3123fc713cd", "author": "Sam-Harper", "body": "Dear All,\r\n\r\nUnfortunately for some reason I cant explain, I made EgammaHLTPixelMatchVarProducer a global module when creating it. And unfortunately it uses a TF1 which is not thread safe. My apologies for this and thank you @slava77  for the spot.\r\n\r\nHere is the fix. I also compared the variable it produces as a global module and as a stream module.  I ran the standard HLT setup with 4 cores on a machine with 12 cores to ensure it was actually multithreading (400% CPU usage was observed). The results are here:\r\nhttps://sharper.web.cern.ch/sharper/cms/heep/2017/Jun22nd/pmS2PreAndPostFix.png\r\nindicating the effect is thankfully very small (no difference observed in 100K Z->ee events) However it is extremely serious hence this quick simple patch while I continue to work on https://github.com/cms-sw/cmssw/pull/19263\r\n\r\nIt would have been sooner but been swamped with p5 operations today. \r\n", "branch": "master", "changed_files": 1, "closed_at": "1498196822", "comments": 9, "commits": 1, "created_at": "1498153863", "deletions": 4, "labels": ["comparison-available", "fully-signed", "hlt-approved", "orp-approved", "tests-approved"], "merge_commit_sha": "10da8e22722267f16163fde64426b04707440582", "merged_at": "1498196822", "merged_by": "cmsbuild", "milestone": "CMSSW_9_2_X", "number": 19410, "release-notes": [], "review_comments": 0, "state": "closed", "title": "making EgammaHLTPixelMatchVarProducer thread safe", "updated_at": "1498196822", "user": "Sam-Harper"}
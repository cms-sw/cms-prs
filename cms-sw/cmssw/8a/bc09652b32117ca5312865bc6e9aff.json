{"additions": 131, "auther_ref": "from-CMSSW_11_0_X_2019-11-01-2300_MAHI", "auther_sha": "d6a2dd12edaed949ae9723cd936e1af691856b65", "author": "mariadalfonso", "body": "This PR gain 45% in CPU speed up in the minimize function see igprof results below.\r\n\r\nValidation plots provided in double and floats\r\nhttp://dalfonso.web.cern.ch/dalfonso/HCAL/HCAL_PR28366.pdf\r\nImpact on the INtime energy is negligible, small changes on the arrivalTime.\r\n\r\nTo keep in mind in the future, the maxSV size should be moved 10 -->8 once the 2018menu is removed.\r\n\r\n-- release tag: CMSSW_11_0_X_2019-11-07-2300  --\r\n\r\n```\r\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n           81.6  .........      54.70 / 54.97        MahiFit::phase1Apply(HBHEChannelInfo const&, float&, float&, bool&, float&) const [18]\r\n[19]       81.6      54.70       2.76 / 51.93      MahiFit::doFit(std::array<float, 3ul>&, int) const\r\n           60.0  .........      40.23 / 40.23        MahiFit::minimize() const [20]\r\n            9.8  .........       6.56 / 6.56         MahiFit::calculateArrivalTime() const [25]\r\n            7.5  .........       5.05 / 5.05         MahiFit::updatePulseShape(double, Eigen::Matrix<double, -1, 1, 0, 19, 1>&, Eigen::Matrix<double, -1, 1, 0, 19, 1>&, Eigen::Matrix<double, -1, -1, 0, 19, 19>&) const [28]\r\n\r\n\r\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n           60.0  .........      40.23 / 54.70        MahiFit::doFit(std::array<float, 3ul>&, int) const [19]\r\n[20]       60.0      40.23       0.31 / 39.91      MahiFit::minimize() const\r\n           30.8  .........      20.61 / 20.61        MahiFit::nnls() const [21]\r\n           16.0  .........      10.74 / 10.74        MahiFit::updateCov() const [23]\r\n            7.7  .........       5.15 / 5.15         MahiFit::onePulseMinimize() const [27]\r\n            5.0  .........       3.38 / 3.38         MahiFit::calculateChiSq() const [33]\r\n\r\n```\r\n \r\n\r\n-- this PR at commit d6a2dd12edaed949ae9723cd936e1af691856b65   --\r\n\r\n```\r\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n           74.1  .........      33.31 / 33.56        MahiFit::phase1Apply(HBHEChannelInfo const&, float&, float&, bool&, float&) const [18]\r\n[19]       74.1      33.31       1.74 / 31.56      MahiFit::doFit(std::array<float, 3ul>&, int) const\r\n           49.8  .........      22.38 / 22.38        MahiFit::minimize() const [20]\r\n           11.0  .........       4.95 / 4.95         MahiFit::updatePulseShape(float, Eigen::Matrix<float, -1, 1, 0, 15, 1>&, Eigen::Matrix<float, -1, 1, 0, 15, 1>&, Eigen::Matrix<float, -1, -1, 0, 15, 15>&) const [25]\r\n            9.4  .........       4.22 / 4.22         MahiFit::calculateArrivalTime(unsigned int) const [26]\r\n\r\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n           49.8  .........      22.38 / 33.31        MahiFit::doFit(std::array<float, 3ul>&, int) const [19]\r\n[20]       49.8      22.38       0.32 / 22.06      MahiFit::minimize() const\r\n           23.2  .........      10.42 / 10.42        MahiFit::nnls() const [21]\r\n           14.7  .........       6.59 / 6.59         MahiFit::updateCov(Eigen::Matrix<float, -1, -1, 0, 10, 10> const&) const [22]\r\n            6.5  .........       2.93 / 2.93         MahiFit::onePulseMinimize() const [29]\r\n            4.7  .........       2.11 / 2.11         MahiFit::calculateChiSq() const [34]\r\n\r\n```\r\n\r\nTests above done on fu-c2a02-37-03 2 CPUs:\r\n  0: Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz (16 cores, 32 threads)\r\n  1: Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz (16 cores, 32 threads)\r\n\r\n", "branch": "master", "changed_files": 9, "closed_at": "1574194335", "comments": 74, "commits": 14, "created_at": "1573205022", "deletions": 126, "labels": ["code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "reconstruction-approved", "tests-approved"], "merge_commit_sha": "775ab38bc93476ea93f6c1296543168375258e9f", "merged_at": "1574194335", "merged_by": "cmsbuild", "milestone": "CMSSW_11_0_X", "number": 28366, "release-notes": [], "review_comments": 12, "state": "closed", "title": "HBHE: speed up + mahi move double to float", "updated_at": "1574194335", "user": "mariadalfonso"}
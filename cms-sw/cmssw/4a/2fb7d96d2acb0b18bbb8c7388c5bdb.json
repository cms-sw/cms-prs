{"additions": 22, "auther_ref": "121_AddGEMUnpackerL1REPACKandUpdateHLTGetConfig", "auther_sha": "6c2bedf226190849fde788be259f9f0c0619732e", "author": "srimanob", "body": "#### PR description:\r\nIt was https://github.com/cms-sw/cmssw/pull/34785\r\nThis PR is to fix two issues when L1REPACK is used for Run3. The error messages w/o this PR is mentioned at the end of the PR description.\r\n(1) no GEM unpacker defined in SimL1EmulatorRepack. It is solved in this PR.\r\n(2) when hltGetConfiguration is used, GEM geometry is not loaded properly. This PR introduced a temporary fix.\r\n\r\nNext step:\r\nFollowing the comment on https://github.com/cms-sw/cmssw/pull/34785#issuecomment-893221496\r\n\r\n#### PR validation:\r\nTo test (1), the following cmsDriver run fine.\r\n`cmsDriver.py --process reHLT -s L1REPACK:FullMC,HLT:@relval2021 --conditions auto:phase1_2021_realistic --datatier GEN-SIM-RAW -n -1 --eventcontent RAWSIM --geometry DB:Extended --era Run3 --filein file:step2.root --fileout file:step3_reHLT.root --python reHLT_ProdLike_2021.py --no_exec`\r\n\r\nTo test (2), the following config can run fine.\r\n`hltGetConfiguration /dev/CMSSW_12_1_0/GRun/V1 --process reHLT --globaltag auto:phase1_2021_realistic --mc --unprescale --paths HLTriggerFirstPath,HLT_IsoMu24_v13,HLT_Mu50_v13,HLTriggerFinalPath --output minimal --input file:step2.root --l1-emulator FullMC > tmp.py`\r\n\r\nTest cover also DD4hep (wf 11634.911), as `GEMGeometryESModule` will be loaded twice.\r\n\r\n#### if this PR is a backport please specify the original PR and why you need to backport that PR:\r\nNot a backport, and no need of backport\r\n\r\n#### Note\r\nIssue of (1): solved in this PR\r\n```\r\n----- Begin Fatal Exception 05-Aug-2021 05:33:59 CEST-----------------------\r\nAn exception of category 'ProductNotFound' occurred while\r\n   [0] Processing  Event run: 1 lumi: 1 event: 1 stream: 0\r\n   [1] Running path 'HLTAnalyzerEndpath'\r\n   [2] Prefetching for module L1TRawToDigi/'hltGtStage2Digis'\r\n   [3] Prefetching for module RawDataCollectorByLabel/'rawDataCollector'\r\n   [4] Prefetching for module L1TDigiToRaw/'packGmtStage2'\r\n   [5] Prefetching for module L1TMuonOverlapTrackProducer/'simOmtfDigis'\r\n   [6] Prefetching for module CSCTriggerPrimitivesProducer/'simCscTriggerPrimitiveDigis'\r\n   [7] Prefetching for module GEMPadDigiClusterProducer/'simMuonGEMPadDigiClusters'\r\n   [8] Calling method for module GEMPadDigiProducer/'simMuonGEMPadDigis'\r\nException Message:\r\nPrincipal::getByToken: Found zero products matching all criteria\r\nLooking for type: MuonDigiCollection<GEMDetId,GEMDigi>\r\nLooking for module label: simMuonGEMDigis\r\nLooking for productInstanceName: \r\n```\r\n\r\nIssue of (2): temporary solution is provided for now\r\n```\r\n----- Begin Fatal Exception 05-Aug-2021 05:59:31 CEST-----------------------\r\nAn exception of category 'NoProxyException' occurred while\r\n   [0] Processing  stream begin Run run: 1 stream: 1\r\n   [1] Calling method for module GEMPadDigiClusterProducer/'simMuonGEMPadDigiClusters'\r\nException Message:\r\nNo data of type \"GEMGeometry\" with label \"\" in record \"MuonGeometryRecord\"\r\n Please add an ESSource or ESProducer to your job which can deliver this data.\r\n----- End Fatal Exception -------------------------------------------------\r\n----- Begin Fatal Exception 05-Aug-2021 05:59:31 CEST-----------------------\r\nAn exception of category 'NoProxyException' occurred while\r\n   [0] Processing  stream begin Run run: 1 stream: 3\r\n   [1] Calling method for module GEMPadDigiProducer/'simMuonGEMPadDigis'\r\nException Message:\r\nNo data of type \"GEMGeometry\" with label \"\" in record \"MuonGeometryRecord\"\r\n Please add an ESSource or ESProducer to your job which can deliver this data.\r\n----- End Fatal Exception -------------------------------------------------\r\n```", "branch": "master", "changed_files": 2, "comments": 52, "commits": 6, "created_at": "1628152764", "deletions": 0, "labels": ["hlt-pending", "operations-pending", "pending-signatures", "tests-pending", "orp-pending", "code-checks-pending"], "milestone": "CMSSW_12_1_X", "number": 34788, "release-notes": [], "review_comments": 11, "state": "open", "title": "Add GEM unpacker in L1Repack FullMC and temporary load of GEM geometry to hltGetConfiguration", "updated_at": "1631747445", "user": "srimanob"}
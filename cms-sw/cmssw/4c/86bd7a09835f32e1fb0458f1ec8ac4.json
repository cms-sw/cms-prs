{"additions": 492, "auther_ref": "sistripCalibTree_2018_102X", "auther_sha": "e8d44a19d0fc593e8b8c2048d005cc92c3d2ee3f", "author": "mmusich", "body": "Greetings,\r\nthis PR packages several updates to the CalibTracker code in order to optimize the storage disk consumption of the Strip Calibration ntuples on eos. \r\nMain features added:\r\n   * possibilty to prescale events entering any of the shallow tree producers;\r\n   * added compression of `TFileService` for the `ShallowTree` class;\r\n   * moved where unnecessary double precision in favor of float;\r\n   * unused variables masked behind a preprocessor flag, `ExtendedCALIBTree`;\r\n   * `chargeoverpath` (single largest offender) variable masked, in favor of building it via ratio of existing `charge` and `path` ;\r\n   * updated unit tests\r\n\r\nChanges have been proposed and revised by @mdelcourt,@clacaputo,@echabert and @jlagram. \r\n\r\nTesting this branch with a O(1k) events from a 2017C ALCARECO file,  ***we get a net reduction of ~ 28% in size***.\r\nGoing tree by tree:\r\n### `gainCalibrationTree` tree:\r\n![gaincalibrationtreestdbunch_tree](https://user-images.githubusercontent.com/5082376/39147672-9571aa74-473a-11e8-9dee-d6cea3f7d6e8.png)\r\n### `anEff` tree:\r\n![aneff_traj](https://user-images.githubusercontent.com/5082376/39147678-98634aa8-473a-11e8-9aff-58ad5cab09f5.png)\r\n###  `EventInfo` tree:\r\n![eventinfo_tree](https://user-images.githubusercontent.com/5082376/39147695-a28c998a-473a-11e8-9ac2-bba8c541149c.png)\r\nAs the code touched here, is used also for the SiStripGains PCL algorithm a dedicated test with O(100k) events has been carried out by using the following commands:\r\n\r\n```bash\r\ncmsDriver.py step3 --datatier ALCARECO --conditions auto:run2_data -s ALCA:PromptCalibProdSiStripGains --eventcontent ALCARECO -n -1 --dasquery='file dataset=/ZeroBias/Run2016C-SiStripCalMinBias-18Apr2017-v1/ALCARECO run=276097' \r\n```\r\nfollowed by:\r\n\r\n```bash\r\ncmsDriver.py stepMultiHarvest --data --conditions auto:run2_data --scenario pp -s ALCAHARVEST:SiStripGains --filein file:PromptCalibProdSiStripGains.root -n -1 --fileout file:calib.root --customise_command \"process.DQMStore.collateHistograms = cms.untracked.bool(True)\\nprocess.dqmSaver.saveByRun=cms.untracked.int32(-1)\\n process.dqmSaver.saveAtJobEnd=cms.untracked.bool(True)\\nprocess.dqmSaver.forceRunNumber=cms.untracked.int32(999999)\" --no_exec\r\n```\r\nto emulate the Multi-Run Harvesting.\r\nNo difference is found in the output (the complete histograms comparison is available [here](https://cernbox.cern.ch/index.php/s/InqftNk879saFqA))\r\nJust to show two examples:\r\n\r\n![image](https://user-images.githubusercontent.com/5082376/39175199-016d536c-47aa-11e8-9ddd-81ac7ed1dd80.png)\r\n\r\n![image](https://user-images.githubusercontent.com/5082376/39175257-1c7aad4e-47aa-11e8-8928-4d6377515ce0.png)\r\n\r\n\r\n", "branch": "master", "changed_files": 17, "closed_at": "1525246385", "comments": 17, "commits": 18, "created_at": "1524552407", "deletions": 221, "labels": ["alca-approved", "code-checks-approved", "comparison-available", "fully-signed", "orp-approved", "tests-approved"], "merge_commit_sha": "7cba39684ac516862530f2cfdfd44054970682f1", "merged_at": "1525246385", "merged_by": "cmsbuild", "milestone": "CMSSW_10_2_X", "number": 23045, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Slimming Strip Calibration Trees output", "updated_at": "1525246385", "user": "mmusich"}
{"additions": 433, "auther_ref": "btvNano_150X", "auther_sha": "a2987166be75887971fbd31d162db1e8dc896fa9", "author": "mseidel42", "body": "#### PR description:\r\n\r\n##### Bugs fixed:\r\n- Store (slightly extended) NanoAod `finalGenparticles` instead of MiniAod `prunedGenParticles` -> restores correct indices into `GenPart` collection for all leptons\r\n- Store constituents of AK8 jets (as originally intended?)\r\n\r\n##### New features:\r\n- `JetPFCands_jetSVIdx`: link PFCands to secondary vertices within a jet\r\n- `PFCands_genCandIdx` links PFCands to matched GenCands (charged, dR<0.02)\r\n- `GenCands_genPartMotherIdx`: link GenCands to mother\r\n- `GenCands_isFromB/C`: 1 from any B/C hadron, 2 from final (weakly decaying) B/C hadron\r\n\r\n=> allows to determine whether a PFCand stems from a b/c hadron, needed for fragmentation studies in style of [HIN-24-005](https://cms-results.web.cern.ch/cms-results/public-results/preliminary-results/HIN-24-005/index.html)\r\n\r\n#### PR validation:\r\n\r\nWith ttbar lepton+jets sample:\r\n`cmsDriver.py btvNanoMC --mc --eventcontent NANOAODSIM --datatier NANOAODSIM --conditions auto:phase1_2023_realistic --step NANO:@BTV --nThreads 4 --era Run3,run3_nanoAOD_pre142X --filein /store/mc/Run3Summer23MiniAODv4/TTtoLNu2Q_TuneCP5_13p6TeV_powheg-pythia8/MINIAODSIM/130X_mcRun3_2023_realistic_v14-v2/2520000/0092e4e1-8cb2-4c2f-b57a-4fa2f42a517f.root --no_exec -n 100`\r\n\r\n##### File size:\r\nBefore: All Events data\t \t \t \t13.59\r\nAfter: All Events data\t \t \t \t13.34\r\n\r\n##### Local testing of jet and particle associations:\r\n```\r\n# Cand matching checks\r\nEvents->Draw(\"JetPFCands_pt - PFCands_pt[JetPFCands_pFCandsIdx]\")\r\nPASS\r\nEvents->Draw(\"GenJetCands_pt - GenCands_pt[GenJetCands_genCandsIdx]\")\r\nPASS\r\n\r\n# Cands to jet matching\r\nEvents->Draw(\"PFCands_eta[JetPFCands_pFCandsIdx] - Jet_eta[JetPFCands_jetIdx]\")\r\nPASS\r\nEvents->Draw(\"PFCands_eta[FatJetPFCands_pFCandsIdx] - FatJet_eta[FatJetPFCands_jetIdx]\")\r\nPASS\r\n\r\n# SV to JetSV  matching\r\nEvents->Draw(\"JetSVs_mass - SV_mass[JetSVs_sVIdx]\", \"JetSVs_sVIdx>-1\")\r\nPASS\r\nEvents->Draw(\"Jet_eta[0] - SV_eta[JetSVs_sVIdx]\", \"JetSVs_sVIdx>-1 && JetSVs_jetIdx==0\")\r\nPASS\r\n\r\n# Cands to SV matching\r\nEvents->Draw(\"PFCands_eta[JetPFCands_pFCandsIdx] - SV_eta[JetSVs_sVIdx[JetPFCands_jetSVIdx]]\", \"JetPFCands_jetSVIdx>-1 && JetSVs_sVIdx[JetPFCands_jetSVIdx]>-1\")\r\nPASS\r\n\r\n# PFCands to GenCands\r\nEvents->Draw(\"PFCands_eta - GenCands_eta[PFCands_genCandIdx]\", \"PFCands_genCandIdx>-1\")\r\nPASS\r\n\r\n# Muons to GenPart (pre-check to GenPart mother)\r\nEvents->Draw(\"Muon_eta - GenPart_eta[Muon_genPartIdx]\", \"Muon_genPartIdx>-1\")\r\nPASS\r\n\r\n# GenCands to GenPart mothers\r\nEvents->Draw(\"GenCands_eta - GenPart_eta[GenCands_genPartMotherIdx]\", \"GenCands_genPartMotherIdx>1 && GenCands_isFromB==2\")\r\nPASS\r\n```", "branch": "master", "changed_files": 6, "comments": 18, "commits": 7, "created_at": "1739291174", "deletions": 175, "labels": ["pending-signatures", "tests-approved", "orp-pending", "code-checks-approved", "xpog-pending", "btv"], "milestone": "CMSSW_15_1_X", "number": 47324, "release-notes": [], "review_comments": 0, "state": "open", "title": "[NanoAOD,BTVNano] Bugfixes and object linking", "updated_at": "1742396818", "user": "mseidel42"}
{"additions": 39, "auther_ref": "comp_gcc630-crabtw_py3", "auther_sha": "4c6624eab345002685071f11d065174d5f3411fe", "author": "mapellidario", "body": "This is ready to be merged.\r\n\r\nchanges:\r\n- `crabserver.spec`: small changes\r\n- `crabtaskworker.spec`: py3 env for tasworker, emulating changes to `crabserver.spec`. excluding ldap temporarily\r\n- `py3-ldap.spec`: first draft, not working yet. build fails with [1]. We would like to proceed with this PR anyway to start working on TW py3 migration, then we will make a new PR when we have a proper solution. Building directly with pip builder fails with [2]\r\n\r\nfyi: @belforte \r\n\r\n[1]:\r\n\r\n```plaintext\r\n* The action \"build-cms+crabtaskworker+py3.211129\" was not completed successfully because The following dependencies could not complete:\r\ninstall-external+py3-ldap+3.4.0\r\n* The action \"install-external+py3-ldap+3.4.0\" was not completed successfully because The following dependencies could not complete:\r\nbuild-external+py3-ldap+3.4.0\r\n* The action \"install-cms+crabtaskworker-webdoc+py3.211129\" was not completed successfully because The following dependencies could not complete:\r\ninstall-cms+crabtaskworker+py3.211129\r\n* The action \"build-cms+crab-devtools+1.1-comp110\" was not completed successfully because The following dependencies could not complete:\r\ninstall-cms+crabtaskworker+py3.211129\r\n* The action \"final-job\" was not completed successfully because The following dependencies could not complete:\r\nbuild-external+py3-ldap+3.4.0\r\n* The action \"install-cms+crab-devtools+1.1-comp110\" was not completed successfully because The following dependencies could not complete:\r\nbuild-cms+crab-devtools+1.1-comp110\r\n* The action \"build-cms+comp+HG2112b-comp\" was not completed successfully because The following dependencies could not complete:\r\ninstall-cms+crabtaskworker+py3.211129\r\n* The action \"install-cms+comp+HG2112b-comp\" was not completed successfully because The following dependencies could not complete:\r\nbuild-cms+comp+HG2112b-comp\r\n* The action \"build-external+py3-ldap+3.4.0\" was not completed successfully because Failed to build py3-ldap. Log file in /build/dmapelli/w/BUILD/slc7_amd64_gcc630/external/py3-ldap/3.4.0/log. Final lines of the log file:\r\ncopying Lib/slapdtest/certs/server.conf -> build/lib.linux-x86_64-3.8/slapdtest/certs\r\ncopying Lib/slapdtest/certs/server.key -> build/lib.linux-x86_64-3.8/slapdtest/certs\r\ncopying Lib/slapdtest/certs/server.pem -> build/lib.linux-x86_64-3.8/slapdtest/certs\r\nrunning build_ext\r\nbuilding '_ldap' extension\r\ncreating build/temp.linux-x86_64-3.8\r\ncreating build/temp.linux-x86_64-3.8/Modules\r\ngcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -DHAVE_TLS -DHAVE_LIBLDAP_R -DHAVE_LIBLDAP_R -DLDAPMODULE_VERSION=3.4.0 -DLDAPMODULE_AUTHOR=python-ldap project -DLDAPMODULE_LICENSE=Python style -IModules -I/build/dmapelli/w/slc7_amd64_gcc630/external/python3/3.8.2-comp/include/python3.8 -c Modules/LDAPObject.c -o build/temp.linux-x86_64-3.8/Modules/LDAPObject.o\r\nIn file included from Modules/LDAPObject.c:3:0:\r\nModules/common.h:15:18: fatal error: lber.h: No such file or directory\r\n#include <lber.h>\r\n^\r\ncompilation terminated.\r\nerror: command 'gcc' failed with exit status 1\r\nerror: Bad exit status from /build/dmapelli/w/tmp/rpm-tmp.qdzCdr (%build)\r\n\r\n\r\nRPM build errors:\r\nMacro %rpmbuild_libdir defined but not used within scope\r\nBad exit status from /build/dmapelli/w/tmp/rpm-tmp.qdzCdr (%build)\r\n\r\n* The action \"install-cms+crabtaskworker+py3.211129\" was not completed successfully because The following dependencies could not complete:\r\nbuild-cms+crabtaskworker+py3.211129\r\n```\r\n\r\n[2]:\r\n\r\n```plaintext\r\n* The action \"install-cms+crab-devtools+1.1-comp110\" was not completed successfully because The following dependencies could not complete:\r\nbuild-cms+crab-devtools+1.1-comp110\r\n* The action \"build-cms+comp+HG2112b-comp\" was not completed successfully because The following dependencies could not complete:\r\ninstall-cms+crabtaskworker+py3.211129\r\n* The action \"install-cms+comp+HG2112b-comp\" was not completed successfully because The following dependencies could not complete:\r\nbuild-cms+comp+HG2112b-comp\r\n* The action \"build-external+py3-ldap+3.4.0\" was not completed successfully because Failed to build py3-ldap. Log file in /build/dmapelli/w/BUILD/slc7_amd64_gcc630/external/py3-ldap/3.4.0/log. Final lines of the log file:\r\nBuilding wheel for python-ldap (PEP 517): finished with status 'error'\r\nERROR: Failed building wheel for python-ldap\r\nFailed to build python-ldap\r\nERROR: Could not build wheels for python-ldap which use PEP 517 and cannot be installed directly\r\nException information:\r\nTraceback (most recent call last):\r\nFile \"/build/dmapelli/w/slc7_amd64_gcc630/external/py3-pip/20.3.3/lib/python3.8/site-packages/pip/_internal/cli/base_command.py\", line 224, in _main\r\nstatus = self.run(options, args)\r\nFile \"/build/dmapelli/w/slc7_amd64_gcc630/external/py3-pip/20.3.3/lib/python3.8/site-packages/pip/_internal/cli/req_command.py\", line 180, in wrapper\r\nreturn func(self, options, args)\r\nFile \"/build/dmapelli/w/slc7_amd64_gcc630/external/py3-pip/20.3.3/lib/python3.8/site-packages/pip/_internal/commands/install.py\", line 361, in run\r\nraise InstallationError(\r\npip._internal.exceptions.InstallationError: Could not build wheels for python-ldap which use PEP 517 and cannot be installed directly\r\nRemoved build tracker: '/build/dmapelli/w/tmp/pip-req-tracker-lv72ypqj'\r\nerror: Bad exit status from /build/dmapelli/w/tmp/rpm-tmp.gUNOYa (%build)\r\n\r\n\r\nRPM build errors:\r\nMacro %rpmbuild_libdir defined but not used within scope\r\nBad exit status from /build/dmapelli/w/tmp/rpm-tmp.gUNOYa (%build)\r\n\r\n* The action \"install-cms+crabtaskworker+py3.211129\" was not completed successfully because The following dependencies could not complete:\r\nbuild-cms+crabtaskworker+py3.211129\r\n```", "branch": "comp_gcc630", "changed_files": 2, "comments": 0, "commits": 2, "created_at": "1638198507", "deletions": 14, "labels": [], "number": 7479, "release-notes": [], "review_comments": 0, "state": "open", "title": "crabtaskworker - py3-compatible env specfile", "updated_at": "1638199094", "user": "mapellidario"}
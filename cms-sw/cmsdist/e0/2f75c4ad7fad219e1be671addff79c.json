{"additions": 5, "auther_ref": "93x-gcc7-jemalloc450", "auther_sha": "03ce3c8e1e89f5608679b970dbd13c97288d5932", "author": "cms-sw", "body": "We noticed that gcc 7.0.0 tests run twice as slow as compare to gcc630 builds. It turned out to be new jemalloc 5.0.1. For now, we are reverting to jemalloc 4.5.0 for gcc7 builds but we should investigate why new jemalloc is slow\r\n```\r\n[a] 93X GCC630:\r\n   99.9   1'569.27  main [4]\r\n   99.8   1'568.18  main::{lambda()#1}::operator()() const [5]\r\n   90.2   1'416.70  edm::EventProcessor::runToCompletion() [6]\r\n   90.0   1'413.80  tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all(tbb::task&, tbb::task*) [7]\r\n   88.9   1'396.45  edm::EventProcessor::readAndProcessEvents() [8]\r\n   87.8   1'379.66  std::__exception_ptr::exception_ptr edm::Worker::runModuleAfterAsyncPrefetch<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(std::__exception_ptr::exception_ptr const*, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::Eve\r\nntPrincipal, (edm::BranchActionType)1>::Context const*) [9]\r\n   87.8   1'379.51  bool edm::Worker::runModule<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*) [10]\r\n   87.8   1'379.45  decltype ({parm#1}()) edm::convertException::wrap<bool edm::Worker::runModule<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Con\r\ntext const*)::{lambda()#1}>(bool edm::Worker::runModule<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*)::{lambda()#1}) [11]\r\n   64.2   1'008.38  edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute() [12]\r\n   63.1     991.64  edm::WorkerT<edm::stream::EDProducerAdaptorBase>::implDo(edm::EventPrincipal const&, edm::EventSetup const&, edm::ModuleCallingContext const*) [13]\r\n   63.1     991.30  edm::stream::EDProducerAdaptorBase::doEvent(edm::EventPrincipal const&, edm::EventSetup const&, edm::ActivityRegistry*, edm::ModuleCallingContext const*) [14]\r\n   23.6     370.82  void edm::SerialTaskQueueChain::actionToRun<edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1}>(edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1} const&) [15]\r\n   21.5     338.08  edm::SerialTaskQueue::QueuedTask<void edm::SerialTaskQueueChain::push<edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1}>(edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1} const&)::{lambda()#1}>::execute() [16]\r\n   20.9     328.02  edm::WorkerT<edm::one::OutputModuleBase>::implDo(edm::EventPrincipal const&, edm::EventSetup const&, edm::ModuleCallingContext const*) [17]\r\n   20.9     328.02  edm::one::OutputModuleBase::doEvent(edm::EventPrincipal const&, edm::EventSetup const&, edm::ActivityRegistry*, edm::ModuleCallingContext const*) [18]\r\n   20.9     328.02  edm::PoolOutputModule::write(edm::EventForOutput const&) [19]\r\n   20.9     327.74  edm::RootOutputFile::fillBranches(edm::BranchType const&, edm::OccurrenceForOutput const&, std::vector<edm::StoredProductProvenance, std::allocator<edm::StoredProductProvenance> >*, edm::ProductProvenanceRetriever const*) [20]\r\n   20.9     327.73  edm::RootOutputFile::writeOne(edm::EventForOutput const&) [21]\r\n   20.8     326.53  TTree::Fill() [22]\r\n\r\n[b] 93X GCC700:\r\n\r\n   99.9   5'067.90  main [4]\r\n   99.7   5'057.46  main::{lambda()#1}::operator()() const [5]\r\n   91.0   4'615.85  edm::EventProcessor::runToCompletion() [6]\r\n   90.8   4'606.56  tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all(tbb::task&, tbb::task*) [7]\r\n   89.9   4'560.22  edm::EventProcessor::readAndProcessEvents() [8]\r\n   87.0   4'411.15  std::__exception_ptr::exception_ptr edm::Worker::runModuleAfterAsyncPrefetch<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(std::__exception_ptr::exception_ptr const*, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*) [9]\r\n   87.0   4'410.94  bool edm::Worker::runModule<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*) [10]\r\n   87.0   4'410.91  decltype ({parm#1}()) edm::convertException::wrap<bool edm::Worker::runModule<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*)::{lambda()#1}>(bool edm::Worker::runModule<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >(edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::MyPrincipal const&, edm::EventSetup const&, edm::StreamID, edm::ParentContext const&, edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1>::Context const*)::{lambda()#1}) [11]\r\n   75.5   3'827.82  edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute() [12]\r\n   73.4   3'720.14  edm::WorkerT<edm::stream::EDProducerAdaptorBase>::implDo(edm::EventPrincipal const&, edm::EventSetup const&, edm::ModuleCallingContext const*) [13]\r\n   73.3   3'714.78  edm::stream::EDProducerAdaptorBase::doEvent(edm::EventPrincipal const&, edm::EventSetup const&, edm::ActivityRegistry*, edm::ModuleCallingContext const*) [14]\r\n   32.8   1'663.74  malloc [15]\r\n   32.5   1'647.14  operator new(unsigned long) [16]\r\n   32.5   1'645.88  void* newImpl<false>(unsigned long) [17]\r\n   31.9   1'618.09  imalloc [18]\r\n   31.2   1'583.90  free [19]\r\n   30.6   1'553.66  operator delete(void*) [20]\r\n   30.6   1'552.61  imalloc_body [21]\r\n   23.7   1'202.78  ifree [22]\r\n   21.0   1'064.07  cms::CkfTrackCandidateMakerBase::produceBase(edm::Event&, edm::EventSetup const&) [23]\r\n   17.7     895.01  imalloc_no_sample [24]\r\n   17.0     862.89  GroupedCkfTrajectoryBuilder::groupedLimitedCandidates(TrajectorySeed const&, TempTrajectory const&, TrajectoryFilter const*, Propagator const*, bool, std::vector<TempTrajectory, std::allocator<TempTrajectory> >&) const [25]\r\n   16.7     845.82  edm::DataMixingModule::put(edm::Event&, edm::EventSetup const&) [26]\r\n   16.6     843.91  idalloctm [27]\r\n   16.1     816.25  GroupedCkfTrajectoryBuilder::advanceOneLayer(TrajectorySeed const&, TempTrajectory&, TrajectoryFilter const*, Propagator const*, bool, std::vector<TempTrajectory, std::allocator<TempTrajectory> >&, std::vector<TempTrajectory, std::allocator<TempTrajectory> >&) const [28]\r\n   15.3     778.22  iallocztm [29]\r\n   14.7     744.27  arena_dalloc [30]\r\n   13.8     700.74  TrajectorySegmentBuilder::segments(TrajectoryStateOnSurface) [31]\r\n   13.5     686.30  arena_malloc [32]\r\n   13.4     677.28  edm::BMixingModule::produce(edm::Event&, edm::EventSetup const&) [33]\r\n   13.0     657.96  GroupedCkfTrajectoryBuilder::buildTrajectories(TrajectorySeed const&, std::vector<Trajectory, std::allocator<Trajectory> >&, TrajectoryFilter const*) const [34]\r\n   12.6     639.39  arena_salloc [35]\r\n   11.9     602.62  check_entry_exit_locking [36]\r\n   11.9     601.80  edm::DataMixingSiStripMCDigiWorker::putSiStrip(edm::Event&, edm::EventSetup const&) [37]\r\n   11.7     592.58  tcache_alloc_small [38]\r\n   11.5     581.78  void edm::SerialTaskQueueChain::actionToRun<edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1}>(edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1} const&) [39]\r\n   11.3     571.40  tcache_dalloc_small [40]\r\n   10.4     525.30  edm::DataMixingModule::doPileUp(edm::Event&, edm::EventSetup const&) [41]\r\n   10.4     525.29  void edm::PileUp::readPileUp<std::_Bind<void (edm::DataMixingModule::*(std::reference_wrapper<edm::DataMixingModule>, std::_Placeholder<1>, int, std::_Placeholder<2>, std::reference_wrapper<edm::EventSetup const>, edm::ModuleCallingContext const*))(edm::EventPrincipal const&, int, int, edm::EventSetup const&, edm::ModuleCallingContext const*)> >(edm::EventID const&, std::vector<edm::SecondaryEventIDAndFileInfo, std::allocator<edm::SecondaryEventIDAndFileInfo> >&, std::_Bind<void (edm::DataMixingModule::*(std::reference_wrapper<edm::DataMixingModule>, std::_Placeholder<1>, int, std::_Placeholder<2>, std::reference_wrapper<edm::EventSetup const>, edm::ModuleCallingContext const*))(edm::EventPrincipal const&, int, int, edm::EventSetup const&, edm::ModuleCallingContext const*)>, int, edm::StreamID const&) [42]\r\n   10.4     525.29  unsigned long edm::VectorInputSource::loopOverEvents<edm::RecordEventID<std::_Bind<void (edm::DataMixingModule::*(std::reference_wrapper<edm::DataMixingModule>, std::_Placeholder<1>, int, std::_Placeholder<2>, std::reference_wrapper<edm::EventSetup const>, edm::ModuleCallingContext const*))(edm::EventPrincipal const&, int, int, edm::EventSetup const&, edm::ModuleCallingContext const*)> > >(edm::EventPrincipal&, unsigned long&, unsigned long, edm::RecordEventID<std::_Bind<void (edm::DataMixingModule::*(std::reference_wrapper<edm::DataMixingModule>, std::_Placeholder<1>, int, std::_Placeholder<2>, std::reference_wrapper<edm::EventSetup const>, edm::ModuleCallingContext const*))(edm::EventPrincipal const&, int, int, edm::EventSetup const&, edm::ModuleCallingContext const*)> >, CLHEP::HepRandomEngine*, edm::EventID const*) [43]\r\n    9.2     467.99  edm::SerialTaskQueue::QueuedTask<void edm::SerialTaskQueueChain::push<edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1}>(edm::Worker::RunModuleTask<edm::OccurrenceTraits<edm::EventPrincipal, (edm::BranchActionType)1> >::execute()::{lambda()#1} const&)::{lambda()#1}>::execute() [44]\r\n    9.1     462.53  edm::DataMixingModule::pileWorker(edm::EventPrincipal const&, int, int, edm::EventSetup const&, edm::ModuleCallingContext const*) [45]\r\n    8.3     423.13  je_tcache_salloc [46]\r\n    8.0     405.85  LayerMeasurements::groupedMeasurements(DetLayer const&, TrajectoryStateOnSurface const&, Propagator const&, MeasurementEstimator const&) const [47]\r\n    7.2     366.33  rtree_read [48]\r\n    6.9     348.24  edm::WorkerT<edm::one::OutputModuleBase>::implDo(edm::EventPrincipal const&, edm::EventSetup const&, edm::ModuleCallingContext const*) [49]\r\n    6.9     348.24  edm::one::OutputModuleBase::doEvent(edm::EventPrincipal const&, edm::EventSetup const&, edm::ActivityRegistry*, edm::ModuleCallingContext const*) [50]\r\n    6.9     348.24  edm::PoolOutputModule::write(edm::EventForOutput const&) [51]\r\n    6.9     348.07  edm::RootOutputFile::fillBranches(edm::BranchType const&, edm::OccurrenceForOutput const&, std::vector<edm::StoredProductProvenance, std::allocator<edm::StoredProductProvenance> >*, edm::ProductProvenanceRetriever const*) [52]\r\n    6.9     348.04  edm::RootOutputFile::writeOne(edm::EventForOutput const&) [53]\r\n    6.8     345.04  TTree::Fill() [54]\r\n```", "branch": "IB/CMSSW_9_3_X/gcc700", "changed_files": 3, "closed_at": "1501675124", "comments": 1, "commits": 1, "created_at": "1501675113", "deletions": 5, "labels": ["externals-pending", "orp-pending", "pending-signatures", "tests-pending"], "merge_commit_sha": "a387621e5840d3241bddb3e1cad5a779682c979c", "merged_at": "1501675124", "merged_by": "smuzaffar", "number": 3329, "release-notes": [], "review_comments": 0, "state": "closed", "title": "revert to use jemalloc 4.5.0", "updated_at": "1502362263", "user": "smuzaffar"}
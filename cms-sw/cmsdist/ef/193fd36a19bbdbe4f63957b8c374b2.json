{"additions": 1, "auther_ref": "20231201_crabzshcompletion", "auther_sha": "9b829a747ce199e72548d09ecf15cc0a47c26cfe", "author": "mapellidario", "body": "### problem\r\n\r\nCurrent `crab-setup.sh` does not support zsh on login shells.\r\n\r\n### description\r\n\r\nWhen opening a shell on lxplus, the shell is of type \"login\", so \r\n\r\n```plaintext\r\n> [15:24] lxplus909 ~\r\n> ps -p$$ -ocmd=\r\n-zsh\r\n```\r\n\r\nwhich makes the check ` [ \"$(ps -p$$ -ocmd=)\" = \"zsh\" ]` in `crab-setup.sh` to return false, and\r\n\r\n```plaintext\r\nautoload -U +X compinit && compinit\r\nautoload -U +X bashcompinit && bashcompinit\r\n```\r\n\r\nare not executed, so zsh does not know about the function `complete`, and we ultimately can not import bash completions into zsh.\r\n\r\n### solution\r\n\r\nchange the condition to match also zsh login shell, something like the following should do the job.\r\n\r\n```diff\r\n- [ \"$(ps -p$$ -ocmd=)\" = \"zsh\" ]\r\n+ [[ \"$(ps -p$$ -ocmd=)\" = *\"zsh\" ]]\r\n```\r\n\r\nI tested it and it works.\r\n\r\nfyi @belforte @novicecpp , I know you use bash, but maybe a user asks for it", "branch": "IB/CMSSW_14_0_X/master", "changed_files": 1, "comments": 1, "commits": 1, "created_at": "1701437617", "deletions": 1, "labels": ["tests-pending", "externals-pending", "pending-signatures", "orp-pending"], "number": 8850, "release-notes": [], "review_comments": 0, "state": "open", "title": "crab-setup - support zsh login shell", "updated_at": "1701437642", "user": "mapellidario"}
{"additions": 8, "auther_ref": "tensorflow_absl_version", "auther_sha": "ed0e178f74dc0adb971dd80af4d802e240f78b9f", "author": "kpedro88", "body": "The change to the abseil version in #8565 introduced an inconsistency in TensorFlow, leading to errors like this:\r\n```\r\n/cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/gcc/11.4.1-30ebdc301ebd200f2ae0e3d880258e65/bin/../lib/gcc/x86_64-unknown-linux-gnu/11.4.1/../../../../x86_64-unknown-linux-gnu/bin/ld.bfd: tmp/slc7_amd64_gcc11/src/RecoMET/METPUSubtraction/plugins/RecoMETMETPUSubtraction_plugins/ccjAPFCF.ltrans0.ltrans.o: in function `DeepMETProducer::DeepMETProducer(edm::ParameterSet const&, tensorflow::SessionCache const*)':\r\n<artificial>:(.text+0x6d6c): undefined reference to `tensorflow::TensorShapeBase<tensorflow::TensorShape>::TensorShapeBase(absl::lts_20230125::Span<long const>)'\r\n/cvmfs/cms.cern.ch/slc7_amd64_gcc11/external/gcc/11.4.1-30ebdc301ebd200f2ae0e3d880258e65/bin/../lib/gcc/x86_64-unknown-linux-gnu/11.4.1/../../../../x86_64-unknown-linux-gnu/bin/ld.bfd: <artificial>:(.text+0x6da7): undefined reference to `tensorflow::TensorShapeBase<tensorflow::TensorShape>::TensorShapeBase(absl::lts_20230125::Span<long const>)'\r\ncollect2: error: ld returned 1 exit status\r\ngmake: *** [config/SCRAM/GMake/Makefile.rules:1793: tmp/slc7_amd64_gcc11/src/RecoMET/METPUSubtraction/plugins/RecoMETMETPUSubtraction_plugins/libRecoMETMETPUSubtraction_plugins.so] Error 1\r\n```\r\n\r\nThe problem as I understand it:\r\n1. The TensorFlow shared libraries are linked to the CMSSW abseil library and have the correct symbols, but the TensorFlow *headers* have a different abseil namespace (`lts_20220623` rather than `lts_20230125`).\r\n2. This appears to be because TensorFlow still uses its local Bazel workspace information for abseil, even with our `bazel-absl.patch` file that updates the central Bazel info on this package.\r\n\r\nI patched all the places I could find where the Bazel version was hardcoded in the TensorFlow source (based on the upstream abseil version update in TensorFlow 2.13.0, one minor version after ours: https://github.com/tensorflow/tensorflow/commit/ad938db0da16d00d7f14da3de2a4abb97b1bc340) and was able to remove the `DeepMETProducer` workaround from https://github.com/cms-sw/cmssw/pull/42228 (see https://github.com/cms-sw/cmssw/pull/42682). I'm happy to reimplement the patches in whatever way is preferred (but it's going to be ugly no matter what).\r\n\r\nattn: @iarspider @yongbinfeng", "branch": "IB/CMSSW_13_3_X/master", "changed_files": 1, "closed_at": "1693452175", "comments": 6, "commits": 2, "created_at": "1693324171", "deletions": 0, "labels": ["tests-approved", "externals-pending", "pending-signatures", "orp-pending"], "number": 8672, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Use consistent abseil version in TensorFlow", "updated_at": "1693452176", "user": "kpedro88"}
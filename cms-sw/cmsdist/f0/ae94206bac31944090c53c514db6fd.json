{"additions": 1, "auther_ref": "smuzaffar-patch-8", "auther_sha": "d22076e00a2adf9468b7b900e7906a9958bfcbb1", "author": "cms-sw", "body": "Looks like edm class checks silently ignore missing `rootmap` files and suggest a different checksum when rootmap files are not there. New tag makes sure that `rootmap` files are also moved to lib production store when `pcm` files are moved.\r\n\r\nLooks like if `rootmap` files (which are generated (along with `pcm`) when we generate root dict source file) are missing then root suggests different checksum. For normal PR tests it works as `rootmap` files are read from the release area but for PR tests with full rebuild ( where we remove ref to release area)  the rootmap files are missing and root suggests different checksum. A simple script ( copied from edm class check) [a] shows that if we have `rootmap` files then class checksum is same as we have in classes_def file but if we remove the `rootmap` files then it shows different checksum [b]\r\n\r\n\r\n[a]\r\n```\r\n> cat get_class_checksum.py\r\n#!/usr/bin/env python3\r\nimport sys, ROOT\r\nname=sys.argv[1]\r\nlib=sys.argv[2]\r\nROOT.PyConfig.DisableRootLogon = True\r\nROOT.gROOT.SetBatch(True)\r\nROOT.gROOT.ProcessLine(\".autodict\")\r\nROOT.gSystem.Load(\"lib%s.so\" % lib)\r\nROOT.gROOT.ProcessLine(\"class checkclass {public: int f(char const* name) {TClass* cl = TClass::GetClass(name); bool b = false; cl->GetCheckSum(b); return (int)b;} };\")\r\nROOT.gROOT.ProcessLine(\"checkclass checkTheClass;\")\r\nc = ROOT.TClass.GetClass(name)\r\ntemp = \"checkTheClass.f(\" + '\"' + name + '\"' + \");\"\r\nROOT.gROOT.ProcessLine(temp)\r\nprint(c.GetCheckSum(),c.GetClassVersion())\r\n```\r\n\r\n[b]\r\n- DataFormats/CTPPSDetId/src/classes_def.xml\r\n``` \r\n<class name=\"CTPPSDetId\" ClassVersion=\"3\">\r\n    <version ClassVersion=\"3\" checksum=\"2579437464\"/>\r\n</class>\r\n```\r\n- content of lib/arch\r\n```\r\nDataFormatsCTPPSDetId_xr.rootmap    DataFormatsCommon_xr.rootmap\r\nDataFormatsDetId_xr.rootmap    DataFormatsProvenance_xr.rootmap\r\nlibDataFormatsCTPPSDetId.so  libDataFormatsDetId.so\r\nlibFWCoreMessageLogger.so  libFWCoreReflection.so\r\nDataFormatsCTPPSDetId_xr_rdict.pcm  DataFormatsCommon_xr_rdict.pcm\r\nDataFormatsDetId_xr_rdict.pcm  DataFormatsProvenance_xr_rdict.pcm\r\nlibDataFormatsCommon.so      libDataFormatsProvenance.so\r\nlibFWCorePluginManager.so  libFWCoreUtilities.so\r\n```\r\n- running  script with `rootmap` files available\r\n```\r\n> get_class_checksum.py CTPPSDetId DataFormatsCTPPSDetId\r\n2579437464 3\r\n```\r\n- running script without `rootmap` files\r\n```\r\n> mv lib/el8_amd64_gcc12/*.rootmap backup/\r\n> get_class_checksum.py CTPPSDetId DataFormatsCTPPSDetId\r\n1554945820 3\r\n```", "branch": "IB/CMSSW_15_0_X/master", "changed_files": 1, "comments": 8, "commits": 2, "created_at": "1733925521", "deletions": 1, "labels": ["externals-pending", "pending-signatures", "tests-started", "orp-pending"], "number": 9568, "release-notes": [], "review_comments": 0, "state": "open", "title": "[BuildRule] Copy rootmap to lib product store", "updated_at": "1733935743", "user": "smuzaffar"}
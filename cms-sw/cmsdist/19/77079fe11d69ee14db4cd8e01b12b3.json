{"additions": 1, "auther_ref": "IB/CMSSW_13_0_X/master", "auther_sha": "70f196917a0d4525629bcda9ebbfd5a91ac06e38", "author": "silviodonato", "body": "About one year ago we discovered differences of few percents between AMD and Intel in few HLT paths when rerunning the HLT [1]. The situation got worse when we added the parking di-electron paths with dZ path, which gave a difference of ~8% [2].\r\n\r\nAfter several failed attempts, @gparida managed to solve the differences following @VinInn suggestion [3] to use `-Ofast  -fno-reciprocal-math -mno-recip`.\r\n\r\n@gparida replaced `<use name=\"ofast-flag\"/>` with `<flags   CXXFLAGS=\"-Ofast  -fno-reciprocal-math -mrecip=none\"/>` in all `BuildFiles.xml` (except `test` folders to save compilation time)\r\n```\r\n\"RecoEgamma/EgammaElectronAlgos/BuildFile.xml\"\r\n\"RecoEgamma/EgammaPhotonAlgos/BuildFile.xml\"\r\n\"RecoPixelVertexing/PixelTriplets/BuildFile.xml\"\r\n\"RecoPixelVertexing/PixelTriplets/plugins/BuildFile.xml\"\r\n\"RecoTracker/FinalTrackSelectors/BuildFile.xml\"\r\n\"RecoTracker/FinalTrackSelectors/plugins/BuildFile.xml\"\r\n\"RecoTracker/TkDetLayers/BuildFile.xml\"\r\n\"RecoTracker/TkHitPairs/BuildFile.xml\"\r\n\"RecoVertex/PrimaryVertexProducer/BuildFile.xml\"\r\n\"TrackingTools/GsfTools/BuildFile.xml\"\r\n\"TrackingTools/GsfTools/plugins/BuildFile.xml\"\r\n\"TrackingTools/GsfTracking/BuildFile.xml\"\r\n\"TrackingTools/KalmanUpdators/BuildFile.xml\"\r\n\"TrackingTools/MaterialEffects/BuildFile.xml\"\r\n\"TrackingTools/MaterialEffects/plugins/BuildFile.xml\"\r\n\"TrackingTools/TrackFitters/BuildFile.xml\"\r\n\"TrackingTools/TrajectoryState/BuildFile.xml\"\r\n```\r\nand found no AMD/Intel differences @gparida please share your results here (which release did you use?).\r\n\r\nSo I made this PR to implement this change directly at `cmsdist` level \r\n(but I didn't test it compiling the externals).\r\n\r\nI don't know exactly the impact on timing, but I assume it will be much smaller than 1%, that was the impact of the full removal of Ofast [4]\r\n\r\n[1] https://its.cern.ch/jira/browse/CMSHLT-2257\r\n[2] https://docs.google.com/spreadsheets/d/1XRu1sfIYJUQ0e7Z_yJWdGrxTDA31zr33uWPFY54-APc\r\n[3] https://its.cern.ch/jira/browse/CMSHLT-2257?focusedCommentId=4686018&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-4686018\r\n[4] https://github.com/cms-sw/cmssw/issues/40089\r\n\r\ncc @cms-sw/hlt-l2 @cms-sw/reconstruction-l2 @gparida @sanuvarghese @cms-sw/core-l2 \r\n", "branch": "IB/CMSSW_13_0_X/master", "changed_files": 1, "closed_at": "1675886250", "comments": 41, "commits": 3, "created_at": "1675244433", "deletions": 1, "labels": ["tests-approved", "reconstruction-approved", "hlt-approved", "externals-approved", "orp-approved", "fully-signed", "urgent"], "merge_commit_sha": "1be93a553efd8451468b6df382fb2ebe9aeb77c7", "merged_at": "1675886250", "merged_by": "smuzaffar", "number": 8280, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Add  -fno-reciprocal-math -mrecip=none to Ofast to solve the AMD/Intel differences", "updated_at": "1675890173", "user": "silviodonato"}
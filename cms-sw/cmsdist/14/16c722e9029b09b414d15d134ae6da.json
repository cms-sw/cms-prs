{"additions": 77, "auther_ref": "dev-20150430-01-CMSSW_7_5_X-pandas", "auther_sha": "ad45a022207f57b0d7749b754b12b8aec8e9b5e6", "author": "TaiSakuma", "body": "This PR adds [_pandas_](http://pandas.pydata.org/).\n\nFollowing [the presentation](https://indico.cern.ch/event/384920/session/4/contribution/3) at [the RECO/AT meeting](https://indico.cern.ch/event/384920/) on Thursday, 30 April 2015, I tried writing _spec files_ for _pandas_ and its requirements.\n\nThis is my first PR to this repo. I am not familiar with the development of this repo. I might not be doing right.\n\nFirst, this PR is made to the branch [IB/CMSSW_7_5_X/stable](https://github.com/cms-sw/cmsdist/tree/IB/CMSSW_7_5_X/stable). I am not sure if this is the right branch. Please let me know if this PR should be made to another branch.\n\n_pandas_ depends on three other packages. It also has recommended and optional dependencies. These are listed at:\n- http://pandas.pydata.org/pandas-docs/stable/install.html#dependencies\n\nThis PR upgrades NumPy and python-dateutil to meet the requirement.\n\nThe website above states that recommended dependencies provide large speedups for large data sets, which might be very useful. But this PR doesn't install those recommended dependencies. I could try to add them as a separate PR.\n\n~~This PR adds ATLAS as NumPy uses it. The compilation of ATLAS is probably the most complicated part of this PR.~~\n#### Comments of packages\n\nI will add comments below for several packages.\n##### ATLAS\n\n(_This PR no longer adds ATLAS_)\n\nThis PR adds [ATLAS](http://math-atlas.sourceforge.net/), which NumPy uses for fast calculation of linear algebra. ATLAS is in the branch [IB/CMSSW_4_4_X/stable](https://github.com/cms-sw/cmsdist/blob/IB/CMSSW_4_4_X/stable/atlas.spec). I copied the spec file from the branch and updated to use [the most recent verion](http://sourceforge.net/projects/math-atlas/files/Stable/) of ATLAS.\n###### Tuning\n\nThe performance of ATLAS depends on [how it is tuned](http://math-atlas.sourceforge.net/atlas_install/node6.html) at the compile time. This PR uses only `-b 64` for the tuning. This might not be the best option. Or this might not work on OSX.\n###### Netlib LAPACK\n\nThis PR uses [the \"--with-netlib-lapack-tarfile\" option](http://math-atlas.sourceforge.net/atlas_install/node8.html), which will compile [netlib's LAPACK](http://www.netlib.org/lapack/) and install it. \n\nHowever, the _cmsdist_ also has _lapack.spec_. So there will be two instances of Netlib's LAPACK.\n###### Shared objects\n\nI modified Makefile such that shared objects are built in the way in which NumPy and other packages appear to expect.\n\nThe configuration option [--shared](http://math-atlas.sourceforge.net/atlas_install/node22.html) creates two share objects: _libsatlas.so_ and _libtatlas.so_, which include all symbols for serial and parallel API's respectively, which are not other packages that use ATLAS expect and find by default. For example, see [a stackoverflow post](http://stackoverflow.com/questions/13439296/build-shared-libraries-in-atlas).\n\nThis PR builds those two shared objects but doesn't install them.\n\nInstead, this PR builds seven share objects, each for one archive file and install them. Those share objects are _libatlas.so_, _libf77blas.so_, _libcblas.so_, _liblapack.so_, _libptf77blas.so_, _libptcblas.so_, and _libptlapack.so_.\n##### NumPy\n\n[This website](http://www.scipy.org/scipylib/building/linux.html) says that shared objects for BLAS, LAPACK, and ATLAS can be specified by environmental variables. However, this wasn't the case when I tried. So instead, this PR uses _site.cfg_ to specify those.\n##### _pandas_\n\nI modified _setup.py_ so that _setuptools_ won't compile NumPy again. I think setuptools are supposed to check if requires are installed and if not then install them. However, it would always try to install NumPy even when NumPy is installed. I couldn't figure out why. So I just removed several lines in _setup.py_ that indicate the requirement of NumPy.\n\nI removed the NumPy requirement from both `setup_requires` and `install_requires`. If it is in `setup_requires`, the setuptools would compile NumPy before compiling pandas. If it is not in `setup_requires` but in `install_requires`, the setuptools would compile NumPy after compiling _pandas_.\n#### Test the branch\n\nI tested my branch with the following commands on ~~lxplus~~ _cmsdev_.\n\n``` bash\nCMSSW_X_Y_Z=CMSSW_7_5_0_pre3\nARCH=slc6_amd64_gcc491\nQUEUE=`echo $CMSSW_X_Y_Z | sed -e 's/\\(CMSSW_[0-9][0-9]*_[0-9][0-9]*\\).*/\\1_X/'`\neval $(curl -f -L https://raw.githubusercontent.com/cms-sw/cms-bot/master/config.map | grep \"SCRAM_ARCH=$ARCH;\" | grep \"RELEASE_QUEUE=$QUEUE;\")\ngit clone -b $CMSDIST_TAG git@github.com:cms-sw/cmsdist.git CMSDIST\ngit clone -b $PKGTOOLS_TAG git@github.com:cms-sw/pkgtools.git PKGTOOLS\nsh -e PKGTOOLS/scripts/prepare-cmsdist $CMSSW_X_Y_Z $ARCH\ncd CMSDIST\ngit remote add mine git@github.com:TaiSakuma/cmsdist.git\ngit fetch mine\ngit merge mine/dev-20150430-01-CMSSW_7_5_X-pandas\ncd ..\nscreen -e^vv -L time PKGTOOLS/cmsBuild --architecture=$ARCH --builders 4 -j 16 build cms-git-tools\nscreen -e^vv -L time PKGTOOLS/cmsBuild --architecture=$ARCH --builders 4 -j 16 build py2-pandas-toolfile\n```\n\n_pandas_ is compiled.\n\nI don't know how to enter the environment that was built. So I didn't try to import _pandas_ to a Python script.\n\nAny comments or suggestions are welcome.\n", "branch": "IB/CMSSW_7_5_X/stable", "changed_files": 7, "closed_at": "1430821723", "comments": 8, "commits": 15, "created_at": "1430579536", "deletions": 22, "labels": ["tests-approved"], "merge_commit_sha": "e8dd70573771e2bce41a4a5dc2fa677c855117d8", "merged_at": "1430821723", "merged_by": "degano", "milestone": "Next CMSSW_7_5_X", "number": 1522, "release-notes": [], "review_comments": 0, "state": "closed", "title": "add pandas", "updated_at": "1430821724", "user": "TaiSakuma"}
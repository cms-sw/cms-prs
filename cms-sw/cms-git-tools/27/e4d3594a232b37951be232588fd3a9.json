{"additions": 58, "auther_ref": "rmpkg2", "auther_sha": "f22660525ee6f38b61bfaca3e265dd0cdce04be7", "author": "kpedro88", "body": "`cms-rmpkg` was originally introduced in #80, but then removed in #83. The problems were:\r\n\r\n> * rmpkg can be used to delete a package which was part of a cms-merge-topic. In this case things can fail.\r\n> * when we delete a package (after it has been built once) then it leaves the newly generated files e.g. package/python/*.pyc files in the area. This can also cause problems.\r\n> * SCRAM/build rules also needs update to support rmpkg as it still create lib/$SCRAM_ARCH/.poisonededmplugincache file for the deleted plugins.\r\n\r\nThis PR addresses the first two concerns by:\r\n* making a list of packages modified after the tag corresponding to `$CMSSW_VERSION` and stopping if any requested packages are on it\r\n* making a list of packages containing untracked files (e.g. `.pyc`) and stopping if any requested packages are on it\r\n* allows overriding the stop with `-o, --force` (will delete untracked files in that case)\r\n\r\nOther changes in this PR:\r\n* update documentation\r\n* simplify logic for handling input files (just convert to a space-separated package list right away, then the rest of the code doesn't have to care if it's an input file or not)\r\n\r\nQuestions for others (@smuzaffar, @fwyzard, @davidlange6, anybody else who cares):\r\n1. Are the messages printed for the special cases sufficient? (see below)\r\n2. Right now, if given packages A and B, `cms-rmpkg` won't remove A if B triggers an error (because nonexistent, containing untracked files, or modified). Should we try to make it more permissive (e.g. remove anything it can remove)?\r\n3. I don't know how to fix the SCRAM build rules to deal with packages that were removed but not deleted. Any ideas?\r\n\r\nTested as follows:\r\n```\r\ncmsrel CMSSW_10_1_0_pre2\r\ncd CMSSW_10_1_0_pre2/src\r\ncmsenv\r\ngit cms-addpkg RecoEgamma/PhotonIdentification Configuration/PyReleaseValidation\r\nscram b -j 8\r\n(add random comment to file in Configuration/PyReleaseValidation, commit change)\r\n```\r\n\r\nFirst test:\r\n```\r\ngit cms-rmpkg RecoEgamma Configuration/PyReleaseValidation\r\n```\r\ngives:\r\n```\r\n\r\nThese packages contain untracked files\r\nRecoEgamma\r\nConfiguration/PyReleaseValidation\r\n\r\nThese packages have been modified from the base release\r\nConfiguration/PyReleaseValidation\r\n```\r\n\r\nSecond test:\r\n```\r\ngit cms-rmpkg -o RecoEgamma Configuration/PyReleaseValidation\r\n```\r\ngives:\r\n```\r\n\r\nThese packages contain untracked files\r\nRecoEgamma\r\nConfiguration/PyReleaseValidation\r\n\r\nThese packages have been modified from the base release\r\nConfiguration/PyReleaseValidation\r\n\r\nRemoving packages\r\nRecoEgamma\r\nConfiguration/PyReleaseValidation\r\n```", "branch": "master", "changed_files": 4, "closed_at": "1527514818", "comments": 3, "commits": 6, "created_at": "1520606160", "deletions": 56, "labels": ["externals-pending", "orp-pending", "pending-signatures", "tests-pending"], "merge_commit_sha": "586e61a8f93996c99af1673b0144dfdc5e53b12b", "merged_at": "1527514818", "merged_by": "smuzaffar", "number": 96, "release-notes": [], "review_comments": 0, "state": "closed", "title": "The return of cms-rmpkg", "updated_at": "1527514818", "user": "kpedro88"}
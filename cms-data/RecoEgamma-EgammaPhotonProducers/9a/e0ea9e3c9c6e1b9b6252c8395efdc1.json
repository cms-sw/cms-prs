{"additions": 24, "auther_ref": "main", "auther_sha": "6b56ced72147a713120e1c6ae3176eef12c21e42", "author": "ssrothman", "body": "In newer versions of torch as packaged by triton, there is a typeing error for empty tensors. The behavior seems to be that they are treated as always being Int tensors, even if the type should be Float (and all of the types are set correctly in the code and config.pbtxt). This results in a crash in the DRN when there are no preshower hits:\r\n```\r\nFile \"/home/submit/srothman/EM-ID-and-reco/models/DynamicReductionNetworkObject.py\", line 266, in forward\r\n        #print(\"min=\", torch.min(ES).item(), \"max=\", torch.max(ES).item(), \"finite\", torch.all(torch.isfinite(ES)).item())\r\n        ECAL = self.inputnetECAL(ECAL)\r\n        ES = self.inputnetES(ES)\r\n             ~~~~~~~~~~~~~~~ <--- HERE\r\n        #print(\"ECAL after inputnet:\")\r\n        #print(\"min=\", torch.min(ECAL).item(), \"max=\", torch.max(ECAL).item(), \"finite\", torch.all(torch.isfinite(ECAL)).item())\r\n  File \"/work/submit/srothman/miniforge3/envs/torch/lib/python3.7/site-packages/torch/nn/modules/container.py\", line 204, in forward\r\n    def forward(self, input):\r\n        for module in self:\r\n            input = module(input)\r\n                    ~~~~~~ <--- HERE\r\n        return input\r\n  File \"/work/submit/srothman/miniforge3/envs/torch/lib/python3.7/site-packages/torch/nn/modules/linear.py\", line 114, in forward\r\n    def forward(self, input: Tensor) -> Tensor:\r\n        return F.linear(input, self.weight, self.bias)\r\n               ~~~~~~~~ <--- HERE\r\nRuntimeError: mat1 and mat2 must have the same dtype, but got Int and Float\r\n```\r\n\r\nThis PR implements a workaround for this bug by wrapping all of the preshower-related calculations in some `if(number of ES hits > 0)` control flow.\r\n\r\nattn @kpedro88 ", "branch": "main", "changed_files": 2, "closed_at": "1764665671", "comments": 30, "commits": 1, "created_at": "1763318102", "deletions": 13, "labels": ["reconstruction-approved", "tests-approved", "orp-pending", "externals-approved", "fully-signed", "ml-approved"], "merge_commit_sha": "e06b7883e4d30e418b01955f58d1c72ce2378cd8", "merged_at": "1764665671", "merged_by": "smuzaffar", "number": 6, "release-notes": [], "review_comments": 0, "state": "closed", "title": "Workaround for typeing bug in newer torch/triton", "updated_at": "1764665672", "user": "ssrothman"}